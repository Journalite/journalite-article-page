exports.id=590,exports.ids=[590],exports.modules={31237:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},95218:e=>{e.exports={articleEditor:"ArticleEditor_articleEditor__Y7zhH",toolbar:"ArticleEditor_toolbar__7VR6u",toolbarButton:"ArticleEditor_toolbarButton__n6ugP",active:"ArticleEditor_active__l06wW",editorContent:"ArticleEditor_editorContent__IMeaV",editorStatus:"ArticleEditor_editorStatus__UViLo",fadeIn:"ArticleEditor_fadeIn__hSZwT"}},99590:(e,t,r)=>{"use strict";r.d(t,{A:()=>P});var n=r(60687),a=r(43210),i=r(16189),s=r(55511),o=r.n(s);let l=new Uint8Array(256),d=l.length,c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).substr(1));let u=function(e,t=0){let r=(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase();if(!("string"==typeof r&&c.test(r)))throw TypeError("Stringified UUID is invalid");return r},p=function(e,t,r){let n=(e=e||{}).random||(e.rng||function(){return d>l.length-16&&(o().randomFillSync(l),d=0),l.slice(d,d+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return u(n)};var g=r(79440),m=r(43649);class f{applyOperation(e,t){let r=JSON.parse(JSON.stringify(e));switch(t.type){case"INSERT_PARAGRAPH":return this.insertParagraph(r,t.sectionId,t.index,t.paragraph);case"REMOVE_PARAGRAPH":return this.removeParagraph(r,t.sectionId,t.paragraphId,t.index);case"UPDATE_PARAGRAPH":return this.updateParagraph(r,t.sectionId,t.paragraphId,t.updates);case"INSERT_SECTION":return this.insertSection(r,t.index,t.section);case"REMOVE_SECTION":return this.removeSection(r,t.sectionId,t.index);case"UPDATE_SECTION":return this.updateSection(r,t.sectionId,t.updates);default:return console.warn("Unknown operation type:",t.type),r}}applyOperations(e,t){return t.reduce((e,t)=>this.applyOperation(e,t),e)}insertParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn(`Section with ID ${t} not found`),e;let i={...n,id:n.id||p()};return e.sections[a].paragraphs.splice(r,0,i),e}removeParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn(`Section with ID ${t} not found`),e;let i=e.sections[a];if(n>=0&&n<i.paragraphs.length)if(i.paragraphs[n].id!==r){console.warn(`Paragraph ID mismatch at index ${n}`);let e=i.paragraphs.findIndex(e=>e.id===r);-1!==e&&i.paragraphs.splice(e,1)}else i.paragraphs.splice(n,1);return e}updateParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn(`Section with ID ${t} not found`),e;let i=e.sections[a].paragraphs.findIndex(e=>e.id===r);return -1===i?console.warn(`Paragraph with ID ${r} not found in section ${t}`):e.sections[a].paragraphs[i]={...e.sections[a].paragraphs[i],...n},e}insertSection(e,t,r){let n={...r,id:r.id||p()};return e.sections.splice(t,0,n),e}removeSection(e,t,r){if(r>=0&&r<e.sections.length)if(e.sections[r].id!==t){console.warn(`Section ID mismatch at index ${r}`);let n=e.sections.findIndex(e=>e.id===t);-1!==n&&e.sections.splice(n,1)}else e.sections.splice(r,1);return e}updateSection(e,t,r){let n=e.sections.findIndex(e=>e.id===t);return -1===n?console.warn(`Section with ID ${t} not found`):e.sections[n]={...e.sections[n],...r},e}addTextMark(e,t,r,n,a,i,s){let o=e.sections.findIndex(e=>e.id===t);if(-1===o)return e;let l=e.sections[o].paragraphs.findIndex(e=>e.id===r);if(-1===l)return e;let d={type:n,from:a,to:i,...s&&{attrs:s}},c=[...e.sections[o].paragraphs[l].marks,d];return this.updateParagraph(e,t,r,{marks:c})}removeTextMark(e,t,r,n,a,i){let s=e.sections.findIndex(e=>e.id===t);if(-1===s)return e;let o=e.sections[s].paragraphs.findIndex(e=>e.id===r);if(-1===o)return e;let l=e.sections[s].paragraphs[o].marks.filter(e=>e.type!==n||e.from!==a||e.to!==i);return this.updateParagraph(e,t,r,{marks:l})}splitParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return e;let i=e.sections[a].paragraphs.findIndex(e=>e.id===r);if(-1===i)return e;let s=e.sections[a].paragraphs[i],o=s.text.substring(0,n),l=s.marks.filter(e=>e.from<n).map(e=>({...e,to:Math.min(e.to,n)})),d=s.text.substring(n),c=s.marks.filter(e=>e.to>n).map(e=>({...e,from:Math.max(e.from-n,0),to:e.to-n})),h=this.updateParagraph(e,t,r,{text:o,marks:l}),u={id:p(),type:s.type,text:d,marks:c,level:s.level};return this.insertParagraph(h,t,i+1,u)}mergeParagraphs(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return e;let i=e.sections[a],s=i.paragraphs.findIndex(e=>e.id===r),o=i.paragraphs.findIndex(e=>e.id===n);if(-1===s||-1===o||o!==s+1)return e;let l=i.paragraphs[s],d=i.paragraphs[o],c=l.text+d.text,h=d.marks.map(e=>({...e,from:e.from+l.text.length,to:e.to+l.text.length})),u=[...l.marks,...h],p=this.updateParagraph(e,t,r,{text:c,marks:u});return this.removeParagraph(p,t,n,o)}}let I=new f;var C=r(6621);class v{initialize(e,t,r){this.model=e,this.editorElement=t,this.onChangeCallback=r||null,C.A.initialize(t,e),C.A.fullRender(e),this.attachEventListeners()}updateModel(e){this.model=e,C.A.fullRender(e)}attachEventListeners(){this.editorElement&&(this.editorElement.setAttribute("contenteditable","true"),this.editorElement.setAttribute("spellcheck","true"),this.editorElement.addEventListener("keydown",this.handleKeyDown),document.addEventListener("selectionchange",this.handleSelectionChange),this.editorElement.addEventListener("focus",this.handleFocus),this.editorElement.addEventListener("blur",this.handleBlur),this.editorElement.addEventListener("input",this.handleInput),this.editorElement.addEventListener("click",this.handleClick),this.editorElement.addEventListener("paste",this.handlePaste))}destroy(){this.editorElement&&(this.editorElement.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("selectionchange",this.handleSelectionChange),this.editorElement.removeEventListener("focus",this.handleFocus),this.editorElement.removeEventListener("blur",this.handleBlur),this.editorElement.removeEventListener("input",this.handleInput),this.editorElement.removeEventListener("click",this.handleClick),this.editorElement.removeEventListener("paste",this.handlePaste))}handleEnterKey(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.findCursorOffsetInParagraph();if(null===e)return;let t=I.splitParagraph(this.model,this.currentSectionId,this.currentParagraphId,e),r=t.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===r)return;let n=t.sections[r].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===n||n+1>=t.sections[r].paragraphs.length)return;let a=t.sections[r].paragraphs[n+1].id;this.model=t,C.A.fullRender(t),this.setCursorPosition(a,0),this.notifyChange()}handleBackspaceAtStart(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||0===t)return;let r=this.model.sections[e].paragraphs[t-1],n=r.text.length,a=I.mergeParagraphs(this.model,this.currentSectionId,r.id,this.currentParagraphId);this.model=a,C.A.fullRender(a),this.setCursorPosition(r.id,n),this.currentParagraphId=r.id,this.notifyChange()}handleDeleteAtEnd(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||t>=this.model.sections[e].paragraphs.length-1)return;let r=this.model.sections[e].paragraphs[t].text.length,n=this.model.sections[e].paragraphs[t+1],a=I.mergeParagraphs(this.model,this.currentSectionId,this.currentParagraphId,n.id);this.model=a,C.A.fullRender(a),this.setCursorPosition(this.currentParagraphId,r),this.notifyChange()}toggleFormat(e){let t;if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let r=window.getSelection();if(!r||r.isCollapsed)return;let{startOffset:n,endOffset:a}=this.getSelectionOffsets();if(null===n||null===a)return;let i=this.findParagraphById(this.currentParagraphId);if(!i)return;let s=i.marks.find(t=>t.type===e&&t.from<=n&&t.to>=a);t=s?I.removeTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,s.from,s.to):I.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,n,a),this.model=t,C.A.fullRender(t),this.setTextSelection(this.currentParagraphId,n,a),this.notifyChange()}insertLink(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=window.getSelection();if(!e||e.isCollapsed)return;let{startOffset:t,endOffset:r}=this.getSelectionOffsets();if(null===t||null===r)return;let n=window.prompt("Enter URL:");if(!n)return;let a=I.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,"link",t,r,{href:n});this.model=a,C.A.fullRender(a),this.setTextSelection(this.currentParagraphId,t,r),this.notifyChange()}updateCurrentParagraphAndSection(){let e=window.getSelection();if(!e||!e.anchorNode){this.currentParagraphId=null,this.currentSectionId=null;return}let t=e.anchorNode.nodeType===Node.ELEMENT_NODE?e.anchorNode:e.anchorNode.parentElement;for(;t&&!t.hasAttribute("data-paragraph-id");)t=t.parentElement;if(!t){this.currentParagraphId=null,this.currentSectionId=null;return}this.currentParagraphId=t.getAttribute("data-paragraph-id");let r=t.parentElement;for(;r&&!r.hasAttribute("data-section-id");)r=r.parentElement;if(!r){this.currentSectionId=null;return}this.currentSectionId=r.getAttribute("data-section-id")}isAtStartOfParagraph(){let e=window.getSelection();return!!e&&!!e.anchorNode&&!!e.isCollapsed&&(e.anchorNode.nodeType===Node.TEXT_NODE,0===e.anchorOffset)}isAtEndOfParagraph(){let e=window.getSelection();if(!e||!e.anchorNode||!e.isCollapsed)return!1;if(e.anchorNode.nodeType===Node.TEXT_NODE)return e.anchorOffset===e.anchorNode.textContent?.length;let t=e.anchorNode;return e.anchorOffset===t.childNodes.length}findCursorOffsetInParagraph(){if(!this.currentParagraphId||!this.model)return null;let e=window.getSelection();if(!e||!e.isCollapsed)return null;let t=this.findParagraphById(this.currentParagraphId);if(!t)return null;let r=document.querySelector(`[data-paragraph-id="${this.currentParagraphId}"]`);return r?e.anchorNode?.nodeType===Node.TEXT_NODE&&e.anchorNode.parentNode===r?e.anchorOffset:t.text.length:null}findParagraphById(e){if(!this.model)return null;for(let t of this.model.sections){let r=t.paragraphs.find(t=>t.id===e);if(r)return r}return null}setCursorPosition(e,t){let r=document.querySelector(`[data-paragraph-id="${e}"]`);if(!r)return;let n=document.createRange(),a=window.getSelection();0===t?(n.setStart(r,0),n.collapse(!0)):(n.selectNodeContents(r),n.collapse(!1)),a&&(a.removeAllRanges(),a.addRange(n))}setTextSelection(e,t,r){let n=document.querySelector(`[data-paragraph-id="${e}"]`);if(!n)return;let a=document.createRange(),i=window.getSelection();a.selectNodeContents(n),i&&(i.removeAllRanges(),i.addRange(a))}getSelectionOffsets(){return{startOffset:0,endOffset:0}}notifyChange(){this.onChangeCallback&&this.model&&this.onChangeCallback(this.model)}constructor(){this.model=null,this.editorElement=null,this.selectionState={anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!0},this.onChangeCallback=null,this.focusedElement=null,this.currentParagraphId=null,this.currentSectionId=null,this.handleKeyDown=e=>{if(this.model)switch(this.updateCurrentParagraphAndSection(),e.key){case"Enter":e.shiftKey||(e.preventDefault(),this.handleEnterKey());break;case"Backspace":this.isAtStartOfParagraph()&&(e.preventDefault(),this.handleBackspaceAtStart());break;case"Delete":this.isAtEndOfParagraph()&&(e.preventDefault(),this.handleDeleteAtEnd());break;case"b":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("bold"));break;case"i":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("italic"));break;case"`":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("code"));break;case"k":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.insertLink())}},this.handleSelectionChange=()=>{let e=window.getSelection();e&&(this.selectionState={anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset,isCollapsed:e.isCollapsed},this.updateCurrentParagraphAndSection())},this.handleFocus=e=>{this.focusedElement=e.target,this.updateCurrentParagraphAndSection()},this.handleBlur=()=>{this.focusedElement=null},this.handleInput=e=>{if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let t=e.target.textContent||"",r={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:t}},n=I.applyOperation(this.model,r);this.model=n,this.notifyChange()},this.handleClick=()=>{this.updateCurrentParagraphAndSection()},this.handlePaste=e=>{if(e.preventDefault(),!this.model||!this.currentParagraphId||!this.currentSectionId||!e.clipboardData)return;let t=e.clipboardData.getData("text/plain"),r=window.getSelection();if(!r||!r.rangeCount)return;r.getRangeAt(0);let n=this.findParagraphById(this.currentParagraphId);if(!n)return;let a=this.findCursorOffsetInParagraph();if(null===a)return;let i=n.text.substring(0,a)+t+n.text.substring(a),s={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:i}},o=I.applyOperation(this.model,s);this.model=o,C.A.applyOperation(o,s),this.notifyChange(),this.setCursorPosition(this.currentParagraphId,a+t.length)}}}let x=new v;var S=r(95218),_=r.n(S);let y=({articleId:e,initialHtml:t="",onChange:r})=>{let i=(0,a.useRef)(null),[s,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)({id:e,title:"",sections:[{id:p(),type:"section",paragraphs:[{id:p(),type:"paragraph",text:"",marks:[]}]}]});(0,a.useEffect)(()=>{if(i.current&&!s){if(t&&t.trim())try{let r=t.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),n=document.createElement("div");n.innerHTML=r;let a=Array.from(n.children).map(e=>{let t=e.tagName.toLowerCase(),r="paragraph";"h1"===t||"h2"===t||"h3"===t?r="heading":"blockquote"===t?r="blockquote":"ul"===t?r="bulletList":"ol"===t?r="orderedList":"li"===t?r="listItem":"img"===t&&(r="image");let n=e.textContent||"",a=[];e.querySelector("strong, b")&&a.push({type:"bold",from:0,to:n.length}),e.querySelector("em, i")&&a.push({type:"italic",from:0,to:n.length});let i={id:p(),type:r,text:n,marks:a};return"heading"===r&&("h1"===t?i.level=1:"h2"===t?i.level=2:"h3"===t&&(i.level=3)),"image"===r&&(i.src=e.getAttribute("src")||""),i});0===a.length&&a.push({id:p(),type:"paragraph",text:"",marks:[]});let i={id:e,title:"",sections:[{id:p(),type:"section",paragraphs:a}]};d(i)}catch(e){console.error("Error parsing initial HTML:",e)}return setTimeout(()=>{if(i.current){if(i.current.innerHTML="",x.initialize(l,i.current,c),t&&t.trim()){let e=t.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");i.current.innerHTML=e;let r=document.createRange(),n=window.getSelection();if(i.current.childNodes.length>0){let e=i.current.lastChild;e&&(r.setStartAfter(e),r.collapse(!0),n&&(n.removeAllRanges(),n.addRange(r)))}}else i.current.innerHTML="<p><br></p>";o(!0)}},50),()=>{x.destroy()}}},[e,t]);let c=e=>{d(e),r&&i.current&&r(i.current.innerHTML.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),e)},h=e=>{document.execCommand("formatBlock",!1,`h${e}`),i.current&&i.current.focus()};return(0,n.jsxs)("div",{className:_().articleEditor,children:[(0,n.jsxs)("div",{className:_().toolbar,children:[(0,n.jsx)("button",{className:_().toolbarButton,onClick:()=>{document.execCommand("bold",!1),i.current&&i.current.focus()},title:"Bold (Ctrl+B)",children:"B"}),(0,n.jsx)("button",{className:_().toolbarButton,onClick:()=>{document.execCommand("italic",!1),i.current&&i.current.focus()},title:"Italic (Ctrl+I)",children:"I"}),(0,n.jsx)("button",{className:_().toolbarButton,onClick:()=>h(1),title:"Heading 1",children:"H1"}),(0,n.jsx)("button",{className:_().toolbarButton,onClick:()=>h(2),title:"Heading 2",children:"H2"}),(0,n.jsx)("button",{className:_().toolbarButton,onClick:()=>h(3),title:"Heading 3",children:"H3"})]}),(0,n.jsx)("div",{ref:i,className:_().editorContent,contentEditable:!0,"aria-label":"Article editor",suppressContentEditableWarning:!0,onFocus:()=>{if(i.current&&""===i.current.innerHTML){i.current.innerHTML="<p><br></p>";let e=document.createRange(),t=window.getSelection(),r=i.current.querySelector("p");r&&(e.setStart(r,0),e.collapse(!0),t&&(t.removeAllRanges(),t.addRange(e)))}},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){e.preventDefault(),document.execCommand("insertParagraph",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).startContainer.parentElement;e&&"div"===e.tagName.toLowerCase()&&document.execCommand("formatBlock",!1,"p")}return i.current&&r&&r(i.current.innerHTML,l),!1}},onPaste:e=>{if("true"===e.nativeEvent.clipboardData?.getData("text/html-editor-match-style")||e.nativeEvent.clipboardData?.types.includes("text/html-editor-match-style")){e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}i.current&&r&&setTimeout(()=>{i.current&&r(i.current.innerHTML,l)},0)}})]})};var E=r(31237),A=r.n(E);let P=({articleId:e})=>{let t=(0,i.useRouter)(),[r,s]=(0,a.useState)(""),[o,l]=(0,a.useState)(""),[d,c]=(0,a.useState)([]),[h,u]=(0,a.useState)(""),[f,I]=(0,a.useState)(!1),[C,v]=(0,a.useState)(!1),[x,S]=(0,a.useState)(!1),[_,E]=(0,a.useState)(""),[P,b]=(0,a.useState)(!!e),[w,N]=(0,a.useState)(null),[k,T]=(0,a.useState)(""),[L,D]=(0,a.useState)(null),R=(0,a.useRef)(null),B=(0,a.useRef)(null),O=(0,a.useCallback)(()=>{R.current&&(R.current.style.height="auto",R.current.style.height=`${R.current.scrollHeight}px`,!r&&R.current&&R.current.focus())},[r]);(0,a.useEffect)(()=>{let e=m.j2.onAuthStateChanged(e=>{N(e),e||t.push("/login?redirect=compose")});return()=>e()},[t]),(0,a.useEffect)(()=>{e&&w?(async()=>{try{b(!0);let r=await (0,g.zE)(e);if(!r){E("Article not found"),t.push("/");return}if(r.authorId!==w.uid){E("You can only edit your own articles"),t.push("/");return}s(r.title);let n=r.body.replace(/data-[\w-]+="[^"]*"/g,"");l(n),c(r.tags||[]),u(r.coverImage||"");let a={id:e,title:r.title,sections:[{id:p(),type:"section",paragraphs:[]}]};D(a)}catch(e){console.error("Error loading article:",e),E("Failed to load article")}finally{b(!1)}})():e||D({id:p(),title:"",sections:[{id:p(),type:"section",paragraphs:[{id:p(),type:"paragraph",text:"",marks:[]}]}]})},[e,w,t]),(0,a.useEffect)(()=>{O()},[r,O]),(0,a.useEffect)(()=>{let e;return w&&r.trim()&&o.trim()&&!C&&!f&&(e=setTimeout(()=>{K("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[w,r,o,C,f]);let j=()=>{let e=k.trim().toLowerCase();e&&!d.includes(e)&&d.length<5&&(c([...d,e]),T(""))},H=e=>{c(d.filter(t=>t!==e))},M=(0,a.useRef)(null),K=async(n="drafts")=>{if(!w)return void E("You must be logged in to save an article");if(!r.trim())return void E("Title is required");if(!o.trim())return void E("Content is required");try{v(!0),E("");let a=o.replace(/data-[\w-]+="[^"]*"/g,""),i={title:r.trim(),body:a,tags:d,coverImage:h.trim(),status:n};if(console.log("Saving article data:",i),e)await (0,g.iZ)(e,i),"published"===n?(S(!0),setTimeout(()=>{t.push(`/articles/${e}`)},1e3)):(S(!0),setTimeout(()=>S(!1),3e3));else{let e=await (0,g.N6)(i);"published"===n?t.push(`/articles/${e.id}`):t.push("/dashboard")}}catch(e){console.error("Error saving article:",e),E("Failed to save article. Please try again.")}finally{v(!1),I(!1)}},U=async()=>{if(!o.trim())return void E("Content is required");I(!0),await K("published")},$=async()=>{await K("drafts")};return P?(0,n.jsxs)("div",{className:A().composerLoading,children:[(0,n.jsx)("div",{className:A().loadingIndicator}),(0,n.jsx)("p",{children:"Loading article..."})]}):(0,n.jsxs)("div",{className:A().articleComposer,children:[(0,n.jsxs)("header",{className:A().composerHeader,children:[(0,n.jsx)("div",{className:A().logoContainer,children:(0,n.jsx)("div",{className:A().logo,children:"Journalite"})}),(0,n.jsxs)("div",{className:A().actionButtons,children:[x&&(0,n.jsxs)("span",{className:A().savedIndicator,children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,n.jsx)("button",{className:A().actionButton,onClick:$,disabled:C||f,children:"Save draft"}),(0,n.jsx)("button",{className:A().publishButton,onClick:U,disabled:C||f||!r.trim()||!o.trim(),children:e?"Update":"Publish"})]})]}),(0,n.jsxs)("main",{className:A().composerContent,children:[(0,n.jsx)("textarea",{ref:R,className:A().titleInput,value:r,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),M.current&&M.current.focus())},placeholder:"Title",rows:1}),(0,n.jsxs)("div",{className:A().coverImageInput,children:[(0,n.jsx)("input",{type:"text",value:h,onChange:e=>{u(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:A().imageUrlInput}),h&&(0,n.jsx)("div",{className:A().coverImagePreview,children:(0,n.jsx)("img",{src:h,alt:"Cover preview"})})]}),(0,n.jsxs)("div",{className:A().tagContainer,children:[d.map(e=>(0,n.jsxs)("div",{className:A().tag,children:[e,(0,n.jsx)("button",{className:A().removeTagButton,onClick:()=>H(e),"aria-label":`Remove ${e} tag`,children:"\xd7"})]},e)),d.length<5&&(0,n.jsx)("input",{ref:B,type:"text",value:k,onChange:e=>{T(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),j())},onBlur:j,placeholder:0===d.length?"Add up to 5 tags...":"Add another tag...",className:A().tagInput})]}),_&&(0,n.jsx)("div",{className:A().errorMessage,children:_}),L&&(0,n.jsx)("div",{className:A().editorContainer,ref:M,children:(0,n.jsx)(y,{articleId:L.id,initialHtml:o,onChange:(e,t)=>{e!==o&&(l(e),D(t),x&&S(!1))}})})]})]})}}};