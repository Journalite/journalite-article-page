(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7160],{3201:(t,e,r)=>{"use strict";r.d(e,{db:()=>c,j2:()=>s});var o=r(3915),n=r(6864),l=r(6203),a=r(5317);let i=(0,o.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,n.P5)(i)}catch(t){}let s=(0,l.xI)(i),c=(0,a.aU)(i);window.location.origin},5901:t=>{t.exports={editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",toolbar:"Editor_toolbar__aaOo7",toolbarGroup:"Editor_toolbarGroup__dOvRT",toolbarButton:"Editor_toolbarButton__hmThZ",active:"Editor_active__UGSnI",keyboardHint:"Editor_keyboardHint__u082F",editorContent:"Editor_editorContent__Hto0I",ProseMirror:"Editor_ProseMirror__DHY3Q",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},7160:(t,e,r)=>{"use strict";r.d(e,{A:()=>O});var o=r(5155),n=r(2115),l=r(5695),a=r(621),i=r(9210),s=r(3201);r(4488);var c=r(2571),u=r(2695),d=r(290),g=r(1514),h=r(7729),m=r(156);let p=new m.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:t=>["h".concat(t.attrs.level),0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt"),width:t.getAttribute("width"),height:t.getAttribute("height")})}],toDOM(t){let{src:e,alt:r,title:o,width:n,height:l}=t.attrs,a={src:e};return null!=r&&(a.alt=r),null!=o&&(a.title=o),null!=n&&(a.width=n),null!=l&&(a.height=l),["img",a]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1==t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!=t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title"),target:t.getAttribute("target")})}],toDOM(t){let{href:e,title:r,target:o}=t.attrs,n={href:e};return null!=r&&(n.title=r),null!=o&&(n.target=o),["a",n,0]}}}});function f(){return p.node("doc",null,[p.node("paragraph")])}var b=r(6770),y=r(3929),w=r(7421),_=r(8754);let v=(t,e)=>(r,o,n)=>{let l=!1;(0,g.T2)(e)(r,o,n)&&(r=n.state,l=!0);let a=t(r,o,n);return l||a},{heading:C,paragraph:k,list_item:E,blockquote:x}=p.nodes,A=t=>v((0,d.y_)(C,{level:t}),E),I=()=>v((0,d.y_)(k),E),M=(t,e,r)=>{let{from:o,to:n}=t.selection,l=!1;return(t.doc.nodesBetween(o,n,t=>t.type!==x||(l=!0,!1)),l)?!!(0,g.T2)(E)(t,e)||(0,d.yY)(t,e):((0,g.T2)(E)(t,e)&&(t=r.state),(0,d.Im)(x)(t,e,r))},j=new c.k_({key:new c.hs("exitHeading"),props:{handleKeyDown(t,e){if("Enter"!==e.key||e.shiftKey)return!1;let{state:r,dispatch:o}=t,{$from:n,empty:l}=r.selection,{heading:a,paragraph:i}=p.nodes;return!!l&&n.parent.type===a&&n.parentOffset===n.parent.content.size&&(e.preventDefault(),(0,d.y_)(i)(r,o,t))}}});var N=r(5901),S=r.n(N);let D=t=>{let{articleId:e,initialContent:r="",onChange:l,placeholder:a="Tell your story...",className:i=""}=t,s=(0,n.useRef)(null),v=(0,n.useRef)(null),[C,k]=(0,n.useState)(!1),[,E]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(console.log("Editor: useEffect running on client"),console.log("Editor: editorRef.current:",s.current),console.log("Editor: viewRef.current:",v.current),!s.current)return void console.log("Editor: editorRef.current is null, cannot initialize");if(v.current)return void console.log("Editor: viewRef.current already exists, skipping");try{let t;console.log("Editor: Starting initialization...");try{if(r)if(r.startsWith("{")){let e=JSON.parse(r);t=p.nodeFromJSON(e)}else{let e=r.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");t=function(t){if(!t||""===t.trim())return f();let e=document.createElement("div");return e.innerHTML=t,m.S4.fromSchema(p).parse(e)}(e)}else t=f();console.log("Editor: Initial document created successfully")}catch(e){console.error("Error parsing initial content:",e),t=f()}t||(console.error("Failed to create initial document"),t=f()),console.log("Editor: Creating editor state...");let e=c.$t.create({doc:t,plugins:function(){console.log("Creating ProseMirror plugins...");let t=function(){console.log("Building input rules plugin...");let t=[];t.push(y.gO),console.log("Added basic smart text rules");let e=(0,y.tG)(/^([-+*])\s$/,p.nodes.bullet_list,t=>null,(t,e)=>({tight:!0}));t.push(e),console.log("Added bullet list rule");let r=(0,y.tG)(/^(\d+)\.\s$/,p.nodes.ordered_list,t=>({order:+t[1]}),(t,e)=>({tight:!0}));t.push(r),console.log("Added ordered list rule");let o=(0,y.JJ)(/^(#{1,6})\s$/,p.nodes.heading,t=>({level:t[1].length}));t.push(o),console.log("Added heading rule");let n=(0,y.tG)(/^>\s$/,p.nodes.blockquote);t.push(n),console.log("Added blockquote rule");let l=(0,y.JJ)(/^```$/,p.nodes.code_block);t.push(l),console.log("Added code block rule"),console.log("Total input rules created:",t.length);let a=(0,y.sM)({rules:t});return console.log("Input rules plugin created successfully"),a}();console.log("Input rules plugin ready");let e=(0,h.b6)();console.log("History plugin ready");let r=function(){let t={...d.RV,"Mod-b":(0,d.wh)(p.marks.strong),"Mod-i":(0,d.wh)(p.marks.em),"Mod-0":I(),"Mod-Shift-1":A(1),"Mod-Shift-2":A(2),"Mod-Shift-3":A(3),"Mod-Shift-4":A(4),"Mod-Shift-5":A(5),"Mod-Shift-6":A(6),"Mod->":M,"Shift-Ctrl->":M,"Shift-Ctrl-8":(0,g.Sd)(p.nodes.bullet_list),"Shift-Ctrl-9":(0,g.Sd)(p.nodes.ordered_list),Enter:(0,g.wn)(p.nodes.list_item),"Mod-[":(0,g.T2)(p.nodes.list_item),"Mod-]":(0,g.$B)(p.nodes.list_item),Backspace:(t,e,r)=>{let{$from:o,empty:n}=t.selection;if(n&&o.parent.type===p.nodes.list_item&&0===o.parentOffset&&0===o.parent.content.size){if(e&&!(0,g.T2)(p.nodes.list_item)(t,e)){let r=t.tr,n=o.blockRange();n&&(r.setBlockType(n.start,n.end,p.nodes.paragraph),e(r))}return!0}return!1},"Mod-z":h.tN,"Mod-y":h.ZS,"Shift-Mod-z":h.ZS};return(0,b.w)(t)}();console.log("Keymap plugin ready");let o=(0,w.A)();console.log("Drop cursor plugin ready");let n=(0,_.z)();console.log("Gap cursor plugin ready"),console.log("Exit heading plugin ready");let l=[t,e,r,o,n,j];return console.log("All plugins created. Total count:",l.length),l}()});console.log("Editor: Creating editor view...");let o=new u.Lz(s.current,{state:e,dispatchTransaction:t=>{let e=o.state.apply(t);if(o.updateState(e),t.docChanged&&l){let t=function(t){let e=document.createElement("div");return e.appendChild(m.ZF.fromSchema(p).serializeFragment(t.content)),e.innerHTML}(e.doc),r=e.doc.toJSON();l(t,r)}(t.docChanged||t.selectionSet)&&E(t=>t+1)},attributes:{class:"".concat(S().prosemirrorEditor," prosemirror-content"),"data-placeholder":a,contenteditable:"true",role:"textbox","aria-multiline":"true"},editable:()=>!0,handleDOMEvents:{focus:(t,e)=>(console.log("Editor focused"),!1),blur:(t,e)=>(console.log("Editor blurred"),!1)}});console.log("Editor: EditorView created successfully"),v.current=o,k(!0),console.log("Editor: setIsReady(true) called - editor should now be visible")}catch(t){console.error("Error initializing editor:",t),console.error("Error details:",t.message,t.stack),k(!0)}return()=>{v.current&&(console.log("Editor: Cleaning up view"),v.current.destroy(),v.current=null)}},[]);let x=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,d.wh)(p.marks.strong)(t,e,v.current),v.current.focus()},[]),N=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,d.wh)(p.marks.em)(t,e,v.current),v.current.focus()},[]),D=(0,n.useCallback)(t=>{if(!v.current)return;let{state:e,dispatch:r}=v.current;A(t)(e,r,v.current),v.current.focus()},[]),B=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;I()(t,e,v.current),v.current.focus()},[]),T=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;M(t,e,v.current),v.current.focus()},[E]),O=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,d.y_)(p.nodes.code_block)(t,e,v.current),v.current.focus()},[]),U=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,g.Sd)(p.nodes.bullet_list)(t,e,v.current),v.current.focus()},[]),H=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,g.Sd)(p.nodes.ordered_list)(t,e,v.current),v.current.focus()},[]),G=(0,n.useCallback)(()=>{let t=prompt("Enter image URL:");if(t&&v.current){let{state:e,dispatch:r}=v.current,o=p.nodes.image.create({src:t,alt:""});r(e.tr.replaceSelectionWith(o)),v.current.focus()}},[]),P=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,h.tN)(t,e),v.current.focus()},[]),z=(0,n.useCallback)(()=>{if(!v.current)return;let{state:t,dispatch:e}=v.current;(0,h.ZS)(t,e),v.current.focus()},[]),R=(0,n.useCallback)(t=>{if(!v.current)return!1;let{from:e,$from:r,to:o,empty:n}=v.current.state.selection;return n?t.isInSet(v.current.state.storedMarks||r.marks()):v.current.state.doc.rangeHasMark(e,o,t)},[E]),L=(0,n.useCallback)(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!v.current)return!1;let{from:r,to:o}=v.current.state.selection,n=!0;return v.current.state.doc.nodesBetween(r,o,r=>!r.isTextblock||!!r.hasMarkup(t,e)||(n=!1,!1)),n},[E]),J=(0,n.useCallback)(()=>{if(!v.current)return!1;let{from:t,to:e}=v.current.state.selection,r=!1;return v.current.state.doc.nodesBetween(t,e,t=>t.type!==p.nodes.blockquote||(r=!0,!1)),r},[E]);return(0,o.jsxs)("div",{className:"".concat(S().editor," ").concat(i),children:[C?(0,o.jsxs)("div",{className:S().toolbar,children:[(0,o.jsxs)("div",{className:S().toolbarGroup,children:[(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(R(p.marks.strong)?S().active:""),onClick:x,title:"Bold (⌘/Ctrl+B)",children:(0,o.jsx)("strong",{children:"B"})}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(R(p.marks.em)?S().active:""),onClick:N,title:"Italic (⌘/Ctrl+I)",children:(0,o.jsx)("em",{children:"I"})})]}),(0,o.jsxs)("div",{className:S().toolbarGroup,children:[(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(L(p.nodes.paragraph)?S().active:""),onClick:B,title:"Paragraph (⌘/Ctrl+0)",children:"P"}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(L(p.nodes.heading,{level:1})?S().active:""),onClick:()=>D(1),title:"Heading 1 (⌘/Ctrl+Shift+1)",children:"H1"}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(L(p.nodes.heading,{level:2})?S().active:""),onClick:()=>D(2),title:"Heading 2 (⌘/Ctrl+Shift+2)",children:"H2"}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(L(p.nodes.heading,{level:3})?S().active:""),onClick:()=>D(3),title:"Heading 3 (⌘/Ctrl+Shift+3)",children:"H3"})]}),(0,o.jsxs)("div",{className:S().toolbarGroup,children:[(0,o.jsx)("button",{className:S().toolbarButton,onClick:U,title:"Bullet List",children:"• List"}),(0,o.jsx)("button",{className:S().toolbarButton,onClick:H,title:"Ordered List",children:"1. List"}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(J()?S().active:""),onClick:T,title:"Blockquote (⌘/Ctrl+>)",children:'" Quote'}),(0,o.jsx)("button",{className:"".concat(S().toolbarButton," ").concat(L(p.nodes.code_block)?S().active:""),onClick:O,title:"Code Block",children:"</>"})]}),(0,o.jsx)("div",{className:S().toolbarGroup,children:(0,o.jsx)("button",{className:S().toolbarButton,onClick:G,title:"Insert Image",children:"\uD83D\uDDBC️ Image"})}),(0,o.jsxs)("div",{className:S().toolbarGroup,children:[(0,o.jsx)("button",{className:S().toolbarButton,onClick:P,title:"Undo (⌘/Ctrl+Z)",children:"↶ Undo"}),(0,o.jsx)("button",{className:S().toolbarButton,onClick:z,title:"Redo (⌘/Ctrl+Y)",children:"↷ Redo"})]}),(0,o.jsxs)("div",{className:S().keyboardHint,children:[(0,o.jsx)("kbd",{children:"⌘B"})," Bold \xa0 ",(0,o.jsx)("kbd",{children:"⌘I"})," Italic \xa0 ",(0,o.jsx)("kbd",{children:"⌘⇧1-3"})," Headings"]})]}):(0,o.jsx)("div",{className:S().loading,children:"Loading editor..."}),(0,o.jsx)("div",{ref:s,className:"ProseMirror ".concat(S().editorContent),"aria-label":"Rich text editor",style:{minHeight:"300px",opacity:C?1:.5}})]})};var B=r(9396),T=r.n(B);let O=t=>{let{articleId:e,onUpdateComplete:r}=t,c=(0,l.useRouter)(),[u,d]=(0,n.useState)(""),[g,h]=(0,n.useState)(""),[m,p]=(0,n.useState)([]),[f,b]=(0,n.useState)(""),[y,w]=(0,n.useState)(!1),[_,v]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),[E,x]=(0,n.useState)(""),[A,I]=(0,n.useState)(!!e),[M,j]=(0,n.useState)(null),[N,S]=(0,n.useState)(""),B=(0,n.useRef)(null),O=(0,n.useRef)(null),U=(0,n.useCallback)(()=>{B.current&&(B.current.style.height="auto",B.current.style.height="".concat(B.current.scrollHeight,"px"),!u&&B.current&&B.current.focus())},[u]);(0,n.useEffect)(()=>{let t=s.j2.onAuthStateChanged(t=>{j(t),t||c.push("/login?redirect=compose")});return()=>t()},[c]),(0,n.useEffect)(()=>{e&&M?(async()=>{try{I(!0);let t=await (0,i.zE)(e);if(!t){x("Article not found"),c.push("/");return}if(t.authorId!==M.uid){x("You can only edit your own articles"),c.push("/");return}d(t.title);let r=t.body.replace(/data-[\w-]+="[^"]*"/g,"");h(r),p(t.tags||[]),b(t.coverImage||"")}catch(t){console.error("Error loading article:",t),x("Failed to load article")}finally{I(!1)}})():e||I(!1)},[e,M,c]),(0,n.useEffect)(()=>{U()},[u,U]),(0,n.useEffect)(()=>{let t;return M&&u.trim()&&g.trim()&&!_&&!y&&(t=setTimeout(()=>{z("drafts")},3e4)),()=>{t&&clearTimeout(t)}},[M,u,g,_,y]);let H=(0,n.useCallback)((t,e)=>{t!==g&&(h(t),C&&k(!1))},[g,C]),G=()=>{let t=N.trim().toLowerCase();t&&!m.includes(t)&&m.length<5&&(p([...m,t]),S(""))},P=t=>{p(m.filter(e=>e!==t))},z=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!M)return void x("You must be logged in to save an article");if(!u.trim())return void x("Title is required");if(!g.trim())return void x("Content is required");try{v(!0),x("");let o=g.replace(/data-[\w-]+="[^"]*"/g,""),n={title:u.trim(),body:o,tags:m,coverImage:f.trim(),status:t};if(console.log("Saving article data:",n),e)try{let t=await (0,i.iZ)(e,n);console.log("Article updated successfully:",null==t?void 0:t.title),k(!0),await new Promise(t=>setTimeout(t,500));let o=await (0,i.zE)(e);console.log("Fetched updated article data:",null==o?void 0:o.title),r&&r(o),setTimeout(()=>{console.log("Applying changes immediately and redirecting to article ID page"),window.location.href="/articles/".concat(e,"/view?updated=true&time=").concat(Date.now()),setTimeout(()=>{window.location.pathname.includes("/edit")&&(console.log("Fallback navigation to ID-based article page"),window.location.href="/articles/".concat(e,"?updated=true&time=").concat(Date.now()))},2e3)},1e3)}catch(t){console.error("Error updating article:",t),x("Failed to update article. Please try again."),k(!1)}else{let e=await (0,i.N6)(n);"published"===t?c.push("/articles/".concat(e.id)):c.push("/dashboard")}}catch(t){console.error("Error saving article:",t),x("Failed to save article. Please try again.")}finally{v(!1),w(!1)}},R=async()=>{if(!g.trim())return void x("Content is required");w(!0),await z("published")},L=async()=>{await z("drafts")};return A?(0,o.jsxs)("div",{className:T().composerLoading,children:[(0,o.jsx)("div",{className:T().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):(0,o.jsxs)("div",{className:T().articleComposer,children:[(0,o.jsxs)("header",{className:T().composerHeader,children:[(0,o.jsx)("div",{className:T().logoContainer,children:(0,o.jsx)("div",{className:T().logo,children:"Journalite"})}),(0,o.jsxs)("div",{className:T().actionButtons,children:[C&&(0,o.jsxs)("span",{className:T().savedIndicator,children:[(0,o.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,o.jsx)("button",{className:T().actionButton,onClick:L,disabled:_||y,children:"Save draft"}),(0,o.jsx)("button",{className:T().publishButton,onClick:R,disabled:_||y||!u.trim()||!g.trim(),children:e?"Update":"Publish"})]})]}),(0,o.jsxs)("main",{className:T().composerContent,children:[(0,o.jsx)("textarea",{ref:B,className:T().titleInput,value:u,onChange:t=>{d(t.target.value)},onKeyDown:t=>{"Enter"===t.key&&t.preventDefault()},placeholder:"Title",rows:1}),(0,o.jsxs)("div",{className:T().coverImageInput,children:[(0,o.jsx)("input",{type:"text",value:f,onChange:t=>{b(t.target.value)},placeholder:"Add a cover image (enter image URL)",className:T().imageUrlInput}),f&&(0,o.jsx)("div",{className:T().coverImagePreview,children:(0,o.jsx)("img",{src:f,alt:"Cover preview"})})]}),(0,o.jsxs)("div",{className:T().tagContainer,children:[m.map(t=>(0,o.jsxs)("div",{className:T().tag,children:[t,(0,o.jsx)("button",{className:T().removeTagButton,onClick:()=>P(t),"aria-label":"Remove ".concat(t," tag"),children:"\xd7"})]},t)),m.length<5&&(0,o.jsx)("input",{ref:O,type:"text",value:N,onChange:t=>{S(t.target.value)},onKeyDown:t=>{("Enter"===t.key||","===t.key)&&(t.preventDefault(),G())},onBlur:G,placeholder:0===m.length?"Add up to 5 tags...":"Add another tag...",className:T().tagInput})]}),E&&(0,o.jsx)("div",{className:T().errorMessage,children:E}),(0,o.jsx)("div",{className:T().editorContainer,children:(0,o.jsx)(D,{articleId:e||(0,a.A)(),initialContent:g,onChange:H,placeholder:"Tell your story..."})})]})]})}},9210:(t,e,r)=>{"use strict";r.d(e,{BC:()=>g,GE:()=>a,N6:()=>c,Oe:()=>h,S1:()=>b,Tu:()=>p,a:()=>f,fz:()=>d,iZ:()=>u,l6:()=>s,tT:()=>m,zE:()=>i});var o=r(5317),n=r(3201),l=r(9995);async function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:e,includeDrafts:r=!1}=t;console.log("getArticles called with limit:",e);try{let t=(0,o.rJ)(n.db,"articles"),l=[];r||l.push((0,o._M)("status","==","published")),l.push((0,o.My)("createdAt","desc")),e&&e>0&&(console.log("Adding limit constraint:",e),l.push((0,o.AB)(e)));let a=(0,o.P)(t,...l),i=await (0,o.GG)(a);console.log("Query returned document count:",i.size);let s=[];return i.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function i(t){try{let l=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(t," (time: ").concat(l,")"));let a=(0,o.H9)(n.db,"articles",t),i=await (0,o.x7)(a);if(!i.exists())return console.log("❌ Article not found for ID:",t),null;{var e,r;let t={id:i.id,...i.data()};return console.log("✅ Article found:",t.title),console.log("\uD83D\uDCC4 Content length:",(null==(e=t.body)?void 0:e.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(r=t.tags)?void 0:r.join(", "))||"none"),t}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function s(t){try{console.log("Getting article by slug: ".concat(t,", timestamp: ").concat(Date.now()));let r=0;for(;r<2;){r++,console.log("Attempt ".concat(r," to get article by slug")),r>1&&await new Promise(t=>setTimeout(t,500));let l=(0,o.rJ)(n.db,"articles"),a=(0,o.P)(l,(0,o._M)("slug","==",t),(0,o._M)("status","==","published")),i=await (0,o.GG)(a);if(i.empty){if(r>=2){console.log("Article not found for slug after multiple attempts:",t);break}}else{var e;let t=i.docs[0],r={id:t.id,...t.data()};return console.log("Article found by slug:",r.title,"Content length:",(null==(e=r.body)?void 0:e.length)||0),r}console.log("Article not found by slug on attempt ".concat(r,", will retry..."))}return null}catch(t){throw console.error("Error getting article by slug:",t),t}}async function c(t){try{var e;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let l={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Dc.now(),authorId:r.uid,authorName:r.displayName||(null==(e=r.email)?void 0:e.split("@")[0])||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"articles"),l)).id,...l}}catch(t){throw console.error("Error creating article:",t),t}}async function u(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let l=(0,o.H9)(n.db,"articles",t),a=await (0,o.x7)(l);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let i={...e};e.title&&(i.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",i.slug)),i.updatedAt=o.Dc.now(),await (0,o.mZ)(l,i);let s=await (0,o.x7)(l);return{id:s.id,...s.data()}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=(0,o.rJ)(n.db,"articles",t,"comments"),r=(0,o.P)(e,(0,o.My)("createdAt","desc")),l=await (0,o.GG)(r),a=[];return l.forEach(t=>{let e=t.data();a.push({id:t.id,commentId:t.id,...e,replies:e.replies||[]})}),a}catch(t){throw console.error("Error getting comments:",t),t}}async function g(t,e){try{var r;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to comment");let s={userId:a.uid,userName:a.displayName||(null==(r=a.email)?void 0:r.split("@")[0])||"Anonymous",content:e,createdAt:o.Dc.now(),likes:[],replies:[]},c=await (0,o.gS)((0,o.rJ)(n.db,"articles",t,"comments"),s),u=await i(t);return u&&u.authorId!==a.uid&&await (0,l.fZ)(u.authorId,t,u.slug||"",u.title||"Article",c.id,e),{id:c.id,commentId:c.id,...s}}catch(t){throw console.error("Error adding comment:",t),t}}async function h(t,e,r){try{var l;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let s=(0,o.H9)(n.db,"articles",t,"comments",e),c=await (0,o.x7)(s);if(!c.exists())throw Error("Comment not found");let u={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||(null==(l=a.email)?void 0:l.split("@")[0])||"Anonymous",content:r,createdAt:o.Dc.now(),likes:[]};await (0,o.mZ)(s,{replies:(0,o.hq)(u)});let d=c.data();if(d.userId!==a.uid){let r=await i(t);console.log("User ".concat(a.uid," replied to comment ").concat(e," by ").concat(d.userId," on article ").concat(null==r?void 0:r.title))}return u}catch(t){throw console.error("Error adding reply:",t),t}}async function m(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let l=(0,o.H9)(n.db,"articles",t,"comments",e),a=await (0,o.x7)(l);if(!a.exists())throw Error("Comment not found");let i=a.data(),s=r.uid,c=(i.likes||[]).includes(s);await (0,o.mZ)(l,{likes:c?(0,o.C3)(s):(0,o.hq)(s)});let u=(await (0,o.x7)(l)).data();return{success:!0,action:c?"unliked":"liked",likes:u.likes,count:u.likes.length}}catch(t){throw console.error("Error liking comment:",t),t}}async function p(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let l=(0,o.H9)(n.db,"articles",t,"comments",e),a=await (0,o.x7)(l);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.kd)(l),{success:!0,message:"Comment deleted successfully"}}catch(t){throw console.error("Error deleting comment:",t),t}}async function f(t){try{let e=n.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let r=(0,o.H9)(n.db,"articles",t),l=await (0,o.x7)(r);if(!l.exists())throw Error("Article not found");if(l.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=e;try{let e=(0,o.rJ)(n.db,"articles"),l=[(0,o._M)("tags","array-contains",t),(0,o._M)("status","==","published"),(0,o.My)("createdAt","desc")];r&&r>0&&l.push((0,o.AB)(r));let a=(0,o.P)(e,...l),i=await (0,o.GG)(a),s=[];return i.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}},9396:t=>{t.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},9995:(t,e,r)=>{"use strict";r.d(e,{Hs:()=>d,N9:()=>a,Ss:()=>i,bA:()=>s,fP:()=>u,fZ:()=>l,he:()=>c});var o=r(5317),n=r(3201);async function l(t,e,r,l,a,i){try{let e=n.j2.currentUser;if(!e||e.uid===t)return null;let s={userId:t,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:"".concat(e.displayName||"Someone",' commented on your article: "').concat(i.substring(0,50)).concat(i.length>50?"...":"",'"'),fromUser:{id:e.uid,name:e.displayName||"Anonymous"},createdAt:o.Dc.now(),articleSlug:r,articleTitle:l};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),s)).id,...s}}catch(t){return console.error("Error creating notification:",t),null}}async function a(t,e,r,l){try{if(t===r)return null;let a={userId:t,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(e," (@").concat(l,") started following you"),fromUser:{id:r,name:e,username:l},createdAt:o.Dc.now()};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),a)).id,...a}}catch(t){return console.error("Error creating follow notification:",t),null}}async function i(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let e,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let l=(0,o.rJ)(n.db,"notifications");e=t?(0,o.P)(l,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1),(0,o.My)("createdAt","desc"),(0,o.AB)(100)):(0,o.P)(l,(0,o._M)("userId","==",r.uid),(0,o.My)("createdAt","desc"),(0,o.AB)(100));let a=await (0,o.GG)(e),i=[];return a.forEach(t=>{i.push({id:t.id,...t.data()})}),i}catch(t){throw console.error("Error fetching notifications:",t),t}}async function s(t){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.H9)(n.db,"notifications",t),l=await (0,o.x7)(r);if(!l.exists())throw Error("Notification not found");if(l.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.mZ)(r,{read:!0}),{success:!0}}catch(t){throw console.error("Error marking notification as read:",t),t}}async function c(){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(e,(0,o._M)("userId","==",t.uid),(0,o._M)("read","==",!1)),l=await (0,o.GG)(r),a=l.docs.map(t=>(0,o.mZ)(t.ref,{read:!0}));return await Promise.all(a),{success:!0,count:l.size}}catch(t){throw console.error("Error marking all notifications as read:",t),t}}async function u(t){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.H9)(n.db,"notifications",t),l=await (0,o.x7)(r);if(!l.exists())throw Error("Notification not found");if(l.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.kd)(r),{success:!0}}catch(t){throw console.error("Error deleting notification:",t),t}}async function d(){try{let t=n.j2.currentUser;if(!t)return 0;let e=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(e,(0,o._M)("userId","==",t.uid),(0,o._M)("read","==",!1));return(await (0,o.GG)(r)).size}catch(t){return console.error("Error counting unread notifications:",t),0}}}}]);