"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{3201:(e,t,r)=>{r.d(t,{db:()=>l,j2:()=>s});var a=r(3915),n=r(6864),i=r(6203),o=r(5317);let c=(0,a.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,n.P5)(c)}catch(e){}let s=(0,i.xI)(c),l=(0,o.aU)(c);window.location.origin},5695:(e,t,r)=>{var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},8159:(e,t,r)=>{r.d(t,{A:()=>n});class a{initialize(e,t){this.containerElement=e,this.currentModel=t,this.rebuildParagraphMap()}fullRender(e){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");this.currentModel=e,this.containerElement.innerHTML="",this.paragraphMap.clear(),this.sectionMap.clear();let t=document.createElement("h1");t.classList.add("article-title"),t.textContent=e.title,this.containerElement.appendChild(t),e.sections.forEach(e=>{let t=this.createSectionElement(e);this.containerElement.appendChild(t),this.sectionMap.set(e.id,t),e.paragraphs.forEach(e=>{let r=this.createParagraphElement(e);t.appendChild(r),this.paragraphMap.set(e.id,r)})})}applyOperation(e,t){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");switch(this.currentModel=e,t.type){case"INSERT_PARAGRAPH":this.insertParagraphDOM(t.sectionId,t.index,t.paragraph);break;case"REMOVE_PARAGRAPH":this.removeParagraphDOM(t.sectionId,t.paragraphId);break;case"UPDATE_PARAGRAPH":this.updateParagraphDOM(t.sectionId,t.paragraphId,t.updates);break;case"INSERT_SECTION":this.insertSectionDOM(t.index,t.section);break;case"REMOVE_SECTION":this.removeSectionDOM(t.sectionId);break;case"UPDATE_SECTION":this.updateSectionDOM(t.sectionId,t.updates);break;default:console.warn("Unknown operation type:",t.type),this.fullRender(e)}}applyOperations(e,t){t.forEach(t=>{this.applyOperation(e,t)})}createParagraphElement(e){let t;switch(e.type){case"heading":t=document.createElement("h".concat(e.level||2));break;case"image":return t=document.createElement("img"),e.src&&(t.setAttribute("src",e.src),t.setAttribute("alt",e.text||"Image")),t;case"blockquote":t=document.createElement("blockquote");break;case"bulletList":t=document.createElement("ul");break;case"orderedList":t=document.createElement("ol");break;case"listItem":t=document.createElement("li");break;default:t=document.createElement("p")}return(t.dataset.paragraphId=e.id,e.marks&&0!==e.marks.length)?this.renderFormattedText(t,e.text,e.marks):t.textContent=e.text,t}createSectionElement(e){let t=document.createElement("section");return t.dataset.sectionId=e.id,t}renderFormattedText(e,t,r){let a=[...r].sort((e,t)=>e.from-t.from);if(0===a.length){e.textContent=t;return}e.innerHTML="";let n=0;if(a.forEach(r=>{let a;if(r.from>n){let a=t.substring(n,r.from);e.appendChild(document.createTextNode(a))}let i=t.substring(r.from,r.to);switch(r.type){case"bold":a=document.createElement("strong");break;case"italic":a=document.createElement("em");break;case"code":a=document.createElement("code");break;case"link":var o;a=document.createElement("a"),(null==(o=r.attrs)?void 0:o.href)&&a.setAttribute("href",r.attrs.href);break;default:a=document.createElement("span")}a.textContent=i,e.appendChild(a),n=r.to}),n<t.length){let r=t.substring(n);e.appendChild(document.createTextNode(r))}}insertParagraphDOM(e,t,r){let a=this.sectionMap.get(e);if(!a)return void console.warn("Section element with ID ".concat(e," not found"));let n=this.createParagraphElement(r);t>=a.children.length?a.appendChild(n):a.insertBefore(n,a.children[t]),this.paragraphMap.set(r.id,n)}removeParagraphDOM(e,t){let r=this.paragraphMap.get(t);if(!r)return void console.warn("Paragraph element with ID ".concat(t," not found"));r.remove(),this.paragraphMap.delete(t)}updateParagraphDOM(e,t,r){var a;let n=this.paragraphMap.get(t);if(!n)return void console.warn("Paragraph element with ID ".concat(t," not found"));let i=null==(a=this.currentModel)?void 0:a.sections.find(t=>t.id===e);if(!i)return;let o=i.paragraphs.find(e=>e.id===t);if(o){if(r.type&&r.type!==o.type){let e=this.createParagraphElement({...o,...r});n.replaceWith(e),this.paragraphMap.set(t,e);return}if(void 0!==r.text||void 0!==r.marks){let e={...o,text:void 0!==r.text?r.text:o.text,marks:void 0!==r.marks?r.marks:o.marks};"image"===e.type?"IMG"===n.tagName&&e.src&&(n.src=e.src,n.alt=e.text||"Image"):(n.innerHTML="",this.renderFormattedText(n,e.text,e.marks))}if(void 0!==r.level&&"heading"===o.type){let e=document.createElement("h".concat(r.level));for(;n.attributes.length>0;){let t=n.attributes[0];e.setAttribute(t.name,t.value),n.removeAttributeNode(t)}e.innerHTML=n.innerHTML,n.replaceWith(e),this.paragraphMap.set(t,e)}}}insertSectionDOM(e,t){if(!this.containerElement)return;let r=this.createSectionElement(t);t.paragraphs.forEach(e=>{let t=this.createParagraphElement(e);r.appendChild(t),this.paragraphMap.set(e.id,t)});let a=Array.from(this.containerElement.querySelectorAll("section"));e>=a.length?this.containerElement.appendChild(r):this.containerElement.insertBefore(r,a[e]),this.sectionMap.set(t.id,r)}removeSectionDOM(e){let t=this.sectionMap.get(e);if(!t)return void console.warn("Section element with ID ".concat(e," not found"));t.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.delete(t)}),t.remove(),this.sectionMap.delete(e)}updateSectionDOM(e,t){if(!this.sectionMap.get(e))return void console.warn("Section element with ID ".concat(e," not found"))}rebuildParagraphMap(){this.containerElement&&(this.paragraphMap.clear(),this.sectionMap.clear(),this.containerElement.querySelectorAll("section[data-section-id]").forEach(e=>{let t=e.getAttribute("data-section-id");t&&this.sectionMap.set(t,e)}),this.containerElement.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.set(t,e)}))}constructor(){this.containerElement=null,this.paragraphMap=new Map,this.sectionMap=new Map,this.currentModel=null}}let n=new a},9210:(e,t,r)=>{r.d(t,{BC:()=>h,GE:()=>o,N6:()=>l,Oe:()=>m,S1:()=>w,Tu:()=>g,a:()=>f,fz:()=>u,iZ:()=>d,l6:()=>s,tT:()=>p,zE:()=>c});var a=r(5317),n=r(3201),i=r(9995);async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,a.rJ)(n.db,"articles"),i=[];r||i.push((0,a._M)("status","==","published")),i.push((0,a.My)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),i.push((0,a.AB)(t)));let o=(0,a.P)(e,...i),c=await (0,a.GG)(o);console.log("Query returned document count:",c.size);let s=[];return c.forEach(e=>{let t=e.data();s.push({id:e.id,...t})}),s}catch(e){throw console.error("Error getting articles:",e),e}}async function c(e){try{let t=(0,a.H9)(n.db,"articles",e),r=await (0,a.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting article:",e),e}}async function s(e){try{let t=(0,a.rJ)(n.db,"articles"),r=(0,a.P)(t,(0,a._M)("slug","==",e),(0,a._M)("status","==","published")),i=await (0,a.GG)(r);if(i.empty)return null;let o=i.docs[0];return{id:o.id,...o.data()}}catch(e){throw console.error("Error getting article by slug:",e),e}}async function l(e){try{var t;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let i={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:a.Dc.now(),authorId:r.uid,authorName:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"articles"),i)).id,...i}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let i=(0,a.H9)(n.db,"articles",e),o=await (0,a.x7)(i);if(!o.exists())throw Error("Article not found");if(o.data().authorId!==r.uid)throw Error("You can only edit your own articles");let c={...t};t.title&&!t.slug&&(c.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),c.updatedAt=a.Dc.now(),await (0,a.mZ)(i,c);let s=await (0,a.x7)(i);return{id:s.id,...s.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,a.rJ)(n.db,"articles",e,"comments"),r=(0,a.P)(t,(0,a.My)("createdAt","desc")),i=await (0,a.GG)(r),o=[];return i.forEach(e=>{let t=e.data();o.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),o}catch(e){throw console.error("Error getting comments:",e),e}}async function h(e,t){try{var r;let o=n.j2.currentUser;if(!o)throw Error("You must be logged in to comment");let s={userId:o.uid,userName:o.displayName||(null==(r=o.email)?void 0:r.split("@")[0])||"Anonymous",content:t,createdAt:a.Dc.now(),likes:[],replies:[]},l=await (0,a.gS)((0,a.rJ)(n.db,"articles",e,"comments"),s),d=await c(e);return d&&d.authorId!==o.uid&&await (0,i.fZ)(d.authorId,e,d.slug||"",d.title||"Article",l.id,t),{id:l.id,commentId:l.id,...s}}catch(e){throw console.error("Error adding comment:",e),e}}async function m(e,t,r){try{var i;let o=n.j2.currentUser;if(!o)throw Error("You must be logged in to reply");let s=(0,a.H9)(n.db,"articles",e,"comments",t),l=await (0,a.x7)(s);if(!l.exists())throw Error("Comment not found");let d={replyId:Math.random().toString(36).substring(2,15),userId:o.uid,userName:o.displayName||(null==(i=o.email)?void 0:i.split("@")[0])||"Anonymous",content:r,createdAt:a.Dc.now(),likes:[]};await (0,a.mZ)(s,{replies:(0,a.hq)(d)});let u=l.data();if(u.userId!==o.uid){let r=await c(e);console.log("User ".concat(o.uid," replied to comment ").concat(t," by ").concat(u.userId," on article ").concat(null==r?void 0:r.title))}return d}catch(e){throw console.error("Error adding reply:",e),e}}async function p(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let i=(0,a.H9)(n.db,"articles",e,"comments",t),o=await (0,a.x7)(i);if(!o.exists())throw Error("Comment not found");let c=o.data(),s=r.uid,l=(c.likes||[]).includes(s);await (0,a.mZ)(i,{likes:l?(0,a.C3)(s):(0,a.hq)(s)});let d=(await (0,a.x7)(i)).data();return{success:!0,action:l?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function g(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let i=(0,a.H9)(n.db,"articles",e,"comments",t),o=await (0,a.x7)(i);if(!o.exists())throw Error("Comment not found");if(o.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,a.kd)(i),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=n.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,a.H9)(n.db,"articles",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,a.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=t;try{let t=(0,a.rJ)(n.db,"articles"),i=[(0,a._M)("tags","array-contains",e),(0,a._M)("status","==","published"),(0,a.My)("createdAt","desc")];r&&r>0&&i.push((0,a.AB)(r));let o=(0,a.P)(t,...i),c=await (0,a.GG)(o),s=[];return c.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting articles by tag:",e),e}}},9995:(e,t,r)=>{r.d(t,{Hs:()=>u,N9:()=>o,Ss:()=>c,bA:()=>s,fP:()=>d,fZ:()=>i,he:()=>l});var a=r(5317),n=r(3201);async function i(e,t,r,i,o,c){try{let t=n.j2.currentUser;if(!t||t.uid===e)return null;let s={userId:e,type:"comment",read:!1,sourceId:o,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(c.substring(0,50)).concat(c.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:a.Dc.now(),articleSlug:r,articleTitle:i};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating notification:",e),null}}async function o(e,t,r,i){try{if(e===r)return null;let o={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(i,") started following you"),fromUser:{id:r,name:t,username:i},createdAt:a.Dc.now()};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"notifications"),o)).id,...o}}catch(e){return console.error("Error creating follow notification:",e),null}}async function c(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let i=(0,a.rJ)(n.db,"notifications");t=e?(0,a.P)(i,(0,a._M)("userId","==",r.uid),(0,a._M)("read","==",!1),(0,a.My)("createdAt","desc"),(0,a.AB)(100)):(0,a.P)(i,(0,a._M)("userId","==",r.uid),(0,a.My)("createdAt","desc"),(0,a.AB)(100));let o=await (0,a.GG)(t),c=[];return o.forEach(e=>{c.push({id:e.id,...e.data()})}),c}catch(e){throw console.error("Error fetching notifications:",e),e}}async function s(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,a.H9)(n.db,"notifications",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,a.mZ)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function l(){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,a.rJ)(n.db,"notifications"),r=(0,a.P)(t,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1)),i=await (0,a.GG)(r),o=i.docs.map(e=>(0,a.mZ)(e.ref,{read:!0}));return await Promise.all(o),{success:!0,count:i.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,a.H9)(n.db,"notifications",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,a.kd)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=n.j2.currentUser;if(!e)return 0;let t=(0,a.rJ)(n.db,"notifications"),r=(0,a.P)(t,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1));return(await (0,a.GG)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}}]);