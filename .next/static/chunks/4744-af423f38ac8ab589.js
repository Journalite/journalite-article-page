"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4744],{3201:(r,e,t)=>{t.d(e,{db:()=>u,j2:()=>c});var o=t(3915),a=t(6864),n=t(6203),i=t(5317);let s=(0,o.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,a.P5)(s)}catch(r){}let c=(0,n.xI)(s),u=(0,i.aU)(s);window.location.origin},4744:(r,e,t)=>{t.d(e,{Ay:()=>d,Ci:()=>b,E$:()=>m,OQ:()=>s,Qt:()=>h,SR:()=>g,VM:()=>u,Vz:()=>c,e_:()=>l,mH:()=>y,pV:()=>w,x5:()=>f});var o=t(5317),a=t(6203),n=t(3201),i=t(9995);async function s(r){try{let e=(0,o.P)((0,o.rJ)(n.db,"users"),(0,o._M)("username","==",r.toLowerCase()));return!(await (0,o.GG)(e)).empty}catch(r){throw console.error("Error checking username:",r),r}}async function c(r,e){try{let t=await u(r);if(t){console.log("User profile already exists, updating instead of creating");let i=(0,o.doc)(n.db,"users",r);await (0,o.updateDoc)(i,{firstName:e.firstName,lastName:e.lastName,username:e.username.toLowerCase(),email:e.email.toLowerCase(),bio:e.bio||t.bio||""}),n.j2.currentUser&&await (0,a.r7)(n.j2.currentUser,{displayName:e.username});return}let i=(0,o.P)((0,o.rJ)(n.db,"users"),(0,o._M)("email","==",e.email.toLowerCase()));if(!(await (0,o.GG)(i)).empty)throw Error("Email is already associated with another account");if(await s(e.username))throw Error("Username is already taken");let c=(0,o.doc)(n.db,"users",r);await (0,o.BN)(c,{uid:r,firstName:e.firstName,lastName:e.lastName,username:e.username.toLowerCase(),email:e.email.toLowerCase(),bio:e.bio||"",createdAt:(0,o.O5)()}),n.j2.currentUser&&await (0,a.r7)(n.j2.currentUser,{displayName:e.username})}catch(r){throw console.error("Error creating user profile:",r),r}}async function u(r){try{let e=(0,o.doc)(n.db,"users",r),t=await (0,o.x7)(e);if(t.exists())return t.data();return null}catch(r){throw console.error("Error fetching user profile:",r),r}}async function l(r){if(!r)return null;try{let e=(0,o.P)((0,o.rJ)(n.db,"users"),(0,o._M)("email","==",r.toLowerCase()),(0,o.AB)(1)),t=await (0,o.GG)(e);if(!t.empty)return t.docs[0].data();return null}catch(r){throw console.error("Error fetching user profile by email:",r),r}}async function d(r,e){try{let t=(0,o.doc)(n.db,"users",r);await (0,o.updateDoc)(t,{interests:e}),console.log("Interests updated for user ".concat(r,":"),e)}catch(r){throw console.error("Error updating user interests:",r),r}}async function f(r){try{if(!r||r.trim().length<2)return[];let e=r.toLowerCase().trim(),t=(0,o.rJ)(n.db,"users");return(await (0,o.GG)(t)).docs.map(r=>r.data()).filter(r=>{let t=r.username.toLowerCase(),o=r.firstName.toLowerCase(),a=r.lastName.toLowerCase(),n="".concat(o," ").concat(a);return t.includes(e)||o.includes(e)||a.includes(e)||n.includes(e)})}catch(r){return console.error("Error searching users:",r),[]}}async function w(r,e){try{if(r===e)throw Error("You cannot follow yourself");let t=(0,o.doc)(n.db,"users",r);await (0,o.updateDoc)(t,{following:(0,o.arrayUnion)(e),followingCount:(0,o.GV)(1)});let a=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(a,{followers:(0,o.arrayUnion)(r),followersCount:(0,o.GV)(1)});let s=await (0,o.x7)(t);if(s.exists()){let t=s.data();await (0,i.N9)(e,"".concat(t.firstName," ").concat(t.lastName),r,t.username)}}catch(r){throw console.error("Error following user:",r),r}}async function h(r,e){try{let t=(0,o.doc)(n.db,"users",r);await (0,o.updateDoc)(t,{following:(0,o.arrayRemove)(e),followingCount:(0,o.GV)(-1)});let a=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(a,{followers:(0,o.arrayRemove)(r),followersCount:(0,o.GV)(-1)})}catch(r){throw console.error("Error unfollowing user:",r),r}}async function m(r,e){try{var t;let a=(0,o.doc)(n.db,"users",r),i=await (0,o.x7)(a);if(!i.exists())return!1;return(null==(t=i.data().following)?void 0:t.includes(e))||!1}catch(r){throw console.error("Error checking follow status:",r),r}}async function y(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let t=(0,o.doc)(n.db,"users",r),a=await (0,o.x7)(t);if(!a.exists())return[];let i=a.data().following||[];if(0===i.length)return[];let s=[],c=Math.min(i.length,e);for(let r=0;r<c;r++){let e=i[r],t=(0,o.doc)(n.db,"users",e),a=await (0,o.x7)(t);a.exists()&&s.push(a.data())}return s}catch(r){throw console.error("Error getting following list:",r),r}}async function g(r){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let t=(0,o.doc)(n.db,"users",r),a=await (0,o.x7)(t);if(!a.exists())return[];let i=a.data().followers||[];if(0===i.length)return[];let s=[],c=Math.min(i.length,e);for(let r=0;r<c;r++){let e=i[r],t=(0,o.doc)(n.db,"users",e),a=await (0,o.x7)(t);a.exists()&&s.push(a.data())}return s}catch(r){throw console.error("Error getting followers list:",r),r}}async function b(r){try{let e=(0,o.doc)(n.db,"users",r);await (0,o.kd)(e),console.log("User profile for UID ".concat(r," deleted from Firestore."));let t=n.j2.currentUser;if(t&&t.uid===r)await (0,a.hG)(t),console.log("User account for UID ".concat(r," deleted from Firebase Authentication."));else if(t)throw console.error("Current authenticated user does not match UID to be deleted."),Error("Mismatch between authenticated user and account to be deleted.");else throw console.error("No current user authenticated. Cannot delete Firebase Auth user."),Error("Authentication required to delete account.")}catch(r){if(console.error("Error deleting user account:",r),"auth/requires-recent-login"===r.code)throw Error("This operation is sensitive and requires recent authentication. Please sign out and sign back in, then try again.");throw Error("Failed to delete user account. "+r.message)}}},9995:(r,e,t)=>{t.d(e,{Hs:()=>d,N9:()=>i,Ss:()=>s,bA:()=>c,fP:()=>l,fZ:()=>n,he:()=>u});var o=t(5317),a=t(3201);async function n(r,e,t,n,i,s){try{let e=a.j2.currentUser;if(!e||e.uid===r)return null;let c={userId:r,type:"comment",read:!1,sourceId:i,sourceType:"comment",message:"".concat(e.displayName||"Someone",' commented on your article: "').concat(s.substring(0,50)).concat(s.length>50?"...":"",'"'),fromUser:{id:e.uid,name:e.displayName||"Anonymous"},createdAt:o.Dc.now(),articleSlug:t,articleTitle:n};return{id:(await (0,o.gS)((0,o.rJ)(a.db,"notifications"),c)).id,...c}}catch(r){return console.error("Error creating notification:",r),null}}async function i(r,e,t,n){try{if(r===t)return null;let i={userId:r,type:"follow",read:!1,sourceId:t,sourceType:"user",message:"".concat(e," (@").concat(n,") started following you"),fromUser:{id:t,name:e,username:n},createdAt:o.Dc.now()};return{id:(await (0,o.gS)((0,o.rJ)(a.db,"notifications"),i)).id,...i}}catch(r){return console.error("Error creating follow notification:",r),null}}async function s(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let e,t=a.j2.currentUser;if(!t)throw Error("User not authenticated");let n=(0,o.rJ)(a.db,"notifications");e=r?(0,o.P)(n,(0,o._M)("userId","==",t.uid),(0,o._M)("read","==",!1),(0,o.My)("createdAt","desc"),(0,o.AB)(100)):(0,o.P)(n,(0,o._M)("userId","==",t.uid),(0,o.My)("createdAt","desc"),(0,o.AB)(100));let i=await (0,o.GG)(e),s=[];return i.forEach(r=>{s.push({id:r.id,...r.data()})}),s}catch(r){throw console.error("Error fetching notifications:",r),r}}async function c(r){try{let e=a.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.doc)(a.db,"notifications",r),n=await (0,o.x7)(t);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(t,{read:!0}),{success:!0}}catch(r){throw console.error("Error marking notification as read:",r),r}}async function u(){try{let r=a.j2.currentUser;if(!r)throw Error("User not authenticated");let e=(0,o.rJ)(a.db,"notifications"),t=(0,o.P)(e,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1)),n=await (0,o.GG)(t),i=n.docs.map(r=>(0,o.updateDoc)(r.ref,{read:!0}));return await Promise.all(i),{success:!0,count:n.size}}catch(r){throw console.error("Error marking all notifications as read:",r),r}}async function l(r){try{let e=a.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.doc)(a.db,"notifications",r),n=await (0,o.x7)(t);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.kd)(t),{success:!0}}catch(r){throw console.error("Error deleting notification:",r),r}}async function d(){try{let r=a.j2.currentUser;if(!r)return 0;let e=(0,o.rJ)(a.db,"notifications"),t=(0,o.P)(e,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1));return(await (0,o.GG)(t)).size}catch(r){return console.error("Error counting unread notifications:",r),0}}}}]);