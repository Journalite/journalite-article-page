(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2938],{1999:e=>{e.exports={articleEditor:"ArticleEditor_articleEditor__Y7zhH",toolbar:"ArticleEditor_toolbar__7VR6u",keyboardHint:"ArticleEditor_keyboardHint__oSXE_",toolbarButton:"ArticleEditor_toolbarButton__n6ugP",active:"ArticleEditor_active__l06wW",editorContent:"ArticleEditor_editorContent__IMeaV",editorStatus:"ArticleEditor_editorStatus__UViLo",fadeIn:"ArticleEditor_fadeIn__hSZwT"}},2938:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var a,n=r(5155),i=r(2115),o=r(5695),s=new Uint8Array(16);let l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));let u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!("string"==typeof r&&l.test(r)))throw TypeError("Stringified UUID is invalid");return r},h=function(e,t,r){var n=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return u(n)};var p=r(9210),m=r(3201);class g{applyOperation(e,t){let r=JSON.parse(JSON.stringify(e));switch(t.type){case"INSERT_PARAGRAPH":return this.insertParagraph(r,t.sectionId,t.index,t.paragraph);case"REMOVE_PARAGRAPH":return this.removeParagraph(r,t.sectionId,t.paragraphId,t.index);case"UPDATE_PARAGRAPH":return this.updateParagraph(r,t.sectionId,t.paragraphId,t.updates);case"INSERT_SECTION":return this.insertSection(r,t.index,t.section);case"REMOVE_SECTION":return this.removeSection(r,t.sectionId,t.index);case"UPDATE_SECTION":return this.updateSection(r,t.sectionId,t.updates);default:return console.warn("Unknown operation type:",t.type),r}}applyOperations(e,t){return t.reduce((e,t)=>this.applyOperation(e,t),e)}insertParagraph(e,t,r,a){let n=e.sections.findIndex(e=>e.id===t);if(-1===n)return console.warn("Section with ID ".concat(t," not found")),e;let i={...a,id:a.id||h()};return e.sections[n].paragraphs.splice(r,0,i),e}removeParagraph(e,t,r,a){let n=e.sections.findIndex(e=>e.id===t);if(-1===n)return console.warn("Section with ID ".concat(t," not found")),e;let i=e.sections[n];if(a>=0&&a<i.paragraphs.length)if(i.paragraphs[a].id!==r){console.warn("Paragraph ID mismatch at index ".concat(a));let e=i.paragraphs.findIndex(e=>e.id===r);-1!==e&&i.paragraphs.splice(e,1)}else i.paragraphs.splice(a,1);return e}updateParagraph(e,t,r,a){let n=e.sections.findIndex(e=>e.id===t);if(-1===n)return console.warn("Section with ID ".concat(t," not found")),e;let i=e.sections[n].paragraphs.findIndex(e=>e.id===r);return -1===i?console.warn("Paragraph with ID ".concat(r," not found in section ").concat(t)):e.sections[n].paragraphs[i]={...e.sections[n].paragraphs[i],...a},e}insertSection(e,t,r){let a={...r,id:r.id||h()};return e.sections.splice(t,0,a),e}removeSection(e,t,r){if(r>=0&&r<e.sections.length)if(e.sections[r].id!==t){console.warn("Section ID mismatch at index ".concat(r));let a=e.sections.findIndex(e=>e.id===t);-1!==a&&e.sections.splice(a,1)}else e.sections.splice(r,1);return e}updateSection(e,t,r){let a=e.sections.findIndex(e=>e.id===t);return -1===a?console.warn("Section with ID ".concat(t," not found")):e.sections[a]={...e.sections[a],...r},e}addTextMark(e,t,r,a,n,i,o){let s=e.sections.findIndex(e=>e.id===t);if(-1===s)return e;let l=e.sections[s].paragraphs.findIndex(e=>e.id===r);if(-1===l)return e;let c={type:a,from:n,to:i,...o&&{attrs:o}},d=[...e.sections[s].paragraphs[l].marks,c];return this.updateParagraph(e,t,r,{marks:d})}removeTextMark(e,t,r,a,n,i){let o=e.sections.findIndex(e=>e.id===t);if(-1===o)return e;let s=e.sections[o].paragraphs.findIndex(e=>e.id===r);if(-1===s)return e;let l=e.sections[o].paragraphs[s].marks.filter(e=>e.type!==a||e.from!==n||e.to!==i);return this.updateParagraph(e,t,r,{marks:l})}splitParagraph(e,t,r,a){let n=e.sections.findIndex(e=>e.id===t);if(-1===n)return e;let i=e.sections[n].paragraphs.findIndex(e=>e.id===r);if(-1===i)return e;let o=e.sections[n].paragraphs[i],s=o.text.substring(0,a),l=o.marks.filter(e=>e.from<a).map(e=>({...e,to:Math.min(e.to,a)})),c=o.text.substring(a),d=o.marks.filter(e=>e.to>a).map(e=>({...e,from:Math.max(e.from-a,0),to:e.to-a})),u=this.updateParagraph(e,t,r,{text:s,marks:l}),p={id:h(),type:o.type,text:c,marks:d,level:o.level};return this.insertParagraph(u,t,i+1,p)}mergeParagraphs(e,t,r,a){let n=e.sections.findIndex(e=>e.id===t);if(-1===n)return e;let i=e.sections[n],o=i.paragraphs.findIndex(e=>e.id===r),s=i.paragraphs.findIndex(e=>e.id===a);if(-1===o||-1===s||s!==o+1)return e;let l=i.paragraphs[o],c=i.paragraphs[s],d=l.text+c.text,u=c.marks.map(e=>({...e,from:e.from+l.text.length,to:e.to+l.text.length})),h=[...l.marks,...u],p=this.updateParagraph(e,t,r,{text:d,marks:h});return this.removeParagraph(p,t,a,s)}}let f=new g;var y=r(8159);class E{initialize(e,t,r){this.model=e,this.editorElement=t,this.onChangeCallback=r||null,y.A.initialize(t,e),y.A.fullRender(e),this.attachEventListeners()}updateModel(e){this.model=e,y.A.fullRender(e)}attachEventListeners(){this.editorElement&&(this.editorElement.setAttribute("contenteditable","true"),this.editorElement.setAttribute("spellcheck","true"),this.editorElement.addEventListener("keydown",this.handleKeyDown),document.addEventListener("selectionchange",this.handleSelectionChange),this.editorElement.addEventListener("focus",this.handleFocus),this.editorElement.addEventListener("blur",this.handleBlur),this.editorElement.addEventListener("input",this.handleInput),this.editorElement.addEventListener("click",this.handleClick),this.editorElement.addEventListener("paste",this.handlePaste))}destroy(){this.editorElement&&(this.editorElement.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("selectionchange",this.handleSelectionChange),this.editorElement.removeEventListener("focus",this.handleFocus),this.editorElement.removeEventListener("blur",this.handleBlur),this.editorElement.removeEventListener("input",this.handleInput),this.editorElement.removeEventListener("click",this.handleClick),this.editorElement.removeEventListener("paste",this.handlePaste))}handleEnterKey(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.findCursorOffsetInParagraph();if(null===e)return;let t=f.splitParagraph(this.model,this.currentSectionId,this.currentParagraphId,e),r=t.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===r)return;let a=t.sections[r].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===a||a+1>=t.sections[r].paragraphs.length)return;let n=t.sections[r].paragraphs[a+1].id;this.model=t,y.A.fullRender(t),this.setCursorPosition(n,0),this.notifyChange()}handleBackspaceAtStart(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||0===t)return;let r=this.model.sections[e].paragraphs[t-1],a=r.text.length,n=f.mergeParagraphs(this.model,this.currentSectionId,r.id,this.currentParagraphId);this.model=n,y.A.fullRender(n),this.setCursorPosition(r.id,a),this.currentParagraphId=r.id,this.notifyChange()}handleDeleteAtEnd(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||t>=this.model.sections[e].paragraphs.length-1)return;let r=this.model.sections[e].paragraphs[t].text.length,a=this.model.sections[e].paragraphs[t+1],n=f.mergeParagraphs(this.model,this.currentSectionId,this.currentParagraphId,a.id);this.model=n,y.A.fullRender(n),this.setCursorPosition(this.currentParagraphId,r),this.notifyChange()}toggleFormat(e){let t;if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let r=window.getSelection();if(!r||r.isCollapsed)return;let{startOffset:a,endOffset:n}=this.getSelectionOffsets();if(null===a||null===n)return;let i=this.findParagraphById(this.currentParagraphId);if(!i)return;let o=i.marks.find(t=>t.type===e&&t.from<=a&&t.to>=n);t=o?f.removeTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,o.from,o.to):f.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,a,n),this.model=t,y.A.fullRender(t),this.setTextSelection(this.currentParagraphId,a,n),this.notifyChange()}insertLink(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=window.getSelection();if(!e||e.isCollapsed)return;let{startOffset:t,endOffset:r}=this.getSelectionOffsets();if(null===t||null===r)return;let a=window.prompt("Enter URL:");if(!a)return;let n=f.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,"link",t,r,{href:a});this.model=n,y.A.fullRender(n),this.setTextSelection(this.currentParagraphId,t,r),this.notifyChange()}updateCurrentParagraphAndSection(){let e=window.getSelection();if(!e||!e.anchorNode){this.currentParagraphId=null,this.currentSectionId=null;return}let t=e.anchorNode.nodeType===Node.ELEMENT_NODE?e.anchorNode:e.anchorNode.parentElement;for(;t&&!t.hasAttribute("data-paragraph-id");)t=t.parentElement;if(!t){this.currentParagraphId=null,this.currentSectionId=null;return}this.currentParagraphId=t.getAttribute("data-paragraph-id");let r=t.parentElement;for(;r&&!r.hasAttribute("data-section-id");)r=r.parentElement;if(!r){this.currentSectionId=null;return}this.currentSectionId=r.getAttribute("data-section-id")}isAtStartOfParagraph(){let e=window.getSelection();return!!e&&!!e.anchorNode&&!!e.isCollapsed&&(e.anchorNode.nodeType===Node.TEXT_NODE,0===e.anchorOffset)}isAtEndOfParagraph(){let e=window.getSelection();if(!e||!e.anchorNode||!e.isCollapsed)return!1;if(e.anchorNode.nodeType===Node.TEXT_NODE){var t;return e.anchorOffset===(null==(t=e.anchorNode.textContent)?void 0:t.length)}let r=e.anchorNode;return e.anchorOffset===r.childNodes.length}findCursorOffsetInParagraph(){var e;if(!this.currentParagraphId||!this.model)return null;let t=window.getSelection();if(!t||!t.isCollapsed)return null;let r=this.findParagraphById(this.currentParagraphId);if(!r)return null;let a=document.querySelector('[data-paragraph-id="'.concat(this.currentParagraphId,'"]'));return a?(null==(e=t.anchorNode)?void 0:e.nodeType)===Node.TEXT_NODE&&t.anchorNode.parentNode===a?t.anchorOffset:r.text.length:null}findParagraphById(e){if(!this.model)return null;for(let t of this.model.sections){let r=t.paragraphs.find(t=>t.id===e);if(r)return r}return null}setCursorPosition(e,t){let r=document.querySelector('[data-paragraph-id="'.concat(e,'"]'));if(!r)return;let a=document.createRange(),n=window.getSelection();0===t?(a.setStart(r,0),a.collapse(!0)):(a.selectNodeContents(r),a.collapse(!1)),n&&(n.removeAllRanges(),n.addRange(a))}setTextSelection(e,t,r){let a=document.querySelector('[data-paragraph-id="'.concat(e,'"]'));if(!a)return;let n=document.createRange(),i=window.getSelection();n.selectNodeContents(a),i&&(i.removeAllRanges(),i.addRange(n))}getSelectionOffsets(){return{startOffset:0,endOffset:0}}notifyChange(){this.onChangeCallback&&this.model&&this.onChangeCallback(this.model)}constructor(){this.model=null,this.editorElement=null,this.selectionState={anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!0},this.onChangeCallback=null,this.focusedElement=null,this.currentParagraphId=null,this.currentSectionId=null,this.handleKeyDown=e=>{if(this.model)switch(this.updateCurrentParagraphAndSection(),e.key){case"Enter":e.shiftKey||(e.preventDefault(),this.handleEnterKey());break;case"Backspace":this.isAtStartOfParagraph()&&(e.preventDefault(),this.handleBackspaceAtStart());break;case"Delete":this.isAtEndOfParagraph()&&(e.preventDefault(),this.handleDeleteAtEnd());break;case"b":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("bold"));break;case"i":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("italic"));break;case"`":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("code"));break;case"k":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.insertLink())}},this.handleSelectionChange=()=>{let e=window.getSelection();e&&(this.selectionState={anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset,isCollapsed:e.isCollapsed},this.updateCurrentParagraphAndSection())},this.handleFocus=e=>{this.focusedElement=e.target,this.updateCurrentParagraphAndSection()},this.handleBlur=()=>{this.focusedElement=null},this.handleInput=e=>{if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let t=e.target.textContent||"",r={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:t}},a=f.applyOperation(this.model,r);this.model=a,this.notifyChange()},this.handleClick=()=>{this.updateCurrentParagraphAndSection()},this.handlePaste=e=>{if(e.preventDefault(),!this.model||!this.currentParagraphId||!this.currentSectionId||!e.clipboardData)return;let t=e.clipboardData.getData("text/plain"),r=window.getSelection();if(!r||!r.rangeCount)return;r.getRangeAt(0);let a=this.findParagraphById(this.currentParagraphId);if(!a)return;let n=this.findCursorOffsetInParagraph();if(null===n)return;let i=a.text.substring(0,n)+t+a.text.substring(n),o={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:i}},s=f.applyOperation(this.model,o);this.model=s,y.A.applyOperation(s,o),this.notifyChange(),this.setCursorPosition(this.currentParagraphId,n+t.length)}}}let w=new E;var I=r(1999),v=r.n(I);let b=e=>{let{articleId:t,initialHtml:r="",onChange:a}=e,o=(0,i.useRef)(null),[s,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)({id:t,title:"",sections:[{id:h(),type:"section",paragraphs:[{id:h(),type:"paragraph",text:"",marks:[]}]}]});(0,i.useEffect)(()=>{if(o.current&&!s){if(r&&r.trim())try{let e=r.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),a=document.createElement("div");a.innerHTML=e;let n=Array.from(a.children).map(e=>{let t=e.tagName.toLowerCase(),r="paragraph";"h1"===t||"h2"===t||"h3"===t?r="heading":"blockquote"===t?r="blockquote":"ul"===t?r="bulletList":"ol"===t?r="orderedList":"li"===t?r="listItem":"img"===t&&(r="image");let a=e.textContent||"",n=[];e.querySelector("strong, b")&&n.push({type:"bold",from:0,to:a.length}),e.querySelector("em, i")&&n.push({type:"italic",from:0,to:a.length});let i={id:h(),type:r,text:a,marks:n};return"heading"===r&&("h1"===t?i.level=1:"h2"===t?i.level=2:"h3"===t&&(i.level=3)),"image"===r&&(i.src=e.getAttribute("src")||""),i});0===n.length&&n.push({id:h(),type:"paragraph",text:"",marks:[]});let i={id:t,title:"",sections:[{id:h(),type:"section",paragraphs:n}]};d(i)}catch(e){console.error("Error parsing initial HTML:",e)}return setTimeout(()=>{if(o.current){if(o.current.innerHTML="",w.initialize(c,o.current,u),r&&r.trim()){let e=r.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");o.current.innerHTML=e;let t=document.createRange(),a=window.getSelection();if(o.current.childNodes.length>0){let e=o.current.lastChild;e&&(t.setStartAfter(e),t.collapse(!0),a&&(a.removeAllRanges(),a.addRange(t)))}}else o.current.innerHTML="<p><br></p>";l(!0)}},50),()=>{w.destroy()}}},[t,r]);let u=e=>{d(e),a&&o.current&&a(o.current.innerHTML.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),e)},p=()=>{document.execCommand("bold",!1),o.current&&o.current.focus()},m=()=>{document.execCommand("italic",!1),o.current&&o.current.focus()},g=e=>{document.execCommand("formatBlock",!1,"h".concat(e)),o.current&&o.current.focus()};return(0,n.jsxs)("div",{className:v().articleEditor,children:[(0,n.jsxs)("div",{className:v().toolbar,children:[(0,n.jsx)("button",{className:v().toolbarButton,onClick:p,title:"Bold (⌘/Ctrl+B)",children:(0,n.jsx)("strong",{children:"B"})}),(0,n.jsx)("button",{className:v().toolbarButton,onClick:m,title:"Italic (⌘/Ctrl+I)",children:(0,n.jsx)("em",{children:"I"})}),(0,n.jsx)("button",{className:v().toolbarButton,onClick:()=>g(1),title:"Heading 1 (⌘/Ctrl+1)",children:"H1"}),(0,n.jsx)("button",{className:v().toolbarButton,onClick:()=>g(2),title:"Heading 2 (⌘/Ctrl+2)",children:"H2"}),(0,n.jsx)("button",{className:v().toolbarButton,onClick:()=>g(3),title:"Heading 3 (⌘/Ctrl+3)",children:"H3"}),(0,n.jsxs)("div",{className:v().keyboardHint,children:[(0,n.jsx)("kbd",{children:"⌘B"})," Bold \xa0 ",(0,n.jsx)("kbd",{children:"⌘I"})," Italic \xa0 ",(0,n.jsx)("kbd",{children:"⌘1-3"})," Headings"]})]}),(0,n.jsx)("div",{ref:o,className:v().editorContent,contentEditable:!0,"aria-label":"Article editor",suppressContentEditableWarning:!0,onFocus:()=>{if(o.current&&""===o.current.innerHTML){o.current.innerHTML="<p><br></p>";let e=document.createRange(),t=window.getSelection(),r=o.current.querySelector("p");r&&(e.setStart(r,0),e.collapse(!0),t&&(t.removeAllRanges(),t.addRange(e)))}},onKeyDown:e=>{let t=navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey;if(t&&"b"===e.key)return e.preventDefault(),p(),!1;if(t&&"i"===e.key)return e.preventDefault(),m(),!1;if(t&&"1"===e.key)return e.preventDefault(),g(1),!1;if(t&&"2"===e.key)return e.preventDefault(),g(2),!1;if(t&&"3"===e.key)return e.preventDefault(),g(3),!1;if("Enter"===e.key&&!e.shiftKey){e.preventDefault(),document.execCommand("insertParagraph",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).startContainer.parentElement;e&&"div"===e.tagName.toLowerCase()&&document.execCommand("formatBlock",!1,"p")}return o.current&&a&&a(o.current.innerHTML,c),!1}},onPaste:e=>{var t,r;if("true"===(null==(t=e.nativeEvent.clipboardData)?void 0:t.getData("text/html-editor-match-style"))||(null==(r=e.nativeEvent.clipboardData)?void 0:r.types.includes("text/html-editor-match-style"))){e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}o.current&&a&&setTimeout(()=>{o.current&&a(o.current.innerHTML,c)},0)}})]})};var C=r(9396),x=r.n(C);let A=e=>{let{articleId:t,onUpdateComplete:r}=e,a=(0,o.useRouter)(),[s,l]=(0,i.useState)(""),[c,d]=(0,i.useState)(""),[u,g]=(0,i.useState)([]),[f,y]=(0,i.useState)(""),[E,w]=(0,i.useState)(!1),[I,v]=(0,i.useState)(!1),[C,A]=(0,i.useState)(!1),[S,P]=(0,i.useState)(""),[_,k]=(0,i.useState)(!!t),[M,N]=(0,i.useState)(null),[D,T]=(0,i.useState)(""),[R,O]=(0,i.useState)(null),j=(0,i.useRef)(null),L=(0,i.useRef)(null),H=(0,i.useCallback)(()=>{j.current&&(j.current.style.height="auto",j.current.style.height="".concat(j.current.scrollHeight,"px"),!s&&j.current&&j.current.focus())},[s]);(0,i.useEffect)(()=>{let e=m.j2.onAuthStateChanged(e=>{N(e),e||a.push("/login?redirect=compose")});return()=>e()},[a]),(0,i.useEffect)(()=>{t&&M?(async()=>{try{k(!0);let e=await (0,p.zE)(t);if(!e){P("Article not found"),a.push("/");return}if(e.authorId!==M.uid){P("You can only edit your own articles"),a.push("/");return}l(e.title);let r=e.body.replace(/data-[\w-]+="[^"]*"/g,"");d(r),g(e.tags||[]),y(e.coverImage||"");let n={id:t,title:e.title,sections:[{id:h(),type:"section",paragraphs:[]}]};O(n)}catch(e){console.error("Error loading article:",e),P("Failed to load article")}finally{k(!1)}})():t||O({id:h(),title:"",sections:[{id:h(),type:"section",paragraphs:[{id:h(),type:"paragraph",text:"",marks:[]}]}]})},[t,M,a]),(0,i.useEffect)(()=>{H()},[s,H]),(0,i.useEffect)(()=>{let e;return M&&s.trim()&&c.trim()&&!I&&!E&&(e=setTimeout(()=>{K("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[M,s,c,I,E]);let B=()=>{let e=D.trim().toLowerCase();e&&!u.includes(e)&&u.length<5&&(g([...u,e]),T(""))},U=e=>{g(u.filter(t=>t!==e))},G=(0,i.useRef)(null),K=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!M)return void P("You must be logged in to save an article");if(!s.trim())return void P("Title is required");if(!c.trim())return void P("Content is required");try{v(!0),P("");let n=c.replace(/data-[\w-]+="[^"]*"/g,""),i={title:s.trim(),body:n,tags:u,coverImage:f.trim(),status:e};if(console.log("Saving article data:",i),t)try{let e=await (0,p.iZ)(t,i);console.log("Article updated successfully:",null==e?void 0:e.title),A(!0),await new Promise(e=>setTimeout(e,500));let a=await (0,p.zE)(t);console.log("Fetched updated article data:",null==a?void 0:a.title),r&&r(a),setTimeout(()=>{console.log("Applying changes immediately and redirecting to article ID page"),window.location.href="/articles/".concat(t,"/view?updated=true&time=").concat(Date.now()),setTimeout(()=>{window.location.pathname.includes("/edit")&&(console.log("Fallback navigation to main articles page"),window.location.href="/articles?id=".concat(t,"&updated=true&time=").concat(Date.now()))},2e3)},1e3)}catch(e){console.error("Error updating article:",e),P("Failed to update article. Please try again."),A(!1)}else{let t=await (0,p.N6)(i);"published"===e?a.push("/articles/".concat(t.id)):a.push("/dashboard")}}catch(e){console.error("Error saving article:",e),P("Failed to save article. Please try again.")}finally{v(!1),w(!1)}},z=async()=>{if(!c.trim())return void P("Content is required");w(!0),await K("published")},q=async()=>{await K("drafts")};return _?(0,n.jsxs)("div",{className:x().composerLoading,children:[(0,n.jsx)("div",{className:x().loadingIndicator}),(0,n.jsx)("p",{children:"Loading article..."})]}):(0,n.jsxs)("div",{className:x().articleComposer,children:[(0,n.jsxs)("header",{className:x().composerHeader,children:[(0,n.jsx)("div",{className:x().logoContainer,children:(0,n.jsx)("div",{className:x().logo,children:"Journalite"})}),(0,n.jsxs)("div",{className:x().actionButtons,children:[C&&(0,n.jsxs)("span",{className:x().savedIndicator,children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,n.jsx)("button",{className:x().actionButton,onClick:q,disabled:I||E,children:"Save draft"}),(0,n.jsx)("button",{className:x().publishButton,onClick:z,disabled:I||E||!s.trim()||!c.trim(),children:t?"Update":"Publish"})]})]}),(0,n.jsxs)("main",{className:x().composerContent,children:[(0,n.jsx)("textarea",{ref:j,className:x().titleInput,value:s,onChange:e=>{l(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),G.current&&G.current.focus())},placeholder:"Title",rows:1}),(0,n.jsxs)("div",{className:x().coverImageInput,children:[(0,n.jsx)("input",{type:"text",value:f,onChange:e=>{y(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:x().imageUrlInput}),f&&(0,n.jsx)("div",{className:x().coverImagePreview,children:(0,n.jsx)("img",{src:f,alt:"Cover preview"})})]}),(0,n.jsxs)("div",{className:x().tagContainer,children:[u.map(e=>(0,n.jsxs)("div",{className:x().tag,children:[e,(0,n.jsx)("button",{className:x().removeTagButton,onClick:()=>U(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),u.length<5&&(0,n.jsx)("input",{ref:L,type:"text",value:D,onChange:e=>{T(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),B())},onBlur:B,placeholder:0===u.length?"Add up to 5 tags...":"Add another tag...",className:x().tagInput})]}),S&&(0,n.jsx)("div",{className:x().errorMessage,children:S}),R&&(0,n.jsx)("div",{className:x().editorContainer,ref:G,children:(0,n.jsx)(b,{articleId:R.id,initialHtml:c,onChange:(e,t)=>{e!==c&&(d(e),O(t),C&&A(!1))}})})]})]})}},3201:(e,t,r)=>{"use strict";r.d(t,{db:()=>c,j2:()=>l});var a=r(3915),n=r(6864),i=r(6203),o=r(5317);let s=(0,a.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,n.P5)(s)}catch(e){}let l=(0,i.xI)(s),c=(0,o.aU)(s);window.location.origin},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},8159:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});class a{initialize(e,t){this.containerElement=e,this.currentModel=t,this.rebuildParagraphMap()}fullRender(e){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");this.currentModel=e,this.containerElement.innerHTML="",this.paragraphMap.clear(),this.sectionMap.clear();let t=document.createElement("h1");t.classList.add("article-title"),t.textContent=e.title,this.containerElement.appendChild(t),e.sections.forEach(e=>{let t=this.createSectionElement(e);this.containerElement.appendChild(t),this.sectionMap.set(e.id,t),e.paragraphs.forEach(e=>{let r=this.createParagraphElement(e);t.appendChild(r),this.paragraphMap.set(e.id,r)})})}applyOperation(e,t){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");switch(this.currentModel=e,t.type){case"INSERT_PARAGRAPH":this.insertParagraphDOM(t.sectionId,t.index,t.paragraph);break;case"REMOVE_PARAGRAPH":this.removeParagraphDOM(t.sectionId,t.paragraphId);break;case"UPDATE_PARAGRAPH":this.updateParagraphDOM(t.sectionId,t.paragraphId,t.updates);break;case"INSERT_SECTION":this.insertSectionDOM(t.index,t.section);break;case"REMOVE_SECTION":this.removeSectionDOM(t.sectionId);break;case"UPDATE_SECTION":this.updateSectionDOM(t.sectionId,t.updates);break;default:console.warn("Unknown operation type:",t.type),this.fullRender(e)}}applyOperations(e,t){t.forEach(t=>{this.applyOperation(e,t)})}createParagraphElement(e){let t;switch(e.type){case"heading":t=document.createElement("h".concat(e.level||2));break;case"image":return t=document.createElement("img"),e.src&&(t.setAttribute("src",e.src),t.setAttribute("alt",e.text||"Image")),t;case"blockquote":t=document.createElement("blockquote");break;case"bulletList":t=document.createElement("ul");break;case"orderedList":t=document.createElement("ol");break;case"listItem":t=document.createElement("li");break;default:t=document.createElement("p")}return(t.dataset.paragraphId=e.id,e.marks&&0!==e.marks.length)?this.renderFormattedText(t,e.text,e.marks):t.textContent=e.text,t}createSectionElement(e){let t=document.createElement("section");return t.dataset.sectionId=e.id,t}renderFormattedText(e,t,r){let a=[...r].sort((e,t)=>e.from-t.from);if(0===a.length){e.textContent=t;return}e.innerHTML="";let n=0;if(a.forEach(r=>{let a;if(r.from>n){let a=t.substring(n,r.from);e.appendChild(document.createTextNode(a))}let i=t.substring(r.from,r.to);switch(r.type){case"bold":a=document.createElement("strong");break;case"italic":a=document.createElement("em");break;case"code":a=document.createElement("code");break;case"link":var o;a=document.createElement("a"),(null==(o=r.attrs)?void 0:o.href)&&a.setAttribute("href",r.attrs.href);break;default:a=document.createElement("span")}a.textContent=i,e.appendChild(a),n=r.to}),n<t.length){let r=t.substring(n);e.appendChild(document.createTextNode(r))}}insertParagraphDOM(e,t,r){let a=this.sectionMap.get(e);if(!a)return void console.warn("Section element with ID ".concat(e," not found"));let n=this.createParagraphElement(r);t>=a.children.length?a.appendChild(n):a.insertBefore(n,a.children[t]),this.paragraphMap.set(r.id,n)}removeParagraphDOM(e,t){let r=this.paragraphMap.get(t);if(!r)return void console.warn("Paragraph element with ID ".concat(t," not found"));r.remove(),this.paragraphMap.delete(t)}updateParagraphDOM(e,t,r){var a;let n=this.paragraphMap.get(t);if(!n)return void console.warn("Paragraph element with ID ".concat(t," not found"));let i=null==(a=this.currentModel)?void 0:a.sections.find(t=>t.id===e);if(!i)return;let o=i.paragraphs.find(e=>e.id===t);if(o){if(r.type&&r.type!==o.type){let e=this.createParagraphElement({...o,...r});n.replaceWith(e),this.paragraphMap.set(t,e);return}if(void 0!==r.text||void 0!==r.marks){let e={...o,text:void 0!==r.text?r.text:o.text,marks:void 0!==r.marks?r.marks:o.marks};"image"===e.type?"IMG"===n.tagName&&e.src&&(n.src=e.src,n.alt=e.text||"Image"):(n.innerHTML="",this.renderFormattedText(n,e.text,e.marks))}if(void 0!==r.level&&"heading"===o.type){let e=document.createElement("h".concat(r.level));for(;n.attributes.length>0;){let t=n.attributes[0];e.setAttribute(t.name,t.value),n.removeAttributeNode(t)}e.innerHTML=n.innerHTML,n.replaceWith(e),this.paragraphMap.set(t,e)}}}insertSectionDOM(e,t){if(!this.containerElement)return;let r=this.createSectionElement(t);t.paragraphs.forEach(e=>{let t=this.createParagraphElement(e);r.appendChild(t),this.paragraphMap.set(e.id,t)});let a=Array.from(this.containerElement.querySelectorAll("section"));e>=a.length?this.containerElement.appendChild(r):this.containerElement.insertBefore(r,a[e]),this.sectionMap.set(t.id,r)}removeSectionDOM(e){let t=this.sectionMap.get(e);if(!t)return void console.warn("Section element with ID ".concat(e," not found"));t.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.delete(t)}),t.remove(),this.sectionMap.delete(e)}updateSectionDOM(e,t){if(!this.sectionMap.get(e))return void console.warn("Section element with ID ".concat(e," not found"))}rebuildParagraphMap(){this.containerElement&&(this.paragraphMap.clear(),this.sectionMap.clear(),this.containerElement.querySelectorAll("section[data-section-id]").forEach(e=>{let t=e.getAttribute("data-section-id");t&&this.sectionMap.set(t,e)}),this.containerElement.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.set(t,e)}))}constructor(){this.containerElement=null,this.paragraphMap=new Map,this.sectionMap=new Map,this.currentModel=null}}let n=new a},9210:(e,t,r)=>{"use strict";r.d(t,{BC:()=>h,GE:()=>o,N6:()=>c,Oe:()=>p,S1:()=>y,Tu:()=>g,a:()=>f,fz:()=>u,iZ:()=>d,l6:()=>l,tT:()=>m,zE:()=>s});var a=r(5317),n=r(3201),i=r(9995);async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,a.rJ)(n.db,"articles"),i=[];r||i.push((0,a._M)("status","==","published")),i.push((0,a.My)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),i.push((0,a.AB)(t)));let o=(0,a.P)(e,...i),s=await (0,a.GG)(o);console.log("Query returned document count:",s.size);let l=[];return s.forEach(e=>{let t=e.data();l.push({id:e.id,...t})}),l}catch(e){throw console.error("Error getting articles:",e),e}}async function s(e){try{let i=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(e," (time: ").concat(i,")"));let o=(0,a.H9)(n.db,"articles",e),s=await (0,a.x7)(o);if(!s.exists())return console.log("❌ Article not found for ID:",e),null;{var t,r;let e={id:s.id,...s.data()};return console.log("✅ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",(null==(t=e.body)?void 0:t.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(r=e.tags)?void 0:r.join(", "))||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function l(e){try{console.log("Getting article by slug: ".concat(e,", timestamp: ").concat(Date.now()));let r=0;for(;r<2;){r++,console.log("Attempt ".concat(r," to get article by slug")),r>1&&await new Promise(e=>setTimeout(e,500));let i=(0,a.rJ)(n.db,"articles"),o=(0,a.P)(i,(0,a._M)("slug","==",e),(0,a._M)("status","==","published")),s=await (0,a.GG)(o);if(s.empty){if(r>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{var t;let e=s.docs[0],r={id:e.id,...e.data()};return console.log("Article found by slug:",r.title,"Content length:",(null==(t=r.body)?void 0:t.length)||0),r}console.log("Article not found by slug on attempt ".concat(r,", will retry..."))}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{var t;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let i={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:a.Dc.now(),authorId:r.uid,authorName:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"articles"),i)).id,...i}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let i=(0,a.H9)(n.db,"articles",e),o=await (0,a.x7)(i);if(!o.exists())throw Error("Article not found");if(o.data().authorId!==r.uid)throw Error("You can only edit your own articles");let s={...t};t.title&&(s.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",s.slug)),s.updatedAt=a.Dc.now(),await (0,a.mZ)(i,s);let l=await (0,a.x7)(i);return{id:l.id,...l.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,a.rJ)(n.db,"articles",e,"comments"),r=(0,a.P)(t,(0,a.My)("createdAt","desc")),i=await (0,a.GG)(r),o=[];return i.forEach(e=>{let t=e.data();o.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),o}catch(e){throw console.error("Error getting comments:",e),e}}async function h(e,t){try{var r;let o=n.j2.currentUser;if(!o)throw Error("You must be logged in to comment");let l={userId:o.uid,userName:o.displayName||(null==(r=o.email)?void 0:r.split("@")[0])||"Anonymous",content:t,createdAt:a.Dc.now(),likes:[],replies:[]},c=await (0,a.gS)((0,a.rJ)(n.db,"articles",e,"comments"),l),d=await s(e);return d&&d.authorId!==o.uid&&await (0,i.fZ)(d.authorId,e,d.slug||"",d.title||"Article",c.id,t),{id:c.id,commentId:c.id,...l}}catch(e){throw console.error("Error adding comment:",e),e}}async function p(e,t,r){try{var i;let o=n.j2.currentUser;if(!o)throw Error("You must be logged in to reply");let l=(0,a.H9)(n.db,"articles",e,"comments",t),c=await (0,a.x7)(l);if(!c.exists())throw Error("Comment not found");let d={replyId:Math.random().toString(36).substring(2,15),userId:o.uid,userName:o.displayName||(null==(i=o.email)?void 0:i.split("@")[0])||"Anonymous",content:r,createdAt:a.Dc.now(),likes:[]};await (0,a.mZ)(l,{replies:(0,a.hq)(d)});let u=c.data();if(u.userId!==o.uid){let r=await s(e);console.log("User ".concat(o.uid," replied to comment ").concat(t," by ").concat(u.userId," on article ").concat(null==r?void 0:r.title))}return d}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let i=(0,a.H9)(n.db,"articles",e,"comments",t),o=await (0,a.x7)(i);if(!o.exists())throw Error("Comment not found");let s=o.data(),l=r.uid,c=(s.likes||[]).includes(l);await (0,a.mZ)(i,{likes:c?(0,a.C3)(l):(0,a.hq)(l)});let d=(await (0,a.x7)(i)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function g(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let i=(0,a.H9)(n.db,"articles",e,"comments",t),o=await (0,a.x7)(i);if(!o.exists())throw Error("Comment not found");if(o.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,a.kd)(i),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=n.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,a.H9)(n.db,"articles",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,a.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=t;try{let t=(0,a.rJ)(n.db,"articles"),i=[(0,a._M)("tags","array-contains",e),(0,a._M)("status","==","published"),(0,a.My)("createdAt","desc")];r&&r>0&&i.push((0,a.AB)(r));let o=(0,a.P)(t,...i),s=await (0,a.GG)(o),l=[];return s.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error getting articles by tag:",e),e}}},9396:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},9995:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>o,Ss:()=>s,bA:()=>l,fP:()=>d,fZ:()=>i,he:()=>c});var a=r(5317),n=r(3201);async function i(e,t,r,i,o,s){try{let t=n.j2.currentUser;if(!t||t.uid===e)return null;let l={userId:e,type:"comment",read:!1,sourceId:o,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(s.substring(0,50)).concat(s.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:a.Dc.now(),articleSlug:r,articleTitle:i};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"notifications"),l)).id,...l}}catch(e){return console.error("Error creating notification:",e),null}}async function o(e,t,r,i){try{if(e===r)return null;let o={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(i,") started following you"),fromUser:{id:r,name:t,username:i},createdAt:a.Dc.now()};return{id:(await (0,a.gS)((0,a.rJ)(n.db,"notifications"),o)).id,...o}}catch(e){return console.error("Error creating follow notification:",e),null}}async function s(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let i=(0,a.rJ)(n.db,"notifications");t=e?(0,a.P)(i,(0,a._M)("userId","==",r.uid),(0,a._M)("read","==",!1),(0,a.My)("createdAt","desc"),(0,a.AB)(100)):(0,a.P)(i,(0,a._M)("userId","==",r.uid),(0,a.My)("createdAt","desc"),(0,a.AB)(100));let o=await (0,a.GG)(t),s=[];return o.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error fetching notifications:",e),e}}async function l(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,a.H9)(n.db,"notifications",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,a.mZ)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,a.rJ)(n.db,"notifications"),r=(0,a.P)(t,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1)),i=await (0,a.GG)(r),o=i.docs.map(e=>(0,a.mZ)(e.ref,{read:!0}));return await Promise.all(o),{success:!0,count:i.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,a.H9)(n.db,"notifications",e),i=await (0,a.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,a.kd)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=n.j2.currentUser;if(!e)return 0;let t=(0,a.rJ)(n.db,"notifications"),r=(0,a.P)(t,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1));return(await (0,a.GG)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}}]);