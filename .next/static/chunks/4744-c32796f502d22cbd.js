"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4744],{3201:(r,t,e)=>{e.d(t,{db:()=>l,j2:()=>c});var o=e(3915),a=e(6864),n=e(6203),i=e(5317);let s=(0,o.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,a.P5)(s)}catch(r){}let c=(0,n.xI)(s),l=(0,i.aU)(s);window.location.origin},4744:(r,t,e)=>{e.d(t,{E$:()=>w,OQ:()=>s,Qt:()=>f,SR:()=>m,VM:()=>l,Vz:()=>c,mH:()=>h,pV:()=>d,x5:()=>u});var o=e(5317),a=e(6203),n=e(3201),i=e(9995);async function s(r){try{let t=(0,o.P)((0,o.rJ)(n.db,"users"),(0,o._M)("username","==",r.toLowerCase()));return!(await (0,o.GG)(t)).empty}catch(r){throw console.error("Error checking username:",r),r}}async function c(r,t){try{let e=await l(r);if(e){console.log("User profile already exists, updating instead of creating");let i=(0,o.H9)(n.db,"users",r);await (0,o.mZ)(i,{firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||e.bio||""}),n.j2.currentUser&&await (0,a.r7)(n.j2.currentUser,{displayName:t.username});return}let i=(0,o.P)((0,o.rJ)(n.db,"users"),(0,o._M)("email","==",t.email.toLowerCase()));if(!(await (0,o.GG)(i)).empty)throw Error("Email is already associated with another account");if(await s(t.username))throw Error("Username is already taken");let c=(0,o.H9)(n.db,"users",r);await (0,o.BN)(c,{uid:r,firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||"",createdAt:(0,o.O5)()}),n.j2.currentUser&&await (0,a.r7)(n.j2.currentUser,{displayName:t.username})}catch(r){throw console.error("Error creating user profile:",r),r}}async function l(r){try{let t=(0,o.H9)(n.db,"users",r),e=await (0,o.x7)(t);if(e.exists())return e.data();return null}catch(r){throw console.error("Error fetching user profile:",r),r}}async function u(r){try{if(!r||r.trim().length<2)return[];let t=r.toLowerCase().trim(),e=(0,o.rJ)(n.db,"users");return(await (0,o.GG)(e)).docs.map(r=>r.data()).filter(r=>{let e=r.username.toLowerCase(),o=r.firstName.toLowerCase(),a=r.lastName.toLowerCase(),n="".concat(o," ").concat(a);return e.includes(t)||o.includes(t)||a.includes(t)||n.includes(t)})}catch(r){return console.error("Error searching users:",r),[]}}async function d(r,t){try{if(r===t)throw Error("You cannot follow yourself");let e=(0,o.H9)(n.db,"users",r);await (0,o.mZ)(e,{following:(0,o.hq)(t),followingCount:(0,o.GV)(1)});let a=(0,o.H9)(n.db,"users",t);await (0,o.mZ)(a,{followers:(0,o.hq)(r),followersCount:(0,o.GV)(1)});let s=await (0,o.x7)(e);if(s.exists()){let e=s.data();await (0,i.N9)(t,"".concat(e.firstName," ").concat(e.lastName),r,e.username)}}catch(r){throw console.error("Error following user:",r),r}}async function f(r,t){try{let e=(0,o.H9)(n.db,"users",r);await (0,o.mZ)(e,{following:(0,o.C3)(t),followingCount:(0,o.GV)(-1)});let a=(0,o.H9)(n.db,"users",t);await (0,o.mZ)(a,{followers:(0,o.C3)(r),followersCount:(0,o.GV)(-1)})}catch(r){throw console.error("Error unfollowing user:",r),r}}async function w(r,t){try{var e;let a=(0,o.H9)(n.db,"users",r),i=await (0,o.x7)(a);if(!i.exists())return!1;return(null==(e=i.data().following)?void 0:e.includes(t))||!1}catch(r){throw console.error("Error checking follow status:",r),r}}async function h(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let e=(0,o.H9)(n.db,"users",r),a=await (0,o.x7)(e);if(!a.exists())return[];let i=a.data().following||[];if(0===i.length)return[];let s=[],c=Math.min(i.length,t);for(let r=0;r<c;r++){let t=i[r],e=(0,o.H9)(n.db,"users",t),a=await (0,o.x7)(e);a.exists()&&s.push(a.data())}return s}catch(r){throw console.error("Error getting following list:",r),r}}async function m(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let e=(0,o.H9)(n.db,"users",r),a=await (0,o.x7)(e);if(!a.exists())return[];let i=a.data().followers||[];if(0===i.length)return[];let s=[],c=Math.min(i.length,t);for(let r=0;r<c;r++){let t=i[r],e=(0,o.H9)(n.db,"users",t),a=await (0,o.x7)(e);a.exists()&&s.push(a.data())}return s}catch(r){throw console.error("Error getting followers list:",r),r}}},9995:(r,t,e)=>{e.d(t,{Hs:()=>d,N9:()=>i,Ss:()=>s,bA:()=>c,fP:()=>u,fZ:()=>n,he:()=>l});var o=e(5317),a=e(3201);async function n(r,t,e,n,i,s){try{let t=a.j2.currentUser;if(!t||t.uid===r)return null;let c={userId:r,type:"comment",read:!1,sourceId:i,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(s.substring(0,50)).concat(s.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:o.Dc.now(),articleSlug:e,articleTitle:n};return{id:(await (0,o.gS)((0,o.rJ)(a.db,"notifications"),c)).id,...c}}catch(r){return console.error("Error creating notification:",r),null}}async function i(r,t,e,n){try{if(r===e)return null;let i={userId:r,type:"follow",read:!1,sourceId:e,sourceType:"user",message:"".concat(t," (@").concat(n,") started following you"),fromUser:{id:e,name:t},createdAt:o.Dc.now()};return{id:(await (0,o.gS)((0,o.rJ)(a.db,"notifications"),i)).id,...i}}catch(r){return console.error("Error creating follow notification:",r),null}}async function s(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,e=a.j2.currentUser;if(!e)throw Error("User not authenticated");let n=(0,o.rJ)(a.db,"notifications");t=r?(0,o.P)(n,(0,o._M)("userId","==",e.uid),(0,o._M)("read","==",!1),(0,o.My)("createdAt","desc"),(0,o.AB)(100)):(0,o.P)(n,(0,o._M)("userId","==",e.uid),(0,o.My)("createdAt","desc"),(0,o.AB)(100));let i=await (0,o.GG)(t),s=[];return i.forEach(r=>{s.push({id:r.id,...r.data()})}),s}catch(r){throw console.error("Error fetching notifications:",r),r}}async function c(r){try{let t=a.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.H9)(a.db,"notifications",r),n=await (0,o.x7)(e);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.mZ)(e,{read:!0}),{success:!0}}catch(r){throw console.error("Error marking notification as read:",r),r}}async function l(){try{let r=a.j2.currentUser;if(!r)throw Error("User not authenticated");let t=(0,o.rJ)(a.db,"notifications"),e=(0,o.P)(t,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1)),n=await (0,o.GG)(e),i=n.docs.map(r=>(0,o.mZ)(r.ref,{read:!0}));return await Promise.all(i),{success:!0,count:n.size}}catch(r){throw console.error("Error marking all notifications as read:",r),r}}async function u(r){try{let t=a.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.H9)(a.db,"notifications",r),n=await (0,o.x7)(e);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.kd)(e),{success:!0}}catch(r){throw console.error("Error deleting notification:",r),r}}async function d(){try{let r=a.j2.currentUser;if(!r)return 0;let t=(0,o.rJ)(a.db,"notifications"),e=(0,o.P)(t,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1));return(await (0,o.GG)(e)).size}catch(r){return console.error("Error counting unread notifications:",r),0}}}}]);