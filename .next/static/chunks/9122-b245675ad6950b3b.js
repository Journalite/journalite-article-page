"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9122],{3201:(e,t,r)=>{r.d(t,{db:()=>n,j2:()=>i});var o=r(3915),a=r(6864),c=r(6203),l=r(5317);let s=(0,o.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,a.P5)(s)}catch(e){}let i=(0,c.xI)(s),n=(0,l.aU)(s);window.location.origin},9122:(e,t,r)=>{r.d(t,{Aq:()=>n,Gy:()=>d,QT:()=>i,Tt:()=>s,saveReflectionResponse:()=>c});var o=r(5317),a=r(3201);async function c(e,t,r,c,s){let i=!(arguments.length>5)||void 0===arguments[5]||arguments[5];console.log("saveReflectionResponse called with:",{articleId:e,promptId:t,promptText:r,response:c,position:s,isPrivate:i});let n=a.j2.currentUser;if(console.log("Current user:",n?n.uid:"Not authenticated"),!n){console.log("User not authenticated, saving to local storage"),l(e,t,r,c,s,i);return}let d="".concat(n.uid,"_").concat(e,"_").concat(t,"_").concat(Date.now()),p=(0,o.doc)(a.db,"reflectionResponses",d),u={id:d,userId:n.uid,articleId:e,promptId:t,promptText:r,response:c,position:s,createdAt:(0,o.O5)(),isPrivate:i};try{console.log("Attempting to save to Firestore with ID:",d),await (0,o.BN)(p,u),console.log("Successfully saved to Firestore"),l(e,t,r,c,s,i)}catch(o){console.error("Error saving reflection response:",o),l(e,t,r,c,s,i)}}function l(e,t,r,o,a,c){try{let l="reflection_".concat(e);console.log("Saving to local storage with key:",l);let s=localStorage.getItem(l),i=s?JSON.parse(s):[];console.log("Existing reflections:",i.length);let n={id:"local_".concat(Date.now()),promptId:t,promptText:r,response:o,position:a,createdAt:new Date().toISOString(),isPrivate:c};i.push(n),localStorage.setItem(l,JSON.stringify(i)),console.log("Successfully saved to local storage. Total reflections:",i.length)}catch(e){console.error("Error saving reflection to local storage:",e)}}async function s(e){let t=a.j2.currentUser,c=e||(null==t?void 0:t.uid),l=new Map;if(t&&c)try{let e=(0,o.rJ)(a.db,"reflectionResponses"),t=(0,o.P)(e,(0,o._M)("userId","==",c),(0,o.My)("createdAt","desc"));(await (0,o.GG)(t)).docs.forEach(e=>{let t=e.data(),r=t.articleId;l.has(r)||l.set(r,{userId:t.userId,articleId:r,articleTitle:"Loading...",articleSlug:r,responses:[],createdAt:t.createdAt,updatedAt:t.createdAt});let o=l.get(r);o.responses.push(t),t.createdAt>o.updatedAt&&(o.updatedAt=t.createdAt)})}catch(e){console.error("Error fetching reflection responses from Firestore:",e)}try{Object.keys(localStorage).filter(e=>e.startsWith("reflection_")).forEach(e=>{let t=e.replace("reflection_",""),r=localStorage.getItem(e);if(r)try{let e=JSON.parse(r);if(!Array.isArray(e))return;e.forEach(e=>{let r={id:e.id||"local_".concat(Date.now()),userId:"local",articleId:t,promptId:e.promptId,promptText:e.promptText,response:e.response,position:e.position,createdAt:new Date(e.createdAt),isPrivate:e.isPrivate};l.has(t)||l.set(t,{userId:"local",articleId:t,articleTitle:"Loading...",articleSlug:t,responses:[],createdAt:r.createdAt,updatedAt:r.createdAt});let o=l.get(t);!o.responses.some(e=>e.promptId===r.promptId&&e.position===r.position&&e.response===r.response)&&(o.responses.push(r),r.createdAt>o.updatedAt&&(o.updatedAt=r.createdAt))})}catch(e){console.error("Error parsing local storage reflection data:",e)}})}catch(e){console.error("Error reading from local storage:",e)}let s=Array.from(l.values()).filter(e=>e.responses.length>0);return await Promise.all(s.map(async e=>{try{let{getArticleById:t}=await r.e(9210).then(r.bind(r,9210)),o=await t(e.articleId);o?(e.articleTitle=o.title,e.articleSlug=o.slug||e.articleId,console.log("Successfully fetched title for ".concat(e.articleId,": ").concat(o.title))):(e.articleTitle="Article: ".concat(e.articleId),console.log("Article not found for ID: ".concat(e.articleId)))}catch(t){console.error("Error fetching article for ".concat(e.articleId,":"),t),e.articleTitle="Article: ".concat(e.articleId)}})),s.sort((e,t)=>{let r=e.updatedAt instanceof Date?e.updatedAt.getTime():e.updatedAt.toMillis();return(t.updatedAt instanceof Date?t.updatedAt.getTime():t.updatedAt.toMillis())-r}),s}async function i(e,t){console.log("Deleting reflection:",{articleId:e,reflectionId:t});let r=a.j2.currentUser,c=!1,l=!1;if(r)try{let l=(0,o.rJ)(a.db,"reflectionResponses"),s=(0,o.P)(l,(0,o._M)("userId","==",r.uid),(0,o._M)("articleId","==",e),(0,o._M)("id","==",t)),i=await (0,o.GG)(s);if(!i.empty){let e=i.docs[0];await (0,o.kd)(e.ref),console.log("Successfully deleted from Firestore"),c=!0}}catch(e){console.error("Error deleting from Firestore:",e)}try{let r="reflection_".concat(e),o=localStorage.getItem(r);if(o){let e=JSON.parse(o),a=e.filter(e=>e.id!==t);a.length!==e.length&&(0===a.length?localStorage.removeItem(r):localStorage.setItem(r,JSON.stringify(a)),console.log("Successfully deleted from local storage"),l=!0)}}catch(e){console.error("Error deleting from local storage:",e)}return c||l}async function n(e){let t=a.j2.currentUser,c=e||(null==t?void 0:t.uid),l=[],s=new Set;if(t&&c)try{let e=(0,o.rJ)(a.db,"reflectionResponses"),t=(0,o.P)(e,(0,o._M)("userId","==",c),(0,o.My)("createdAt","desc"),(0,o.AB)(10)),i=await (0,o.GG)(t),n=new Map;for(let e of i.docs){let t=e.data();if(t.response&&t.response.length>20){let e=t.response.toLowerCase().trim();if(!s.has(e)){s.add(e);let o=n.get(t.articleId);if(!o)try{let{getArticleById:e}=await r.e(9210).then(r.bind(r,9210)),a=await e(t.articleId);o=(null==a?void 0:a.title)||"Unknown Article",n.set(t.articleId,o)}catch(e){o="Unknown Article"}l.push({response:t.response,articleTitle:o,promptText:t.promptText})}}}}catch(e){console.error("Error fetching inspiration from Firestore:",e)}try{let e=Object.keys(localStorage).filter(e=>e.startsWith("reflection_")),t=[];e.forEach(e=>{let r=localStorage.getItem(e);if(r)try{let e=JSON.parse(r);Array.isArray(e)&&t.push(...e)}catch(e){console.error("Error parsing local storage reflection:",e)}}),t.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,10).forEach(e=>{if(e.response&&e.response.length>20){let t=e.response.toLowerCase().trim();s.has(t)||(s.add(t),l.push({response:e.response,articleTitle:"Local Article",promptText:e.promptText}))}})}catch(e){console.error("Error reading inspiration from local storage:",e)}return l.sort(()=>Math.random()-.5).slice(0,5)}async function d(e){let t=a.j2.currentUser,r=e||(null==t?void 0:t.uid),c=new Set,l=[];if(t&&r)try{let e=(0,o.rJ)(a.db,"reflectionResponses"),t=(0,o.P)(e,(0,o._M)("userId","==",r),(0,o.My)("createdAt","desc"),(0,o.AB)(20));(await (0,o.GG)(t)).docs.forEach(e=>{let t=e.data();t.promptText&&l.push(t.promptText)})}catch(e){console.error("Error fetching themes from Firestore:",e)}try{Object.keys(localStorage).filter(e=>e.startsWith("reflection_")).forEach(e=>{let t=localStorage.getItem(e);if(t)try{let e=JSON.parse(t);Array.isArray(e)&&e.forEach(e=>{e.promptText&&l.push(e.promptText)})}catch(e){console.error("Error parsing local storage for themes:",e)}})}catch(e){console.error("Error reading themes from local storage:",e)}return l.forEach(e=>{let t=e.toLowerCase();t.includes("feel")&&c.add("emotions"),(t.includes("choice")||t.includes("decision"))&&c.add("decision-making"),t.includes("experience")&&c.add("personal experience"),t.includes("question")&&c.add("questioning"),t.includes("surprise")&&c.add("unexpected insights"),(t.includes("perspective")||t.includes("view"))&&c.add("perspectives"),t.includes("author")&&c.add("dialogue with authors"),(t.includes("relate")||t.includes("connect"))&&c.add("connections")}),Array.from(c).slice(0,6)}}}]);