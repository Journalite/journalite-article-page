(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4632],{3891:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var s=a(5155),n=a(2115),l=a(3201),r=a(5317),o=a(4744);class i{async startPresence(e){let t=l.j2.currentUser;if(t)try{let a=await (0,o.VM)(t.uid);if(!a)return;let s=(0,r.doc)(l.db,"articlePresence","".concat(e,"_").concat(t.uid));await (0,r.setDoc)(s,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,r.serverTimestamp)(),articleId:e});let n=setInterval(async()=>{if(l.j2.currentUser&&!document.hidden)try{await (0,r.setDoc)(s,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,r.serverTimestamp)(),articleId:e})}catch(t){clearInterval(n),this.heartbeatIntervals.delete(e)}},15e3);this.heartbeatIntervals.set(e,n);let i=()=>{this.stopPresence(e)};window.addEventListener("beforeunload",i),window.addEventListener("pagehide",i),document.addEventListener("visibilitychange",()=>{document.hidden&&setTimeout(()=>{document.hidden&&this.stopPresence(e)},3e4)});let c=l.j2.onAuthStateChanged(t=>{t||this.stopPresence(e)});this.presenceRefs.set(e,()=>{i(),c()})}catch(e){}}async stopPresence(e){let t=l.j2.currentUser;if(t)try{let a=this.heartbeatIntervals.get(e);a&&(clearInterval(a),this.heartbeatIntervals.delete(e));let s=(0,r.doc)(l.db,"articlePresence","".concat(e,"_").concat(t.uid));await (0,r.deleteDoc)(s);let n=this.presenceRefs.get(e);n&&(window.removeEventListener("beforeunload",n),this.presenceRefs.delete(e))}catch(e){}}subscribeToActiveUsers(e,t){let a=new Date(Date.now()-45e3),s=(0,r.query)((0,r.collection)(l.db,"articlePresence"),(0,r.where)("articleId","==",e),(0,r.where)("lastSeen",">",r.Timestamp.fromDate(a)),(0,r.orderBy)("lastSeen","desc"),(0,r.limit)(10));return(0,r.onSnapshot)(s,async e=>{try{let a=[];for(let t of e.docs){let e=t.data();if(!l.j2.currentUser||e.uid!==l.j2.currentUser.uid)try{let t=await (0,o.VM)(e.uid);a.push({...e,profile:t||void 0})}catch(t){a.push({...e,profile:void 0})}}t(a)}catch(e){t([])}},e=>{t([])})}async cleanupStalePresence(){try{let e=new Date(Date.now()-6e4),t=(0,r.query)((0,r.collection)(l.db,"articlePresence"),(0,r.where)("lastSeen","<",r.Timestamp.fromDate(e))),a=(await (0,r.getDocs)(t)).docs.map(e=>(0,r.deleteDoc)(e.ref));a.length>0&&await Promise.all(a)}catch(e){}}cleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.heartbeatIntervals.forEach(e=>{clearInterval(e)}),this.heartbeatIntervals.clear(),this.presenceRefs.forEach(e=>{e()}),this.presenceRefs.clear()}constructor(){this.presenceRefs=new Map,this.heartbeatIntervals=new Map,this.cleanupInterval=null,this.cleanupInterval=setInterval(()=>{this.cleanupStalePresence()},3e4)}}let c=new i;window.addEventListener("beforeunload",()=>{c.cleanup()});var d=a(6336),m=a.n(d);let v=e=>{var t,a;return(null==(t=e.profile)?void 0:t.firstName)&&(null==(a=e.profile)?void 0:a.lastName)?"".concat(e.profile.firstName[0]).concat(e.profile.lastName[0]).toUpperCase():e.firstName&&e.lastName?"".concat(e.firstName[0]).concat(e.lastName[0]).toUpperCase():e.username?e.username.slice(0,2).toUpperCase():"?"},h=e=>{var t,a;return(null==(t=e.profile)?void 0:t.firstName)&&(null==(a=e.profile)?void 0:a.lastName)?"".concat(e.profile.firstName," ").concat(e.profile.lastName):e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||"Anonymous"},u=e=>{let t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FECA57","#FF9FF3","#A8E6CF","#FFD93D"];return t[e%t.length]},p=e=>{let{articleId:t}=e,[a,r]=(0,n.useState)([]),[o,i]=(0,n.useState)(!1),[d,p]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=l.j2.onAuthStateChanged(e=>{p(!!e)});return()=>e()},[]),(0,n.useEffect)(()=>{if(!t||!d)return;c.startPresence(t);let e=c.subscribeToActiveUsers(t,e=>{let t=e.slice(0,5);r(t),i(t.length>0)});return()=>{e(),c.stopPresence(t)}},[t,d]),d&&o&&0!==a.length)?(0,s.jsxs)("div",{className:m().activeReadersContainer,children:[(0,s.jsxs)("div",{className:m().avatarStack,children:[a.map((e,t)=>(0,s.jsx)("div",{className:m().avatar,style:{backgroundColor:u(t),zIndex:5-t,left:"".concat(20*t,"px")},title:h(e),children:v(e)},e.uid)),a.length>0&&(0,s.jsx)("div",{className:m().readingIndicator,style:{left:"".concat((a.length-1)*20+24,"px")},children:(0,s.jsx)("div",{className:m().pulse})})]}),(0,s.jsx)("div",{className:m().tooltip,children:1===a.length?(0,s.jsxs)("span",{children:[h(a[0])," is reading this"]}):(0,s.jsxs)("span",{children:[a.length," people are reading this"]})})]}):null}},4362:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var s=a(5155);a(2115);var n=a(6874),l=a.n(n),r=a(5695),o=a(8163),i=a.n(o);let c=e=>{let{isAuthenticated:t}=e,a=(0,r.usePathname)();return(0,s.jsx)("nav",{className:i()["bottom-navigation"],children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l(),{href:"/",className:"".concat(i()["bottom-nav-item"]," ").concat("/"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 0 0 1 1h3m10-11 2 2m-2-2v10a1 1 0 0 1-1 1h-3m-6 0a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1m-6 0h6'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Home"})]}),(0,s.jsxs)(l(),{href:"/create-article",className:"".concat(i()["bottom-nav-item"]," ").concat("/create-article"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/create-article"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Write"})]}),(0,s.jsxs)(l(),{href:"/my-thoughts",className:"".concat(i()["bottom-nav-item"]," ").concat("/my-thoughts"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/my-thoughts"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"My Posts"})]}),(0,s.jsxs)(l(),{href:"/explore",className:"".concat(i()["bottom-nav-item"]," ").concat("/explore"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/explore"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Explore"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l(),{href:"/",className:"".concat(i()["bottom-nav-item"]," ").concat("/"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 0 0 1 1h3m10-11 2 2m-2-2v10a1 1 0 0 1-1 1h-3m-6 0a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1m-6 0h6'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Home"})]}),(0,s.jsxs)(l(),{href:"/explore",className:"".concat(i()["bottom-nav-item"]," ").concat("/explore"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/explore"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Explore"})]}),(0,s.jsxs)(l(),{href:"/register",className:"".concat(i()["bottom-nav-item"]," ").concat("/register"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/register"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Sign Up"})]}),(0,s.jsxs)(l(),{href:"/login",className:"".concat(i()["bottom-nav-item"]," ").concat("/login"===a?i().active:""),children:[(0,s.jsx)("div",{className:i()["bottom-nav-icon"],style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='".concat("/login"===a?"%232563EB":"%236B7280","'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75'/%3E%3C/svg%3E\")")}}),(0,s.jsx)("span",{className:i()["bottom-nav-text"],children:"Login"})]})]})})}},5405:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(5155),n=a(2115),l=a(3201);let r=n.memo(e=>{let{articleId:t,initialLikes:r=[],className:o="",styles:i={}}=e,[c,d]=(0,n.useState)(r),[m,v]=(0,n.useState)(!1),[h,u]=(0,n.useState)(null),[p,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=l.j2.onAuthStateChanged(e=>{u(e),e?v(c.includes(e.uid)):v(!1)});return()=>e()},[c]),(0,n.useEffect)(()=>{d(r),h&&v(r.includes(h.uid))},[r,h]);let w=async e=>{if(e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDC4D LikeButton clicked - should NOT trigger parent re-render"),!h)return void alert("Please login to like articles");g(!0),setTimeout(()=>g(!1),300);try{if(m){let e=c.filter(e=>e!==h.uid);d(e),v(!1),console.log("\uD83D\uDC4D Unlike completed - likes:",e.length);let{doc:s,updateDoc:n,arrayRemove:l}=await Promise.resolve().then(a.bind(a,5317)),{db:r}=await Promise.resolve().then(a.bind(a,3201)),o=s(r,"articles",t);await n(o,{likes:l(h.uid)})}else{let e=[...c,h.uid];d(e),v(!0),console.log("\uD83D\uDC4D Like completed - likes:",e.length);let{doc:s,updateDoc:n,arrayUnion:l}=await Promise.resolve().then(a.bind(a,5317)),{db:r}=await Promise.resolve().then(a.bind(a,3201)),o=s(r,"articles",t);await n(o,{likes:l(h.uid)})}}catch(e){console.error("Error updating like status:",e),m?(d([...c,h.uid]),v(!0)):(d(c.filter(e=>e!==h.uid)),v(!1))}};return(0,s.jsxs)("button",{className:"".concat(o," ").concat(m?i.liked:""),onClick:w,"aria-label":m?"Unlike article":"Like article",style:{transition:"all 0.3s ease",transform:p?"scale(1.2)":"scale(1)"},children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:m?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:i.likeIcon,style:{transition:"all 0.3s ease",filter:p?"drop-shadow(0 0 8px currentColor)":"none"},children:(0,s.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,s.jsx)("span",{children:c.length>0?c.length:""})]})})},6336:e=>{e.exports={activeReadersContainer:"ActiveReaders_activeReadersContainer__kzDyK",avatarStack:"ActiveReaders_avatarStack__C0oAd",avatar:"ActiveReaders_avatar__dmRJ6",readingIndicator:"ActiveReaders_readingIndicator__aAJCN",pulse:"ActiveReaders_pulse__xIR81",tooltip:"ActiveReaders_tooltip__hAqNr",avatarAppear:"ActiveReaders_avatarAppear__UbwiK",slideIn:"ActiveReaders_slideIn__40eQ_"}}}]);