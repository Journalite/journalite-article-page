(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2650],{2650:(e,t,r)=>{"use strict";r.d(t,{A:()=>q});var a=r(5155),s=r(2115),l=r(5695),n=r(621),o=r(9210),i=r(3201),c=r(5317);async function d(e,t){let r=i.j2.currentUser;if(!r)throw Error("Authentication required");try{let a=(0,c.doc)(i.db,"articles",e);await (0,c.updateDoc)(a,{hasReflectionRoom:!0,updatedAt:(0,c.serverTimestamp)()});let s=(0,c.doc)(i.db,"reflections",e,"metadata","main");await (0,c.setDoc)(s,{topic:t,createdAt:(0,c.serverTimestamp)(),authorId:r.uid})}catch(e){throw console.error("Error enabling reflection room:",e),e}}async function u(e,t){if(!i.j2.currentUser)throw Error("Authentication required");try{let r=(0,c.collection)(i.db,"reflections",e,"messages"),a=(await (0,c.getDocs)(r)).docs.map(e=>(0,c.deleteDoc)(e.ref));await Promise.all(a);let s=(0,c.doc)(i.db,"reflections",e,"metadata","main");await (0,c.updateDoc)(s,{topic:t,updatedAt:(0,c.serverTimestamp)()})}catch(e){throw console.error("Error updating reflection topic:",e),e}}r(4488);var h=r(2571),m=r(2695),g=r(290),p=r(1514),f=r(7729),x=r(6770),b=r(7421),v=r(8754),y=r(156);let j=new y.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>["h".concat(e.attrs.level),0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:a,width:s,height:l}=e.attrs,n={src:t};return null!=r&&(n.alt=r),null!=a&&(n.title=a),null!=s&&(n.width=s),null!=l&&(n.height=l),["img",n]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:"javascript"}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs(e){let t=e.getAttribute("data-language");if(t)return{language:t};let r=e.querySelector("code");if(r){let e=(r.className||"").match(/language-(\w+)/);if(e)return{language:e[1]}}return{language:"javascript"}},getContent(e,t){let r=e.querySelector("code");if(r){let e=r.textContent||r.innerText||"";return e?[t.text(e)]:[]}return[]}}],toDOM:e=>["pre",{"data-language":e.attrs.language},["code",{class:"language-".concat(e.attrs.language)},0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:a}=e.attrs,s={href:t};return null!=r&&(s.title=r),null!=a&&(s.target=a),["a",s,0]}}}});function w(){return j.node("doc",null,[j.node("paragraph")])}function N(e){if(!e||""===e.trim())return w();let t=document.createElement("div");return t.innerHTML=e,y.S4.fromSchema(j).parse(t)}function k(e){let t=document.createElement("div");return t.appendChild(y.ZF.fromSchema(j).serializeFragment(e.content)),t.innerHTML}let C=(e,t)=>(r,a,s)=>{let l=!1;(0,p.T2)(t)(r,a,s)&&(r=s.state,l=!0);let n=e(r,a,s);return l||n},{heading:_,paragraph:E,list_item:D,blockquote:M}=j.nodes,S=e=>C((0,g.y_)(_,{level:e}),D),A=()=>C((0,g.y_)(E),D),T=(e,t,r)=>{let{from:a,to:s}=e.selection,l=!1;return(e.doc.nodesBetween(a,s,e=>e.type!==M||(l=!0,!1)),l)?!!(0,p.T2)(D)(e,t)||(0,g.yY)(e,t):((0,p.T2)(D)(e,t)&&(e=r.state),(0,g.Im)(M)(e,t,r))};new h.k_({key:new h.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:a}=e,{$from:s,empty:l}=r.selection,{heading:n,paragraph:o}=j.nodes;return!!l&&s.parent.type===n&&s.parentOffset===s.parent.content.size&&(t.preventDefault(),(0,g.y_)(o)(r,a,e))}}}),r(3241),r(8042),r(5802),r(7846),r(1280),r(8496),r(941),r(3523),r(4495),r(1177),r(1990),r(3686),r(642),r(7867),r(3337),r(3435),r(1055),r(2103),r(255),r(9829),r(656);var H=r(5901),z=r.n(H);let R=s.forwardRef((e,t)=>{let{articleId:r,initialContent:l="",onChange:n,placeholder:o="Tell your story...",className:i=""}=e,c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(n),[y,C]=(0,s.useState)(!1);u.current=n;let _=(0,s.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current,{selection:a}=t,s=j.text(e);r(t.tr.replaceSelectionWith(s)),d.current.focus()},[]);s.useImperativeHandle(t,()=>({insertText:_,focus:()=>{var e;return null==(e=d.current)?void 0:e.focus()}}),[_]),(0,s.useEffect)(()=>{if(c.current&&!d.current){try{let e;if(l&&l.trim())try{e=N(l)}catch(t){console.error("Editor: Failed to parse HTML content:",t),e=w()}else e=w();let t=h.$t.create({doc:e,plugins:[(0,x.w)({"Mod-b":(0,g.wh)(j.marks.strong),"Mod-i":(0,g.wh)(j.marks.em),"Mod-z":f.tN,"Mod-y":f.ZS,Enter:(0,p.wn)(j.nodes.list_item),"Mod-[":(0,p.T2)(j.nodes.list_item),"Mod-]":(0,p.$B)(j.nodes.list_item),Space:(e,t)=>{let{$from:r}=e.selection;if(r.parent.type===j.nodes.paragraph){let a=r.parent.textContent.slice(0,r.parentOffset),s=a.match(/^(#{1,6})$/);if(s){let a=s[1].length,l=e.tr.delete(r.start(),r.pos).setBlockType(r.start(),r.start(),j.nodes.heading,{level:a});return t(l),!0}let l=a.match(/\*\*([^*]+)\*\*$/);if(l){let a=r.pos-l[0].length,s=e.tr.delete(a,r.pos).insertText(l[1]+" ",a).addMark(a,a+l[1].length,j.marks.strong);return t(s),!0}let n=a.match(RegExp("(?<!\\*)\\*([^*]+)\\*$"));if(n){let a=r.pos-n[0].length,s=e.tr.delete(a,r.pos).insertText(n[1]+" ",a).addMark(a,a+n[1].length,j.marks.em);return t(s),!0}let o=a.match(/`([^`]+)`$/);if(o){let a=r.pos-o[0].length,s=e.tr.delete(a,r.pos).insertText(o[1]+" ",a).addMark(a,a+o[1].length,j.marks.code);return t(s),!0}if(a.match(/^[-*]$/))try{let a=j.nodes.list_item.create(null,j.nodes.paragraph.create()),s=j.nodes.bullet_list.create(null,a),l=r.pos-1,n=e.tr.delete(l,r.pos).replaceWith(l,l,s);return n=n.setSelection(h.U3.create(n.doc,l+2)),t(n),!0}catch(e){}if(a.match(/^1\.$/))try{let a=j.nodes.list_item.create(null,j.nodes.paragraph.create()),s=j.nodes.ordered_list.create(null,a),l=r.pos-2,n=e.tr.delete(l,r.pos).replaceWith(l,l,s);return n=n.setSelection(h.U3.create(n.doc,l+2)),t(n),!0}catch(e){}}return!1}}),(0,x.w)(g.RV),(0,f.b6)(),(0,b.A)(),(0,v.z)()]}),r=new m.Lz(c.current,{state:t,editable:()=>!0,dispatchTransaction:e=>{let t=r.state.apply(e);if(r.updateState(t),e.docChanged&&u.current){let e=k(t.doc),r=t.doc.toJSON();u.current(e,r)}},attributes:{"data-placeholder":o||"Tell your story..."}});d.current=r,C(!0),setTimeout(()=>{r&&!r.isDestroyed&&r.focus()},100)}catch(e){console.error("Error initializing editor:",e),C(!0)}return()=>{d.current&&(d.current.destroy(),d.current=null)}}},[]),(0,s.useEffect)(()=>{if(d.current&&y&&l)try{let e=N(l),t=k(d.current.state.doc);if(l!==t){let t=d.current.state.tr.replaceWith(0,d.current.state.doc.content.size,e.content);d.current.dispatch(t)}}catch(e){console.error("Editor: Failed to update content:",e)}},[l,y]);let E=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.wh)(j.marks.strong)(e,t)&&d.current.focus()},[]),D=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.wh)(j.marks.em)(e,t)&&d.current.focus()},[]),M=(0,s.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current;S(e)(t,r,d.current)&&d.current.focus()},[]);(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;A()(e,t,d.current)&&d.current.focus()},[]);let H=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;T(e,t,d.current)&&d.current.focus()},[]),R=(0,s.useCallback)(()=>{if(!d.current)return;let e=prompt("Enter programming language (e.g., javascript, python, css):","javascript");if(!e)return;let{state:t,dispatch:r}=d.current,{from:a,to:s}=t.selection,l=j.nodes.code_block.create({language:e.toLowerCase()}),n=t.tr.replaceRangeWith(a,s,l);r&&(r(n),d.current.focus())},[]),B=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current,{$from:r,$to:a}=e.selection;try{let s=j.nodes.list_item.create(null,j.nodes.paragraph.create(null,r.parent.content)),l=j.nodes.bullet_list.create(null,s),n=e.tr.replaceWith(r.start(),a.end(),l);t(n),d.current.focus()}catch(r){(0,p.Sd)(j.nodes.bullet_list)(e,t)&&d.current.focus()}},[]),L=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current,{$from:r,$to:a}=e.selection;try{let s=j.nodes.list_item.create(null,j.nodes.paragraph.create(null,r.parent.content)),l=j.nodes.ordered_list.create(null,s),n=e.tr.replaceWith(r.start(),a.end(),l);t(n),d.current.focus()}catch(r){(0,p.Sd)(j.nodes.ordered_list)(e,t)&&d.current.focus()}},[]),I=(0,s.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&d.current){let{state:t,dispatch:r}=d.current,a=j.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(a)),d.current.focus()}},[]),O=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,f.tN)(e,t),d.current.focus()},[]),W=(0,s.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,f.ZS)(e,t),d.current.focus()},[]),q=(0,s.useCallback)(e=>{if(!d.current)return!1;let{from:t,$from:r,to:a,empty:s}=d.current.state.selection;return s?e.isInSet(d.current.state.storedMarks||r.marks()):d.current.state.doc.rangeHasMark(t,a,e)},[]),U=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d.current)return!1;let{from:r,to:a}=d.current.state.selection,s=!0;return d.current.state.doc.nodesBetween(r,a,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(s=!1,!1)),s},[]),F=(0,s.useCallback)(()=>{if(!d.current)return!1;let{from:e,to:t}=d.current.state.selection,r=!1;return d.current.state.doc.nodesBetween(e,t,e=>e.type!==j.nodes.blockquote||(r=!0,!1)),r},[]);return(0,a.jsxs)("div",{className:"".concat(z().editor," ").concat("seamless-editor"===i?z().seamlessEditor:""),style:"seamless-editor"===i?{}:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[y&&(0,a.jsx)("div",{className:z().modernToolbar,style:"seamless-editor"===i?{}:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,a.jsxs)("div",{className:z().toolbarContainer,children:[(0,a.jsxs)("div",{className:z().formatGroup,children:[(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(q(j.marks.strong)?z().active:""),onClick:E,title:"Bold (⌘B)","aria-label":"Bold",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(q(j.marks.em)?z().active:""),onClick:D,title:"Italic (⌘I)","aria-label":"Italic",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,a.jsx)("div",{className:z().divider}),(0,a.jsxs)("div",{className:z().formatGroup,children:[(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(U(j.nodes.heading,{level:1})?z().active:""),onClick:()=>M(1),title:"Large Heading (⌘⇧1)","aria-label":"Heading 1",children:(0,a.jsx)("span",{className:z().headingIcon,children:"H1"})}),(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(U(j.nodes.heading,{level:2})?z().active:""),onClick:()=>M(2),title:"Medium Heading (⌘⇧2)","aria-label":"Heading 2",children:(0,a.jsx)("span",{className:z().headingIcon,children:"H2"})}),(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(U(j.nodes.heading,{level:3})?z().active:""),onClick:()=>M(3),title:"Small Heading (⌘⇧3)","aria-label":"Heading 3",children:(0,a.jsx)("span",{className:z().headingIcon,children:"H3"})})]}),(0,a.jsx)("div",{className:z().divider}),(0,a.jsxs)("div",{className:z().formatGroup,children:[(0,a.jsx)("button",{className:z().toolBtn,onClick:B,title:"Bullet List","aria-label":"Bullet list",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,a.jsx)("button",{className:z().toolBtn,onClick:L,title:"Numbered List","aria-label":"Numbered list",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(F()?z().active:""),onClick:H,title:"Quote (⌘>)","aria-label":"Quote",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,a.jsx)("div",{className:z().divider}),(0,a.jsxs)("div",{className:z().formatGroup,children:[(0,a.jsx)("button",{className:z().toolBtn,onClick:I,title:"Add Image","aria-label":"Insert image",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,a.jsx)("button",{className:"".concat(z().toolBtn," ").concat(U(j.nodes.code_block)?z().active:""),onClick:R,title:"Code Block","aria-label":"Code block",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,a.jsx)("div",{className:z().divider}),(0,a.jsxs)("div",{className:z().formatGroup,children:[(0,a.jsx)("button",{className:z().toolBtn,onClick:O,title:"Undo (⌘Z)","aria-label":"Undo",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,a.jsx)("button",{className:z().toolBtn,onClick:W,title:"Redo (⌘Y)","aria-label":"Redo",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!y&&(0,a.jsxs)("div",{className:z().loading,children:[(0,a.jsx)("div",{className:z().loadingSpinner}),(0,a.jsx)("span",{children:"Loading editor..."})]}),(0,a.jsx)("div",{ref:c,className:z().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"seamless-editor"===i?"500px":"400px",opacity:y?1:.3,..."seamless-editor"===i?{background:"transparent",border:"none",boxShadow:"none",padding:0,margin:0,fontSize:"18px",lineHeight:"1.6",color:"#1f2937"}:{}}})]})});R.displayName="Editor";var B=r(9122),L=r(4814),I=r(8163),O=r.n(I);let W=e=>{let{onInsert:t}=e,[r,l]=(0,s.useState)(!1),[n,o]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(!1),[h,m]=(0,s.useState)("inspirations"),g=async()=>{u(!0);try{let[e,t]=await Promise.all([(0,B.Aq)(),(0,B.Gy)()]);o(e),c(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{u(!1)}},p=e=>{t&&t(e),l(!1)},f=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||"Write about ".concat(e,"...");return r?(0,a.jsx)("div",{className:"fixed bottom-8 right-8 z-40 w-96",children:(0,a.jsxs)("div",{className:"".concat(O()["glass-modal"]," max-h-96 overflow-hidden"),children:[(0,a.jsx)("div",{className:O()["glass-highlight"]}),(0,a.jsxs)("div",{className:O()["glass-content"],children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-stone-800 flex items-center gap-2 font-serif",children:[(0,a.jsx)(L.TG,{size:18,color:"#f59e0b"}),"Your Reflection Insights"]}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-stone-500 hover:text-stone-700 text-xl font-bold leading-none",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"flex p-4 gap-2",children:[(0,a.jsxs)("button",{className:"".concat(O()["glass-tag"]," flex-1 text-center py-2 text-sm font-semibold transition-all ").concat("inspirations"===h?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"),onClick:()=>m("inspirations"),children:["Recent Thoughts (",n.length,")"]}),(0,a.jsxs)("button",{className:"".concat(O()["glass-tag"]," flex-1 text-center py-2 text-sm font-semibold transition-all ").concat("themes"===h?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"),onClick:()=>m("themes"),children:["Writing Themes (",i.length,")"]})]}),(0,a.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:d?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-stone-600",children:"Loading your insights..."})]}):"inspirations"===h?(0,a.jsx)("div",{children:0===n.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,a.jsx)(L.d3,{size:16,color:"#6b7280"}),(0,a.jsx)("p",{className:"font-semibold",children:"No reflections yet!"})]}),(0,a.jsx)("p",{className:"text-sm text-stone-500",children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Your past reflections that might spark new ideas:"}),(0,a.jsx)("div",{className:"space-y-3",children:n.map((e,t)=>(0,a.jsxs)("div",{className:"".concat(O()["glass-card"]," p-4"),children:[(0,a.jsx)("div",{className:O()["glass-card-highlight"]}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("p",{className:"text-sm text-stone-700 italic mb-2",children:['"',e.response,'"']}),e.articleTitle&&(0,a.jsxs)("p",{className:"text-xs text-stone-500 mb-3",children:["From: ",e.articleTitle]}),(0,a.jsx)("button",{onClick:()=>{let t=e.articleTitle?' (inspired by "'.concat(e.articleTitle,'")'):"";p('"'.concat(e.response,'"').concat(t," - This reminds me of..."))},className:"".concat(O()["glass-button"]," ").concat(O()["glass-button-primary"]," text-xs px-3 py-1 w-full"),children:"Use as starting point"})]})]},t))})]})}):(0,a.jsx)("div",{children:0===i.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,a.jsx)(L.v1,{size:16,color:"#6b7280"}),(0,a.jsx)("p",{className:"font-semibold",children:"No themes identified yet!"})]}),(0,a.jsx)("p",{className:"text-sm text-stone-500",children:"Keep reflecting on articles to discover your writing themes."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Writing prompts based on your reflection patterns:"}),(0,a.jsx)("div",{className:"space-y-3",children:i.map((e,t)=>(0,a.jsxs)("div",{className:"".concat(O()["glass-card"]," p-4"),children:[(0,a.jsx)("div",{className:O()["glass-card-highlight"]}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsx)("div",{className:"".concat(O()["glass-tag"]," inline-block mb-2 text-xs"),children:e}),(0,a.jsx)("p",{className:"text-sm text-stone-700 mb-3",children:f(e)}),(0,a.jsx)("button",{onClick:()=>p(f(e)),className:"".concat(O()["glass-button"]," ").concat(O()["glass-button-primary"]," text-xs px-3 py-1 w-full"),children:"Start writing"})]})]},t))})]})})}),(0,a.jsx)("div",{className:"p-4 border-t border-white/20",children:(0,a.jsx)("button",{onClick:g,className:"".concat(O()["glass-button"]," text-sm px-4 py-2 w-full disabled:opacity-50"),disabled:d,children:"\uD83D\uDD04 Refresh insights"})})]})]})}):(0,a.jsx)("div",{className:"fixed bottom-8 right-8 z-40",children:(0,a.jsxs)("button",{onClick:()=>{r||g(),l(!r)},className:"".concat(O()["glass-button"]," ").concat(O()["glass-button-primary"]," flex items-center gap-2 px-6 py-4 text-sm font-semibold"),title:"Get inspiration from your reflections",children:[(0,a.jsx)(L.Y_,{size:16,color:"currentColor"}),"Inspiration"]})})},q=e=>{let{articleId:t,onUpdateComplete:r,backToArticleAction:h,editingTitle:m}=e,g=(0,l.useRouter)(),[p,f]=(0,s.useState)(""),[x,b]=(0,s.useState)(""),[v,y]=(0,s.useState)([]),[j,w]=(0,s.useState)(""),[N,k]=(0,s.useState)(!1),[C,_]=(0,s.useState)(!1),[E,D]=(0,s.useState)(!1),[M,S]=(0,s.useState)(""),[A,T]=(0,s.useState)(!!t),[H,z]=(0,s.useState)(null),[B,L]=(0,s.useState)(""),[I,q]=(0,s.useState)(!1),[U,F]=(0,s.useState)(""),[G,Y]=(0,s.useState)(""),V=(0,s.useRef)(null),$=(0,s.useRef)(null),P=(0,s.useRef)(null),Z=(0,s.useCallback)(()=>{V.current&&(V.current.style.height="auto",V.current.style.height="".concat(V.current.scrollHeight,"px"),!p&&V.current&&V.current.focus())},[p]);(0,s.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{z(e),e||g.push("/login?redirect=compose")});return()=>e()},[g]),(0,s.useEffect)(()=>{let e=setTimeout(async()=>{if(t&&I&&H&&U.trim()&&G&&U.trim()!==G.trim())try{await u(t,U.trim()),Y(U.trim()),console.log("Reflection room topic updated and chat cleared")}catch(e){console.error("Error updating reflection topic:",e),F(G)}},1e3);return()=>clearTimeout(e)},[U,t,I,H,G]),(0,s.useEffect)(()=>{t&&H?(async()=>{try{T(!0);let e=await (0,c.getDoc)((0,c.doc)(i.db,"articles",t));if(!e.exists())return void S("Article not found");let r={id:e.id,...e.data()};if(r.authorId!==H.uid)return void S("You can only edit your own articles");if(f(r.title),b(r.body||""),y(r.tags||[]),w(r.coverImage||""),q(r.hasReflectionRoom||!1),r.hasReflectionRoom)try{let e=(0,c.doc)(i.db,"reflections",t,"metadata","main"),r=await (0,c.getDoc)(e);if(r.exists()){let e=r.data().topic||"";F(e),Y(e)}}catch(e){console.error("Error loading reflection room topic:",e)}}catch(e){console.error("Error loading article:",e),S("Failed to load article")}finally{T(!1)}})():t||T(!1)},[t,H,g]),(0,s.useEffect)(()=>{Z()},[p,Z]),(0,s.useEffect)(()=>{let e;return H&&p.trim()&&x.trim()&&!C&&!N&&(e=setTimeout(()=>{ee("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[H,p,x,C,N]);let K=(0,s.useCallback)((e,t)=>{b(t=>e!==t?(E&&D(!1),e):t)},[E]),Q=()=>{let e=B.trim().toLowerCase();e&&!v.includes(e)&&v.length<5&&(y([...v,e]),L(""))},J=e=>{y(v.filter(t=>t!==e))},X=e=>{w(e.target.value)},ee=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!H)return void S("You must be logged in to save articles");if(!p.trim())return void S("Title is required");try{S(""),_(!0);let a=p.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),s={title:p.trim(),body:x,tags:v,coverImage:j,status:e,authorId:H.uid,authorName:H.displayName||H.email||"Anonymous",slug:a,hasReflectionRoom:I};if(t)try{let e=await (0,o.iZ)(t,s);if(I&&U.trim())try{await d(t,U.trim())}catch(e){console.error("Error setting up reflection room:",e)}D(!0),r?r(e):setTimeout(()=>{g.push("/articles/?slug=".concat(a))},1e3)}catch(e){console.error("Error updating article:",e),S("Failed to update article. Please try again."),D(!1)}else{let t=await (0,o.N6)(s);if(I&&U.trim()&&(null==t?void 0:t.id))try{await d(t.id,U.trim())}catch(e){console.error("Error setting up reflection room for new article:",e)}"published"===e?g.push("/articles/?slug=".concat(a)):g.push("/dashboard")}}catch(e){console.error("Error saving article:",e),S("Failed to save article. Please try again.")}finally{_(!1),k(!1)}},et=async()=>{if(!x.trim())return void S("Content is required");k(!0),await ee("published")},er=async()=>{await ee("drafts")};return A?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed"},children:(0,a.jsxs)("div",{className:O()["glass-loading"],children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-stone-600 text-lg",children:"Loading your article..."})]})}):(0,a.jsxs)("div",{className:"".concat(O()["glass-container"]," min-h-screen w-full"),style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed",position:"relative",borderRadius:"0px",border:"none"},children:[(0,a.jsx)("div",{className:O()["glass-highlight"]}),(0,a.jsxs)("header",{className:"".concat(O()["glass-container"]," fixed top-6 left-6 right-6 z-50 max-w-6xl mx-auto"),style:{backdropFilter:"blur(20px) saturate(180%)"},children:[(0,a.jsx)("div",{className:O()["glass-highlight"]}),(0,a.jsxs)("div",{className:"".concat(O()["glass-content"]," flex items-center justify-between p-4"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[h?(0,a.jsxs)("button",{onClick:h,className:"".concat(O()["glass-button"]," flex items-center gap-2 px-3 py-2 text-sm font-medium text-stone-700 hover:text-stone-900 transition-colors"),children:[(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"})}),"Back to Article"]}):(0,a.jsx)("div",{className:"text-xl font-bold text-stone-800 font-serif",children:"Journalite"}),(0,a.jsx)("div",{className:"text-stone-500 text-sm",children:t?m?"Editing: ".concat(m):"Editing":"Writing"}),E&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,a.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:(0,a.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"".concat(O()["glass-button"]," px-4 py-2 text-sm font-semibold disabled:opacity-50"),onClick:er,disabled:C||N,children:C?"Saving...":"Save Draft"}),(0,a.jsx)("button",{className:"".concat(O()["glass-button"]," ").concat(O()["glass-button-primary"]," px-4 py-2 text-sm font-semibold disabled:opacity-50"),onClick:et,disabled:C||N||!p.trim()||!x.trim(),children:N?"Publishing...":t?"Update":"Publish"})]})]})]}),(0,a.jsxs)("div",{className:"".concat(O()["glass-content"]," pt-32 pb-16 min-h-screen w-full max-w-4xl mx-auto"),style:{paddingLeft:"64px",paddingRight:"64px"},children:[(0,a.jsx)("textarea",{ref:V,value:p,onChange:e=>{f(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1,className:"w-full bg-transparent border-none outline-none resize-none overflow-hidden text-5xl font-bold text-stone-800 placeholder-stone-400 font-serif leading-tight mb-8 focus:outline-none",style:{minHeight:"60px"}}),(j||p.length>10)&&(0,a.jsxs)("div",{className:"mb-8",children:[!j&&(0,a.jsx)("input",{type:"text",value:j,onChange:X,placeholder:"Add a cover image URL...",className:"w-full bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 py-2 border-b border-stone-200 focus:border-stone-400 transition-colors"}),j&&(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:j,alt:"Cover",className:"w-full h-64 object-cover rounded-2xl mb-4"}),(0,a.jsx)("input",{type:"text",value:j,onChange:X,placeholder:"Cover image URL...",className:"w-full bg-white/70 backdrop-blur border border-stone-200 outline-none text-stone-600 placeholder-stone-400 py-1.5 px-3 rounded-md focus:border-stone-400 transition-colors"})]})]}),(v.length>0||p.length>5)&&(0,a.jsxs)("div",{className:"mb-8 flex flex-wrap gap-2 items-center",children:[v.map(e=>(0,a.jsxs)("div",{className:"px-2.5 py-0.5 bg-blue-100/50 backdrop-blur text-blue-700 rounded-full text-sm font-medium flex items-center gap-1.5",children:[e,(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 font-bold text-base leading-none",onClick:()=>J(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),v.length<5&&(0,a.jsx)("input",{ref:$,type:"text",value:B,onChange:e=>{L(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),Q())},onBlur:Q,placeholder:0===v.length?"Add tags...":"Add tag...",className:"bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 min-w-24 py-1"})]}),p.length>5&&(0,a.jsxs)("div",{className:"mb-8 p-4 bg-white/50 backdrop-blur border border-stone-200/50 rounded-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"hasReflectionRoom",checked:I,onChange:e=>{q(e.target.checked),e.target.checked||F("")},className:"w-4 h-4 text-blue-600 bg-white border-stone-300 rounded focus:ring-blue-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"hasReflectionRoom",className:"text-sm font-medium text-stone-700 cursor-pointer",children:"Enable Reflection Room"})]}),(0,a.jsx)("span",{className:"text-xs text-stone-500 bg-stone-100 px-2 py-1 rounded-full",children:"\uD83D\uDCAD Let readers discuss"})]}),I&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("label",{className:"block text-xs font-medium text-stone-600 mb-2",children:["Discussion Topic",t&&G&&(0,a.jsx)("span",{className:"ml-2 text-orange-600 font-normal",children:"(⚠️ Changing this will clear all chat messages)"})]}),(0,a.jsx)("input",{type:"text",value:U,onChange:e=>F(e.target.value),placeholder:"What should readers discuss? (e.g., 'Share your thoughts on the main theme')",maxLength:200,className:"w-full bg-white/70 backdrop-blur border border-stone-200 outline-none text-stone-700 placeholder-stone-400 py-2 px-3 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all text-sm"}),(0,a.jsxs)("div",{className:"text-xs text-stone-500 mt-1",children:[U.length,"/200 characters"]})]}),(0,a.jsx)("p",{className:"text-xs text-stone-500 mt-2",children:"Reflection rooms create a real-time chat sidebar where authenticated readers can discuss your article."})]}),M&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-50/80 border border-red-200 rounded-xl text-red-700 text-sm",children:M}),(0,a.jsx)("div",{className:"min-h-[500px] w-full",style:{background:"transparent"},children:(0,a.jsx)(R,{ref:P,...{articleId:t||(0,n.A)(),initialContent:x,onChange:K,placeholder:"Write your story...",className:"seamless-editor"}})})]}),(0,a.jsx)(W,{onInsert:e=>{P.current&&P.current.insertText?P.current.insertText("\n\n"+e+"\n\n"):b(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{P.current&&P.current.focus&&P.current.focus()},100)}})]})}},5901:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",seamlessEditor:"Editor_seamlessEditor__2leHe",modernToolbar:"Editor_modernToolbar__VDG5b",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},9210:(e,t,r)=>{"use strict";r.d(t,{GE:()=>l,N6:()=>i,a:()=>d,getArticleById:()=>n,iZ:()=>c,l6:()=>o,zE:()=>u});var a=r(5317),s=r(3201);async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:r=!1}=e;try{let e=(0,a.collection)(s.db,"articles"),l=[];r||l.push((0,a.where)("status","==","published")),l.push((0,a.orderBy)("createdAt","desc")),t&&t>0&&l.push((0,a.limit)(t));let n=(0,a.query)(e,...l),o=await (0,a.getDocs)(n),i=[];return o.forEach(e=>{let t=e.data();i.push({id:e.id,...t})}),i}catch(e){throw console.error("Error getting articles:",e),e}}async function n(e){Date.now();try{let t=(0,a.doc)(s.db,"articles",e),r=await (0,a.getDoc)(t);if(!r.exists())return null;return{id:r.id,...r.data()}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function o(e){let t=0;for(;t<3;){t++;try{let r=(0,a.collection)(s.db,"articles"),l=(0,a.query)(r,(0,a.where)("slug","==",e),(0,a.where)("status","==","published"),(0,a.limit)(1)),n=await (0,a.getDocs)(l);if(n.empty)if(3===t)break;else await new Promise(e=>setTimeout(e,1e3));else{let e=n.docs[0];return{id:e.id,...e.data()}}}catch(e){if(console.error("Error getting article by slug:",e),3===t)throw e}}return null}async function i(e){try{var t;let r=s.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let l={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:a.Timestamp.now(),authorId:r.uid,authorName:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[],hasReflectionRoom:e.hasReflectionRoom||!1};return{id:(await (0,a.addDoc)((0,a.collection)(s.db,"articles"),l)).id,...l}}catch(e){throw console.error("Error creating article:",e),e}}async function c(e,t){try{let r=s.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let l=(0,a.doc)(s.db,"articles",e),n=await (0,a.getDoc)(l);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==r.uid)throw Error("You can only edit your own articles");let o={...t};t.title&&(o.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),o.updatedAt=a.Timestamp.now(),await (0,a.updateDoc)(l,o);let i=await (0,a.getDoc)(l);if(!i.exists())return{id:e,...o,createdAt:a.Timestamp.now(),updatedAt:a.Timestamp.now()};{let e=i.data();return{id:i.id,...e}}}catch(e){throw console.error("Error updating article:",e),e}}async function d(e){try{let t=s.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,a.doc)(s.db,"articles",e),l=await (0,a.getDoc)(r);if(!l.exists())throw Error("Article not found");if(l.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,a.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=t;try{let t=(0,a.collection)(s.db,"articles"),l=[(0,a.where)("tags","array-contains",e),(0,a.where)("status","==","published"),(0,a.orderBy)("createdAt","desc")];r&&r>0&&l.push((0,a.limit)(r));let n=(0,a.query)(t,...l),o=await (0,a.getDocs)(n),i=[];return o.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){throw console.error("Error getting articles by tag:",e),e}}r(9995)}}]);