(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5844],{239:(e,t,n)=>{var o={"./en/index":8021};function r(e){return n(i(e))}function i(e){if(!n.o(o,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=239},326:(e,t,n)=>{"use strict";n.d(t,{Qx:()=>o});let o={joyful:{gradientStart:"#fde047",gradientEnd:"#fb923c",accent:"#f59e0b"},angry:{gradientStart:"#f87171",gradientEnd:"#dc2626",accent:"#ef4444"},energetic:{gradientStart:"#34d399",gradientEnd:"#059669",accent:"#10b981"},peaceful:{gradientStart:"#60a5fa",gradientEnd:"#2563eb",accent:"#3b82f6"},reflective:{gradientStart:"#a78bfa",gradientEnd:"#7c3aed",accent:"#8b5cf6"},sad:{gradientStart:"#94a3b8",gradientEnd:"#475569",accent:"#64748b"},calm:{gradientStart:"#67e8f9",gradientEnd:"#0891b2",accent:"#06b6d4"}}},2195:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var o=n(5155),r=n(2115),i=n(5317),a=n(6203),l=n(3201),s=n(5377),c=n.n(s),d=n(4814);let g=function(e,t){var n;let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=(null==e||null==(n=e.charAt(0))?void 0:n.toUpperCase())||"A",a=["#4f46e5","#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16"],l=t?Math.abs(t.charCodeAt(0)%a.length):0,s=a[l];return r.createElement("div",{style:{backgroundColor:s,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:o?"0.8rem":"1rem",width:o?"32px":"40px",height:o?"32px":"40px",borderRadius:"50%",flexShrink:0}},i)};n(7041),n(326);let h=r.memo(e=>{let{articleId:t,className:n=""}=e,[s,h]=(0,r.useState)([]),[m,u]=(0,r.useState)(""),[p,x]=(0,r.useState)(null),[f,b]=(0,r.useState)(!1),[y,_]=(0,r.useState)(!1),[w,v]=(0,r.useState)(null),[S,j]=(0,r.useState)(""),[C,k]=(0,r.useState)(null),[A,R]=(0,r.useState)(""),[N,E]=(0,r.useState)(new Set),[F,M]=(0,r.useState)(!1),[T,I]=(0,r.useState)(0),B=(0,r.useMemo)(()=>({isMobile:T<=768,isTablet:T>768&&T<=1024,isSmallPhone:T<=480,bottomSafeArea:T<=768?120:40}),[T]);(0,r.useEffect)(()=>{let e,t=()=>I(window.innerWidth);t();let n=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),clearTimeout(e)}},[]),(0,r.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(l.j2,e=>{x(e),b(!!e)});return()=>e()},[]),(0,r.useEffect)(()=>{if(!t)return;let e=(0,i.collection)(l.db,"articles",t,"comments"),n=(0,i.query)(e,(0,i.orderBy)("createdAt","desc")),o=(0,i.onSnapshot)(n,e=>{let t=[];e.forEach(e=>{let n=e.data();t.push({id:e.id,...n})}),h(D(t))});return()=>o()},[t]);let D=(0,r.useCallback)(e=>{let t=e.filter(e=>!e.parentId),n=e.filter(e=>e.parentId);return t.map(e=>({...e,replies:n.filter(t=>t.parentId===e.id).sort((e,t)=>{var n,o;return(null==(n=e.createdAt)?void 0:n.toDate())-(null==(o=t.createdAt)?void 0:o.toDate())})}))},[]),L=(0,r.useMemo)(()=>"calm",[!1,m,S,A]),W=(0,r.useCallback)(async e=>{if(e.preventDefault(),m.trim()&&p&&!y){_(!0);try{let e=(0,i.collection)(l.db,"articles",t,"comments");await (0,i.addDoc)(e,{text:m.trim(),authorId:p.uid,authorName:p.displayName||"Anonymous",authorEmail:p.email||"",createdAt:new Date,likes:[],mood:void 0}),u(""),M(!1)}catch(e){console.error("Error adding comment:",e)}finally{_(!1)}}},[m,p,y,t,L,!1]),z=(0,r.useCallback)(async e=>{if(S.trim()&&p&&!y){_(!0);try{let n=(0,i.collection)(l.db,"articles",t,"comments");await (0,i.addDoc)(n,{text:S.trim(),authorId:p.uid,authorName:p.displayName||"Anonymous",authorEmail:p.email||"",createdAt:new Date,likes:[],parentId:e,mood:void 0}),j(""),v(null)}catch(e){console.error("Error adding reply:",e)}finally{_(!1)}}},[S,p,y,t,!1]),P=(0,r.useCallback)(async(e,n)=>{if(p)try{let o=(0,i.doc)(l.db,"articles",t,"comments",e),r=n.includes(p.uid)?n.filter(e=>e!==p.uid):[...n,p.uid];await (0,i.updateDoc)(o,{likes:r})}catch(e){console.error("Error updating like:",e)}},[p,t]),H=(0,r.useCallback)(async e=>{if(A.trim()&&p&&!y){_(!0);try{let n=(0,i.doc)(l.db,"articles",t,"comments",e);await (0,i.updateDoc)(n,{text:A.trim(),mood:void 0,editedAt:new Date}),k(null),R("")}catch(e){console.error("Error editing comment:",e)}finally{_(!1)}}},[A,p,y,t,!1]),O=(0,r.useCallback)(async e=>{if(p&&!y&&confirm("Are you sure you want to delete this comment?")){_(!0);try{let n=(0,i.doc)(l.db,"articles",t,"comments",e);await (0,i.deleteDoc)(n);let o=(0,i.query)((0,i.collection)(l.db,"articles",t,"comments"),(0,i.where)("parentId","==",e)),r=(await (0,i.getDocs)(o)).docs.map(e=>(0,i.deleteDoc)((0,i.doc)(l.db,"articles",t,"comments",e.id)));await Promise.all(r),E(t=>{let n=new Set(t);return n.delete(e),n})}catch(e){console.error("Error deleting comment:",e)}finally{_(!1)}}},[p,y,t]),U=(0,r.useCallback)(e=>{if(!e)return"Just now";let t=e.toDate?e.toDate():new Date(e),n=Math.floor((new Date().getTime()-t.getTime())/6e4);return n<1?"Just now":n<60?"".concat(n,"m ago"):n<1440?"".concat(Math.floor(n/60),"h ago"):"".concat(Math.floor(n/1440),"d ago")},[]),q=(0,r.useMemo)(()=>({marginBottom:B.isMobile?"max(".concat(B.bottomSafeArea+40,"px, calc(").concat(B.bottomSafeArea,"px + env(safe-area-inset-bottom)))"):"2rem",paddingBottom:B.isMobile?"20px":"0"}),[B]),J=(0,r.useCallback)(function(e){var t,n,r;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,o.jsxs)("div",{className:"".concat(c().comment," ").concat(i?c().reply:""),children:[(0,o.jsxs)("div",{className:c().commentContent,children:[(0,o.jsxs)("div",{className:c().commentHeader,children:[(0,o.jsx)("div",{className:c().commentAvatar,children:g(e.authorName,e.authorId)}),(0,o.jsxs)("div",{className:c().commentMeta,children:[(0,o.jsx)("span",{className:c().commentAuthor,children:e.authorName}),(0,o.jsx)("span",{className:c().commentTime,children:U(e.createdAt)})]}),(null==p?void 0:p.uid)===e.authorId&&(0,o.jsxs)("div",{className:c().commentActions,children:[(0,o.jsx)("button",{onClick:()=>{let t=new Set(N);N.has(e.id)?t.delete(e.id):t.add(e.id),E(t)},className:c().menuButton,"aria-label":"Comment options",children:(0,o.jsx)(d.Mg,{size:16,color:"#64748b"})}),N.has(e.id)&&(0,o.jsxs)("div",{className:c().dropdownMenu,children:[(0,o.jsxs)("button",{onClick:()=>{k(e.id),R(e.text),E(new Set)},className:c().menuItem,children:[(0,o.jsx)(d.qU,{size:14,color:"#3b82f6"}),"Edit"]}),(0,o.jsxs)("button",{onClick:()=>O(e.id),className:c().menuItem,disabled:y,children:[(0,o.jsx)(d.uc,{size:14,color:"#ef4444"}),"Delete"]})]})]})]}),C===e.id?(0,o.jsxs)("div",{className:c().editForm,children:[(0,o.jsx)("textarea",{value:A,onChange:e=>R(e.target.value),className:"".concat(c().editInput," mobile-optimized-input"),"data-mobile":"true",rows:3,autoFocus:!0}),(0,o.jsxs)("div",{className:c().editActions,children:[(0,o.jsx)("button",{onClick:()=>{k(null),R("")},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,o.jsx)("button",{onClick:()=>H(e.id),className:c().saveButton,disabled:!A.trim()||y,children:y?"Saving...":"Save"})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:c().commentText,children:e.text}),(0,o.jsxs)("div",{className:c().commentFooter,children:[(0,o.jsxs)("button",{onClick:()=>P(e.id,e.likes||[]),className:"".concat(c().likeButton," ").concat((null==(t=e.likes)?void 0:t.includes(null==p?void 0:p.uid))?c().liked:""),disabled:!f,children:[(0,o.jsx)(d.C3,{size:14,color:(null==(n=e.likes)?void 0:n.includes(null==p?void 0:p.uid))?"#ef4444":"#64748b"}),(null==(r=e.likes)?void 0:r.length)?e.likes.length:""]}),!i&&(0,o.jsxs)("button",{onClick:()=>v(e.id),className:c().replyButton,disabled:!f,children:[(0,o.jsx)(d.Sb,{size:14,color:"#64748b"}),"Reply"]})]})]})]}),w===e.id&&(0,o.jsxs)("div",{className:c().replyForm,children:[(0,o.jsxs)("div",{className:c().replyInputContainer,children:[(0,o.jsx)("div",{className:c().commentAvatar,children:g((null==p?void 0:p.displayName)||"User",null==p?void 0:p.uid)}),(0,o.jsx)("textarea",{value:S,onChange:e=>j(e.target.value),placeholder:"Write a reply...",className:"".concat(c().replyInput," mobile-optimized-input"),"data-mobile":"true",rows:2,autoFocus:!0})]}),(0,o.jsxs)("div",{className:c().replyActions,children:[(0,o.jsx)("button",{onClick:()=>{v(null),j("")},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,o.jsx)("button",{onClick:()=>z(e.id),className:c().submitButton,disabled:!S.trim()||y,children:y?"Replying...":"Reply"})]})]}),e.replies&&e.replies.length>0&&(0,o.jsx)("div",{className:c().repliesContainer,children:e.replies.map(e=>J(e,!0))})]},e.id)},[p,N,C,A,w,S,y,f,U,P,O,H,z]);return(0,o.jsxs)("div",{className:"".concat(c().commentsSection," ").concat(n," comment-section"),style:q,children:[(0,o.jsxs)("h3",{className:c().commentsTitle,children:["Comments (",s.length,")"]}),(0,o.jsx)("form",{className:c().commentForm,onSubmit:W,children:(0,o.jsx)("div",{className:c().commentInputContainer,style:{background:"rgba(255, 255, 255, ".concat(F?"0.1":"0.05",")"),border:"1px solid rgba(255, 255, 255, ".concat(F?"0.2":"0.12",")"),borderRadius:"16px",boxShadow:F?"0 4px 20px rgba(0, 0, 0, 0.1),\n                     inset 0 1px 0 rgba(255, 255, 255, 0.2)":"0 2px 12px rgba(0, 0, 0, 0.06),\n                     inset 0 1px 0 rgba(255, 255, 255, 0.12)",backdropFilter:"blur(16px) saturate(180%)",WebkitBackdropFilter:"blur(16px) saturate(180%)",transform:F?"translateY(-1px)":"translateY(0)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",overflow:"hidden",padding:B.isMobile?"0.875rem":"1rem",marginBottom:B.isMobile?"20px":"0"},children:f?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:c().commentAvatar,children:g(p.displayName||p.name,p.uid||p.id)}),(0,o.jsx)("textarea",{className:"".concat(c().commentInput," mobile-optimized-input comment-input"),placeholder:"Share your thoughts...",value:m,onChange:e=>u(e.target.value),onFocus:e=>{M(!0),B.isMobile&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},100)},onBlur:()=>{m.trim()||M(!1)},"data-mobile":"true",rows:B.isSmallPhone?3:4,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"20px",color:"#2d3748",fontSize:B.isMobile?"16px":"1rem",padding:B.isMobile?"0.875rem":"1rem",resize:"vertical",minHeight:B.isMobile?"80px":"120px",backdropFilter:"blur(8px)",transition:"all 0.3s ease",...{}}}),(F||m.trim())&&(0,o.jsxs)("div",{className:c().commentActions,children:[(0,o.jsx)("button",{type:"button",onClick:()=>{u(""),M(!1)},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:c().submitButton,disabled:!m.trim()||y,style:{minHeight:B.isMobile?"44px":"36px"},children:y?"Posting...":"Post Comment"})]})]}):(0,o.jsx)("div",{className:c().authPrompt,children:(0,o.jsx)("p",{children:"Please log in to join the conversation."})})})}),(0,o.jsx)("div",{className:c().commentsList,children:0===s.length?(0,o.jsx)("div",{className:c().emptyState,children:(0,o.jsx)("p",{children:"No comments yet. Be the first to share your thoughts!"})}):s.map(e=>J(e))})]})})},5377:e=>{e.exports={commentSection:"comment_commentSection__SP_jS",commentSectionTitle:"comment_commentSectionTitle__F_Jxe",commentError:"comment_commentError__A2v6U",commentForm:"comment_commentForm__U8b7X",commentInputContainer:"comment_commentInputContainer__3WsSp",loginPromptContainer:"comment_loginPromptContainer__X4aZr",commentAvatar:"comment_commentAvatar__uav6Q",replyAvatar:"comment_replyAvatar__dIlrw",commentInput:"comment_commentInput__4DHa1",replyInput:"comment_replyInput__8t_ho",commentSubmit:"comment_commentSubmit__UfvUF",replySubmit:"comment_replySubmit__2eCP7",loginButton:"comment_loginButton__4encR",loginModalOverlay:"comment_loginModalOverlay__Pk_AM",loginModal:"comment_loginModal__n984X",loginModalClose:"comment_loginModalClose__v02Rx",loginModalTitle:"comment_loginModalTitle__nZpZB",loginModalText:"comment_loginModalText__XwRn6",loginModalButtons:"comment_loginModalButtons__XdVNl",loginModalButton:"comment_loginModalButton__d8Bnr",primary:"comment_primary__1UIRJ",secondary:"comment_secondary__zc89j",commentLoading:"comment_commentLoading___WYvK",loadingDots:"comment_loadingDots___Lw2B",loadingDot:"comment_loadingDot__skUEk",pulse:"comment_pulse__czQlg",noComments:"comment_noComments__U9FG6",commentsList:"comment_commentsList__ZRMbc",commentItem:"comment_commentItem__Vx48l",commentHeader:"comment_commentHeader__3oOD6",commentUser:"comment_commentUser__QP5pY",commentDate:"comment_commentDate__5zfpn",commentContent:"comment_commentContent__DiE8h",commentActions:"comment_commentActions___Wpzi",commentLikeBtn:"comment_commentLikeBtn__wAYZO",replyToggle:"comment_replyToggle__bCRZg",commentDeleteBtn:"comment_commentDeleteBtn__BnLQc",liked:"comment_liked__2yWZ9",repliesToggle:"comment_repliesToggle__yepDc",repliesToggleIcon:"comment_repliesToggleIcon__EZRkK",open:"comment_open__cpLDc",replySection:"comment_replySection__mAqn4",replyItem:"comment_replyItem__ndhqf",replyHeader:"comment_replyHeader__Y2bUK",replyUser:"comment_replyUser__rw4V8",replyDate:"comment_replyDate__4Jafb",replyContent:"comment_replyContent__uV2jp",replyForm:"comment_replyForm__aYyum",inThread:"comment_inThread__lUoKT",replyButtons:"comment_replyButtons__KRGyv",replyCancel:"comment_replyCancel__od7Vq"}},6202:(e,t,n)=>{"use strict";n.d(t,{A:()=>q});var o=n(5155),r=n(2115),i=n(3201),a=n(5317);let l=async function(e,t,n,o,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"insight";try{let s={articleId:e,userId:t,text:n,prefix:o,suffix:r,tag:l,createdAt:(0,a.serverTimestamp)(),comments:[],reactions:{},userReactions:{}};return(await (0,a.addDoc)((0,a.collection)(i.db,"highlights"),s)).id}catch(e){throw console.error("Error saving highlight:",e),e}},s=async(e,t)=>{try{let n=(0,a.query)((0,a.collection)(i.db,"highlights"),(0,a.where)("articleId","==",e));return t&&(n=(0,a.query)((0,a.collection)(i.db,"highlights"),(0,a.where)("articleId","==",e),(0,a.where)("userId","==",t))),(await (0,a.getDocs)(n)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting highlights:",e),[]}},c=async e=>{try{await (0,a.deleteDoc)((0,a.doc)(i.db,"highlights",e))}catch(e){throw console.error("Error deleting highlight:",e),e}},d=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.location.origin;return"".concat(n,"/articles?slug=").concat(e,"#highlight=").concat(t)},g=(0,r.createContext)(void 0),h=e=>{let{children:t,articleId:n}=e,[a,d]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[u,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{p(e)});return()=>e()},[]),(0,r.useEffect)(()=>{(async()=>{if(n&&u){m(!0);try{let e=await s(n,u.uid);d(e)}catch(e){console.error("Error loading highlights:",e)}finally{m(!1)}}else d([]),m(!1)})()},[n,u]);let x=async(e,t,n,o,r)=>{if(!u)return alert("You must be logged in to highlight text"),null;try{let i=await l(o,u.uid,e,t,n,r),a={id:i,articleId:o,userId:u.uid,text:e,prefix:t,suffix:n,tag:r,createdAt:new Date,reactions:{},userReactions:{}};return d(e=>[...e,a]),i}catch(e){return console.error("Error saving highlight:",e),null}},f=async e=>{try{await c(e),d(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error removing highlight:",e)}};return(0,o.jsx)(g.Provider,{value:{highlights:a,loading:h,saveHighlight:x,removeHighlight:f,highlightElement:(e,t)=>{var n,o,r;try{if(!e.toString())return;let o=document.createElement("mark");o.className="article-highlight highlight-".concat(t);try{e.surroundContents(o)}catch(t){try{let t=e.extractContents();o.appendChild(t),e.insertNode(o)}catch(n){let t=e.cloneContents();o.appendChild(t),e.deleteContents(),e.insertNode(o)}}null==(n=window.getSelection())||n.removeAllRanges()}catch(t){console.error("Error highlighting range:",t),null==(o=window.getSelection())||o.removeAllRanges(),null==(r=window.getSelection())||r.addRange(e)}}},children:t})},m=()=>{let e=(0,r.useContext)(g);if(void 0===e)throw Error("useHighlights must be used within a HighlightProvider");return e};var u=n(4814),p=n(7650);let x=[{tag:"insight",label:"Insight",color:"#3B82F6",icon:u.TG},{tag:"question",label:"Question",color:"#F59E0B",icon:u.Ko},{tag:"quote",label:"Quote",color:"#10B981",icon:u.Tw},{tag:"important",label:"Important",color:"#EF4444",icon:u.Gg}],f=e=>{let{selection:t,onHighlight:n,onResponse:i,onShare:a,onAiAssist:l}=e,[s,c]=(0,r.useState)({top:0,left:0}),[d,g]=(0,r.useState)(!1),[h,m]=(0,r.useState)(!1),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e,n;if(!t||t.isCollapsed){g(!1),m(!1);return}let o=t.getRangeAt(0).getBoundingClientRect(),r=window.innerWidth,i=window.innerHeight,a=(null==(e=u.current)?void 0:e.offsetWidth)||280,l=(null==(n=u.current)?void 0:n.offsetHeight)||40,s=o.left+o.width/2;s-a/2<16?s=a/2+16:s+a/2>r-16&&(s=r-a/2-16);let d=o.top-l-10+window.scrollY;if(o.top-l-10<0&&(d=o.bottom+10+window.scrollY),r<=768){let e=window.scrollY,t=window.scrollY+i;d<e+16&&(d=e+16),d+l>t-16&&(d=t-l-16)}c({top:d,left:s}),g(!0)},[t]);let f=e=>{if(t&&!t.isCollapsed){var o;let r=t.getRangeAt(0);n(t.toString(),r,e),null==(o=window.getSelection())||o.removeAllRanges(),g(!1),m(!1)}},b=()=>{m(!h)};return d?(0,p.createPortal)((0,o.jsx)("div",{ref:u,className:"highlight-toolbar",style:{position:"absolute",top:"".concat(s.top,"px"),left:"".concat(s.left,"px"),transform:"translateX(-50%)",zIndex:1e3},children:h?(0,o.jsxs)("div",{className:"highlight-color-options",children:[(0,o.jsx)("span",{className:"highlight-color-label",children:"Choose highlight type:"}),x.map(e=>{let t=e.icon;return(0,o.jsxs)("button",{onClick:()=>f(e.tag),className:"highlight-color-btn",style:{backgroundColor:e.color},title:e.label,children:[(0,o.jsx)("span",{className:"highlight-icon",children:(0,o.jsx)(t,{size:14,color:"white"})}),(0,o.jsx)("span",{className:"highlight-label",children:e.label})]},e.tag)}),(0,o.jsx)("button",{onClick:b,className:"highlight-btn highlight-btn-cancel",children:"Cancel"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("button",{onClick:b,className:"highlight-btn highlight-btn-main",children:[(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,o.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),(0,o.jsx)("span",{children:"Highlight"})]}),i&&(0,o.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&i){var e;i(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),g(!1)}},className:"highlight-btn",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),(0,o.jsx)("span",{children:"Response"})]}),a&&(0,o.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&a){var e;a(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),g(!1)}},className:"highlight-btn",children:[(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,o.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,o.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,o.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,o.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),(0,o.jsx)("span",{children:"Share"})]}),l&&(0,o.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&l){var e;l(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),g(!1)}},className:"highlight-btn",children:[(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,o.jsx)("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),(0,o.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"16"})]}),(0,o.jsx)("span",{children:"Journa AI"})]})]})}),document.body):null};var b=n(9576);let y=e=>{let t={prefix:"",suffix:""};if(!e||0===e.rangeCount)return t;let n=e.getRangeAt(0),o=n.toString(),r=n.commonAncestorContainer,i=r.nodeType===Node.TEXT_NODE?r.parentElement:r;if(!i)return t;let a=i.textContent||"",l=a.indexOf(o);if(-1===l){let e=o.replace(/\s+/g," ").trim(),t=a.replace(/\s+/g," ").indexOf(e);-1!==t&&(l=t)}if(-1!==l){let e=Math.max(0,l-50),n=Math.min(a.length,l+o.length+50),r=a.substring(e,l),i=a.substring(l+o.length,n);r=r.replace(/^\S*\s/,""),i=i.replace(/\s\S*$/,""),t.prefix=r,t.suffix=i}return t},_=(e,t)=>{if(!e||!t)return;let n=t.querySelectorAll(".article-highlight"),o=Array.from(n).map(e=>e.getAttribute("data-highlight-id")).filter(Boolean),r=e.map(e=>e.id);if(o.length===r.length&&o.every(e=>r.includes(e)))return;n.forEach(e=>{let t=e.parentNode;if(t){let n=document.createTextNode(e.textContent||"");t.replaceChild(n,e),t.normalize()}});let i=[];if(e.forEach(e=>{let n=((e,n,o)=>{let r,i,a,l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);for(;r=l.nextNode();){let t=(r.textContent||"").indexOf(e);if(-1!==t){let n=document.createRange();return n.setStart(r,t),n.setEnd(r,t+e.length),n}}let s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),c=e=>RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\s+/g,"\\s+"),"i");for(;i=s.nextNode();){let t=i.textContent||"",n=c(e),o=t.match(n);if(o&&void 0!==o.index){let e=document.createRange();return e.setStart(i,o.index),e.setEnd(i,o.index+o[0].length),e}}if(n||o){let r,i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),a=c(n+e+o);for(;r=i.nextNode();){let t=(r.textContent||"").match(a);if(t&&void 0!==t.index){let o=t[0],i=c(n),a=o.match(i),l=a?a[0].length:0,s=document.createRange(),d=t.index+l,g=c(e),h=o.substring(l).match(g);if(h)return s.setStart(r,d),s.setEnd(r,d+h[0].length),s}}}let d=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),g=(n+e+o).replace(/\s+/g," ").trim();for(;a=d.nextNode();){let t=(a.textContent||"").replace(/\s+/g," ").indexOf(g);if(-1!==t){let o=document.createRange(),r=n.replace(/\s+/g," ").trim().length,i=t+(r>0?r+1:0);return o.setStart(a,i),o.setEnd(a,i+e.replace(/\s+/g," ").trim().length),o}}return null})(e.text,e.prefix||"",e.suffix||"");if(n)try{let t=document.createElement("mark");t.className="article-highlight highlight-".concat(e.tag||"insight"),t.dataset.highlightId=e.id;try{n.surroundContents(t)}catch(o){let e=n.extractContents();t.appendChild(e),n.insertNode(t)}console.log('✅ Applied highlight "'.concat(e.text.substring(0,30),'..." with ID: ').concat(e.id))}catch(t){console.error("Error applying highlight:",t,{text:e.text,id:e.id,tag:e.tag}),i.push(e.id)}else console.warn('❌ Could not find text for highlight: "'.concat(e.text.substring(0,30),'..." with ID: ').concat(e.id)),i.push(e.id)}),i.length>0){console.log("\uD83E\uDDF9 Found ".concat(i.length," highlights that couldn't be applied. These might be from old text formatting."));let e="failed-highlights-".concat(location.pathname),t=JSON.parse(sessionStorage.getItem(e)||"{}");i.forEach(e=>{t[e]=(t[e]||0)+1}),sessionStorage.setItem(e,JSON.stringify(t));let n=Object.entries(t).filter(e=>{let[t,n]=e;return n>=3}).map(e=>{let[t]=e;return t});n.length>0&&(console.log("\uD83D\uDDD1️  Suggesting cleanup of ".concat(n.length," persistently failed highlights")),sessionStorage.getItem("cleanup-notification-".concat(location.pathname))||(console.log("\uD83D\uDD04 Auto-cleaning broken highlights from text format change..."),setTimeout(()=>{n.forEach(async e=>{try{let t=new CustomEvent("cleanup-broken-highlight",{detail:{highlightId:e}});window.dispatchEvent(t)}catch(t){console.error("Failed to cleanup highlight:",e,t)}})},1e3),sessionStorage.setItem("cleanup-notification-".concat(location.pathname),"shown")))}},w=e=>{let{articleId:t,children:n,articleTitle:i="Article",articleSlug:a=""}=e,[l,s]=(0,r.useState)(null),{highlights:c,saveHighlight:g,removeHighlight:h,highlightElement:u}=m(),[p,x]=(0,r.useState)(null),[w,v]=(0,r.useState)(!1),[S,j]=(0,r.useState)(""),[C,k]=(0,r.useState)(!1),[A,R]=(0,r.useState)(""),[N,E]=(0,r.useState)(null),[F,M]=(0,r.useState)(!1),[T,I]=(0,r.useState)(!1),[B,D]=(0,r.useState)({top:0,left:0}),[L,W]=(0,r.useState)(!1),[z,P]=(0,r.useState)(""),H=(0,r.useCallback)(()=>{I(!0),setTimeout(()=>{M(!1),I(!1)},150)},[]),O=(0,r.useCallback)(()=>{F||setTimeout(()=>{let e=window.getSelection();if(e&&!e.isCollapsed){let n=e.toString(),o=n.trim();if(o&&o.length>0&&n.length<1e3){var t;let n=e.getRangeAt(0).commonAncestorContainer;(n.nodeType===Node.TEXT_NODE?null==(t=n.parentElement)?void 0:t.closest(".article-highlight-container"):null==n?void 0:n.closest(".article-highlight-container"))?s(e):s(null)}else s(null)}else s(null)},100)},[F]),U=(0,r.useCallback)((e,n,o)=>{if(e&&n){let r=y(window.getSelection());g(e,r.prefix,r.suffix,t,o),u(n,o)}},[t,g,u]),q=(0,r.useCallback)(e=>{let t=e.target;if(t.classList.contains("article-highlight")){e.preventDefault(),e.stopPropagation();let n=t.dataset.highlightId,o=t.textContent||"";if(n){I(!1),E({id:n,text:o});let e=t.getBoundingClientRect();D({top:e.top-40+window.scrollY,left:e.left+e.width/2}),M(!0),s(null)}}else F&&(H(),E(null))},[F,H]),J=(0,r.useCallback)(()=>{if(N&&N.id){H();let e=N.id;if(E(null),h(e),p){let t=p.querySelector('[data-highlight-id="'.concat(e,'"]'));if(t&&t.parentNode){let e=document.createTextNode(t.textContent||"");t.parentNode.replaceChild(e,t),t.parentNode.normalize()}}}},[N,h,p,H]),X=(0,r.useCallback)(e=>{j(e),v(!0)},[]),Y=(0,r.useCallback)(e=>{P(e),W(!0)},[]),Z=(0,r.useCallback)(e=>{R(e),k(!0)},[]);(0,r.useEffect)(()=>{document.addEventListener("selectionchange",O);let e=()=>{setTimeout(O,150)};return"ontouchstart"in window&&document.addEventListener("touchend",e),()=>{document.removeEventListener("selectionchange",O),"ontouchstart"in window&&document.removeEventListener("touchend",e)}},[O]),(0,r.useEffect)(()=>{if(p)return p.addEventListener("click",q),()=>{p.removeEventListener("click",q)}},[p,q]),(0,r.useEffect)(()=>{let e=e=>{if(F){let t=e.target;t.closest(".highlight-toolbar")||t.classList.contains("article-highlight")||(H(),E(null))}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[F,H]),(0,r.useEffect)(()=>{if(p){let e=setTimeout(()=>{console.log("\uD83C\uDFA8 Applying ".concat(c.length," highlights to content")),_(c,p)},100);return()=>clearTimeout(e)}},[c,p]),(0,r.useEffect)(()=>{let e=e=>{var t;let n=null==(t=e.detail)?void 0:t.highlightId;n&&(console.log("\uD83D\uDDD1️ Cleaning up broken highlight: ".concat(n)),h(n))};return window.addEventListener("cleanup-broken-highlight",e),()=>{window.removeEventListener("cleanup-broken-highlight",e)}},[h]);let V=(0,r.useCallback)(e=>{e&&e!==p&&x(e)},[p]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(f,{selection:l,onHighlight:U,onResponse:X,onShare:Y,onAiAssist:Z}),F&&N&&(0,o.jsxs)("div",{className:"highlight-toolbar unhighlight-toolbar ".concat(T?"hiding":""),style:{position:"absolute",top:"".concat(B.top,"px"),left:"".concat(B.left,"px"),transform:T?"translateY(-10px) translateX(-50%)":"translateX(-50%)",zIndex:1e3},children:[(0,o.jsxs)("button",{onClick:J,className:"highlight-btn highlight-btn-danger",children:[(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("path",{d:"M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"}),(0,o.jsx)("line",{x1:"18",y1:"9",x2:"12",y2:"15"}),(0,o.jsx)("line",{x1:"12",y1:"9",x2:"18",y2:"15"})]}),(0,o.jsx)("span",{children:"Unhighlight"})]}),(0,o.jsxs)("button",{onClick:()=>{Y(N.text),H()},className:"highlight-btn",children:[(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,o.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,o.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,o.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,o.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),(0,o.jsx)("span",{children:"Share"})]}),(0,o.jsxs)("button",{onClick:()=>{X(N.text),H()},className:"highlight-btn",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),(0,o.jsx)("span",{children:"Response"})]})]}),(0,o.jsx)("div",{ref:V,className:"article-highlight-container",children:n}),w&&(0,o.jsx)("div",{className:"highlight-response-modal",children:(0,o.jsxs)("div",{className:"highlight-modal-content",children:[(0,o.jsx)("button",{className:"highlight-modal-close",onClick:()=>v(!1),children:"\xd7"}),(0,o.jsx)("h3",{children:"Respond to highlighted text"}),(0,o.jsxs)("div",{className:"highlight-selected-text",children:['"',S,'"']}),(0,o.jsx)("textarea",{className:"highlight-response-input",placeholder:"Write your response..."}),(0,o.jsx)("button",{className:"highlight-response-submit",children:"Submit"})]})}),C&&(0,o.jsx)("div",{className:"highlight-ai-modal",children:(0,o.jsxs)("div",{className:"highlight-modal-content",children:[(0,o.jsx)("button",{className:"highlight-modal-close",onClick:()=>k(!1),children:"\xd7"}),(0,o.jsx)("h3",{children:"Journa AI"}),(0,o.jsxs)("div",{className:"highlight-selected-text",children:['"',A,'"']}),(0,o.jsxs)("div",{className:"highlight-ai-options",children:[(0,o.jsx)("button",{children:"Explain this"}),(0,o.jsx)("button",{children:"Fact check"}),(0,o.jsx)("button",{children:"Provide context"}),(0,o.jsx)("button",{children:"Summarize"})]}),(0,o.jsx)("div",{className:"highlight-ai-response",children:(0,o.jsx)("div",{className:"highlight-ai-loading",children:"Journa AI is thinking..."})})]})}),L&&(0,o.jsx)(b.A,{isOpen:L,onClose:()=>W(!1),highlightText:z,articleTitle:i,shareUrl:d(a,t)})]})},v=e=>{let{currentMood:t,isVisible:n,moodFeatureEnabled:i}=e,[a,l]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),[d,g]=(0,r.useState)({colorStops:[{id:"1",color:"#007AFF",x:30,y:40,isSelected:!0}],opacity:80,grain:30,mode:"auto"}),h=(0,r.useRef)(null),m=(0,r.useRef)(null),p=(0,r.useRef)(null),x=e=>{let{colorStops:t,opacity:n,grain:o}=e,r=n/100,i=o/100,a="";if(i>.1){let e=.08*i,t=Math.max(15,25-8*i);a="\n        radial-gradient(ellipse at 12% 18%, rgba(255,255,255,".concat(e,") 3px, transparent ").concat(t,"px),\n        radial-gradient(ellipse at 87% 23%, rgba(0,0,0,").concat(.7*e,") 2px, transparent ").concat(1.2*t,"px),\n        radial-gradient(ellipse at 43% 82%, rgba(255,255,255,").concat(.5*e,") 4px, transparent ").concat(.9*t,"px),\n        radial-gradient(ellipse at 71% 64%, rgba(0,0,0,").concat(.6*e,") 2.5px, transparent ").concat(1.1*t,"px),\n        radial-gradient(ellipse at 29% 57%, rgba(255,255,255,").concat(.4*e,") 3.5px, transparent ").concat(1.3*t,"px),\n        radial-gradient(ellipse at 93% 11%, rgba(0,0,0,").concat(.3*e,") 2px, transparent ").concat(.8*t,"px),\n        radial-gradient(ellipse at 6% 89%, rgba(255,255,255,").concat(.6*e,") 3px, transparent ").concat(1.4*t,"px),\n        radial-gradient(ellipse at 78% 91%, rgba(0,0,0,").concat(.4*e,") 2.5px, transparent ").concat(1.1*t,"px),\n      ")}let l="";if(1===t.length){let e=t[0];l="radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(255*r).toString(16),", transparent 70%)")}else if(2===t.length){let[e,n]=t;l="\n        radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(.7*r*255).toString(16),", transparent 50%),\n        radial-gradient(circle at ").concat(n.x,"% ").concat(n.y,"%, ").concat(n.color).concat(Math.round(.7*r*255).toString(16),", transparent 50%)\n      ")}else if(3===t.length){let[e,n,o]=t;l="\n        radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%),\n        radial-gradient(circle at ").concat(n.x,"% ").concat(n.y,"%, ").concat(n.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%),\n        radial-gradient(circle at ").concat(o.x,"% ").concat(o.y,"%, ").concat(o.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%)\n      ")}return a?"".concat(a).concat(l):l||"transparent"},f=e=>{let{colorStops:t,opacity:n,grain:o}=e,r=Math.max(.7,n/100),i=o/100,a="";if(i>.3){let e=.04*i;a="\n        radial-gradient(ellipse at 25% 25%, rgba(255,255,255,".concat(e,") 4px, transparent 20px),\n        radial-gradient(ellipse at 75% 75%, rgba(0,0,0,").concat(.5*e,") 3px, transparent 25px),\n        radial-gradient(ellipse at 50% 15%, rgba(255,255,255,").concat(.7*e,") 3.5px, transparent 22px),\n      ")}let l="";if(1===t.length){let e=t[0];l="linear-gradient(135deg, ".concat(e.color).concat(Math.round(255*r).toString(16),", ").concat(e.color).concat(Math.round(.8*r*255).toString(16),")")}else if(2===t.length){let[e,n]=t;l="linear-gradient(135deg, ".concat(e.color).concat(Math.round(255*r).toString(16),", ").concat(n.color).concat(Math.round(255*r).toString(16),")")}else if(3===t.length){let[e,n,o]=t;l="linear-gradient(135deg, ".concat(e.color).concat(Math.round(255*r).toString(16),", ").concat(n.color).concat(Math.round(.9*r*255).toString(16),", ").concat(o.color).concat(Math.round(255*r).toString(16),")")}return a?"".concat(a).concat(l):l||"transparent"},b=e=>{if(!i)return;let t=x(e),n=f(e);document.querySelectorAll("[data-mood-element]").forEach(e=>{e.style.backgroundImage=t,e.style.transition="background-image 0.2s ease"}),document.querySelectorAll("[data-mood-header]").forEach(e=>{e.style.backgroundImage=t,e.style.transition="background-image 0.2s ease"}),console.log("\uD83C\uDFA8 Looking for toggle bar to update...");let o=document.querySelector('[data-toggle-bar="true"]');o?(console.log("\uD83C\uDFA8 Found toggle bar with data attribute:",o),o.style.backgroundImage=n,o.style.transition="background-image 0.2s ease",o.style.backgroundSize="cover",o.style.backgroundPosition="center"):(console.log("\uD83C\uDFA8 Toggle bar with data attribute not found, trying fallback..."),document.querySelectorAll("div").forEach(e=>{let t=e.textContent||"";t.includes("Atmosphere")&&t.includes("Enhanced features")&&t.includes("Mood Background")&&t.includes("Interactive Reflections")&&(console.log("\uD83C\uDFA8 Found toggle bar via text content:",e),e.style.backgroundImage=n,e.style.transition="background-image 0.2s ease",e.style.backgroundSize="cover",e.style.backgroundPosition="center")})),document.querySelectorAll("[data-reflection-bar], [data-mood-bar]").forEach(e=>{e.style.backgroundImage=n,e.style.transition="background-image 0.2s ease",e.style.backgroundSize="cover",e.style.backgroundPosition="center"}),document.querySelectorAll(".progress-bar, .status-bar, .mood-indicator").forEach(e=>{e.style.backgroundImage=n,e.style.transition="background-image 0.2s ease"}),localStorage.setItem("journaColorThemeConfig",JSON.stringify(e))},y=(e,t)=>{e.preventDefault(),c(t),g({...d,colorStops:d.colorStops.map(e=>({...e,isSelected:e.id===t}))})},_=e=>{let t,n;if(!s||!h.current)return;let o=h.current.getBoundingClientRect();e instanceof MouseEvent?(t=e.clientX,n=e.clientY):(t=e.touches[0].clientX,n=e.touches[0].clientY);let r=Math.max(5,Math.min(95,(t-o.left)/o.width*100)),i=Math.max(5,Math.min(95,(n-o.top)/o.height*100)),a={...d,colorStops:d.colorStops.map(e=>e.id===s?{...e,x:r,y:i}:e)};g(a),b(a)},w=()=>{c(null)},v=e=>{e.preventDefault(),c("opacity"),S(e)},S=e=>{let t;if(!m.current)return;let n=m.current.getBoundingClientRect(),o=Math.max(0,Math.min(100,((e instanceof MouseEvent||void 0!==e.clientX?e.clientX:e.touches[0].clientX)-n.left)/n.width*100)),r={...d,opacity:o};g(r),b(r)},j=e=>{e.preventDefault(),c("grain"),C(e)},C=e=>{let t,n;if(!p.current)return;let o=p.current.getBoundingClientRect(),r=o.left+o.width/2,i=o.top+o.height/2;e instanceof MouseEvent||void 0!==e.clientX?(t=e.clientX,n=e.clientY):(t=e.touches[0].clientX,n=e.touches[0].clientY);let a=180/Math.PI*Math.atan2(n-i,t-r);(a=(a+270)%360)<0&&(a+=360);let l=Math.round(Math.max(0,Math.min(100,4.166666666666667*Math.round(a/360*100/4.166666666666667))));if(Math.abs(l-d.grain)>.5){navigator.vibrate&&navigator.vibrate(10);let e={...d,grain:l};g(e),b(e)}},k=e=>{if(!d.colorStops.find(e=>e.isSelected))return;let t={...d,colorStops:d.colorStops.map(t=>t.isSelected?{...t,color:e}:t)};g(t),b(t)};if((0,r.useEffect)(()=>{if(s){let e=e=>{"opacity"===s?S(e):"grain"===s?C(e):_(e)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",w),document.addEventListener("touchmove",e,{passive:!1}),document.addEventListener("touchend",w),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",w),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",w)}}},[s,d]),(0,r.useEffect)(()=>{let e=localStorage.getItem("journaColorThemeConfig");if(e)try{let t=JSON.parse(e);g(t),b(t)}catch(e){console.error("Failed to load theme config:",e)}},[]),!n||!i)return null;let A=x(d),R=d.colorStops.find(e=>e.isSelected)||d.colorStops[0];return(0,o.jsxs)("div",{style:{position:"fixed",bottom:window.innerWidth<=768?"100px":"40px",left:window.innerWidth<=768?"20px":"40px",zIndex:1001,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[(0,o.jsx)("button",{onClick:()=>l(!a),style:{width:window.innerWidth<=768?"48px":"56px",height:window.innerWidth<=768?"48px":"56px",borderRadius:"50%",border:"none",background:A||"#007AFF",color:"white",fontSize:"20px",cursor:"pointer",boxShadow:a?"0 8px 25px rgba(0, 122, 255, 0.4), 0 0 0 2px rgba(0, 122, 255, 0.2)":"0 6px 20px rgba(0, 122, 255, 0.3)",transform:a?"scale(1.05) rotate(45deg)":"scale(1) rotate(0deg)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},title:"Journa Color Editor",children:(0,o.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",{id:"iconGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0.9"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"0.7"})]})}),(0,o.jsx)("circle",{cx:"8",cy:"8",r:"3",fill:"url(#iconGradient)"}),(0,o.jsx)("circle",{cx:"16",cy:"12",r:"2.5",fill:"url(#iconGradient)"}),(0,o.jsx)("circle",{cx:"12",cy:"18",r:"2",fill:"url(#iconGradient)"}),(0,o.jsx)("path",{d:"M8 8L16 12M16 12L12 18",stroke:"url(#iconGradient)",strokeWidth:"1.5",strokeLinecap:"round"})]})}),a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("style",{children:"\n              @keyframes gentleSlideUp {\n                from {\n                  opacity: 0;\n                  transform: translateY(20px) scale(0.98);\n                }\n                to {\n                  opacity: 1;\n                  transform: translateY(0) scale(1);\n                }\n              }\n            "}),(0,o.jsxs)("div",{style:{position:"fixed",bottom:window.innerWidth<=768?"160px":"110px",left:window.innerWidth<=768?"20px":"40px",width:window.innerWidth<=768?"340px":"380px",maxHeight:window.innerWidth<=768?"400px":"500px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",borderRadius:window.innerWidth<=768?"16px":"24px",padding:window.innerWidth<=768?"16px":"24px",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",zIndex:999,animation:"gentleSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden"},children:[(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem"},children:[{mode:"auto",icon:u.R9,title:"Auto"},{mode:"light",icon:"☀️",title:"Light"},{mode:"dark",icon:"\uD83C\uDF19",title:"Dark"}].map(e=>{let{mode:t,icon:n,title:r}=e;return(0,o.jsx)("button",{onClick:()=>{let e={...d,mode:t};g(e),b(e)},style:{width:"48px",height:"48px",borderRadius:"12px",border:d.mode===t?"2px solid #007AFF":"2px solid rgba(0,0,0,0.1)",background:d.mode===t?"rgba(0, 122, 255, 0.1)":"rgba(0,0,0,0.05)",fontSize:"20px",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},title:r,children:"auto"===t?(0,o.jsx)(u.R9,{size:20,color:d.mode===t?"#007AFF":"#666"}):n},t)})}),(0,o.jsx)("div",{ref:h,style:{width:"100%",height:"180px",borderRadius:"16px",background:"\n                radial-gradient(circle at 50% 50%, rgba(100, 100, 100, 0.1) 0%, transparent 70%),\n                repeating-linear-gradient(0deg, rgba(255,255,255,0.03), rgba(255,255,255,0.03) 1px, transparent 1px, transparent 8px),\n                repeating-linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.03) 1px, transparent 1px, transparent 8px),\n                linear-gradient(135deg, #f0f0f0, #e8e8e8)\n              ",position:"relative",cursor:"grab",marginBottom:"1.5rem",border:"1px solid rgba(0,0,0,0.1)",overflow:"hidden"},children:d.colorStops.map(e=>(0,o.jsx)("div",{onMouseDown:t=>y(t,e.id),onTouchStart:t=>y(t,e.id),style:{position:"absolute",top:"".concat(e.y,"%"),left:"".concat(e.x,"%"),transform:"translate(-50%, -50%)",width:e.isSelected?window.innerWidth<=768?"32px":"24px":window.innerWidth<=768?"28px":"20px",height:e.isSelected?window.innerWidth<=768?"32px":"24px":window.innerWidth<=768?"28px":"20px",borderRadius:"50%",background:e.color,border:e.isSelected?"3px solid white":"2px solid white",boxShadow:e.isSelected?"0 4px 12px rgba(0,0,0,0.4)":"0 2px 8px rgba(0,0,0,0.3)",cursor:s===e.id?"grabbing":"grab",transition:s===e.id?"none":"all 0.2s ease",zIndex:e.isSelected?10:5}},e.id))}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,o.jsx)("button",{onClick:()=>{if(d.colorStops.length<=1)return;let e={...d,colorStops:d.colorStops.slice(0,-1)};g(e),b(e)},disabled:d.colorStops.length<=1,style:{width:window.innerWidth<=768?"44px":"36px",height:window.innerWidth<=768?"44px":"36px",borderRadius:"8px",border:"1px solid rgba(0,0,0,0.2)",background:d.colorStops.length<=1?"rgba(0,0,0,0.05)":"white",fontSize:window.innerWidth<=768?"20px":"18px",cursor:d.colorStops.length<=1?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:d.colorStops.length<=1?.5:1},children:"−"}),(0,o.jsxs)("span",{style:{fontSize:"14px",color:"#666",minWidth:"80px",textAlign:"center"},children:[d.colorStops.length,"/3 colors"]}),(0,o.jsx)("button",{onClick:()=>{if(d.colorStops.length>=3)return;let e={id:Date.now().toString(),color:"#FF6B6B",x:50+15*d.colorStops.length,y:50+10*d.colorStops.length,isSelected:!1},t={...d,colorStops:[...d.colorStops,e]};g(t),b(t)},disabled:d.colorStops.length>=3,style:{width:window.innerWidth<=768?"44px":"36px",height:window.innerWidth<=768?"44px":"36px",borderRadius:"8px",border:"1px solid rgba(0,0,0,0.2)",background:d.colorStops.length>=3?"rgba(0,0,0,0.05)":"white",fontSize:window.innerWidth<=768?"20px":"18px",cursor:d.colorStops.length>=3?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:d.colorStops.length>=3?.5:1},children:"+"})]}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:["#FFFFFF","#FFB3D9","#B19CD9","#FF6B6B","#FF8E53","#FFD93D","#6BCF7F","#4ECDC4","#45B7D1"].map((e,t)=>(0,o.jsx)("button",{onClick:()=>k(e),style:{width:"32px",height:"32px",borderRadius:"50%",border:R.color===e?"3px solid #007AFF":"2px solid rgba(0,0,0,0.1)",background:e,cursor:"pointer",transform:R.color===e?"scale(1.15)":"scale(1)",transition:"all 0.2s ease"}},t))}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[(0,o.jsxs)("div",{ref:m,onMouseDown:v,onTouchStart:v,style:{flex:1,height:"40px",background:"rgba(0,0,0,0.05)",borderRadius:"20px",position:"relative",cursor:"pointer",display:"flex",alignItems:"center",paddingLeft:"12px",paddingRight:"12px"},children:[(0,o.jsx)("div",{style:{position:"absolute",left:"12px",right:"12px",height:"4px",background:"repeating-linear-gradient(to right, #ccc 0px, #ccc 3px, transparent 3px, transparent 6px)",borderRadius:"2px"}}),(0,o.jsx)("div",{style:{position:"absolute",left:"".concat(12+d.opacity/100*76,"%"),width:"16px",height:"16px",background:"white",borderRadius:"50%",border:"2px solid #007AFF",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",transform:"translateX(-50%)"}})]}),(0,o.jsxs)("div",{ref:p,onMouseDown:j,onTouchStart:j,style:{width:"60px",height:"60px",borderRadius:"50%",background:"linear-gradient(145deg, #f0f0f0, #d9d9d9)",position:"relative",cursor:"grain"===s?"grabbing":"grab",border:"1px solid rgba(0,0,0,0.1)",boxShadow:"grain"===s?"inset 0 2px 4px rgba(0,0,0,0.2)":"0 2px 4px rgba(0,0,0,0.1)",transition:"grain"===s?"none":"all 0.2s ease"},children:[[0,45,90,135,180,225,270,315].map((e,t)=>(0,o.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",width:"2px",height:"6px",background:"rgba(0,0,0,0.3)",borderRadius:"1px",transform:"translate(-50%, -50%) rotate(".concat(e,"deg) translateY(-22px)"),transformOrigin:"center"}},t)),(0,o.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",width:"40px",height:"40px",borderRadius:"50%",background:"linear-gradient(145deg, #ffffff, #e8e8e8)",transform:"translate(-50%, -50%)",border:"1px solid rgba(0,0,0,0.1)",boxShadow:"grain"===s?"inset 0 1px 3px rgba(0,0,0,0.2)":"0 1px 3px rgba(0,0,0,0.1)"},children:[(0,o.jsx)("div",{style:{position:"absolute",top:"6px",left:"50%",width:"3px",height:"12px",background:"#007AFF",borderRadius:"1.5px",transform:"translateX(-50%) rotate(".concat(d.grain/100*360,"deg)"),transformOrigin:"50% 14px",transition:"grain"===s?"none":"transform 0.2s ease"}}),(0,o.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",width:"4px",height:"4px",background:"#007AFF",borderRadius:"50%",transform:"translate(-50%, -50%)"}})]}),(0,o.jsxs)("div",{style:{position:"absolute",bottom:"-20px",left:"50%",transform:"translateX(-50%)",fontSize:"10px",color:"#666",fontWeight:"500"},children:[Math.round(d.grain),"%"]})]})]})]})]})]})},S=r.memo(e=>{let{initialEnabled:t=!0,className:n="",style:a={},currentMood:l="joyful"}=e,[s,c]=(0,r.useState)(t),[d,g]=(0,r.useState)(null),[h,m]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{if(g(e),e){let e=localStorage.getItem("moodFeatureEnabled");if(null!==e){let t=JSON.parse(e);c(t);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log("\uD83C\uDFA8 Applying initial mood state (attempt ".concat(e,"):"),t);let o=document.querySelectorAll("[data-mood-element]");if(console.log("\uD83C\uDFA8 Found mood elements on init:",o.length),0===o.length&&e<5)return void setTimeout(()=>n(e+1),200);o.forEach(e=>{e.style.transition="opacity 0.3s ease, transform 0.3s ease",t?(e.setAttribute("data-mood-active","true"),e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.style.transform="scale(1)",console.log("\uD83C\uDFA8 Initial show:",e.getAttribute("data-mood-element"))):(e.setAttribute("data-mood-active","false"),e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.transform="scale(0.95)",console.log("\uD83C\uDFA8 Initial hide:",e.getAttribute("data-mood-element")))}),document.querySelectorAll("[data-mood-header]").forEach(e=>{e.style.transition="background 0.4s ease, border 0.4s ease, box-shadow 0.4s ease",t||(e.style.background="rgba(255, 255, 255, 0.95)",e.style.border="1px solid rgba(0, 0, 0, 0.1)",e.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")})};setTimeout(()=>n(),100)}else c(!0)}else c(!1)});return()=>e()},[]),d)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>{if(console.log("\uD83C\uDFA8 MoodToggle clicked - should NOT trigger parent re-render"),!d)return;m(!0),setTimeout(()=>m(!1),300);let e=!s;c(e),localStorage.setItem("moodFeatureEnabled",JSON.stringify(e)),console.log("\uD83C\uDFA8 Mood feature toggled to:",e),console.log("\uD83C\uDFA8 Toggle clicked - searching for mood elements...");let t=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=document.querySelectorAll("[data-mood-element]");if(console.log("\uD83C\uDFA8 Found mood elements (attempt ".concat(n,"):"),o.length),0===o.length&&n<3)return void setTimeout(()=>t(n+1),100);o.forEach(t=>{t.style.transition="opacity 0.3s ease, transform 0.3s ease",e?(t.setAttribute("data-mood-active","true"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1",t.style.transform="scale(1)",console.log("\uD83C\uDFA8 Showing mood element:",t.getAttribute("data-mood-element"))):(t.setAttribute("data-mood-active","false"),t.style.opacity="0",t.style.transform="scale(0.95)",console.log("\uD83C\uDFA8 Hiding mood element:",t.getAttribute("data-mood-element")),setTimeout(()=>{"false"===t.getAttribute("data-mood-active")&&(t.style.display="none",t.style.visibility="hidden")},300))})};t(),document.querySelectorAll("[data-mood-header]").forEach(t=>{if(t.style.transition="background 0.4s ease, border 0.4s ease, box-shadow 0.4s ease",e){t.style.background="",t.style.border="",t.style.boxShadow="";let e=t.style.display;t.style.display="none",t.offsetHeight,t.style.display=e,console.log("\uD83C\uDFA8 Header mood styling restored - cleared overrides")}else t.setAttribute("data-mood-style",t.style.background),t.style.background="rgba(255, 255, 255, 0.95)",t.style.border="1px solid rgba(0, 0, 0, 0.1)",t.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)",console.log("\uD83C\uDFA8 Header mood styling removed")}),console.log("\uD83C\uDFA8 Mood backgrounds updated immediately. Enabled:",e)},className:n,style:{...a,transition:"all 0.3s ease",transform:h?"scale(1.1)":"scale(1)"},title:s?"Turn off mood feature":"Turn on mood feature",children:s?"ON":"OFF"}),(0,o.jsx)(v,{currentMood:l,isVisible:!!d,moodFeatureEnabled:s})]}):null}),j=r.memo(e=>{let{articleId:t,className:a,style:l}=e,[s,c]=(0,r.useState)(null),[d,g]=(0,r.useState)(!1),[h,m]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[y,_]=(0,r.useState)(!1),[w,v]=(0,r.useState)(!1),[S,j]=(0,r.useState)({width:0,height:0}),C=(0,r.useMemo)(()=>{let e=S.width;return{isMobile:e<=768,isTablet:e>768&&e<=1024,isDesktop:e>1024,isSmallPhone:e<=480,isLandscape:e>S.height,isIPad11:e>=820&&e<=1024,bottomSafeArea:Math.max(100,e<=768?120:80),sideMargin:e<=480?16:e<=768?20:40}},[S]);(0,r.useEffect)(()=>{let e,t=()=>{j({width:window.innerWidth,height:window.innerHeight})};t();let n=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),clearTimeout(e)}},[]),(0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{c(e)});return()=>e()},[]);let k=(0,r.useMemo)(()=>["How does this make you feel?","What questions does this raise for you?","How does this relate to your own experience?","What would you do differently?","What surprised you most about this?","What's your main takeaway from this?","How might this change your perspective?"],[]),A=(0,r.useCallback)(()=>{let e=Math.floor(Math.random()*k.length);return k[e]},[k]);(0,r.useEffect)(()=>{h||m(A())},[h,A]);let R=(0,r.useCallback)(()=>{v(!0),g(e=>!e),setTimeout(()=>v(!1),300),d&&(b(!1),x(""))},[d]),N=(0,r.useCallback)(()=>{b(!1),h.trim()||m(A())},[h,A]),E=(0,r.useCallback)(async()=>{if(p.trim()&&!y&&s){_(!0);try{let{saveReflectionResponse:e}=await Promise.resolve().then(n.bind(n,9122));await e(t,"custom_".concat(Date.now()),h,p.trim(),0,!0),x(""),g(!1),console.log("Reflection saved successfully")}catch(e){console.error("Error saving reflection:",e)}finally{_(!1)}}},[p,y,s,t,h]),F=(0,r.useMemo)(()=>({position:"fixed",bottom:C.isMobile?"max(".concat(C.bottomSafeArea+20,"px, calc(").concat(C.bottomSafeArea,"px + env(safe-area-inset-bottom)))"):"40px",right:"".concat(C.sideMargin,"px"),width:C.isSmallPhone?"48px":C.isMobile?"52px":"56px",height:C.isSmallPhone?"48px":C.isMobile?"52px":"56px",borderRadius:"50%",background:d?"linear-gradient(135deg, #1d4ed8, #7c3aed)":"linear-gradient(135deg, #3b82f6, #8b5cf6)",border:"none",boxShadow:d?"0 8px 25px rgba(59, 130, 246, 0.4), 0 0 0 2px rgba(59, 130, 246, 0.2)":"0 6px 20px rgba(59, 130, 246, 0.3)",cursor:"pointer",zIndex:1002,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center",transform:w?"scale(1.1)":d?"scale(1.05)":"scale(1)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",contain:"layout style paint",willChange:w?"transform":"auto",...l}),[C,d,w,l]),M=(0,r.useMemo)(()=>({position:"fixed",bottom:C.isMobile?"max(".concat(C.bottomSafeArea+80,"px, calc(").concat(C.bottomSafeArea+60,"px + env(safe-area-inset-bottom)))"):"110px",right:C.isMobile?"".concat(C.sideMargin,"px"):"40px",left:C.isMobile?"".concat(C.sideMargin,"px"):"auto",width:C.isMobile?"auto":"380px",maxWidth:C.isMobile?"none":"380px",maxHeight:C.isLandscape&&C.isMobile?"60vh":C.isMobile?"50vh":"500px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:C.isSmallPhone?"16px":C.isMobile?"18px":"24px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.3)",zIndex:1001,padding:C.isSmallPhone?"16px":C.isMobile?"18px":"24px",overflow:"hidden auto",contain:"layout style paint",transform:"translateZ(0)"}),[C]);return s?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{"data-reflection-element":"floating-button",onClick:R,className:"reflection-component hw-accelerated ".concat(a||""),style:F,title:d?"Close reflection":"Open reflection","aria-label":d?"Close reflection panel":"Open reflection panel",children:(0,o.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:d?(0,o.jsx)(u.US,{size:C.isSmallPhone?12:14,color:"#ffffff"}):(0,o.jsx)(u.zf,{size:C.isSmallPhone?12:14,color:"#ffffff"})})}),d&&(0,o.jsxs)("div",{className:"reflection-component floating-panel hw-accelerated",style:M,role:"dialog","aria-labelledby":"reflection-title","aria-modal":"true",children:[(0,o.jsx)("style",{children:"\n              @keyframes gentleSlideUp {\n                from {\n                  opacity: 0;\n                  transform: translateY(20px) scale(0.98);\n                }\n                to {\n                  opacity: 1;\n                  transform: translateY(0) scale(1);\n                }\n              }\n              \n              .reflection-panel-enter {\n                animation: gentleSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n              }\n            "}),(0,o.jsxs)("div",{style:{marginBottom:"20px",textAlign:"center"},children:[(0,o.jsxs)("h3",{id:"reflection-title",style:{margin:"0 0 12px 0",fontSize:C.isSmallPhone?"14px":"16px",fontWeight:"600",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,o.jsx)(u.uQ,{size:C.isSmallPhone?14:16,color:"#3b82f6"}),"Time to Reflect"]}),(0,o.jsx)("div",{style:{position:"relative"},children:f?(0,o.jsx)("input",{type:"text",value:h,onChange:e=>m(e.target.value),onBlur:N,onKeyDown:e=>{"Enter"===e.key&&N(),"Escape"===e.key&&(m(A()),b(!1))},autoFocus:!0,className:"mobile-optimized-input",style:{width:"100%",padding:"8px 12px",border:"2px solid #3b82f6",borderRadius:"12px",background:"white",fontSize:C.isSmallPhone?"13px":"14px",textAlign:"center",outline:"none"}}):(0,o.jsx)("button",{onClick:()=>b(!0),style:{background:"transparent",border:"2px solid transparent",borderRadius:"12px",padding:"8px 12px",fontSize:C.isSmallPhone?"13px":"14px",color:"#3b82f6",cursor:"pointer",transition:"all 0.2s ease",fontWeight:"500",textAlign:"center",width:"100%"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#e2e8f0",e.currentTarget.style.background="#f8fafc"},onMouseLeave:e=>{e.currentTarget.style.borderColor="transparent",e.currentTarget.style.background="transparent"},title:"Click to edit prompt",children:h})})]}),(0,o.jsx)("textarea",{value:p,onChange:e=>x(e.target.value),placeholder:"Share your thoughts...",className:"mobile-optimized-input reflection-input","data-mobile":"true",style:{width:"100%",height:C.isSmallPhone?"100px":"120px",padding:"12px",border:"2px solid #e2e8f0",borderRadius:"12px",background:"white",fontSize:C.isSmallPhone?"15px":"16px",fontFamily:"inherit",resize:"vertical",outline:"none",transition:"border-color 0.2s ease",marginBottom:"16px"},onFocus:e=>{e.target.style.borderColor="#3b82f6",C.isMobile&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},100)},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexDirection:C.isSmallPhone?"column":"row"},children:[(0,o.jsx)("button",{onClick:()=>g(!1),style:{background:"transparent",border:"2px solid #e2e8f0",borderRadius:"12px",padding:C.isSmallPhone?"12px 20px":"8px 16px",fontSize:C.isSmallPhone?"15px":"14px",color:"#64748b",cursor:"pointer",fontWeight:"500",transition:"all 0.2s ease",width:C.isSmallPhone?"100%":"auto",minHeight:"44px"},children:"Cancel"}),(0,o.jsx)("button",{onClick:E,disabled:!p.trim()||y,style:{background:p.trim()?"linear-gradient(135deg, #3b82f6, #8b5cf6)":"#e2e8f0",border:"none",borderRadius:"12px",padding:C.isSmallPhone?"12px 20px":"8px 20px",fontSize:C.isSmallPhone?"15px":"14px",color:p.trim()?"white":"#94a3b8",cursor:p.trim()?"pointer":"not-allowed",fontWeight:"600",transition:"all 0.2s ease",opacity:y?.7:1,width:C.isSmallPhone?"100%":"auto",minHeight:"44px"},children:y?"Saving...":"Save Reflection"})]})]})]}):null});var C=n(326);let k=r.memo(e=>{let{className:t="",style:n={}}=e,[a,l]=(0,r.useState)(!0),[s,c]=(0,r.useState)(null),[d,g]=(0,r.useState)(!1),[h]=(0,r.useState)("reflective");return((0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{if(c(e),e){let e=localStorage.getItem("reflectionsEnabled");if(null!==e){let t=JSON.parse(e);l(t),setTimeout(()=>{document.querySelectorAll("[data-reflection-element]").forEach(e=>{e.style.display=t?"":"none"})},100)}else l(!0)}else l(!1)});return()=>e()},[]),s)?(0,o.jsx)("button",{onClick:()=>{if(console.log("ReflectionModeToggle clicked - should NOT trigger parent re-render"),!s)return;g(!0),setTimeout(()=>g(!1),300);let e=!a;l(e),localStorage.setItem("reflectionsEnabled",JSON.stringify(e)),console.log("Reflection mode toggled to:",e),document.querySelectorAll("[data-reflection-element]").forEach(t=>{e?t.style.display="":t.style.display="none"}),window.dispatchEvent(new CustomEvent("reflectionModeToggle",{detail:{enabled:e}}))},className:t,style:{...n,transition:"all 0.3s ease",transform:d?"scale(1.1)":"scale(1)",background:a?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.2)",color:a?C.Qx[h].accent:"#F7FAFC"},title:a?"Turn off reflections":"Turn on reflections",children:a?"ON":"OFF"}):(0,o.jsx)("button",{style:{...n,opacity:.6,cursor:"not-allowed"},disabled:!0,title:"Sign in to use reflections",children:"OFF"})});var A=n(7036),R=n.n(A);async function N(e){let t="".concat("http://127.0.0.1:5001","/api/prototype/v1/article/").concat(e),n=await fetch(t);if(!n.ok)throw Error("Failed to fetch article: ".concat(n.status," ").concat(n.statusText));return n.json()}var E=n(3241),F=n.n(E);function M(){return(0,r.useEffect)(()=>{let e=document.createElement("script");return e.textContent="\n// Simple syntax highlighting without external dependencies\nfunction highlightCode() {\n  const codeBlocks = document.querySelectorAll('pre code');\n  \n  codeBlocks.forEach(codeBlock => {\n    const pre = codeBlock.parentElement;\n    if (!pre) return;\n    \n    // Apply dark theme\n    pre.style.backgroundColor = '#1e1e1e';\n    pre.style.color = '#d4d4d4';\n    pre.style.border = '1px solid #333';\n    pre.style.borderRadius = '8px';\n    pre.style.padding = '16px';\n    pre.style.fontFamily = \"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace\";\n    pre.style.fontSize = '14px';\n    pre.style.lineHeight = '1.6';\n    pre.style.overflowX = 'auto';\n    pre.style.position = 'relative';\n    \n    const code = codeBlock.textContent || '';\n    let highlightedCode = code;\n    \n    // Simplified highlighting to avoid regex issues\n    try {\n      // Keywords\n      const keywords = ['const', 'let', 'var', 'function', 'class', 'interface', 'type', 'enum', 'import', 'export', 'from', 'as', 'return', 'if', 'else', 'for', 'while', 'switch', 'case', 'break', 'default', 'try', 'catch', 'finally', 'async', 'await', 'new', 'this', 'extends', 'implements', 'private', 'public', 'protected', 'static'];\n      keywords.forEach(keyword => {\n        const regex = new RegExp('\\\\b' + keyword + '\\\\b', 'g');\n        highlightedCode = highlightedCode.replace(regex, '<span style=\"color: #569cd6; font-weight: 500;\">' + keyword + '</span>');\n      });\n      \n      // Simple string highlighting\n      highlightedCode = highlightedCode.replace(/\"([^\"]*)\"/g, '<span style=\"color: #ce9178;\">\"$1\"</span>');\n      highlightedCode = highlightedCode.replace(/'([^']*)'/g, '<span style=\"color: #ce9178;\">'$1'</span>');\n      \n      // Numbers\n      highlightedCode = highlightedCode.replace(/\\b\\d+\\.?\\d*\\b/g, '<span style=\"color: #b5cea8;\">$&</span>');\n      \n      // Comments\n      highlightedCode = highlightedCode.replace(///.*$/gm, '<span style=\"color: #6a9955; font-style: italic;\">$&</span>');\n    } catch (e) {\n      console.warn('Syntax highlighting failed:', e);\n      // Keep original code if highlighting fails\n    }\n    \n    codeBlock.innerHTML = highlightedCode;\n    \n    // Add language indicator if available\n    let language = 'code';\n    const classNames = codeBlock.className.split(' ');\n    for (const className of classNames) {\n      if (className.startsWith('language-')) {\n        language = className.replace('language-', '');\n        break;\n      }\n    }\n    \n    if (pre.hasAttribute('data-language')) {\n      language = pre.getAttribute('data-language');\n    }\n    \n    // Add language badge\n    const badge = document.createElement('div');\n    badge.textContent = language.toUpperCase();\n    badge.style.position = 'absolute';\n    badge.style.top = '8px';\n    badge.style.right = '12px';\n    badge.style.background = 'rgba(255, 255, 255, 0.1)';\n    badge.style.color = '#a0a0a0';\n    badge.style.padding = '2px 8px';\n    badge.style.borderRadius = '4px';\n    badge.style.fontSize = '12px';\n    badge.style.fontWeight = '500';\n    badge.style.letterSpacing = '0.5px';\n    pre.appendChild(badge);\n  });\n}\n\n// Run when DOM is loaded\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', highlightCode);\n} else {\n  highlightCode();\n}\n\n// Also run on dynamic content changes\nconst observer = new MutationObserver(() => {\n  setTimeout(highlightCode, 100);\n});\n\nobserver.observe(document.body, {\n  childList: true,\n  subtree: true\n});\n",document.head.appendChild(e),()=>{try{document.head.removeChild(e)}catch(e){}}},[]),null}n(8042),n(5802),n(7846),n(1280),n(8496),n(941),n(3523),n(4495),n(1177),n(1990),n(3686),n(642),n(7867),n(3337),n(3435),n(1055),n(2103),n(255),n(9829),n(656);var T=n(7041),I=n(6203),B=n(6408),D=n(7023),L=n.n(D);let W=e=>{let{topic:t,unreadCount:n,isOpen:r,onClick:i}=e,a=t.length>60?"".concat(t.substring(0,60),"..."):t;return(0,o.jsx)(B.P.div,{className:L().reflectionSearchBar,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:i,children:(0,o.jsxs)("div",{className:"".concat(L().reflectionSearchWrapper," ").concat(r?L().focused:""),children:[(0,o.jsx)("div",{className:L().reflectionIcon,children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),(0,o.jsx)("path",{d:"M8 10h8"}),(0,o.jsx)("path",{d:"M8 14h6"})]})}),(0,o.jsxs)("div",{className:L().reflectionText,children:[(0,o.jsx)("span",{className:L().reflectionLabel,children:"Reflect on:"}),(0,o.jsxs)("span",{className:L().reflectionTopic,children:['"',a,'"']})]}),(0,o.jsxs)("div",{className:L().reflectionJoin,children:[n>0&&(0,o.jsx)("div",{className:L().reflectionUnread,children:n}),(0,o.jsx)("span",{className:L().reflectionJoinText,children:"Join discussion"}),(0,o.jsx)("svg",{className:L().reflectionArrow,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("path",{d:"M9 18l6-6-6-6"})})]})]})})};var z=n(760),P=n(4744);let H=e=>{let[t,n]=(0,r.useState)([]),[o,l]=(0,r.useState)(""),[s,c]=(0,r.useState)(!0),[d,g]=(0,r.useState)(null),[h,m]=(0,r.useState)(0),u=i.j2.currentUser,p=(0,r.useCallback)(async()=>{try{let t=(0,a.doc)(i.db,"reflections",e,"metadata","main"),n=await (0,a.getDoc)(t);if(n.exists()){let e=n.data();l(e.topic)}}catch(e){console.error("Error loading reflection metadata:",e),g("Failed to load discussion topic")}},[e]);(0,r.useEffect)(()=>{if(!e)return;c(!0);let t=(0,a.collection)(i.db,"reflections",e,"messages"),o=(0,a.query)(t,(0,a.orderBy)("createdAt","asc")),r=(0,a.onSnapshot)(o,e=>{let t=[],o=0;e.forEach(e=>{let n=e.data(),r={id:e.id,userId:n.userId,userName:n.userName,content:n.content,createdAt:n.createdAt,read:n.read||!1};t.push(r),!r.read&&r.userId!==(null==u?void 0:u.uid)&&o++}),n(t),m(o),c(!1),g(null)},e=>{console.error("Error listening to messages:",e),g("Failed to load messages"),c(!1)});return p(),()=>r()},[e,null==u?void 0:u.uid,p]);let x=(0,r.useCallback)(async t=>{if(u&&t.trim())try{var n;let o=await (0,P.VM)(u.uid),r=o?"".concat(o.firstName," ").concat(o.lastName):u.displayName||(null==(n=u.email)?void 0:n.split("@")[0])||"Anonymous",l=(0,a.collection)(i.db,"reflections",e,"messages");await (0,a.addDoc)(l,{userId:u.uid,userName:r,content:t.trim(),createdAt:(0,a.serverTimestamp)(),read:!1})}catch(e){throw console.error("Error sending message:",e),e}},[u,e]),f=(0,r.useCallback)(async()=>{if(u)try{let t=(0,a.collection)(i.db,"reflections",e,"messages"),n=(await (0,a.getDocs)(t)).docs.filter(e=>{let t=e.data();return!t.read&&t.userId!==u.uid}).map(e=>(0,a.setDoc)(e.ref,{read:!0},{merge:!0}));await Promise.all(n)}catch(e){console.error("Error marking messages as read:",e)}},[u,e]),b=(0,r.useCallback)(async t=>{if(u)try{let n=(0,a.doc)(i.db,"reflections",e,"metadata","main");await (0,a.setDoc)(n,{topic:t,createdAt:(0,a.serverTimestamp)(),authorId:u.uid}),l(t)}catch(e){throw console.error("Error creating reflection room:",e),e}},[u,e]);return{messages:t,topic:o,loading:s,error:d,unreadCount:h,sendMessage:x,deleteMessage:(0,r.useCallback)(async t=>{if(u)try{let n=(0,a.doc)(i.db,"reflections",e,"messages",t),o=await (0,a.getDoc)(n);if(!o.exists())throw Error("Message not found");if(o.data().userId!==u.uid)throw Error("You can only delete your own messages");await (0,a.deleteDoc)(n)}catch(e){throw console.error("Error deleting message:",e),e}},[u,e]),markAllAsRead:f,createReflectionRoom:b}},O=e=>{let{articleId:t,isOpen:n,onClose:a,isMobile:l,authorId:s}=e,[c,d]=(0,r.useState)(""),[g,h]=(0,r.useState)(!1),[m,p]=(0,r.useState)(null),x=(0,r.useRef)(null),f=(0,r.useRef)(null),{messages:b,topic:y,loading:_,error:w,sendMessage:v,deleteMessage:S,unreadCount:j,markAllAsRead:C}=H(t),k=i.j2.currentUser,A=(0,r.useMemo)(()=>({closed:{x:"100%",opacity:0},open:{x:0,opacity:1}}),[]),R=(0,r.useMemo)(()=>({closed:{y:"100%",opacity:0},open:{y:0,opacity:1}}),[]),N=(0,r.useMemo)(()=>({type:"tween",duration:.3,ease:[.4,0,.2,1]}),[]);(0,r.useEffect)(()=>{let e=setTimeout(()=>{var e;null==(e=x.current)||e.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(e)},[b.length]),(0,r.useEffect)(()=>{if(n&&j>0){let e=setTimeout(()=>{C()},500);return()=>clearTimeout(e)}},[n,j,C]);let E=(0,r.useCallback)(()=>{f.current&&(f.current.style.height="auto",f.current.style.height="".concat(f.current.scrollHeight,"px"))},[]);(0,r.useEffect)(()=>{E()},[c,E]);let F=(0,r.useCallback)(async e=>{if(e.preventDefault(),c.trim()&&!g&&k){h(!0);try{await v(c.trim()),d("")}catch(e){console.error("Error sending message:",e)}finally{h(!1)}}},[c,g,k,v]),M=(0,r.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),F(e))},[F]),T=(0,r.useCallback)(e=>{if(!e)return"";let t=e.toDate?e.toDate():new Date(e);return(new Date().getTime()-t.getTime())/36e5<24?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},[]),I=(0,r.useCallback)(async e=>{if(k&&!m){p(e);try{await S(e)}catch(e){console.error("Error deleting message:",e)}finally{p(null)}}},[k,S,m]),D=(0,r.useMemo)(()=>b.map(e=>{let t=e.userId===(null==k?void 0:k.uid),n=e.userId===s,r=m===e.id;return(0,o.jsxs)("div",{className:"".concat(L().message," ").concat(t?L().ownMessage:L().otherMessage," ").concat(n?L().authorMessage:""," ").concat(r?L().messageDeleting:""),children:[(0,o.jsxs)("div",{className:L().messageHeader,children:[(0,o.jsxs)("span",{className:"".concat(L().userName," ").concat(n?L().authorName:""),children:[e.userName,n&&(0,o.jsx)("span",{className:L().authorBadge,children:"Author"})]}),(0,o.jsxs)("div",{className:L().messageHeaderRight,children:[(0,o.jsx)("span",{className:L().messageTime,children:T(e.createdAt)}),t&&(0,o.jsx)("button",{className:L().deleteButton,onClick:()=>I(e.id),disabled:r,"aria-label":"Delete message",title:"Delete message",children:r?(0,o.jsx)("div",{className:L().deleteSpinner}):(0,o.jsx)(u.uc,{size:14})})]})]}),(0,o.jsx)("div",{className:L().messageContent,children:e.content})]},e.id)}),[b,null==k?void 0:k.uid,s,T,m,I]);return(0,o.jsx)(z.N,{mode:"wait",children:n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(B.P.div,{className:L().backdrop,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:a}),(0,o.jsxs)(B.P.div,{className:"".concat(L().sidebar," ").concat(l?L().mobileModal:""),variants:l?R:A,initial:"closed",animate:"open",exit:"closed",transition:N,children:[(0,o.jsxs)("div",{className:L().header,children:[(0,o.jsxs)("div",{className:L().headerTitle,children:[(0,o.jsx)("h3",{children:"Reflection Room"}),(0,o.jsx)("button",{className:L().closeButton,onClick:a,"aria-label":"Close reflection room",children:(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),y&&(0,o.jsxs)("div",{className:L().topicSection,children:[(0,o.jsx)("div",{className:L().topicLabel,children:"Discussion Topic"}),(0,o.jsx)("div",{className:L().topicText,children:y})]})]}),(0,o.jsx)("div",{className:L().messagesContainer,children:_?(0,o.jsxs)("div",{className:L().loadingState,children:[(0,o.jsx)("div",{className:L().loadingSpinner}),(0,o.jsx)("p",{children:"Loading messages..."})]}):w?(0,o.jsx)("div",{className:L().errorState,children:(0,o.jsxs)("p",{children:["Error loading messages: ",w]})}):0===b.length?(0,o.jsxs)("div",{className:L().emptyState,children:[(0,o.jsx)("div",{className:L().emptyIcon,children:"\uD83D\uDCAD"}),(0,o.jsx)("p",{children:"No messages yet. Be the first to share your thoughts!"})]}):(0,o.jsxs)("div",{className:L().messagesList,children:[D,(0,o.jsx)("div",{ref:x})]})}),k&&(0,o.jsxs)("form",{onSubmit:F,className:L().messageForm,children:[(0,o.jsxs)("div",{className:L().inputContainer,children:[(0,o.jsx)("textarea",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:M,placeholder:"Share your thoughts...",className:L().messageInput,rows:1,maxLength:1e3,disabled:g}),(0,o.jsx)("button",{type:"submit",className:L().sendButton,disabled:!c.trim()||g,children:g?(0,o.jsx)("div",{className:L().sendingSpinner}):(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,o.jsxs)("div",{className:L().characterCount,children:[c.length,"/1000"]})]}),!k&&(0,o.jsx)("div",{className:L().authPrompt,children:(0,o.jsx)("p",{children:"Please sign in to join the conversation"})})]})]})})},U=r.memo(e=>{let{articleId:t,hasReflectionRoom:n,authorId:a}=e,[l,s]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),{topic:m,unreadCount:u}=H(t),p=(0,r.useCallback)(()=>{s(e=>!e)},[]),x=(0,r.useCallback)(()=>{s(!1)},[]);(0,r.useEffect)(()=>{let e=(0,I.onAuthStateChanged)(i.j2,e=>{h(!!e)});return()=>e()},[]),(0,r.useEffect)(()=>{let e,t=()=>{d(window.innerWidth<=768)};t();let n=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),clearTimeout(e)}},[]);let f=(0,r.useMemo)(()=>m||"Join the discussion",[m]);return n&&g?(0,o.jsxs)("div",{className:L().reflectionRoomContainer,children:[(0,o.jsx)(W,{topic:f,unreadCount:u,isOpen:l,onClick:p}),(0,o.jsx)(O,{articleId:t,isOpen:l,onClose:x,isMobile:c,authorId:a})]}):null},(e,t)=>e.articleId===t.articleId&&e.hasReflectionRoom===t.hasReflectionRoom&&e.authorId===t.authorId),q=e=>{let{articleId:t,initialHtml:n,isAuthenticated:i=!1,articleTitle:a="Article",articleSlug:l="",hasReflectionRoom:s=!1,authorId:c}=e,[d,g]=(0,r.useState)(null),[m,p]=(0,r.useState)(!n),[x,f]=(0,r.useState)(""),[b,y]=(0,r.useState)("reflective"),_=(0,r.useRef)(null);(0,r.useEffect)(()=>{_.current&&(n||d)&&setTimeout(()=>{_.current&&_.current.querySelectorAll("pre code").forEach(e=>{let t=e.parentElement,n="javascript";for(let t of e.className.split(" "))if(t.startsWith("language-")){n=t.replace("language-","");break}if(t.hasAttribute("data-language")&&(n=t.getAttribute("data-language")),F().languages[n])try{let o=e.textContent||"";e.innerHTML=F().highlight(o,F().languages[n],n),t.setAttribute("data-language",n),t.style.position="relative"}catch(e){console.warn("Syntax highlighting failed for language:",n,e)}})},100)},[n,d]),(0,r.useEffect)(()=>{let e=v();if(e){let t=e.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();t&&y((0,T.H)(t))}},[n,d]),(0,r.useEffect)(()=>{n||d||(async()=>{try{p(!0);let e=await N(t);if(!e)return void f("Article not found");let n="",o=("string"==typeof e.content?e.content:e.content.map(e=>"<p>".concat(e.text,"</p>")).join("\n")).replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");g({title:e.title,body:o})}catch(e){console.error("Error loading article:",e),f("Failed to load article")}finally{p(!1)}})()},[t,d,n]);let v=()=>n?n.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""):(null==d?void 0:d.body)||"";return m?(0,o.jsxs)("div",{className:R().loadingContainer,children:[(0,o.jsx)("div",{className:R().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):x?(0,o.jsx)("div",{className:R().errorContainer,children:(0,o.jsx)("p",{className:R().errorMessage,children:x})}):(0,o.jsxs)(h,{articleId:t,children:[(0,o.jsx)(M,{}),(0,o.jsxs)("article",{className:R().articleContainer,children:[s&&i&&(0,o.jsx)(U,{articleId:t,hasReflectionRoom:s,authorId:c}),(0,o.jsx)("div",{"data-toggle-bar":"true",style:{display:"flex",justifyContent:window.innerWidth<=768?"center":"space-between",alignItems:"center",gap:window.innerWidth<=768?"0.5rem":"1rem",margin:window.innerWidth<=768?"0.5rem 0":"1rem 0",padding:window.innerWidth<=768?"0.5rem 0.75rem":"1rem",backgroundImage:i?"linear-gradient(270deg, ".concat(C.Qx[b].gradientStart,", ").concat(C.Qx[b].gradientEnd,")"):"linear-gradient(270deg, #9CA3AF, #6B7280)",backgroundSize:"200% 200%",animation:"slideGradient 8s ease infinite alternate",borderRadius:window.innerWidth<=768?"12px":"20px",border:"1px solid rgba(255, 255, 255, 0.5)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",fontSize:window.innerWidth<=768?"0.75rem":"0.875rem",flexWrap:window.innerWidth<=768?"wrap":"nowrap"},children:window.innerWidth<=768?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.65rem"},children:"\uD83C\uDFA8 Mood"}),(0,o.jsx)(S,{style:{padding:"0.25rem 0.5rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"12px",fontSize:"0.6rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",minHeight:"24px",minWidth:"32px"}})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.65rem"},children:"✨ Reflect"}),(0,o.jsx)(k,{style:{padding:"0.25rem 0.5rem",border:"none",borderRadius:"12px",fontSize:"0.6rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",minHeight:"24px",minWidth:"32px"}})]}),i&&(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.6rem",opacity:.7,width:"100%",textAlign:"center",marginTop:"0.25rem"},children:"Enhanced active"})]}):window.innerWidth<=1024?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.8rem",opacity:.9},children:i?"\uD83C\uDFA8 Enhanced mode":"\uD83D\uDD12 Sign in for features"})}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.7rem"},children:"Mood"}),(0,o.jsx)(S,{style:{padding:"0.35rem 0.7rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"16px",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}}),(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.7rem"},children:"Reflect"}),(0,o.jsx)(k,{style:{padding:"0.35rem 0.7rem",border:"none",borderRadius:"16px",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.875rem",opacity:.9},children:i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.cL,{size:16,color:"#F7FAFC"}),"Atmosphere adapted"]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.JD,{size:16,color:"#F7FAFC"}),"Sign in for enhanced features"]})}),i&&(0,o.jsxs)("span",{style:{color:"#F7FAFC",fontWeight:"600",fontSize:"0.875rem"},children:[(0,o.jsx)(u.gI,{size:16,color:"#F7FAFC"}),"Enhanced features active"]})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.75rem"},children:"Mood Background"}),(0,o.jsx)(S,{style:{padding:"0.4rem 0.8rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"20px",fontSize:"0.7rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}}),(0,o.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.75rem"},children:"Interactive Reflections"}),(0,o.jsx)(k,{style:{padding:"0.4rem 0.8rem",border:"none",borderRadius:"20px",fontSize:"0.7rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}})]})]})}),(0,o.jsxs)(w,{articleId:t,articleTitle:a,articleSlug:l,children:[(0,o.jsx)("div",{className:R().articleContent,children:(0,o.jsx)("div",{ref:_,dangerouslySetInnerHTML:{__html:v()}})}),(0,o.jsx)(j,{articleId:t})]})]})]})}},7023:e=>{e.exports={reflectionRoomContainer:"ReflectionRoom_reflectionRoomContainer__6TmAa",backdrop:"ReflectionRoom_backdrop__KGxTG",sidebar:"ReflectionRoom_sidebar__dbvRa",mobileModal:"ReflectionRoom_mobileModal__7pRP5",header:"ReflectionRoom_header__0Ynj_",headerTitle:"ReflectionRoom_headerTitle__sMhoT",closeButton:"ReflectionRoom_closeButton__pqCgf",topicSection:"ReflectionRoom_topicSection__Iywnd",topicLabel:"ReflectionRoom_topicLabel__rhBKQ",topicText:"ReflectionRoom_topicText__tZ6jm",messagesContainer:"ReflectionRoom_messagesContainer__flbBi",messagesList:"ReflectionRoom_messagesList__XdeUo",message:"ReflectionRoom_message__IFqbO",ownMessage:"ReflectionRoom_ownMessage__21F3j",otherMessage:"ReflectionRoom_otherMessage__Azd_Z",messageHeader:"ReflectionRoom_messageHeader__8CyNx",messageHeaderRight:"ReflectionRoom_messageHeaderRight__bkPS2",userName:"ReflectionRoom_userName__B2m8R",messageTime:"ReflectionRoom_messageTime__HmW9V",messageContent:"ReflectionRoom_messageContent__TEe9D",authorMessage:"ReflectionRoom_authorMessage__ywPrb",authorName:"ReflectionRoom_authorName__wHiMA",authorBadge:"ReflectionRoom_authorBadge__uIGSy",messageForm:"ReflectionRoom_messageForm__IStCS",inputContainer:"ReflectionRoom_inputContainer__jICbm",messageInput:"ReflectionRoom_messageInput__xbHQv",sendButton:"ReflectionRoom_sendButton__Op965",characterCount:"ReflectionRoom_characterCount__Pgn4b",authPrompt:"ReflectionRoom_authPrompt__06gaE",loadingState:"ReflectionRoom_loadingState__mCkLq",errorState:"ReflectionRoom_errorState__lLBS3",emptyState:"ReflectionRoom_emptyState__O3Cs7",sendingSpinner:"ReflectionRoom_sendingSpinner__As_2t",spin:"ReflectionRoom_spin__9rYOC",loadingSpinner:"ReflectionRoom_loadingSpinner__dqZv4",emptyIcon:"ReflectionRoom_emptyIcon__jEtSv",reflectionSearchBar:"ReflectionRoom_reflectionSearchBar__pUXJI",reflectionSearchWrapper:"ReflectionRoom_reflectionSearchWrapper__CbCn1",focused:"ReflectionRoom_focused__LOk9v","holographic-shine":"ReflectionRoom_holographic-shine__YGlYP",reflectionIcon:"ReflectionRoom_reflectionIcon__UzCmu",reflectionText:"ReflectionRoom_reflectionText__vB9qw",reflectionLabel:"ReflectionRoom_reflectionLabel__7f_Nj",reflectionTopic:"ReflectionRoom_reflectionTopic__eWDD4",reflectionJoin:"ReflectionRoom_reflectionJoin__U6Usf",reflectionUnread:"ReflectionRoom_reflectionUnread__a6Wc7",reflectionJoinText:"ReflectionRoom_reflectionJoinText__4Z582",reflectionArrow:"ReflectionRoom_reflectionArrow__ST2X_",deleteButton:"ReflectionRoom_deleteButton___BxTC",deleteSpinner:"ReflectionRoom_deleteSpinner__rLa7d",messageDeleting:"ReflectionRoom_messageDeleting__z62yB"}},7036:e=>{e.exports={articleContainer:"ArticleWithHighlights_articleContainer__r1hgP",articleContent:"ArticleWithHighlights_articleContent__qrFhS",loadingContainer:"ArticleWithHighlights_loadingContainer__6cqbO",loadingIndicator:"ArticleWithHighlights_loadingIndicator__ymNyj",spin:"ArticleWithHighlights_spin__Olepl",errorContainer:"ArticleWithHighlights_errorContainer__njqpS",errorMessage:"ArticleWithHighlights_errorMessage__D4C7O"}},7041:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var o=n(7347),r=n.n(o);function i(e){let t=new(r())().analyze(e),n=e.toLowerCase(),o=["angry","furious","rage","mad","hate","disgusted","outraged","pissed","frustrated","livid","infuriated","enraged","trump","politician","corrupt","stupid","idiot","terrible","awful","worst","disgusting","pathetic"].filter(e=>n.includes(e)).length,i=["happy","joy","excited","amazing","wonderful","fantastic","great","awesome","brilliant","excellent","perfect","beautiful","love","celebrate","triumph","success","victory","delighted","cheerful","blissful"].filter(e=>n.includes(e)).length,a=["calm","peaceful","serene","tranquil","gentle","soothing","quiet","meditation","zen","harmony","balance","nature","garden","sunset","ocean","mindful","breathe","stillness"].filter(e=>n.includes(e)).length,l=["energy","power","strong","dynamic","intense","passionate","vibrant","bold","fierce","electric","explosive","powerful","charged","pumped","motivated","driven"].filter(e=>n.includes(e)).length,s=["sad","depressed","melancholy","grief","sorrow","tragic","heartbreak","crying","tears","lonely","despair","hopeless","miserable","devastated","broken"].filter(e=>n.includes(e)).length;return o>=2||o>=1&&t.score<-2?"angry":i>=2||i>=1&&t.score>3?"joyful":a>=2||a>=1&&t.score>0?"peaceful":l>=2||l>=1&&Math.abs(t.score)>2?"energetic":s>=2||s>=1&&t.score<-1?"sad":t.score>2?"joyful":t.score<-3?"angry":t.score<-1?"sad":"reflective"}},8501:e=>{e.exports={articlePageContainer:"ArticlePage_articlePageContainer__S9vO3",pageHeader:"ArticlePage_pageHeader__LpJc9",headerContainer:"ArticlePage_headerContainer__2_FTv",logoLink:"ArticlePage_logoLink__fMNNv",headerLogo:"ArticlePage_headerLogo__QZCOB",headerActions:"ArticlePage_headerActions__gK7Eo",profileMenu:"ArticlePage_profileMenu__LJeQ0",profileCircle:"ArticlePage_profileCircle__mpTwC",profileDropdown:"ArticlePage_profileDropdown__PnV9R",dropdownItem:"ArticlePage_dropdownItem__Lac2v",authButtons:"ArticlePage_authButtons__R_ANg",loginButton:"ArticlePage_loginButton__kpUQh",signupButton:"ArticlePage_signupButton__EvVWG",pageContainer:"ArticlePage_pageContainer__7QNUg",relatedTagsSection:"ArticlePage_relatedTagsSection__SvZ8y",relatedTagsHeading:"ArticlePage_relatedTagsHeading__Ys9Op",relatedTagsList:"ArticlePage_relatedTagsList__Xn3ds",relatedTag:"ArticlePage_relatedTag__DEwLe",writeButton:"ArticlePage_writeButton__yZp3x",articleHeader:"ArticlePage_articleHeader__LJolV",articleHeaderWithReaders:"ArticlePage_articleHeaderWithReaders__Ni9rZ",titleSection:"ArticlePage_titleSection__fYdJv",readersSection:"ArticlePage_readersSection__SRec1",articleTitle:"ArticlePage_articleTitle__euOmw",articleMeta:"ArticlePage_articleMeta__LXXWl",authorInfo:"ArticlePage_authorInfo__nnMSs",authorAvatar:"ArticlePage_authorAvatar__1S1bM",authorDetails:"ArticlePage_authorDetails__65w4B",authorNameLink:"ArticlePage_authorNameLink__c6fCN",authorName:"ArticlePage_authorName__o2DdL",articleDetails:"ArticlePage_articleDetails__mK6k_",articleActions:"ArticlePage_articleActions__IZLcw",editButton:"ArticlePage_editButton__Yl62q",tagContainer:"ArticlePage_tagContainer__kI5Py",tag:"ArticlePage_tag__F5Z0e",likeButton:"ArticlePage_likeButton__V0q84",liked:"ArticlePage_liked__Mzzkj",likeIcon:"ArticlePage_likeIcon__zOA_O",commentsContainer:"ArticlePage_commentsContainer__rpCTJ",loadingContainer:"ArticlePage_loadingContainer__v7RVf",loadingIndicator:"ArticlePage_loadingIndicator__E2bt3",spin:"ArticlePage_spin__yRZnI",errorContainer:"ArticlePage_errorContainer__pxRgD",errorMessage:"ArticlePage_errorMessage__quACi",editingHeader:"ArticlePage_editingHeader__nzcMi",cancelButton:"ArticlePage_cancelButton__V2ihM",articleContent:"ArticlePage_articleContent__NWe57",backLink:"ArticlePage_backLink__Cfs_B",moodControls:"ArticlePage_moodControls__iU3JZ",moodToggleButton:"ArticlePage_moodToggleButton__U3y0U",shareButton:"ArticlePage_shareButton__IgaGg"}},9576:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var o=n(5155),r=n(9137),i=n.n(r),a=n(2115),l=n(4814),s=n(7650);let c=e=>{let{isOpen:t,onClose:n,highlightText:r,articleTitle:c,shareUrl:d}=e,[g,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(g){let e=setTimeout(()=>h(!1),3e3);return()=>clearTimeout(e)}},[g]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,n]);let m=async()=>{try{await navigator.clipboard.writeText(d),h(!0)}catch(e){console.error("Failed to copy link:",e)}},u=async()=>{if(navigator.share)try{await navigator.share({title:'Highlight from "'.concat(c,'"'),text:'"'.concat(r,'" - from "').concat(c,'"'),url:d}),n()}catch(e){"AbortError"!==e.name&&console.error("Error sharing:",e)}};return t?(0,s.createPortal)((0,o.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem"},onClick:n,className:"jsx-8795408d21c696e",children:[(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"2rem",maxWidth:"500px",width:"100%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",position:"relative",animation:"modalSlideIn 0.3s ease-out"},onClick:e=>e.stopPropagation(),className:"jsx-8795408d21c696e",children:[(0,o.jsx)("button",{onClick:n,style:{position:"absolute",top:"1rem",right:"1rem",background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#6B7280",padding:"0.25rem",borderRadius:"0.375rem",transition:"color 0.2s ease"},onMouseOver:e=>e.currentTarget.style.color="#374151",onMouseOut:e=>e.currentTarget.style.color="#6B7280",className:"jsx-8795408d21c696e",children:"\xd7"}),(0,o.jsxs)("div",{style:{marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,o.jsxs)("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600",color:"#1F2937"},className:"jsx-8795408d21c696e",children:[(0,o.jsx)(l.uQ,{size:20,color:"#3b82f6"}),"Share Highlight"]}),(0,o.jsxs)("p",{style:{margin:0,color:"#6B7280",fontSize:"0.875rem"},className:"jsx-8795408d21c696e",children:['Share this highlight from "',c,'"']})]}),(0,o.jsxs)("div",{style:{backgroundColor:"#F9FAFB",border:"2px solid #E5E7EB",borderRadius:"0.75rem",padding:"1.25rem",marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,o.jsxs)("div",{style:{fontSize:"1rem",lineHeight:"1.6",color:"#374151",fontStyle:"italic",marginBottom:"0.75rem"},className:"jsx-8795408d21c696e",children:['"',r,'"']}),(0,o.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6B7280",fontWeight:"500"},className:"jsx-8795408d21c696e",children:['— from "',c,'"']})]}),(0,o.jsxs)("div",{style:{marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},className:"jsx-8795408d21c696e",children:"Share Link"}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},className:"jsx-8795408d21c696e",children:[(0,o.jsx)("input",{type:"text",value:d,readOnly:!0,style:{flex:1,padding:"0.75rem",border:"1px solid #D1D5DB",borderRadius:"0.5rem",fontSize:"0.875rem",backgroundColor:"#F9FAFB",fontFamily:"monospace"},className:"jsx-8795408d21c696e"}),(0,o.jsx)("button",{onClick:m,style:{padding:"0.75rem 1rem",backgroundColor:g?"#10B981":"#3B82F6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},className:"jsx-8795408d21c696e",children:g?"✓ Copied!":"\uD83D\uDCCB Copy"})]})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},className:"jsx-8795408d21c696e",children:["undefined"!=typeof navigator&&"share"in navigator&&(0,o.jsx)("button",{onClick:u,style:{padding:"0.75rem 1.5rem",backgroundColor:"#6366F1",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#5B21B6",onMouseOut:e=>e.currentTarget.style.backgroundColor="#6366F1",className:"jsx-8795408d21c696e",children:"\uD83D\uDCE4 Share"}),(0,o.jsx)("button",{onClick:n,style:{padding:"0.75rem 1.5rem",backgroundColor:"#F3F4F6",color:"#374151",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#E5E7EB",onMouseOut:e=>e.currentTarget.style.backgroundColor="#F3F4F6",className:"jsx-8795408d21c696e",children:"Close"})]})]}),(0,o.jsx)(i(),{id:"8795408d21c696e",children:"@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}"})]}),document.body):null}}}]);