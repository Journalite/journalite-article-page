(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3430,9210],{3094:e=>{e.exports={inspirationButton:"InspirationWidget_inspirationButton__RMfVc",inspirationWidget:"InspirationWidget_inspirationWidget__q1gMO",header:"InspirationWidget_header__wZRt7",closeButton:"InspirationWidget_closeButton__qCHBN",tabs:"InspirationWidget_tabs__hfv7d",tab:"InspirationWidget_tab__7hEDY",active:"InspirationWidget_active__CK3jp",content:"InspirationWidget_content__X6qiV",loading:"InspirationWidget_loading__2pTEa",spinner:"InspirationWidget_spinner__Z8Ppp",spin:"InspirationWidget_spin__syiZE",empty:"InspirationWidget_empty__S_QN1",subtitle:"InspirationWidget_subtitle__c_Jph",inspirationItem:"InspirationWidget_inspirationItem__295J_",themeItem:"InspirationWidget_themeItem__oQ_6E",themeTag:"InspirationWidget_themeTag__66K0g",themePrompt:"InspirationWidget_themePrompt__m0Ebn",useButton:"InspirationWidget_useButton__aSW_t",footer:"InspirationWidget_footer__7guyU",refreshButton:"InspirationWidget_refreshButton__yTge0"}},3430:(e,t,r)=>{"use strict";r.d(t,{A:()=>L});var o=r(5155),n=r(2115),i=r(5695),a=r(621),l=r(9210),s=r(3201);r(4488);var c=r(2571),d=r(2695),u=r(290),g=r(1514),h=r(7729),m=r(6770),p=r(7421),f=r(8754),v=r(156);let _=new v.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>["h".concat(e.attrs.level),0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:o,width:n,height:i}=e.attrs,a={src:t};return null!=r&&(a.alt=r),null!=o&&(a.title=o),null!=n&&(a.width=n),null!=i&&(a.height=i),["img",a]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:"javascript"}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs(e){let t=e.getAttribute("data-language");if(t)return{language:t};let r=e.querySelector("code");if(r){let e=(r.className||"").match(/language-(\w+)/);if(e)return{language:e[1]}}return{language:"javascript"}},getContent(e,t){let r=e.querySelector("code");if(r){let e=r.textContent||r.innerText||"";return e?[t.text(e)]:[]}return[]}}],toDOM:e=>["pre",{"data-language":e.attrs.language},["code",{class:"language-".concat(e.attrs.language)},0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:o}=e.attrs,n={href:t};return null!=r&&(n.title=r),null!=o&&(n.target=o),["a",n,0]}}}});function y(){return _.node("doc",null,[_.node("paragraph")])}function b(e){if(!e||""===e.trim())return y();let t=document.createElement("div");return t.innerHTML=e,v.S4.fromSchema(_).parse(t)}function w(e){let t=document.createElement("div");return t.appendChild(v.ZF.fromSchema(_).serializeFragment(e.content)),t.innerHTML}let x=(e,t)=>(r,o,n)=>{let i=!1;(0,g.T2)(t)(r,o,n)&&(r=n.state,i=!0);let a=e(r,o,n);return i||a},{heading:C,paragraph:j,list_item:k,blockquote:I}=_.nodes,N=e=>x((0,u.y_)(C,{level:e}),k),E=()=>x((0,u.y_)(j),k),A=(e,t,r)=>{let{from:o,to:n}=e.selection,i=!1;return(e.doc.nodesBetween(o,n,e=>e.type!==I||(i=!0,!1)),i)?!!(0,g.T2)(k)(e,t)||(0,u.yY)(e,t):((0,g.T2)(k)(e,t)&&(e=r.state),(0,u.Im)(I)(e,t,r))};new c.k_({key:new c.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:o}=e,{$from:n,empty:i}=r.selection,{heading:a,paragraph:l}=_.nodes;return!!i&&n.parent.type===a&&n.parentOffset===n.parent.content.size&&(t.preventDefault(),(0,u.y_)(l)(r,o,e))}}}),r(3241),r(8042),r(5802),r(7846),r(1280),r(8496),r(941),r(3523),r(4495),r(1177),r(1990),r(3686),r(642),r(7867),r(3337),r(3435),r(1055),r(2103),r(255),r(9829),r(656);var D=r(5901),B=r.n(D);let M=n.forwardRef((e,t)=>{let{articleId:r,initialContent:i="",onChange:a,placeholder:l="Tell your story...",className:s=""}=e,v=(0,n.useRef)(null),x=(0,n.useRef)(null),C=(0,n.useRef)(a),[j,k]=(0,n.useState)(!1);C.current=a;let I=(0,n.useCallback)(e=>{if(!x.current)return;let{state:t,dispatch:r}=x.current,{selection:o}=t,n=_.text(e);r(t.tr.replaceSelectionWith(n)),x.current.focus()},[]);n.useImperativeHandle(t,()=>({insertText:I,focus:()=>{var e;return null==(e=x.current)?void 0:e.focus()}}),[I]),(0,n.useEffect)(()=>{if(v.current&&!x.current){try{let e;if(i&&i.trim()){console.log("Editor: Loading initial content, length:",i.length);try{e=b(i),console.log("Editor: Successfully parsed HTML content")}catch(t){console.error("Editor: Failed to parse HTML content:",t),e=y()}}else console.log("Editor: No initial content, creating empty document"),e=y();let t=c.$t.create({doc:e,plugins:[(0,m.w)({"Mod-b":(0,u.wh)(_.marks.strong),"Mod-i":(0,u.wh)(_.marks.em),"Mod-z":h.tN,"Mod-y":h.ZS,Enter:(0,g.wn)(_.nodes.list_item),"Mod-[":(0,g.T2)(_.nodes.list_item),"Mod-]":(0,g.$B)(_.nodes.list_item),Space:(e,t)=>{let{$from:r}=e.selection;if(console.log("\uD83D\uDD75️‍♂️ Space handler triggered. beforeCursor:",r.parent.textContent.slice(0,r.parentOffset)),r.parent.type===_.nodes.paragraph){let o=r.parent.textContent.slice(0,r.parentOffset),n=o.match(/^(#{1,6})$/);if(n){let o=n[1].length,i=e.tr.delete(r.start(),r.pos).setBlockType(r.start(),r.start(),_.nodes.heading,{level:o});return t(i),!0}let i=o.match(/\*\*([^*]+)\*\*$/);if(i){let o=r.pos-i[0].length,n=e.tr.delete(o,r.pos).insertText(i[1]+" ",o).addMark(o,o+i[1].length,_.marks.strong);return t(n),!0}let a=o.match(RegExp("(?<!\\*)\\*([^*]+)\\*$"));if(a){let o=r.pos-a[0].length,n=e.tr.delete(o,r.pos).insertText(a[1]+" ",o).addMark(o,o+a[1].length,_.marks.em);return t(n),!0}let l=o.match(/`([^`]+)`$/);if(l){let o=r.pos-l[0].length,n=e.tr.delete(o,r.pos).insertText(l[1]+" ",o).addMark(o,o+l[1].length,_.marks.code);return t(n),!0}let s=o.match(/^[-*]$/);if(s){console.log("Bullet list match:",s[0]);try{let o=_.nodes.list_item.create(null,_.nodes.paragraph.create()),n=_.nodes.bullet_list.create(null,o),i=r.pos-1,a=e.tr.delete(i,r.pos).replaceWith(i,i,n);return a=a.setSelection(c.U3.create(a.doc,i+2)),t(a),console.log("Auto bullet list creation: success"),!0}catch(e){console.log("Auto bullet list creation failed:",e)}}let d=o.match(/^1\.$/);if(d){console.log("Ordered list match:",d[0]);try{let o=_.nodes.list_item.create(null,_.nodes.paragraph.create()),n=_.nodes.ordered_list.create(null,o),i=r.pos-2,a=e.tr.delete(i,r.pos).replaceWith(i,i,n);return a=a.setSelection(c.U3.create(a.doc,i+2)),t(a),console.log("Auto ordered list creation: success"),!0}catch(e){console.log("Auto ordered list creation failed:",e)}}}return!1}}),(0,m.w)(u.RV),(0,h.b6)(),(0,p.A)(),(0,f.z)()]}),r=new d.Lz(v.current,{state:t,editable:()=>!0,dispatchTransaction:e=>{let t=r.state.apply(e);if(r.updateState(t),e.docChanged&&C.current){let e=w(t.doc),r=t.doc.toJSON();C.current(e,r)}},attributes:{"data-placeholder":l||"Tell your story..."}});x.current=r,k(!0),setTimeout(()=>{r&&!r.isDestroyed&&r.focus()},100)}catch(e){console.error("Error initializing editor:",e),k(!0)}return()=>{x.current&&(x.current.destroy(),x.current=null)}}},[]),(0,n.useEffect)(()=>{if(x.current&&j&&i){console.log("Editor: Updating content without reinitializing, length:",i.length);try{let e=b(i),t=w(x.current.state.doc);if(i!==t){let t=x.current.state.tr.replaceWith(0,x.current.state.doc.content.size,e.content);x.current.dispatch(t),console.log("Editor: Content updated successfully")}}catch(e){console.error("Editor: Failed to update content:",e)}}},[i,j]);let D=(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;(0,u.wh)(_.marks.strong)(e,t)&&x.current.focus()},[]),M=(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;(0,u.wh)(_.marks.em)(e,t)&&x.current.focus()},[]),T=(0,n.useCallback)(e=>{if(!x.current)return;let{state:t,dispatch:r}=x.current;N(e)(t,r,x.current)&&x.current.focus()},[]);(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;E()(e,t,x.current)&&x.current.focus()},[]);let S=(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;A(e,t,x.current)&&x.current.focus()},[]),H=(0,n.useCallback)(()=>{if(!x.current)return;let e=prompt("Enter programming language (e.g., javascript, python, css):","javascript");if(!e)return;let{state:t,dispatch:r}=x.current,{from:o,to:n}=t.selection,i=_.nodes.code_block.create({language:e.toLowerCase()}),a=t.tr.replaceRangeWith(o,n,i);r&&(r(a),x.current.focus())},[]),W=(0,n.useCallback)(()=>{if(!x.current)return;console.log("Bullet list button clicked");let{state:e,dispatch:t}=x.current,{$from:r,$to:o}=e.selection;try{let n=_.nodes.list_item.create(null,_.nodes.paragraph.create(null,r.parent.content)),i=_.nodes.bullet_list.create(null,n),a=e.tr.replaceWith(r.start(),o.end(),i);t(a),console.log("Manual bullet list creation: success"),x.current.focus()}catch(o){console.log("Manual bullet list creation failed:",o);let r=(0,g.Sd)(_.nodes.bullet_list)(e,t);console.log("wrapInList fallback result:",r),r&&x.current.focus()}},[]),z=(0,n.useCallback)(()=>{if(!x.current)return;console.log("Ordered list button clicked");let{state:e,dispatch:t}=x.current,{$from:r,$to:o}=e.selection;try{let n=_.nodes.list_item.create(null,_.nodes.paragraph.create(null,r.parent.content)),i=_.nodes.ordered_list.create(null,n),a=e.tr.replaceWith(r.start(),o.end(),i);t(a),console.log("Manual ordered list creation: success"),x.current.focus()}catch(o){console.log("Manual ordered list creation failed:",o);let r=(0,g.Sd)(_.nodes.ordered_list)(e,t);console.log("wrapInList fallback result:",r),r&&x.current.focus()}},[]),U=(0,n.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&x.current){let{state:t,dispatch:r}=x.current,o=_.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(o)),x.current.focus()}},[]),L=(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;(0,h.tN)(e,t),x.current.focus()},[]),O=(0,n.useCallback)(()=>{if(!x.current)return;let{state:e,dispatch:t}=x.current;(0,h.ZS)(e,t),x.current.focus()},[]),R=(0,n.useCallback)(e=>{if(!x.current)return!1;let{from:t,$from:r,to:o,empty:n}=x.current.state.selection;return n?e.isInSet(x.current.state.storedMarks||r.marks()):x.current.state.doc.rangeHasMark(t,o,e)},[]),q=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!x.current)return!1;let{from:r,to:o}=x.current.state.selection,n=!0;return x.current.state.doc.nodesBetween(r,o,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(n=!1,!1)),n},[]),Y=(0,n.useCallback)(()=>{if(!x.current)return!1;let{from:e,to:t}=x.current.state.selection,r=!1;return x.current.state.doc.nodesBetween(e,t,e=>e.type!==_.nodes.blockquote||(r=!0,!1)),r},[]);return(0,o.jsxs)("div",{className:B().editor,style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[j&&(0,o.jsx)("div",{className:B().modernToolbar,style:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,o.jsxs)("div",{className:B().toolbarContainer,children:[(0,o.jsxs)("div",{className:B().formatGroup,children:[(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(R(_.marks.strong)?B().active:""),onClick:D,title:"Bold (⌘B)","aria-label":"Bold",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(R(_.marks.em)?B().active:""),onClick:M,title:"Italic (⌘I)","aria-label":"Italic",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,o.jsx)("div",{className:B().divider}),(0,o.jsxs)("div",{className:B().formatGroup,children:[(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(q(_.nodes.heading,{level:1})?B().active:""),onClick:()=>T(1),title:"Large Heading (⌘⇧1)","aria-label":"Heading 1",children:(0,o.jsx)("span",{className:B().headingIcon,children:"H1"})}),(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(q(_.nodes.heading,{level:2})?B().active:""),onClick:()=>T(2),title:"Medium Heading (⌘⇧2)","aria-label":"Heading 2",children:(0,o.jsx)("span",{className:B().headingIcon,children:"H2"})}),(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(q(_.nodes.heading,{level:3})?B().active:""),onClick:()=>T(3),title:"Small Heading (⌘⇧3)","aria-label":"Heading 3",children:(0,o.jsx)("span",{className:B().headingIcon,children:"H3"})})]}),(0,o.jsx)("div",{className:B().divider}),(0,o.jsxs)("div",{className:B().formatGroup,children:[(0,o.jsx)("button",{className:B().toolBtn,onClick:W,title:"Bullet List","aria-label":"Bullet list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,o.jsx)("button",{className:B().toolBtn,onClick:z,title:"Numbered List","aria-label":"Numbered list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(Y()?B().active:""),onClick:S,title:"Quote (⌘>)","aria-label":"Quote",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,o.jsx)("div",{className:B().divider}),(0,o.jsxs)("div",{className:B().formatGroup,children:[(0,o.jsx)("button",{className:B().toolBtn,onClick:U,title:"Add Image","aria-label":"Insert image",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,o.jsx)("button",{className:"".concat(B().toolBtn," ").concat(q(_.nodes.code_block)?B().active:""),onClick:H,title:"Code Block","aria-label":"Code block",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,o.jsx)("div",{className:B().divider}),(0,o.jsxs)("div",{className:B().formatGroup,children:[(0,o.jsx)("button",{className:B().toolBtn,onClick:L,title:"Undo (⌘Z)","aria-label":"Undo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,o.jsx)("button",{className:B().toolBtn,onClick:O,title:"Redo (⌘Y)","aria-label":"Redo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!j&&(0,o.jsxs)("div",{className:B().loading,children:[(0,o.jsx)("div",{className:B().loadingSpinner}),(0,o.jsx)("span",{children:"Loading editor..."})]}),(0,o.jsx)("div",{ref:v,className:B().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"400px",opacity:j?1:.3}})]})});M.displayName="Editor";var T=r(9122),S=r(3094),H=r.n(S);let W=e=>{let{onInsert:t}=e,[r,i]=(0,n.useState)(!1),[a,l]=(0,n.useState)([]),[s,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),[g,h]=(0,n.useState)("inspirations"),m=async()=>{u(!0);try{let[e,t]=await Promise.all([(0,T.Aq)(),(0,T.Gy)()]);l(e),c(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{u(!1)}},p=e=>{t&&t(e),i(!1)},f=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||"Write about ".concat(e,"...");return r?(0,o.jsxs)("div",{className:H().inspirationWidget,children:[(0,o.jsxs)("div",{className:H().header,children:[(0,o.jsx)("h3",{children:"\uD83D\uDCA1 Your Reflection Insights"}),(0,o.jsx)("button",{onClick:()=>i(!1),className:H().closeButton,children:"\xd7"})]}),(0,o.jsxs)("div",{className:H().tabs,children:[(0,o.jsxs)("button",{className:"".concat(H().tab," ").concat("inspirations"===g?H().active:""),onClick:()=>h("inspirations"),children:["Recent Thoughts (",a.length,")"]}),(0,o.jsxs)("button",{className:"".concat(H().tab," ").concat("themes"===g?H().active:""),onClick:()=>h("themes"),children:["Writing Themes (",s.length,")"]})]}),(0,o.jsx)("div",{className:H().content,children:d?(0,o.jsxs)("div",{className:H().loading,children:[(0,o.jsx)("div",{className:H().spinner}),(0,o.jsx)("p",{children:"Loading your insights..."})]}):"inspirations"===g?(0,o.jsx)("div",{className:H().inspirationsList,children:0===a.length?(0,o.jsxs)("div",{className:H().empty,children:[(0,o.jsx)("p",{children:"\uD83D\uDCAD No reflections yet!"}),(0,o.jsx)("p",{children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:H().subtitle,children:"Your past reflections that might spark new ideas:"}),a.map((e,t)=>(0,o.jsxs)("div",{className:H().inspirationItem,children:[(0,o.jsxs)("p",{children:['"',e.response,'"']}),e.articleTitle&&(0,o.jsxs)("p",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["From: ",e.articleTitle]}),(0,o.jsx)("button",{onClick:()=>{let t=e.articleTitle?' (inspired by "'.concat(e.articleTitle,'")'):"";p('"'.concat(e.response,'"').concat(t," - This reminds me of..."))},className:H().useButton,children:"Use as starting point"})]},t))]})}):(0,o.jsx)("div",{className:H().themesList,children:0===s.length?(0,o.jsxs)("div",{className:H().empty,children:[(0,o.jsx)("p",{children:"\uD83C\uDFA8 No themes identified yet!"}),(0,o.jsx)("p",{children:"Keep reflecting on articles to discover your writing themes."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:H().subtitle,children:"Writing prompts based on your reflection patterns:"}),s.map((e,t)=>(0,o.jsxs)("div",{className:H().themeItem,children:[(0,o.jsx)("div",{className:H().themeTag,children:e}),(0,o.jsx)("p",{className:H().themePrompt,children:f(e)}),(0,o.jsx)("button",{onClick:()=>p(f(e)),className:H().useButton,children:"Start writing"})]},t))]})})}),(0,o.jsx)("div",{className:H().footer,children:(0,o.jsx)("button",{onClick:m,className:H().refreshButton,disabled:d,children:"\uD83D\uDD04 Refresh insights"})})]}):(0,o.jsx)("button",{onClick:()=>{r||m(),i(!r)},className:H().inspirationButton,title:"Get inspiration from your reflections",children:"✨ Inspiration"})};var z=r(9396),U=r.n(z);let L=e=>{let{articleId:t,onUpdateComplete:r}=e,c=(0,i.useRouter)(),[d,u]=(0,n.useState)(""),[g,h]=(0,n.useState)(""),[m,p]=(0,n.useState)([]),[f,v]=(0,n.useState)(""),[_,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(!1),[x,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(""),[I,N]=(0,n.useState)(!!t),[E,A]=(0,n.useState)(null),[D,B]=(0,n.useState)(""),T=(0,n.useRef)(null),S=(0,n.useRef)(null),H=(0,n.useRef)(null),z=(0,n.useCallback)(()=>{T.current&&(T.current.style.height="auto",T.current.style.height="".concat(T.current.scrollHeight,"px"),!d&&T.current&&T.current.focus())},[d]);(0,n.useEffect)(()=>{let e=s.j2.onAuthStateChanged(e=>{A(e),e||c.push("/login?redirect=compose")});return()=>e()},[c]),(0,n.useEffect)(()=>{console.log("ArticleComposer useEffect - articleId:",t,"user:",null==E?void 0:E.uid),t&&E?(async()=>{try{var e;console.log("Fetching article for editing, ID:",t),N(!0);let r=await (0,l.getArticleById)(t);if(console.log("Fetched article:",null==r?void 0:r.title,"Body length:",null==r||null==(e=r.body)?void 0:e.length),!r){console.log("Article not found"),k("Article not found"),c.push("/");return}if(r.authorId!==E.uid){console.log("User not authorized to edit this article"),k("You can only edit your own articles"),c.push("/");return}console.log("Setting title:",r.title),u(r.title);let o=r.body.replace(/data-[\w-]+="[^"]*"/g,"");console.log("Setting content, length:",o.length,"Preview:",o.substring(0,100)+"..."),h(o),p(r.tags||[]),v(r.coverImage||""),console.log("Article data loaded successfully for editing")}catch(e){console.error("Error loading article:",e),k("Failed to load article")}finally{N(!1)}})():t?console.log("User not logged in, waiting..."):(console.log("No articleId, starting with empty content"),N(!1))},[t,E,c]),(0,n.useEffect)(()=>{z()},[d,z]),(0,n.useEffect)(()=>{let e;return E&&d.trim()&&g.trim()&&!b&&!_&&(e=setTimeout(()=>{q("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[E,d,g,b,_]);let L=(0,n.useCallback)((e,t)=>{h(t=>e!==t?(x&&C(!1),e):t)},[x]),O=()=>{let e=D.trim().toLowerCase();e&&!m.includes(e)&&m.length<5&&(p([...m,e]),B(""))},R=e=>{p(m.filter(t=>t!==e))},q=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!E)return void k("You must be logged in to save an article");if(!d.trim())return void k("Title is required");if(!g.trim())return void k("Content is required");try{w(!0),k("");let o=g.replace(/data-[\w-]+="[^"]*"/g,""),n={title:d.trim(),body:o,tags:m,coverImage:f.trim(),status:e};if(console.log("Saving article data:",n),t)try{let e=await (0,l.iZ)(t,n);console.log("Article updated successfully:",null==e?void 0:e.title),C(!0),await new Promise(e=>setTimeout(e,500));let o=await (0,l.getArticleById)(t);console.log("Fetched updated article data:",null==o?void 0:o.title),r?(console.log("Calling onUpdateComplete callback instead of navigating"),r(o)):(console.log("No callback provided, navigating to article page"),setTimeout(()=>{window.location.href="/articles/".concat(t,"/view?updated=true&time=").concat(Date.now())},1e3))}catch(e){console.error("Error updating article:",e),k("Failed to update article. Please try again."),C(!1)}else{let t=await (0,l.N6)(n);"published"===e?c.push("/articles/".concat(t.id)):c.push("/dashboard")}}catch(e){console.error("Error saving article:",e),k("Failed to save article. Please try again.")}finally{w(!1),y(!1)}},Y=async()=>{if(!g.trim())return void k("Content is required");y(!0),await q("published")},P=async()=>{await q("drafts")};return I?(0,o.jsxs)("div",{className:U().composerLoading,children:[(0,o.jsx)("div",{className:U().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):(0,o.jsxs)("div",{className:U().articleComposer,children:[(0,o.jsxs)("header",{className:U().composerHeader,children:[(0,o.jsx)("div",{className:U().logoContainer,children:(0,o.jsx)("div",{className:U().logo,children:"Journalite"})}),(0,o.jsxs)("div",{className:U().actionButtons,children:[x&&(0,o.jsxs)("span",{className:U().savedIndicator,children:[(0,o.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,o.jsx)("button",{className:U().actionButton,onClick:P,disabled:b||_,children:"Save draft"}),(0,o.jsx)("button",{className:U().publishButton,onClick:Y,disabled:b||_||!d.trim()||!g.trim(),children:t?"Update":"Publish"})]})]}),(0,o.jsxs)("main",{className:U().composerContent,children:[(0,o.jsx)("textarea",{ref:T,className:U().titleInput,value:d,onChange:e=>{u(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1}),(0,o.jsxs)("div",{className:U().coverImageInput,children:[(0,o.jsx)("input",{type:"text",value:f,onChange:e=>{v(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:U().imageUrlInput}),f&&(0,o.jsx)("div",{className:U().coverImagePreview,children:(0,o.jsx)("img",{src:f,alt:"Cover preview"})})]}),(0,o.jsxs)("div",{className:U().tagContainer,children:[m.map(e=>(0,o.jsxs)("div",{className:U().tag,children:[e,(0,o.jsx)("button",{className:U().removeTagButton,onClick:()=>R(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),m.length<5&&(0,o.jsx)("input",{ref:S,type:"text",value:D,onChange:e=>{B(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),O())},onBlur:O,placeholder:0===m.length?"Add up to 5 tags...":"Add another tag...",className:U().tagInput})]}),j&&(0,o.jsx)("div",{className:U().errorMessage,children:j}),(0,o.jsx)("div",{className:U().editorContainer,children:(0,o.jsx)(M,{ref:H,articleId:t||(0,a.A)(),initialContent:g,onChange:L,placeholder:"Tell your story..."})})]}),(0,o.jsx)(W,{onInsert:e=>{H.current&&H.current.insertText?H.current.insertText("\n\n"+e+"\n\n"):h(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{H.current&&H.current.focus&&H.current.focus()},100)}})]})}},5901:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",modernToolbar:"Editor_modernToolbar__VDG5b",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},9210:(e,t,r)=>{"use strict";r.d(t,{BC:()=>g,GE:()=>a,N6:()=>c,Oe:()=>h,Tu:()=>p,a:()=>f,fz:()=>u,getArticleById:()=>l,iZ:()=>d,l6:()=>s,tT:()=>m,zE:()=>v});var o=r(5317),n=r(3201),i=r(9995);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,o.collection)(n.db,"articles"),i=[];r||i.push((0,o.where)("status","==","published")),i.push((0,o.orderBy)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),i.push((0,o.limit)(t)));let a=(0,o.query)(e,...i),l=await (0,o.getDocs)(a);console.log("Query returned document count:",l.size);let s=[];return l.forEach(e=>{let t=e.data();s.push({id:e.id,...t})}),s}catch(e){throw console.error("Error getting articles:",e),e}}async function l(e){try{let i=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(e," (time: ").concat(i,")"));let a=(0,o.doc)(n.db,"articles",e),l=await (0,o.getDoc)(a);if(!l.exists())return console.log("❌ Article not found for ID:",e),null;{var t,r;let e={id:l.id,...l.data()};return console.log("✅ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",(null==(t=e.body)?void 0:t.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(r=e.tags)?void 0:r.join(", "))||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function s(e){try{console.log("Getting article by slug: ".concat(e,", timestamp: ").concat(Date.now()));let r=0;for(;r<2;){r++,console.log("Attempt ".concat(r," to get article by slug")),r>1&&await new Promise(e=>setTimeout(e,500));let i=(0,o.collection)(n.db,"articles"),a=(0,o.query)(i,(0,o.where)("slug","==",e),(0,o.where)("status","==","published")),l=await (0,o.getDocs)(a);if(l.empty){if(r>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{var t;let e=l.docs[0],r={id:e.id,...e.data()};return console.log("Article found by slug:",r.title,"Content length:",(null==(t=r.body)?void 0:t.length)||0),r}console.log("Article not found by slug on attempt ".concat(r,", will retry..."))}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{var t;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let i={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:r.uid,authorName:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.addDoc)((0,o.collection)(n.db,"articles"),i)).id,...i}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let i=(0,o.doc)(n.db,"articles",e),a=await (0,o.getDoc)(i);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let l={...t};t.title&&(l.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",l.slug)),l.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(i,l);let s=await (0,o.getDoc)(i);return{id:s.id,...s.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,o.collection)(n.db,"articles",e,"comments"),r=(0,o.query)(t,(0,o.orderBy)("createdAt","desc")),i=await (0,o.getDocs)(r),a=[];return i.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function g(e,t){try{var r;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to comment");let s={userId:a.uid,userName:a.displayName||(null==(r=a.email)?void 0:r.split("@")[0])||"Anonymous",content:t,createdAt:o.Timestamp.now(),likes:[],replies:[]},c=await (0,o.addDoc)((0,o.collection)(n.db,"articles",e,"comments"),s),d=await l(e);return d&&d.authorId!==a.uid&&await (0,i.fZ)(d.authorId,e,d.slug||"",d.title||"Article",c.id,t),{id:c.id,commentId:c.id,...s}}catch(e){throw console.error("Error adding comment:",e),e}}async function h(e,t,r){try{var i;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let s=(0,o.doc)(n.db,"articles",e,"comments",t),c=await (0,o.getDoc)(s);if(!c.exists())throw Error("Comment not found");let d={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||(null==(i=a.email)?void 0:i.split("@")[0])||"Anonymous",content:r,createdAt:o.Timestamp.now(),likes:[]};await (0,o.updateDoc)(s,{replies:(0,o.arrayUnion)(d)});let u=c.data();if(u.userId!==a.uid){let r=await l(e);console.log("User ".concat(a.uid," replied to comment ").concat(t," by ").concat(u.userId," on article ").concat(null==r?void 0:r.title))}return d}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let i=(0,o.doc)(n.db,"articles",e,"comments",t),a=await (0,o.getDoc)(i);if(!a.exists())throw Error("Comment not found");let l=a.data(),s=r.uid,c=(l.likes||[]).includes(s);await (0,o.updateDoc)(i,{likes:c?(0,o.arrayRemove)(s):(0,o.arrayUnion)(s)});let d=(await (0,o.getDoc)(i)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function p(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let i=(0,o.doc)(n.db,"articles",e,"comments",t),a=await (0,o.getDoc)(i);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.deleteDoc)(i),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=n.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(n.db,"articles",e),i=await (0,o.getDoc)(r);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=t;try{let t=(0,o.collection)(n.db,"articles"),i=[(0,o.where)("tags","array-contains",e),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];r&&r>0&&i.push((0,o.limit)(r));let a=(0,o.query)(t,...i),l=await (0,o.getDocs)(a),s=[];return l.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting articles by tag:",e),e}}},9396:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},9995:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>a,Ss:()=>l,bA:()=>s,fP:()=>d,fZ:()=>i,he:()=>c});var o=r(5317),n=r(3201);async function i(e,t,r,i,a,l){try{let t=n.j2.currentUser;if(!t||t.uid===e)return null;let s={userId:e,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(l.substring(0,50)).concat(l.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:o.Timestamp.now(),articleSlug:r,articleTitle:i};return{id:(await (0,o.addDoc)((0,o.collection)(n.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating notification:",e),null}}async function a(e,t,r,i){try{if(e===r)return null;let a={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(i,") started following you"),fromUser:{id:r,name:t,username:i},createdAt:o.Timestamp.now()};return{id:(await (0,o.addDoc)((0,o.collection)(n.db,"notifications"),a)).id,...a}}catch(e){return console.error("Error creating follow notification:",e),null}}async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let i=(0,o.collection)(n.db,"notifications");t=e?(0,o.query)(i,(0,o.where)("userId","==",r.uid),(0,o.where)("read","==",!1),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100)):(0,o.query)(i,(0,o.where)("userId","==",r.uid),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100));let a=await (0,o.getDocs)(t),l=[];return a.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error fetching notifications:",e),e}}async function s(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",e),i=await (0,o.getDoc)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.collection)(n.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1)),i=await (0,o.getDocs)(r),a=i.docs.map(e=>(0,o.updateDoc)(e.ref,{read:!0}));return await Promise.all(a),{success:!0,count:i.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",e),i=await (0,o.getDoc)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.deleteDoc)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=n.j2.currentUser;if(!e)return 0;let t=(0,o.collection)(n.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1));return(await (0,o.getDocs)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}}]);