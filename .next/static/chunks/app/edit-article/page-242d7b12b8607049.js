(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{824:e=>{e.exports={articleFormContainer:"ArticleForm_articleFormContainer__Oamhm",articleFormHeader:"ArticleForm_articleFormHeader__lPvz4",articleFormTitle:"ArticleForm_articleFormTitle__GQZ6U",articleFormSubtitle:"ArticleForm_articleFormSubtitle__d0K2B",articleForm:"ArticleForm_articleForm__aPoqs",formGroup:"ArticleForm_formGroup__NG8OF",formLabel:"ArticleForm_formLabel__DP5Fz",optionalLabel:"ArticleForm_optionalLabel__C_B1S",formControl:"ArticleForm_formControl__mBao_",formTextarea:"ArticleForm_formTextarea__ZsknF",formActions:"ArticleForm_formActions__WqypQ",cancelButton:"ArticleForm_cancelButton__OAgVI",submitButton:"ArticleForm_submitButton__o9hsW",errorAlert:"ArticleForm_errorAlert__1DQ3x",errorIcon:"ArticleForm_errorIcon___YV5p",imagePreview:"ArticleForm_imagePreview__92eKB",tagsPreview:"ArticleForm_tagsPreview__48G_v",tag:"ArticleForm_tag__MTDKK",statusDropdown:"ArticleForm_statusDropdown__FfXJV",characterCount:"ArticleForm_characterCount__IqdJb",characterWarning:"ArticleForm_characterWarning__ZKaNu",formHint:"ArticleForm_formHint__h9Deh",loading:"ArticleForm_loading__EUkeX",loadingSpinner:"ArticleForm_loadingSpinner__iaWlv",spin:"ArticleForm_spin__reKcv"}},3201:(e,r,t)=>{"use strict";t.d(r,{db:()=>c,j2:()=>l});var a=t(3915),i=t(6864),o=t(6203),s=t(5317);let n=(0,a.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,i.P5)(n)}catch(e){}let l=(0,o.xI)(n),c=(0,s.aU)(n);window.location.origin},5159:(e,r,t)=>{Promise.resolve().then(t.bind(t,9994))},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},9994:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>_});var a=t(5155),i=t(2115),o=t(5695),s=t(6203),n=t(3201),l=t(6874),c=t.n(l),d=t(9210),u=t(824),m=t.n(u);let h=e=>{let{articleId:r}=e,[t,s]=(0,i.useState)(""),[l,u]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),[g,p]=(0,i.useState)(""),[_,v]=(0,i.useState)("published"),[j,x]=(0,i.useState)(!1),[y,b]=(0,i.useState)(!0),[N,F]=(0,i.useState)(""),[w,A]=(0,i.useState)(0),[S,E]=(0,i.useState)(""),C=(0,o.useRouter)();(0,i.useEffect)(()=>{A(l.length)},[l]),(0,i.useEffect)(()=>{let e=async()=>{try{var e;b(!0);let t=await (0,d.zE)(r);s(t.title),u(t.body),f((null==(e=t.tags)?void 0:e.join(", "))||""),p(t.coverImage||""),v(t.status||"published"),E(t.slug||""),A(t.body.length)}catch(e){console.error("Error loading article:",e),F("Failed to load article data")}finally{b(!1)}};r&&e()},[r]);let I=async e=>{if(e.preventDefault(),!t||!l)return void F("Title and content are required");if(!n.j2.currentUser)return void F("You must be logged in to edit an article");try{x(!0),F("");let e=h.split(",").map(e=>e.trim()).filter(e=>""!==e),a={title:t,body:l,tags:e,status:_};""!==g.trim()&&(a.coverImage=g);let i=await (0,d.iZ)(r,a);"published"===_?C.push("/articles?slug=".concat(i.slug)):C.push("/my-thoughts")}catch(e){console.error("Error updating article:",e),F("Failed to update article. Please try again.")}finally{x(!1)}},P=["Consider adding more details to make your content more engaging","Re-read your article for clarity before publishing","Use descriptive language to paint a picture for your readers","Update your tags to reach a wider audience"],U=P[Math.floor(Math.random()*P.length)];return y?(0,a.jsx)("div",{className:m().articleFormContainer,children:(0,a.jsxs)("div",{className:m().loading,children:[(0,a.jsx)("div",{className:m().loadingSpinner}),(0,a.jsx)("span",{children:"Loading article data..."})]})}):(0,a.jsxs)("div",{className:m().articleFormContainer,children:[(0,a.jsxs)("div",{className:m().articleFormHeader,children:[(0,a.jsx)("h1",{className:m().articleFormTitle,children:"Edit Your Story"}),(0,a.jsx)("p",{className:m().articleFormSubtitle,children:"Refine your thoughts and make your article shine"})]}),N&&(0,a.jsxs)("div",{className:m().errorAlert,children:[(0,a.jsx)("span",{className:m().errorIcon,children:"⚠️"}),(0,a.jsx)("span",{children:N})]}),(0,a.jsxs)("form",{onSubmit:I,className:m().articleForm,children:[(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsx)("label",{htmlFor:"title",className:m().formLabel,children:"Title"}),(0,a.jsx)("input",{type:"text",id:"title",value:t,onChange:e=>s(e.target.value),required:!0,placeholder:"Enter a captivating title for your article...",className:m().formControl,maxLength:100}),(0,a.jsx)("div",{className:m().formHint,children:"A good title is clear, specific, and engaging"})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"coverImage",className:m().formLabel,children:["Cover Image URL ",(0,a.jsx)("span",{className:m().optionalLabel,children:"optional"})]}),(0,a.jsx)("input",{type:"url",id:"coverImage",value:g,onChange:e=>p(e.target.value),placeholder:"https://example.com/image.jpg",className:m().formControl}),(0,a.jsx)("div",{className:m().formHint,children:"A striking image can increase engagement with your article"}),g&&(0,a.jsx)("div",{className:m().imagePreview,children:(0,a.jsx)("img",{src:g,alt:"Cover preview"})})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"tags",className:m().formLabel,children:["Tags ",(0,a.jsx)("span",{className:m().optionalLabel,children:"comma separated"})]}),(0,a.jsx)("input",{type:"text",id:"tags",value:h,onChange:e=>f(e.target.value),placeholder:"technology, news, science, learning",className:m().formControl}),(0,a.jsx)("div",{className:m().formHint,children:"Tags help readers discover your content"}),h&&(0,a.jsx)("div",{className:m().tagsPreview,children:h.split(",").map((e,r)=>e.trim()&&(0,a.jsx)("span",{className:m().tag,children:e.trim()},r))})]}),(0,a.jsxs)("div",{className:"".concat(m().formGroup," ").concat(m().statusDropdown),children:[(0,a.jsx)("label",{htmlFor:"status",className:m().formLabel,children:"Status"}),(0,a.jsxs)("select",{id:"status",value:_,onChange:e=>v(e.target.value),className:m().formControl,children:[(0,a.jsx)("option",{value:"published",children:"Published (visible to everyone)"}),(0,a.jsx)("option",{value:"drafts",children:"Save as Draft (only visible to you)"})]}),(0,a.jsx)("div",{className:m().formHint,children:"published"===_?"Your article will be visible to all users":"Only you can see your draft until you publish it"})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsx)("label",{htmlFor:"body",className:m().formLabel,children:"Content"}),(0,a.jsx)("textarea",{id:"body",value:l,onChange:e=>u(e.target.value),required:!0,placeholder:"Write your article content here. Provide valuable insights, share your experience, or tell a compelling story...",className:m().formTextarea,rows:15}),(0,a.jsx)("div",{className:m().characterCount,children:(0,a.jsxs)("span",{className:w>3e3?m().characterWarning:"",children:[w," characters"]})}),(0,a.jsx)("div",{className:m().formHint,children:(0,a.jsxs)("span",{children:["✨ Tip: ",U]})})]}),(0,a.jsxs)("div",{className:m().formActions,children:[(0,a.jsx)(c(),{href:"/my-thoughts",className:m().cancelButton,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:m().submitButton,disabled:j,children:j?"Saving...":"Save Changes"})]})]})]})};var f=t(8163),g=t.n(f);function p(){let e=(0,o.useSearchParams)(),r=(null==e?void 0:e.get("id"))||"",[t,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!0),u=(0,o.useRouter)();return((0,i.useEffect)(()=>{let e=(0,s.hg)(n.j2,e=>{let t=!!e;l(t),d(!1),t||u.push("/login?redirect=/edit-article?id=".concat(r))});return()=>e()},[r,u]),(0,i.useEffect)(()=>{c||!t||r||u.push("/my-thoughts")},[r,t,c,u]),c)?(0,a.jsx)("div",{className:g().container,children:(0,a.jsx)("div",{className:g().loading,children:"Loading..."})}):t?r?(0,a.jsx)(h,{articleId:r}):(0,a.jsx)("div",{className:g().container,children:(0,a.jsx)("div",{className:g().loading,children:"No article ID provided."})}):(0,a.jsx)("div",{className:g().container,children:(0,a.jsx)("div",{className:g().loading,children:"Please log in to edit articles."})})}function _(){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{className:g().container,children:(0,a.jsx)("div",{className:g().loading,children:"Loading..."})}),children:(0,a.jsx)(p,{})})}},9995:(e,r,t)=>{"use strict";t.d(r,{Hs:()=>u,N9:()=>s,Ss:()=>n,bA:()=>l,fP:()=>d,fZ:()=>o,he:()=>c});var a=t(5317),i=t(3201);async function o(e,r,t,o,s,n){try{let r=i.j2.currentUser;if(!r||r.uid===e)return null;let l={userId:e,type:"comment",read:!1,sourceId:s,sourceType:"comment",message:"".concat(r.displayName||"Someone",' commented on your article: "').concat(n.substring(0,50)).concat(n.length>50?"...":"",'"'),fromUser:{id:r.uid,name:r.displayName||"Anonymous"},createdAt:a.Dc.now(),articleSlug:t,articleTitle:o};return{id:(await (0,a.gS)((0,a.rJ)(i.db,"notifications"),l)).id,...l}}catch(e){return console.error("Error creating notification:",e),null}}async function s(e,r,t,o){try{if(e===t)return null;let s={userId:e,type:"follow",read:!1,sourceId:t,sourceType:"user",message:"".concat(r," (@").concat(o,") started following you"),fromUser:{id:t,name:r},createdAt:a.Dc.now()};return{id:(await (0,a.gS)((0,a.rJ)(i.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating follow notification:",e),null}}async function n(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let r,t=i.j2.currentUser;if(!t)throw Error("User not authenticated");let o=(0,a.rJ)(i.db,"notifications");r=e?(0,a.P)(o,(0,a._M)("userId","==",t.uid),(0,a._M)("read","==",!1),(0,a.My)("createdAt","desc"),(0,a.AB)(100)):(0,a.P)(o,(0,a._M)("userId","==",t.uid),(0,a.My)("createdAt","desc"),(0,a.AB)(100));let s=await (0,a.GG)(r),n=[];return s.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error fetching notifications:",e),e}}async function l(e){try{let r=i.j2.currentUser;if(!r)throw Error("User not authenticated");let t=(0,a.H9)(i.db,"notifications",e),o=await (0,a.x7)(t);if(!o.exists())throw Error("Notification not found");if(o.data().userId!==r.uid)throw Error("Unauthorized access to notification");return await (0,a.mZ)(t,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,a.rJ)(i.db,"notifications"),t=(0,a.P)(r,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1)),o=await (0,a.GG)(t),s=o.docs.map(e=>(0,a.mZ)(e.ref,{read:!0}));return await Promise.all(s),{success:!0,count:o.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let r=i.j2.currentUser;if(!r)throw Error("User not authenticated");let t=(0,a.H9)(i.db,"notifications",e),o=await (0,a.x7)(t);if(!o.exists())throw Error("Notification not found");if(o.data().userId!==r.uid)throw Error("Unauthorized access to notification");return await (0,a.kd)(t),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=i.j2.currentUser;if(!e)return 0;let r=(0,a.rJ)(i.db,"notifications"),t=(0,a.P)(r,(0,a._M)("userId","==",e.uid),(0,a._M)("read","==",!1));return(await (0,a.GG)(t)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}},e=>{var r=r=>e(e.s=r);e.O(0,[4697,2992,7158,7117,6874,4692,8441,1684,7358],()=>r(5159)),_N_E=e.O()}]);