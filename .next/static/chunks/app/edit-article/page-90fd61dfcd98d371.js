(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{3201:(e,t,r)=>{"use strict";r.d(t,{db:()=>d,j2:()=>s});var i=r(3915),o=r(6864),a=r(6203),n=r(5317);let c=(0,i.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,o.P5)(c)}catch(e){}let s=(0,a.getAuth)(c),d=(0,n.getFirestore)(c);window.location.origin},4670:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var i=r(5155),o=r(2115),a=r(5695),n=r(6203),c=r(3201),s=r(2650),d=r(8163),u=r.n(d);let l=(0,o.cache)(()=>(0,a.useSearchParams)());function h(){let e=l(),t=(null==e?void 0:e.get("id"))||"",[r,d]=(0,o.useState)(!1),[h,f]=(0,o.useState)(!0),w=(0,a.useRouter)();return((0,o.useEffect)(()=>{let e=(0,n.onAuthStateChanged)(c.j2,e=>{let r=!!e;d(r),f(!1),r||w.push("/login?redirect=/edit-article?id=".concat(t))});return()=>e()},[t,w]),(0,o.useEffect)(()=>{h||!r||t||w.push("/my-thoughts")},[t,r,h,w]),h)?(0,i.jsx)("div",{className:u().container,children:(0,i.jsx)("div",{className:u().loading,children:"Loading..."})}):r?t?(0,i.jsx)(s.A,{articleId:t}):(0,i.jsx)("div",{className:u().container,children:(0,i.jsx)("div",{className:u().loading,children:"No article ID provided."})}):(0,i.jsx)("div",{className:u().container,children:(0,i.jsx)("div",{className:u().loading,children:"Please log in to edit articles."})})}function f(){return(0,i.jsx)(o.Suspense,{fallback:(0,i.jsx)("div",{className:u().container,children:(0,i.jsx)("div",{className:u().loading,children:"Loading..."})}),children:(0,i.jsx)(h,{})})}},5159:(e,t,r)=>{Promise.resolve().then(r.bind(r,4670))},9995:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>a,Ss:()=>n,bA:()=>c,fP:()=>d,he:()=>s});var i=r(5317),o=r(3201);async function a(e,t,r,a){try{if(e===r)return null;let n={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(a,") started following you"),fromUser:{id:r,name:t,username:a},createdAt:i.Timestamp.now()};return{id:(await (0,i.addDoc)((0,i.collection)(o.db,"notifications"),n)).id,...n}}catch(e){return console.error("Error creating follow notification:",e),null}}async function n(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=o.j2.currentUser;if(!r)throw Error("User not authenticated");let a=(0,i.collection)(o.db,"notifications");t=e?(0,i.query)(a,(0,i.where)("userId","==",r.uid),(0,i.where)("read","==",!1),(0,i.orderBy)("createdAt","desc"),(0,i.limit)(100)):(0,i.query)(a,(0,i.where)("userId","==",r.uid),(0,i.orderBy)("createdAt","desc"),(0,i.limit)(100));let n=await (0,i.getDocs)(t),c=[];return n.forEach(e=>{c.push({id:e.id,...e.data()})}),c}catch(e){throw console.error("Error fetching notifications:",e),e}}async function c(e){try{let t=o.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,i.doc)(o.db,"notifications",e),a=await (0,i.getDoc)(r);if(!a.exists())throw Error("Notification not found");if(a.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,i.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function s(){try{let e=o.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,i.collection)(o.db,"notifications"),r=(0,i.query)(t,(0,i.where)("userId","==",e.uid),(0,i.where)("read","==",!1)),a=await (0,i.getDocs)(r),n=a.docs.map(e=>(0,i.updateDoc)(e.ref,{read:!0}));return await Promise.all(n),{success:!0,count:a.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=o.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,i.doc)(o.db,"notifications",e),a=await (0,i.getDoc)(r);if(!a.exists())throw Error("Notification not found");if(a.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,i.deleteDoc)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=o.j2.currentUser;if(!e)return 0;let t=(0,i.collection)(o.db,"notifications"),r=(0,i.query)(t,(0,i.where)("userId","==",e.uid),(0,i.where)("read","==",!1));return(await (0,i.getDocs)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2156,1708,2992,7158,5004,7117,8460,2800,9122,2650,8441,1684,7358],()=>t(5159)),_N_E=e.O()}]);