(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{3201:(e,r,t)=>{"use strict";t.d(r,{db:()=>d,j2:()=>s});var a=t(3915),o=t(6864),i=t(6203),n=t(5317);let c=(0,a.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,o.P5)(c)}catch(e){}let s=(0,i.getAuth)(c),d=(0,n.getFirestore)(c);window.location.origin},4670:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var a=t(5155),o=t(2115),i=t(5695),n=t(6203),c=t(3201),s=t(2650),d=t(8163),u=t.n(d);let l=(0,o.cache)(()=>(0,i.useSearchParams)());function h(){let e=l(),r=(null==e?void 0:e.get("id"))||"",[t,d]=(0,o.useState)(!1),[h,f]=(0,o.useState)(!0),w=(0,i.useRouter)();return((0,o.useEffect)(()=>{let e=(0,n.onAuthStateChanged)(c.j2,e=>{let t=!!e;d(t),f(!1),t||w.push("/login?redirect=/edit-article?id=".concat(r))});return()=>e()},[r,w]),(0,o.useEffect)(()=>{h||!t||r||w.push("/my-thoughts")},[r,t,h,w]),h)?(0,a.jsx)("div",{className:u().container,children:(0,a.jsx)("div",{className:u().loading,children:"Loading..."})}):t?r?(0,a.jsx)(s.A,{articleId:r}):(0,a.jsx)("div",{className:u().container,children:(0,a.jsx)("div",{className:u().loading,children:"No article ID provided."})}):(0,a.jsx)("div",{className:u().container,children:(0,a.jsx)("div",{className:u().loading,children:"Please log in to edit articles."})})}function f(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{className:u().container,children:(0,a.jsx)("div",{className:u().loading,children:"Loading..."})}),children:(0,a.jsx)(h,{})})}},5159:(e,r,t)=>{Promise.resolve().then(t.bind(t,4670))},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"redirect")&&t.d(r,{redirect:function(){return a.redirect}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},9995:(e,r,t)=>{"use strict";t.d(r,{Hs:()=>u,N9:()=>i,Ss:()=>n,bA:()=>c,fP:()=>d,he:()=>s});var a=t(5317),o=t(3201);async function i(e,r,t,i){try{if(e===t)return null;let n={userId:e,type:"follow",read:!1,sourceId:t,sourceType:"user",message:"".concat(r," (@").concat(i,") started following you"),fromUser:{id:t,name:r,username:i},createdAt:a.Timestamp.now()};return{id:(await (0,a.addDoc)((0,a.collection)(o.db,"notifications"),n)).id,...n}}catch(e){return console.error("Error creating follow notification:",e),null}}async function n(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let r,t=o.j2.currentUser;if(!t)throw Error("User not authenticated");let i=(0,a.collection)(o.db,"notifications");r=e?(0,a.query)(i,(0,a.where)("userId","==",t.uid),(0,a.where)("read","==",!1),(0,a.orderBy)("createdAt","desc"),(0,a.limit)(100)):(0,a.query)(i,(0,a.where)("userId","==",t.uid),(0,a.orderBy)("createdAt","desc"),(0,a.limit)(100));let n=await (0,a.getDocs)(r),c=[];return n.forEach(e=>{c.push({id:e.id,...e.data()})}),c}catch(e){throw console.error("Error fetching notifications:",e),e}}async function c(e){try{let r=o.j2.currentUser;if(!r)throw Error("User not authenticated");let t=(0,a.doc)(o.db,"notifications",e),i=await (0,a.getDoc)(t);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==r.uid)throw Error("Unauthorized access to notification");return await (0,a.updateDoc)(t,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function s(){try{let e=o.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,a.collection)(o.db,"notifications"),t=(0,a.query)(r,(0,a.where)("userId","==",e.uid),(0,a.where)("read","==",!1)),i=await (0,a.getDocs)(t),n=i.docs.map(e=>(0,a.updateDoc)(e.ref,{read:!0}));return await Promise.all(n),{success:!0,count:i.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let r=o.j2.currentUser;if(!r)throw Error("User not authenticated");let t=(0,a.doc)(o.db,"notifications",e),i=await (0,a.getDoc)(t);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==r.uid)throw Error("Unauthorized access to notification");return await (0,a.deleteDoc)(t),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=o.j2.currentUser;if(!e)return 0;let r=(0,a.collection)(o.db,"notifications"),t=(0,a.query)(r,(0,a.where)("userId","==",e.uid),(0,a.where)("read","==",!1));return(await (0,a.getDocs)(t)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}},e=>{var r=r=>e(e.s=r);e.O(0,[5786,1708,2992,7158,5004,7117,4366,2800,9122,2650,8441,1684,7358],()=>r(5159)),_N_E=e.O()}]);