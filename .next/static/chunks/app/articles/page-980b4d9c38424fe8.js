(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5292],{6462:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var a=i(5155),l=i(2115),s=i(6874),n=i.n(s),r=i(5695),o=i(8501),c=i.n(o),d=i(3201),h=i(6203),u=i(9995),m=i(6559),f=i.n(m);let g=()=>{let[e,t]=(0,l.useState)(0),[i,s]=(0,l.useState)([]),[r,o]=(0,l.useState)(!1),c=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=async()=>{t(await (0,u.Hs)())};e();let i=setInterval(e,6e4);return()=>clearInterval(i)},[]),(0,l.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,l.useEffect)(()=>{r&&d()},[r]);let d=async()=>{try{let e=await (0,u.Ss)(!1);s(e)}catch(e){console.error("Error fetching notifications:",e)}},h=async e=>{try{!e.read&&e.id&&(await (0,u.bA)(e.id),t(e=>Math.max(e-1,0)),s(t=>t.map(t=>t.id===e.id?{...t,read:!0}:t)))}catch(e){console.error("Error marking notification as read:",e)}},m=e=>{if(!e)return"";let t=e.toDate?e.toDate():new Date(e),i=Math.floor((new Date().getTime()-t.getTime())/6e4);if(i<1)return"Just now";if(i<60)return"".concat(i,"m ago");let a=Math.floor(i/60);if(a<24)return"".concat(a,"h ago");let l=Math.floor(a/24);return l<7?"".concat(l,"d ago"):t.toLocaleDateString()},g=e=>{if("follow"===e.type){var t;return(null==(t=e.fromUser)?void 0:t.username)?"/user/".concat(e.fromUser.username):"/notifications"}return e.articleSlug?"/articles?slug=".concat(e.articleSlug):"/notifications"};return(0,a.jsxs)("div",{className:f().container,ref:c,children:[(0,a.jsxs)("button",{className:f().button,onClick:()=>{o(!r)},"aria-label":"Notifications",children:[(0,a.jsxs)("svg",{className:f().icon,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),(0,a.jsx)("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e>0&&(0,a.jsx)("span",{className:f().badge,children:e})]}),r&&(0,a.jsxs)("div",{className:f().dropdown,children:[(0,a.jsxs)("div",{className:f().header,children:[(0,a.jsx)("h3",{children:"Notifications"}),i.length>0&&(0,a.jsx)(n(),{href:"/notifications",className:f().viewAll,children:"View All"})]}),(0,a.jsx)("div",{className:f().list,children:0===i.length?(0,a.jsx)("div",{className:f().empty,children:"No notifications yet"}):i.slice(0,5).map(e=>(0,a.jsxs)(n(),{href:g(e),className:"".concat(f().item," ").concat(e.read?"":f().unread),onClick:()=>h(e),children:[(0,a.jsxs)("div",{className:f().content,children:[(0,a.jsx)("p",{className:f().message,children:e.message}),(0,a.jsx)("span",{className:f().time,children:m(e.createdAt)})]}),!e.read&&(0,a.jsx)("div",{className:f().dot})]},e.id))}),i.length>5&&(0,a.jsx)("div",{className:f().footer,children:(0,a.jsx)(n(),{href:"/notifications",className:f().seeMore,children:"See more notifications"})})]})]})};var N=i(4568),x=i(6016),j=i(3430),v=i(9210);function p(){var e,t;let s=(0,r.useSearchParams)();(0,r.useRouter)();let o=null==s?void 0:s.get("slug"),[u,m]=(0,l.useState)(null),[f,p]=(0,l.useState)(!0),[w,_]=(0,l.useState)(null),[k,A]=(0,l.useState)([]),[M,y]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!0),[B,I]=(0,l.useState)(!1),[b,E]=(0,l.useState)(0),[L,D]=(0,l.useState)(null),[T,U]=(0,l.useState)([]),[H,P]=(0,l.useState)(!1),[W,K]=(0,l.useState)(null),[F,J]=(0,l.useState)(!1);(0,l.useEffect)(()=>{E(window.innerWidth);let e=()=>{E(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{let e=(0,h.hg)(d.j2,e=>{y(!!e),K(e),e&&(null==u?void 0:u.likes)&&P(u.likes.includes(e.uid))});return()=>e()},[u]),(0,l.useEffect)(()=>{let e=e=>{let t=e.target,i=document.getElementById("profile-menu"),a=document.getElementById("profile-button");i&&!i.contains(t)&&a&&!a.contains(t)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,l.useEffect)(()=>{(async()=>{if(!o){_("No article slug provided"),p(!1);return}try{let e=await (0,v.l6)(o);if(!e){_("Article not found"),p(!1);return}let t=e.body.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");D(t),U(e.likes||[]);let i=e.body.split(/\s+/).length,a=Math.ceil(i/200),l=e.createdAt?new Date(1e3*e.createdAt.seconds).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Unknown date";m({id:e.id,title:e.title,authorName:e.authorName||"Anonymous",authorId:e.authorId,createdAt:l,readTime:a,likes:e.likes||[],tags:e.tags||[],slug:o}),A(e.tags||[]),p(!1)}catch(e){console.error("Error fetching article:",e),_("Failed to load article"),p(!1)}})()},[o]);let R=async()=>{try{await (0,h.CI)(d.j2),I(!1)}catch(e){console.error("Error signing out:",e)}},z=async()=>{if(console.log("\uD83D\uDD25 LIKE BUTTON CLICKED!"),console.log("Current user:",W),console.log("Article ID:",null==u?void 0:u.id),console.log("Is liked:",H),!W)return void alert("Please login to like articles");if(!(null==u?void 0:u.id))return void console.error("❌ No article ID found");try{let{doc:e,updateDoc:t,arrayUnion:a,arrayRemove:l}=await Promise.resolve().then(i.bind(i,5317)),{db:s}=await Promise.resolve().then(i.bind(i,3201));console.log("\uD83D\uDCDD Updating Firestore...");let n=e(s,"articles",u.id);H?(console.log("\uD83D\uDC4D Removing like..."),await t(n,{likes:l(W.uid)}),U(T.filter(e=>e!==W.uid)),P(!1),console.log("✅ Like removed successfully")):(console.log("❤️ Adding like..."),await t(n,{likes:a(W.uid)}),U([...T,W.uid]),P(!0),console.log("✅ Like added successfully"))}catch(e){console.error("❌ Error updating like status:",e),H?(U([...T,W.uid]),P(!0)):(U(T.filter(e=>e!==W.uid)),P(!1))}};return f?(0,a.jsxs)("div",{className:c().loadingContainer,children:[(0,a.jsx)("div",{className:c().loadingIndicator}),(0,a.jsx)("p",{children:"Loading article..."})]}):w?(0,a.jsx)("div",{className:c().errorContainer,children:(0,a.jsx)("p",{className:c().errorMessage,children:w})}):F&&u?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:c().editingHeader,children:[(0,a.jsx)("button",{onClick:()=>J(!1),className:c().cancelButton,children:"← Back to Article"}),(0,a.jsxs)("h2",{children:["Editing: ",u.title]})]}),(0,a.jsx)(j.A,{articleId:u.id,onUpdateComplete:()=>{console.log("Article update complete"),p(!0),J(!1),(null==u?void 0:u.id)?window.location.href="/articles/".concat(u.id,"/view?updated=true&t=").concat(Date.now()):window.location.reload(),(async()=>{try{let e=await (0,v.l6)(o||"");if(!e)return void _("Article not found");let t=e.body.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");D(t),U(e.likes||[]);let i=e.body.split(/\s+/).length,a=Math.ceil(i/200),l=e.createdAt?new Date(1e3*e.createdAt.seconds).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Unknown date";m({id:e.id,title:e.title,authorName:e.authorName||"Anonymous",authorId:e.authorId,createdAt:l,readTime:a,likes:e.likes||[],tags:e.tags||[],slug:o||""}),A(e.tags||[])}catch(e){console.error("Error refetching article:",e)}})()}})]}):(0,a.jsx)("div",{className:c().articlePageContainer,children:u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("header",{className:c().pageHeader,children:(0,a.jsxs)("div",{className:c().headerContainer,children:[(0,a.jsx)(n(),{href:"/",className:c().logoLink,children:(0,a.jsx)("div",{className:c().headerLogo,children:"Journalite"})}),(0,a.jsxs)("div",{className:c().headerActions,children:[M&&(0,a.jsx)(g,{}),(0,a.jsx)("div",{className:c().profileMenu,id:"profile-menu",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:c().profileCircle,onClick:()=>{I(!B)},id:"profile-button",children:(null==W||null==(e=W.displayName)?void 0:e.charAt(0))||(null==W||null==(t=W.email)?void 0:t.charAt(0))||"U"}),B&&(0,a.jsxs)("div",{className:c().profileDropdown,children:[(0,a.jsx)(n(),{href:"/",className:c().dropdownItem,children:"Home"}),(0,a.jsx)(n(),{href:"/my-thoughts",className:c().dropdownItem,children:"My Thoughts"}),(0,a.jsx)(n(),{href:"/dashboard",className:c().dropdownItem,children:"Dashboard"}),(0,a.jsx)(n(),{href:"/write",className:c().dropdownItem,children:"Write a story"}),(0,a.jsx)(n(),{href:"/create-article",className:c().dropdownItem,children:"Create Article"}),(0,a.jsx)(n(),{href:"/explore",className:c().dropdownItem,children:"Explore"}),(0,a.jsx)(n(),{href:"/profile",className:c().dropdownItem,children:"Profile"}),(0,a.jsx)(n(),{href:"/settings",className:c().dropdownItem,children:"Settings"}),(0,a.jsx)("button",{onClick:R,className:c().dropdownItem,children:"Sign out"})]})]}):(0,a.jsxs)("div",{className:c().authButtons,children:[(0,a.jsx)(n(),{href:"/login",className:c().loginButton,children:"Sign in"}),(0,a.jsx)(n(),{href:"/signup",className:c().signupButton,children:"Get started"})]})})]})]})}),(0,a.jsxs)("div",{className:c().pageContainer,children:[(0,a.jsxs)("header",{className:c().articleHeader,children:[(0,a.jsx)("h1",{className:c().articleTitle,children:u.title}),(0,a.jsxs)("div",{className:c().articleMeta,children:[(0,a.jsxs)("div",{className:c().authorInfo,children:[(0,a.jsx)("div",{className:c().authorAvatar,children:u.authorName.charAt(0)}),(0,a.jsxs)("div",{className:c().authorDetails,children:[(0,a.jsx)(n(),{href:"/user/".concat(u.authorName.toLowerCase().replace(/\s+/g,"")),className:c().authorNameLink,children:(0,a.jsx)("div",{className:c().authorName,children:u.authorName})}),(0,a.jsxs)("div",{className:c().articleDetails,children:[u.createdAt," \xb7 ",u.readTime," min read"]})]})]}),(0,a.jsxs)("div",{className:c().articleActions,children:[(0,a.jsxs)("button",{className:"".concat(c().likeButton," ").concat(H?c().liked:""),onClick:z,"aria-label":H?"Unlike article":"Like article",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:H?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:c().likeIcon,children:(0,a.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,a.jsx)("span",{children:T.length>0?T.length:""})]}),M&&u.authorId===(null==W?void 0:W.uid)&&(0,a.jsx)("button",{className:c().editButton,onClick:()=>J(!0),children:"Edit"})]})]}),u.tags&&u.tags.length>0&&(0,a.jsx)("div",{className:c().tagContainer,children:u.tags.map((e,t)=>(0,a.jsx)("span",{className:c().tag,children:e},t))})]}),(0,a.jsx)(N.A,{articleId:u.id,initialHtml:L||void 0}),(0,a.jsx)("div",{className:c().commentsContainer,children:(0,a.jsx)(x.A,{articleId:u.id})}),(0,a.jsxs)("aside",{className:c().relatedTagsSection,children:[(0,a.jsx)("h2",{className:c().relatedTagsHeading,children:"Related Tags"}),(0,a.jsx)("div",{className:c().relatedTagsList,children:k.map(e=>(0,a.jsxs)(n(),{href:"/tag/".concat(e.toLowerCase()),className:c().relatedTag,children:["# ",e]},e))}),(0,a.jsx)(n(),{href:"/write",className:c().writeButton,children:"Write"})]})]})]})})}function w(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading article..."}),children:(0,a.jsx)(p,{})})}},6559:e=>{e.exports={container:"MinimalNotificationBell_container__NGUf_",button:"MinimalNotificationBell_button__MAJkt",icon:"MinimalNotificationBell_icon__c6pW9",badge:"MinimalNotificationBell_badge___Di_K",dropdown:"MinimalNotificationBell_dropdown__PJtYq",header:"MinimalNotificationBell_header__zCiQJ",viewAll:"MinimalNotificationBell_viewAll__ZLWoU",list:"MinimalNotificationBell_list__MmsKd",item:"MinimalNotificationBell_item__flonv",unread:"MinimalNotificationBell_unread__278b3",content:"MinimalNotificationBell_content__31WKK",message:"MinimalNotificationBell_message__fnAua",time:"MinimalNotificationBell_time___76Fq",dot:"MinimalNotificationBell_dot__R2YqN",empty:"MinimalNotificationBell_empty__kDVAL",footer:"MinimalNotificationBell_footer__Pslwe",seeMore:"MinimalNotificationBell_seeMore__ggGUA"}},9251:(e,t,i)=>{Promise.resolve().then(i.bind(i,6462))}},e=>{var t=t=>e(e.s=t);e.O(0,[8130,2507,2992,7158,5004,7117,6874,8735,9122,3430,4419,8441,1684,7358],()=>t(9251)),_N_E=e.O()}]);