(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8406],{4114:(e,t,a)=>{"use strict";a.d(t,{default:()=>E});var i=a(5155),l=a(2115),n=a(5695),r=a(6874),o=a.n(r),d=a(3201),c=a(6203),s=a(9547);let u=l.memo(e=>{let{articleId:t,articleHtml:a,isAuthenticated:l,articleTitle:n,articleSlug:r,hasReflectionRoom:o=!1,moodFeatureEnabled:d,onToggleMoodFeature:c}=e;return console.log("\uD83D\uDCDD ArticleContent re-rendered at:",new Date().toLocaleTimeString()),(0,i.jsx)(s.A,{articleId:t,initialHtml:a||void 0,isAuthenticated:l,articleTitle:n,articleSlug:r,hasReflectionRoom:o,...l&&{moodFeatureEnabled:d,onToggleMoodFeature:c}})},(e,t)=>{let a=e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&e.isAuthenticated===t.isAuthenticated&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.hasReflectionRoom===t.hasReflectionRoom&&e.moodFeatureEnabled===t.moodFeatureEnabled&&e.onToggleMoodFeature===t.onToggleMoodFeature;return a||console.log("\uD83D\uDCDD ArticleContent memo comparison - will re-render because:",{articleId:e.articleId!==t.articleId,articleHtml:e.articleHtml!==t.articleHtml,isAuthenticated:e.isAuthenticated!==t.isAuthenticated,articleTitle:e.articleTitle!==t.articleTitle,articleSlug:e.articleSlug!==t.articleSlug,hasReflectionRoom:e.hasReflectionRoom!==t.hasReflectionRoom,moodFeatureEnabled:e.moodFeatureEnabled!==t.moodFeatureEnabled,onToggleMoodFeature:e.onToggleMoodFeature!==t.onToggleMoodFeature}),a});var m=a(5405),g=a(3891),h=a(8501),x=a.n(h);let p=l.memo(e=>{let{articleId:t,articleHtml:a,article:l,initialLikes:n,currentUser:r,isAuthenticated:o,onEditClick:d,articleTitle:c,articleSlug:s}=e;return console.log("\uD83C\uDFD7️ ArticleLayout re-rendered at:",new Date().toLocaleTimeString()),(0,i.jsxs)("div",{className:x().pageContainer,children:[l&&(0,i.jsxs)("header",{className:x().articleHeader,children:[(0,i.jsxs)("div",{className:x().articleHeaderWithReaders,children:[(0,i.jsx)("div",{className:x().titleSection,children:(0,i.jsx)("h1",{className:x().articleTitle,style:{margin:0},children:l.title})}),(0,i.jsx)("div",{className:x().readersSection,children:(0,i.jsx)(g.A,{articleId:t})})]}),(0,i.jsxs)("div",{className:x().articleMeta,children:[(0,i.jsxs)("div",{className:x().authorInfo,children:[(0,i.jsx)("div",{className:x().authorAvatar,children:l.authorName.charAt(0)}),(0,i.jsxs)("div",{className:x().authorDetails,children:[(0,i.jsx)("div",{className:x().authorName,children:l.authorName}),(0,i.jsxs)("div",{className:x().articleDetails,children:[l.createdAt," \xb7 ",l.readTime," min read"]})]})]}),(0,i.jsxs)("div",{className:x().articleActions,children:[(0,i.jsx)(m.A,{articleId:t,initialLikes:n,className:x().likeButton,styles:x()}),r&&l.authorId===r.uid&&(0,i.jsx)("button",{className:x().editButton,onClick:d,children:"Edit"})]})]}),l.tags&&l.tags.length>0&&(0,i.jsx)("div",{className:x().tagContainer,children:l.tags.map((e,t)=>(0,i.jsx)("span",{className:x().tag,children:e},t))})]}),(0,i.jsx)(u,{articleId:t,articleHtml:a,isAuthenticated:o,articleTitle:c,articleSlug:s,hasReflectionRoom:(null==l?void 0:l.hasReflectionRoom)||!1})]})},(e,t)=>{var a,i,l,n,r,o,d,c,s,u,m,g,h,x;let p=e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&(null==(a=e.article)?void 0:a.title)===(null==(i=t.article)?void 0:i.title)&&(null==(l=e.article)?void 0:l.authorName)===(null==(n=t.article)?void 0:n.authorName)&&(null==(r=e.article)?void 0:r.createdAt)===(null==(o=t.article)?void 0:o.createdAt)&&(null==(d=e.article)?void 0:d.readTime)===(null==(c=t.article)?void 0:c.readTime)&&(null==(s=e.article)?void 0:s.authorId)===(null==(u=t.article)?void 0:u.authorId)&&(null==(m=e.article)?void 0:m.hasReflectionRoom)===(null==(g=t.article)?void 0:g.hasReflectionRoom)&&e.isAuthenticated===t.isAuthenticated&&(null==(h=e.currentUser)?void 0:h.uid)===(null==(x=t.currentUser)?void 0:x.uid)&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.onEditClick===t.onEditClick;return p||console.log("\uD83C\uDFD7️ ArticleLayout memo - will re-render because something changed"),p});var v=a(6016),f=a(2650),j=a(9210),S=a(7041),b=a(326),N=a(4362),A=a(3487),I=a(8883);let E=e=>{var t,a;let{id:r}=e,s=(0,n.useRouter)(),[u,m]=(0,l.useState)(!0),[g,h]=(0,l.useState)(""),[E,w]=(0,l.useState)(null),[y,k]=(0,l.useState)(null),[T,C]=(0,l.useState)([]),[F,R]=(0,l.useState)(null),[Q,H]=(0,l.useState)(!1),[L,M]=(0,l.useState)(!1),[z,D]=(0,l.useState)(window.innerWidth),[U,B]=(0,l.useState)(!1),_=(0,l.useRef)(null),[O,W]=(0,l.useState)("reflective"),[P,J]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=d.j2.onAuthStateChanged(e=>{R(e),M(!!e)});return()=>e()},[]),(0,l.useEffect)(()=>{let e=()=>{D(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{if(L){let e=localStorage.getItem("moodFeatureEnabled");null!==e?J(JSON.parse(e)):J(!0)}else J(!1)},[L]);let G=async()=>{try{await (0,c.signOut)(d.j2),B(!1),s.push("/")}catch(e){console.error("Error signing out:",e)}};(0,l.useEffect)(()=>{let e=e=>{_.current&&!_.current.contains(e.target)&&B(!1)};return U&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[U]);let $=async()=>{try{var e;console.log("Fetching article with ID: ".concat(r,", timestamp: ").concat(Date.now())),m(!0),await new Promise(e=>setTimeout(e,300));let t=await (0,j.getArticleById)(r);if(console.log("Article data received:",null==t?void 0:t.title,"Content length:",(null==t||null==(e=t.body)?void 0:e.length)||0),!t)return void h("Article not found");let a=t.body?t.body.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""):"";w(a),C(t.likes||[]);let i=t.body?t.body.split(/\s+/).length:0,l=Math.ceil(i/200),n=t.createdAt?new Date(1e3*t.createdAt.seconds).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Unknown date";k({title:t.title||"Untitled Article",authorName:t.authorName||"Anonymous",createdAt:n,readTime:l,tags:t.tags||[],authorId:t.authorId,hasReflectionRoom:t.hasReflectionRoom||!1})}catch(e){console.error("Error loading article:",e),h("Failed to load article")}finally{m(!1)}};(0,l.useEffect)(()=>{$()},[r]),(0,l.useEffect)(()=>{if(E&&L){let e=E.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();e&&W((0,S.H)(e))}},[E,L]);let q=(0,l.useCallback)(()=>{H(!0)},[]),K=(0,l.useCallback)(()=>{H(!1)},[]);(0,l.useCallback)(e=>{J(e),localStorage.setItem("moodFeatureEnabled",JSON.stringify(e))},[]);let V=(0,l.useMemo)(()=>(null==y?void 0:y.title)||"Article",[null==y?void 0:y.title]),X=(0,l.useMemo)(()=>(null==y?void 0:y.title)?y.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):r,[null==y?void 0:y.title,r]);return u?(0,i.jsxs)("div",{className:x().loadingContainer,children:[(0,i.jsx)("div",{className:x().loadingIndicator}),(0,i.jsx)("p",{children:"Loading article..."})]}):g?(0,i.jsx)("div",{className:x().errorContainer,children:(0,i.jsx)("p",{className:x().errorMessage,children:g})}):Q?(0,i.jsx)(f.A,{articleId:r,onUpdateComplete:e=>{console.log("Article update complete with data:",e),m(!0),w(null),k(null),e?(console.log("Forcing hard reload to see updated content"),window.location.href="/articles/".concat(r,"?reload=").concat(Date.now())):setTimeout(()=>{$()},800)},backToArticleAction:K,editingTitle:null==y?void 0:y.title}):(0,i.jsxs)("div",{className:x().articlePageContainer,style:{position:"relative",backgroundColor:"#ffffff"},children:[L&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{"data-mood-element":"primary-gradient",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundImage:"linear-gradient(45deg, \n                ".concat(b.Qx[O].gradientStart,"40, \n                ").concat(b.Qx[O].gradientEnd,"60, \n                ").concat(b.Qx[O].gradientStart,"30, \n                ").concat(b.Qx[O].gradientEnd,"50)"),backgroundSize:"400% 400%",animation:"gradientFlow 8s ease-in-out infinite",filter:"contrast(1.1) brightness(1.05) saturate(1.1)",zIndex:0,transition:"background-image 1s ease-in-out",pointerEvents:"none",display:"false"===localStorage.getItem("moodFeatureEnabled")?"none":""}}),(0,i.jsx)("div",{"data-mood-element":"secondary-wave",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundImage:"radial-gradient(circle at 20% 80%, ".concat(b.Qx[O].gradientEnd,"25 0%, transparent 50%),\n                radial-gradient(circle at 80% 20%, ").concat(b.Qx[O].gradientStart,"25 0%, transparent 50%),\n                radial-gradient(circle at 40% 40%, ").concat(b.Qx[O].gradientEnd,"15 0%, transparent 50%)"),backgroundSize:"600px 600px, 800px 800px, 400px 400px",animation:"moodFloat 12s ease-in-out infinite alternate",zIndex:1,opacity:.6,pointerEvents:"none",display:"false"===localStorage.getItem("moodFeatureEnabled")?"none":""}}),(0,i.jsx)("div",{"data-mood-element":"floating-orbs",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundImage:"radial-gradient(circle at 25% 25%, ".concat(b.Qx[O].gradientStart,"20 0%, transparent 25%),\n                radial-gradient(circle at 75% 75%, ").concat(b.Qx[O].gradientEnd,"20 0%, transparent 25%),\n                radial-gradient(circle at 50% 10%, ").concat(b.Qx[O].gradientStart,"15 0%, transparent 30%),\n                radial-gradient(circle at 10% 90%, ").concat(b.Qx[O].gradientEnd,"15 0%, transparent 30%)"),backgroundSize:"300px 300px, 500px 500px, 200px 200px, 400px 400px",animation:"orbitalFloat 20s linear infinite",zIndex:2,opacity:.4,pointerEvents:"none",display:"false"===localStorage.getItem("moodFeatureEnabled")?"none":""}}),(0,i.jsx)("div",{"data-mood-element":"grain-texture",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundImage:"repeating-linear-gradient(\n                90deg,\n                transparent,\n                transparent 2px,\n                ".concat(b.Qx[O].gradientStart,"02 2px,\n                ").concat(b.Qx[O].gradientStart,"02 4px\n              )"),zIndex:3,opacity:.15,mixBlendMode:"overlay",pointerEvents:"none",display:"false"===localStorage.getItem("moodFeatureEnabled")?"none":""}})]}),(0,i.jsx)("header",{className:x().pageHeader,"data-mood-header":"page-header",style:P&&L?{position:"relative",zIndex:1e4,background:"linear-gradient(135deg, \n            rgba(255, 255, 255, 0.15) 0%, \n            ".concat(b.Qx[O].gradientStart,"12 40%, \n            ").concat(b.Qx[O].gradientEnd,"08 100%)"),backdropFilter:"blur(24px) saturate(180%)",borderBottom:"1px solid ".concat(b.Qx[O].gradientStart,"25"),boxShadow:"\n            0 2px 8px -2px ".concat(b.Qx[O].gradientStart,"15,\n            0 8px 32px -8px ").concat(b.Qx[O].gradientStart,"20,\n            inset 0 1px 0 rgba(255, 255, 255, 0.25),\n            inset 0 -1px 0 ").concat(b.Qx[O].gradientStart,"10\n          "),transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",border:"1px solid ".concat(b.Qx[O].gradientStart,"15"),borderTop:"none"}:{position:"relative",zIndex:1e4},children:(0,i.jsxs)("div",{className:x().headerContainer,children:[(0,i.jsx)(o(),{href:"/",className:x().logoLink,children:(0,i.jsx)("div",{className:x().headerLogo,style:P&&L?{color:b.Qx[O].accent,fontWeight:"700",textShadow:"0 0 20px ".concat(b.Qx[O].gradientStart,"30, 0 0 40px ").concat(b.Qx[O].gradientStart,"15"),transition:"all 0.3s ease"}:{fontWeight:"700"},children:"Journalite"})}),(0,i.jsxs)("div",{className:x().headerActions,children:[L&&(0,i.jsx)(A.A,{}),L&&(0,i.jsx)(I.A,{}),(0,i.jsx)("div",{className:x().profileMenu,id:"profile-menu",ref:_,children:L?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:x().profileCircle,onClick:()=>{B(!U)},id:"profile-button",children:(null==F||null==(t=F.displayName)?void 0:t.charAt(0))||(null==F||null==(a=F.email)?void 0:a.charAt(0))||"U"}),U&&(0,i.jsxs)("div",{className:x().profileDropdown,children:[(0,i.jsx)(o(),{href:"/",className:x().dropdownItem,children:"Home"}),(0,i.jsx)(o(),{href:"/my-thoughts",className:x().dropdownItem,children:"My Thoughts"}),(0,i.jsx)(o(),{href:"/messages",className:x().dropdownItem,children:"Messages"}),(0,i.jsx)(o(),{href:"/create-article",className:x().dropdownItem,children:"Create Article"}),(0,i.jsx)(o(),{href:"/explore",className:x().dropdownItem,children:"Explore"}),(0,i.jsx)(o(),{href:"/my-profile",className:x().dropdownItem,children:"Profile"}),(0,i.jsx)(o(),{href:"/settings",className:x().dropdownItem,children:"Settings"}),(0,i.jsx)("button",{onClick:G,className:x().dropdownItem,children:"Sign out"})]})]}):(0,i.jsxs)("div",{className:x().authButtons,children:[(0,i.jsx)(o(),{href:"/login",className:x().loginButton,children:"Sign in"}),(0,i.jsx)(o(),{href:"/register",className:x().signupButton,children:"Get started"})]})})]})]})}),(0,i.jsx)(p,{articleId:r,articleHtml:E,article:y,initialLikes:T,currentUser:F,isAuthenticated:L,onEditClick:q,articleTitle:V,articleSlug:X}),(0,i.jsx)("div",{className:x().commentsContainer,children:(0,i.jsx)(v.A,{articleId:r,...L&&{mood:O,moodFeatureEnabled:P}})}),(0,i.jsx)(N.A,{isAuthenticated:L})]})}},4734:(e,t,a)=>{Promise.resolve().then(a.bind(a,4114))}},e=>{var t=t=>e(e.s=t);e.O(0,[7267,5786,1708,2992,7158,5004,7117,6874,3593,4366,6713,4744,2800,8883,9122,2650,1431,914,8441,1684,7358],()=>t(4734)),_N_E=e.O()}]);