(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9451],{2897:(e,t,s)=>{"use strict";s.d(t,{$i:()=>u,FA:()=>d,KB:()=>h,SR:()=>x,_z:()=>m,iS:()=>f,zS:()=>b});var r=s(5112),a=s(3201),n=s(4744);let i=new Map,l=new Map;async function o(e){let t=i.get(e),s=Date.now();if(t&&s-t.timestamp<3e5)return t.profile;let r=await (0,n.VM)(e);return r&&i.set(e,{profile:r,timestamp:s}),r}async function c(e,t){let s="".concat(e,"-").concat(t),r=l.get(s),a=Date.now();if(r&&a-r.timestamp<3e4)return r.count;let n=await g(e,t);return l.set(s,{count:n,timestamp:a}),n}async function d(e,t){if(!e||!t)throw Error("Both user IDs are required");if(e===t)throw Error("Cannot create conversation with yourself");try{let s=(0,r.collection)(a.db,"conversations"),n=(0,r.query)(s,(0,r.where)("participants","array-contains",e));for(let e of(await (0,r.getDocs)(n)).docs)if(e.data().participants.includes(t))return e.id;let i={participants:[e,t].sort(),lastMessage:{content:"",senderId:"",timestamp:(0,r.serverTimestamp)(),read:!1},createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)()};return(await (0,r.addDoc)(s,i)).id}catch(e){throw console.error("Error getting or creating conversation:",e),e}}async function m(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"text",i=a.j2.currentUser;if(!i)throw Error("User must be authenticated to send messages");if(!s.trim())throw Error("Message content cannot be empty");try{let o=(0,r.collection)(a.db,"messages"),c={conversationId:e,senderId:i.uid,receiverId:t,content:s.trim(),type:n,timestamp:(0,r.serverTimestamp)(),read:!1},d=await (0,r.addDoc)(o,c),m=(0,r.doc)(a.db,"conversations",e);await (0,r.updateDoc)(m,{lastMessage:{content:s.trim(),senderId:i.uid,timestamp:(0,r.serverTimestamp)(),read:!1},updatedAt:(0,r.serverTimestamp)()});let u="".concat(e,"-").concat(t);return l.delete(u),d.id}catch(e){throw console.error("Error sending message:",e),e}}async function u(e,t,s){let n=a.j2.currentUser;if(!n)throw Error("User must be authenticated to send messages");if(!s.uid||!s.username)throw Error("Profile data must include uid and username");try{let i=(0,r.collection)(a.db,"messages"),o={conversationId:e,senderId:n.uid,receiverId:t,content:"Shared ".concat(s.firstName," ").concat(s.lastName,"'s profile"),type:"profile",timestamp:(0,r.serverTimestamp)(),read:!1,profileAttachment:s},c=await (0,r.addDoc)(i,o),d=(0,r.doc)(a.db,"conversations",e);await (0,r.updateDoc)(d,{lastMessage:{content:"Shared ".concat(s.firstName," ").concat(s.lastName,"'s profile"),senderId:n.uid,timestamp:(0,r.serverTimestamp)(),read:!1},updatedAt:(0,r.serverTimestamp)()});let m="".concat(e,"-").concat(t);return l.delete(m),c.id}catch(e){throw console.error("Error sending profile message:",e),e}}function x(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;try{let n=(0,r.collection)(a.db,"messages"),i=(0,r.query)(n,(0,r.where)("conversationId","==",e),(0,r.orderBy)("timestamp","desc"),(0,r.limit)(s));return(0,r.onSnapshot)(i,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,...e.data()})}),t(s.reverse())})}catch(e){throw console.error("Error subscribing to messages:",e),e}}function h(e,t){try{let s=(0,r.collection)(a.db,"conversations"),n=(0,r.query)(s,(0,r.where)("participants","array-contains",e),(0,r.orderBy)("updatedAt","desc"));return(0,r.onSnapshot)(n,async s=>{let r=[],a=new Map;for(let t of s.docs){let s=({id:t.id,...t.data()}).participants.find(t=>t!==e);s&&!a.has(s)&&a.set(s,o(s))}let n=new Map;for(let[e,t]of a)try{let s=await t;s&&n.set(e,s)}catch(t){console.error("Error fetching profile for user ".concat(e,":"),t)}for(let t of s.docs){let s={id:t.id,...t.data()},a=s.participants.find(t=>t!==e);if(!a)continue;let i=n.get(a);if(!i)continue;let l=await c(s.id,e);r.push({conversation:s,otherUser:{uid:i.uid,username:i.username,firstName:i.firstName,lastName:i.lastName},unreadCount:l})}t(r)})}catch(e){throw console.error("Error subscribing to conversations:",e),e}}async function f(e,t){try{let s=(0,r.collection)(a.db,"messages"),n=(0,r.query)(s,(0,r.where)("conversationId","==",e),(0,r.where)("receiverId","==",t),(0,r.where)("read","==",!1)),i=(await (0,r.getDocs)(n)).docs.map(e=>(0,r.updateDoc)(e.ref,{read:!0}));await Promise.all(i);let o="".concat(e,"-").concat(t);l.delete(o)}catch(e){throw console.error("Error marking messages as read:",e),e}}async function g(e,t){try{let s=(0,r.collection)(a.db,"messages"),n=(0,r.query)(s,(0,r.where)("conversationId","==",e),(0,r.where)("receiverId","==",t),(0,r.where)("read","==",!1));return(await (0,r.getDocs)(n)).size}catch(e){return console.error("Error getting unread message count:",e),0}}async function b(e){try{let t=(0,r.collection)(a.db,"messages"),s=(0,r.query)(t,(0,r.where)("receiverId","==",e),(0,r.where)("read","==",!1));return(await (0,r.getDocs)(s)).size}catch(e){return console.error("Error getting total unread count:",e),0}}},5664:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var r=s(5155),a=s(2115),n=s(5695),i=s(8731),l=s(3201),o=s(2897),c=s(8607);function d(e){let{conversations:t,selectedConversation:s,onConversationSelect:a,loading:n,isMobile:i=!1}=e,l=e=>{if(!e)return"";try{let t=e.toDate?e.toDate():new Date(e),s=(new Date().getTime()-t.getTime())/36e5;if(s<24)return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});if(s<168)return t.toLocaleDateString("en-US",{weekday:"short"});return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch(e){return console.warn("Error formatting timestamp:",e),""}},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;return e.length<=t?e:e.substring(0,t)+"..."};return n?(0,r.jsx)("div",{className:"p-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-3 mb-2",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full animate-pulse"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2 animate-pulse"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2 animate-pulse"})]})]},t))}):0===t.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No conversations yet"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Start a new conversation to get messaging."})]})}):(0,r.jsx)("div",{className:"".concat(i?"px-0":"p-0"),children:t.map(e=>{let t=(null==s?void 0:s.conversation.id)===e.conversation.id,n=e.conversation.lastMessage;return(0,r.jsx)("button",{onClick:()=>a(e),className:"w-full text-left p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors ".concat(t?"bg-blue-50 border-blue-200":""),children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.otherUser.firstName,e.otherUser.lastName)})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsxs)("p",{className:"text-sm font-medium truncate ".concat(e.unreadCount>0?"text-gray-900":"text-gray-700"),children:[e.otherUser.firstName," ",e.otherUser.lastName]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[e.unreadCount>0&&(0,r.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:e.unreadCount>99?"99+":e.unreadCount}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:l(n.timestamp)})]})]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("p",{className:"text-sm truncate ".concat(e.unreadCount>0?"text-gray-900 font-medium":"text-gray-500"),children:n.content?o(n.content):"No messages yet"})}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["@",e.otherUser.username]})]})]})},e.conversation.id)})})}var m=s(4744),u=s(6874),x=s.n(u);function h(e){let{profile:t,isOwn:s=!1}=e;return(0,r.jsxs)("div",{className:"max-w-sm mx-2 my-1 ".concat(s?"ml-auto":"mr-auto"),children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 border-b border-gray-100",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:(0,c.I)(t.firstName,t.lastName)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("h3",{className:"font-semibold text-gray-900 truncate",children:[t.firstName," ",t.lastName]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:["@",t.username]})]})]})}),(0,r.jsxs)("div",{className:"p-4",children:[t.bio&&(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-3 line-clamp-3",children:t.bio}),(0,r.jsxs)(x(),{href:"/user/".concat(encodeURIComponent(t.username.toLowerCase())),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"View Profile"]})]})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 text-center mt-1",children:"\uD83D\uDCCB Shared Profile"})]})}function f(e){let{users:t,onUserSelect:s,isLoading:a=!1,searchTerm:n}=e;return a?(0,r.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"Searching users..."})]})}):0===t.length&&n.length>0?(0,r.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:(0,r.jsxs)("div",{className:"text-sm text-gray-500 text-center",children:['No users found matching "@',n,'"']})}):0===t.length?null:(0,r.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 max-h-64 overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 font-medium mb-2 px-2",children:"People you can mention:"}),t.map(e=>(0,r.jsxs)("button",{onClick:()=>s(e),className:"w-full flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors text-left",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.firstName,e.lastName)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"font-medium text-gray-900 text-sm truncate",children:[e.firstName," ",e.lastName]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:["@",e.username]})]}),(0,r.jsx)("div",{className:"text-xs text-blue-600 font-medium",children:"Send Profile"})]},e.uid))]})})}function g(e){var t;let{conversation:s,currentUserId:n,isMobile:i=!1}=e,[l,d]=(0,a.useState)([]),[u,x]=(0,a.useState)(""),[g,b]=(0,a.useState)(!0),[p,v]=(0,a.useState)(!1),j=(0,a.useRef)(null),N=(0,a.useRef)(null),[y,w]=(0,a.useState)([]),[S,k]=(0,a.useState)(!1),[C,U]=(0,a.useState)(!1),[M,E]=(0,a.useState)("");(0,a.useEffect)(()=>{var e;if(null==s||null==(e=s.conversation)?void 0:e.id)return(0,o.SR)(s.conversation.id,e=>{d(e),b(!1),(0,o.iS)(s.conversation.id,n)})},[null==s||null==(t=s.conversation)?void 0:t.id,n]),(0,a.useEffect)(()=>{D()},[l]),(0,a.useEffect)(()=>{let e=setTimeout(async()=>{if(M.length>=2){U(!0);try{let e=(await (0,m.x5)(M)).filter(e=>e.uid!==n&&e.uid!==s.otherUser.uid);w(e)}catch(e){console.error("Error searching users for mention:",e),w([])}finally{U(!1)}}else w([])},300);return()=>clearTimeout(e)},[M,n,s.otherUser.uid]);let D=()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},I=async e=>{v(!0);try{await (0,o.$i)(s.conversation.id,s.otherUser.uid,{uid:e.uid,username:e.username,firstName:e.firstName,lastName:e.lastName,bio:e.bio}),x(""),k(!1),E(""),N.current&&N.current.focus()}catch(e){console.error("Error sending profile message:",e),alert("Failed to send profile. Please try again.")}finally{v(!1)}},L=async e=>{if(e.preventDefault(),u.trim()&&!p){v(!0);try{await (0,o._z)(s.conversation.id,s.otherUser.uid,u.trim()),x(""),k(!1),E(""),N.current&&N.current.focus()}catch(e){console.error("Error sending message:",e),alert("Failed to send message. Please try again.")}finally{v(!1)}}},T=e=>{if(!e)return"";try{let t=e.toDate?e.toDate():new Date(e);if((new Date().getTime()-t.getTime())/36e5<24)return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(e){return console.warn("Error formatting timestamp:",e),"Just now"}};return g?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Loading conversation..."})]})}):(0,r.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[!i&&(0,r.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(s.otherUser.firstName,s.otherUser.lastName)}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[s.otherUser.firstName," ",s.otherUser.lastName]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["@",s.otherUser.username]})]})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 ".concat(i?"pb-20":"pb-4"),children:[0===l.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl mx-auto mb-4",children:(0,c.I)(s.otherUser.firstName,s.otherUser.lastName)}),(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:[s.otherUser.firstName," ",s.otherUser.lastName]}),(0,r.jsxs)("p",{className:"text-gray-500 mb-4",children:["@",s.otherUser.username]}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Start the conversation with a message."})]})}):l.map((e,t)=>{let a=e.senderId===n,i=l[t-1],o=l[t+1],d=0===t||i&&e.timestamp&&i.timestamp&&Math.abs(e.timestamp.toMillis()-i.timestamp.toMillis())>3e5,m=!a&&(!o||o.senderId!==e.senderId||o&&o.timestamp&&e.timestamp&&Math.abs(o.timestamp.toMillis()-e.timestamp.toMillis())>3e5);return(0,r.jsxs)("div",{children:[d&&e.timestamp&&(0,r.jsx)("div",{className:"text-center text-xs text-gray-400 my-4",children:T(e.timestamp)}),(0,r.jsxs)("div",{className:"flex items-end ".concat(a?"justify-end":"justify-start space-x-2"," mb-1"),children:[m&&(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-xs flex-shrink-0 mb-1",children:(0,c.I)(s.otherUser.firstName,s.otherUser.lastName)}),!a&&!m&&(0,r.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),"profile"===e.type&&e.profileAttachment?(0,r.jsx)(h,{profile:e.profileAttachment,isOwn:a}):(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ".concat(a?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content}),!e.read&&!a&&(0,r.jsx)("div",{className:"text-xs text-blue-400 mt-1",children:"New"})]})]})]},e.id)}),(0,r.jsx)("div",{ref:j})]}),(0,r.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white ".concat(i?"pb-8":""),children:(0,r.jsxs)("div",{className:"relative",children:[S&&(0,r.jsx)(f,{users:y,onUserSelect:I,isLoading:C,searchTerm:M}),(0,r.jsxs)("form",{onSubmit:L,className:"flex space-x-3",children:[(0,r.jsx)("input",{ref:N,type:"text",value:u,onChange:e=>{let t=e.target.value;x(t);let s=t.lastIndexOf("@");if(-1!==s&&s===t.length-1)k(!0),E("");else if(-1!==s){let e=t.substring(s+1);e.length>0&&!e.includes(" ")?(k(!0),E(e)):e.includes(" ")&&(k(!1),E(""))}else k(!1),E("")},placeholder:"Message ".concat(s.otherUser.firstName,"... (Type @ to mention someone)"),className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p}),(0,r.jsx)("button",{type:"submit",disabled:!u.trim()||p,className:"px-6 py-2 bg-blue-600 text-white rounded-full font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors",children:p?(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Send"})]})]})})]})}function b(e){let{onClose:t,onConversationCreated:s}=e,[n]=(0,i.hD)(l.j2),[d,u]=(0,a.useState)(""),[x,h]=(0,a.useState)([]),[f,g]=(0,a.useState)(!1),[b,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=setTimeout(async()=>{if(!d.trim()||d.length<2)return void h([]);g(!0);try{let e=(await (0,m.x5)(d)).filter(e=>e.uid!==(null==n?void 0:n.uid));h(e)}catch(e){console.error("Error searching users:",e),h([])}finally{g(!1)}},300);return()=>clearTimeout(e)},[d,null==n?void 0:n.uid]);let v=async e=>{if(n&&!b){p(!0);try{let t={conversation:{id:await (0,o.FA)(n.uid,e.uid),participants:[n.uid,e.uid],lastMessage:{content:"",senderId:"",timestamp:new Date,read:!1},createdAt:new Date,updatedAt:new Date},otherUser:{uid:e.uid,username:e.username,firstName:e.firstName,lastName:e.lastName},unreadCount:0};s(t)}catch(e){console.error("Error creating conversation:",e),alert("Failed to start conversation. Please try again.")}finally{p(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,r.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[80vh] overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"New Message"}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Search for users...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto max-h-96",children:f?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Searching..."})]}):d.trim()&&d.length>=2?x.length>0?(0,r.jsx)("div",{className:"p-2",children:x.map(e=>(0,r.jsx)("button",{onClick:()=>v(e),disabled:b,className:"w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.firstName,e.lastName)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["@",e.username]}),e.bio&&(0,r.jsx)("p",{className:"text-xs text-gray-400 truncate mt-1",children:e.bio})]}),b&&(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})]})},e.uid))}):(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No users found"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Try searching with a different term."})]}):(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Search for users"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Type at least 2 characters to search for users to message."})]})})]})})}var p=s(2461),v=s(7765);function j(){let[e]=(0,i.hD)(l.j2),[t,s]=(0,a.useState)([]),[n,c]=(0,a.useState)(null),[m,u]=(0,a.useState)(!1),[x,h]=(0,a.useState)(!0),[f,j]=(0,a.useState)(0),[N,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=()=>{y(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{if(e)return(0,o.KB)(e.uid,e=>{s(e),h(!1)})},[e]),(0,a.useEffect)(()=>{if(!e)return;let t=async()=>{try{let t=await (0,o.zS)(e.uid);j(t)}catch(e){console.error("Error getting total unread count:",e)}};t();let s=setInterval(t,3e4);return()=>clearInterval(s)},[e,t]);let w=e=>{c(e)};return e?(0,r.jsxs)("div",{className:"h-screen flex bg-white",children:[N&&(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-white border-b border-gray-200 px-4 py-3",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{c(null)},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,r.jsx)(p.A,{className:"h-6 w-6 text-gray-700"})}),(0,r.jsxs)("div",{className:"flex-1 text-center",children:[(0,r.jsxs)("h1",{className:"text-lg font-semibold text-gray-900",children:[n.otherUser.firstName," ",n.otherUser.lastName]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["@",n.otherUser.username]})]}),(0,r.jsx)("div",{className:"w-10"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),(0,r.jsx)("button",{onClick:()=>u(!0),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,r.jsx)(v.A,{className:"h-6 w-6 text-blue-600"})})]})})}),N?(0,r.jsx)("div",{className:"flex-1 flex flex-col pt-16",children:n?(0,r.jsx)(g,{conversation:n,currentUserId:e.uid,isMobile:!0}):(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsx)(d,{conversations:t,selectedConversation:n,onConversationSelect:w,loading:x,isMobile:!0})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),(0,r.jsx)("button",{onClick:()=>u(!0),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"New message",children:(0,r.jsx)(v.A,{className:"h-5 w-5 text-blue-600"})})]}),f>0&&(0,r.jsxs)("p",{className:"text-sm text-blue-600 font-medium",children:[f," unread message",1!==f?"s":""]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,r.jsx)(d,{conversations:t,selectedConversation:n,onConversationSelect:w,loading:x})})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col",children:n?(0,r.jsx)(g,{conversation:n,currentUserId:e.uid}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Choose from your existing conversations or start a new one."})]})})})]}),m&&(0,r.jsx)(b,{onClose:()=>u(!1),onConversationCreated:e=>{c(e),u(!1)}})]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-gray-600",children:"Please log in to view messages."})})}function N(){let[e,t]=(0,i.hD)(l.j2);return t?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading messages..."})]})}):(e||(0,n.redirect)("/login"),(0,r.jsx)(j,{}))}},8607:(e,t,s)=>{"use strict";s.d(t,{I:()=>n,d:()=>a});var r=s(2115);let a=function(e,t){var s;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(null==e||null==(s=e.charAt(0))?void 0:s.toUpperCase())||"A",i=["#4f46e5","#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16"],l=t?Math.abs(t.charCodeAt(0)%i.length):0,o=i[l];return r.createElement("div",{style:{backgroundColor:o,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:a?"0.8rem":"1rem",width:a?"32px":"40px",height:a?"32px":"40px",borderRadius:"50%",flexShrink:0}},n)},n=(e,t)=>{var s,r;return((null==e||null==(s=e.charAt(0))?void 0:s.toUpperCase())||"")+((null==t||null==(r=t.charAt(0))?void 0:r.toUpperCase())||"")||"U"}},8718:(e,t,s)=>{Promise.resolve().then(s.bind(s,5664))}},e=>{var t=t=>e(e.s=t);e.O(0,[8096,4744,7358],()=>t(8718)),_N_E=e.O()}]);