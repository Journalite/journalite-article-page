(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9002],{1112:(e,n,t)=>{Promise.resolve().then(t.bind(t,9052))},3201:(e,n,t)=>{"use strict";t.d(n,{db:()=>c,j2:()=>l});var r=t(3915),o=t(6864),a=t(6597),i=t(5112);let s=(0,r.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,o.P5)(s)}catch(e){}let l=(0,a.getAuth)(s),c=(0,i.getFirestore)(s);window.location.origin},6121:(e,n,t)=>{"use strict";t.d(n,{J0:()=>r.useState,vJ:()=>r.useEffect});var r=t(2115)},8163:e=>{e.exports={"article-page":"home_article-page__CJrzD","three-column-layout":"home_three-column-layout__x41EQ","left-sidebar":"home_left-sidebar__MaSov","top-left-logo":"home_top-left-logo__JmZ4H","mobile-header-logo":"home_mobile-header-logo__B_8n9","toggle-button":"home_toggle-button__sVP2W","sidebar-footer":"home_sidebar-footer__Fj8FR","sidebar-collapse-button":"home_sidebar-collapse-button__W3ZL0","vertical-nav":"home_vertical-nav__Cj0En","nav-home":"home_nav-home__X8XEK","nav-icon":"home_nav-icon__yM4nn","nav-create":"home_nav-create__My7ng","nav-thoughts":"home_nav-thoughts__0rfq1","nav-trending":"home_nav-trending__ExDVC","nav-news":"home_nav-news___K3Hw","nav-explore":"home_nav-explore__bcQBn","nav-learn":"home_nav-learn__M1FC_","nav-signin":"home_nav-signin__tzTY_","nav-login":"home_nav-login__1lQUW","nav-link":"home_nav-link__6kEPW","nav-text":"home_nav-text__B7jdN",active:"home_active__S0jaV","profile-button":"home_profile-button__hzl_I","profile-dropdown":"home_profile-dropdown__Y5WsU",open:"home_open__XfBoq","profile-dropdown-item":"home_profile-dropdown-item__evd8S","profile-dropdown-separator":"home_profile-dropdown-separator___NXrk","center-column":"home_center-column__eaxY9",expanded:"home_expanded__mJRm4",loading:"home_loading__D6__B",centerSearchContainer:"home_centerSearchContainer__IOa3K",centerSearchWrapper:"home_centerSearchWrapper__NNrYK",focused:"home_focused__5YCO2","holographic-shine":"home_holographic-shine__x_mJJ",searchIcon:"home_searchIcon__xc0XK",centerSearchInput:"home_centerSearchInput__48wSR",searchLoadingIcon:"home_searchLoadingIcon__k5Sm7",centerSearchResults:"home_centerSearchResults__nuYpC",slideDown:"home_slideDown__8UuRE",shimmer:"home_shimmer__Qx0I4",centerSearchResultItem:"home_centerSearchResultItem__bn8jP",resultUserAvatar:"home_resultUserAvatar__UWdCO",resultUserInfo:"home_resultUserInfo__OeoCv",resultUserName:"home_resultUserName___o7C3",resultUserUsername:"home_resultUserUsername__7tLvP",centerSearchNoResults:"home_centerSearchNoResults__qKulK","featured-card":"home_featured-card__r3SXe","featured-content":"home_featured-content__gbOMz","featured-image":"home_featured-image__3DBbZ","cover-image":"home_cover-image___ZInI","featured-label":"home_featured-label__z2IzP","featured-title":"home_featured-title__qNCn0","featured-meta":"home_featured-meta__Lq6uD","featured-excerpt":"home_featured-excerpt__dhAPX","read-link":"home_read-link___6ZMN","article-grid":"home_article-grid__mC5EI","article-card":"home_article-card__fzb4w","article-title":"home_article-title__toAvL","article-meta":"home_article-meta__9UhXG","article-excerpt":"home_article-excerpt__kuCuZ","article-tags":"home_article-tags__VxN88",tag:"home_tag__LEtq4","reaction-bar":"home_reaction-bar__Y0gsv","reaction-button":"home_reaction-button__KLD0h","reaction-icon":"home_reaction-icon__vhB0y","right-sidebar":"home_right-sidebar__e_5Hr","sidebar-heading":"home_sidebar-heading__lega4","tag-list":"home_tag-list__fgeEi","trending-tag":"home_trending-tag__0awB8","write-button":"home_write-button__Gowtg","edit-button":"home_edit-button__RsQLX","quote-card":"home_quote-card__LAcHm","quote-tag":"home_quote-tag__AukSw","article-container":"home_article-container__RCmcS","article-header":"home_article-header__mdTUd","article-content":"home_article-content__HUOVu","article-paragraph":"home_article-paragraph__6t7oy","article-cover-image":"home_article-cover-image__KDspQ","bottom-navigation":"home_bottom-navigation__mzhzv","bottom-nav-item":"home_bottom-nav-item__TX_Qx","bottom-nav-icon":"home_bottom-nav-icon__tNRlA","bottom-nav-text":"home_bottom-nav-text__AyeB6",header:"home_header__PUC5f",logo:"home_logo__fwoF8",hero:"home_hero__3iLRs","hero-title":"home_hero-title__tuN3q","hero-subtitle":"home_hero-subtitle__cyiJZ","cta-button":"home_cta-button__X8xB1","main-grid":"home_main-grid__qFsbA","section-title":"home_section-title__wEK3N","article-tag":"home_article-tag__m6NuJ","author-info":"home_author-info__Xw67P","author-avatar":"home_author-avatar__kBH_g","author-name":"home_author-name__vEgN7",topics:"home_topics__lPwTP","topic-tag":"home_topic-tag__LL122","trending-list":"home_trending-list__YinkY",writers:"home_writers__2u4IP","writer-item":"home_writer-item__1jEW3","writer-info":"home_writer-info__OG3R7","writer-avatar":"home_writer-avatar__b69xH","writer-name":"home_writer-name__McEqt","follow-button":"home_follow-button__UX_LS",features:"home_features__Uc1bS","feature-title":"home_feature-title__9pzGT","feature-desc":"home_feature-desc__jOby5",footer:"home_footer__1HL_E","menu-overlay":"home_menu-overlay__S__PE",fadeIn:"home_fadeIn__uLm0f",articleFormContainer:"home_articleFormContainer__DSMnb",articleFormHeader:"home_articleFormHeader__yeH26",articleFormTitle:"home_articleFormTitle__B11fv",articleFormSubtitle:"home_articleFormSubtitle__XZLCa",articleForm:"home_articleForm__qtKbt",formGroup:"home_formGroup__dX_8o",formLabel:"home_formLabel__qdIcu",optionalLabel:"home_optionalLabel__U0gvl",formControl:"home_formControl__Cf48C",formTextarea:"home_formTextarea__tVyby",formActions:"home_formActions__BdMyR",cancelButton:"home_cancelButton__docpL",submitButton:"home_submitButton__gVGwS",errorAlert:"home_errorAlert__tVY_A",errorIcon:"home_errorIcon__gc9ZB",imagePreview:"home_imagePreview__zqwvQ",tagsPreview:"home_tagsPreview__V6lf7",container:"home_container__TLSt1","writing-tips":"home_writing-tips__2ODsS","writing-tip":"home_writing-tip__dmGLE",loginLink:"home_loginLink__imUQF",discussionSection:"home_discussionSection__0Ifpl",discussionTitle:"home_discussionTitle__O3EuW",commentForm:"home_commentForm__zAQrR",commentInputContainer:"home_commentInputContainer__gKx6N",commentAvatar:"home_commentAvatar__T8zJ0",replyAvatar:"home_replyAvatar___kB3f",commentInputWrapper:"home_commentInputWrapper__hxZkN",commentInput:"home_commentInput__uUtg_",replyInput:"home_replyInput__rYKdQ",commentActions:"home_commentActions__OO9jZ",replyActions:"home_replyActions__p9B_f",submitReplyButton:"home_submitReplyButton__BdUJ2",cancelReplyButton:"home_cancelReplyButton__XvM8F",loginPrompt:"home_loginPrompt__w4N0u",loginPromptButtons:"home_loginPromptButtons__snC_B",loginButton:"home_loginButton__YS1MQ",closePromptButton:"home_closePromptButton__QYTJ8",errorMessage:"home_errorMessage__9Ki1b",loadingSpinner:"home_loadingSpinner__peANt",spin:"home_spin__D0mwY",noComments:"home_noComments__850HV",commentsList:"home_commentsList__fRn9g",commentItem:"home_commentItem__L5fNy",commentHeader:"home_commentHeader___Zk6a",replyHeader:"home_replyHeader__f7TaG",commentMeta:"home_commentMeta__MJRA8",replyMeta:"home_replyMeta__ve_YC",commentAuthor:"home_commentAuthor__HPgNT",replyAuthor:"home_replyAuthor__2Brdn",commentDate:"home_commentDate__VBAuX",replyDate:"home_replyDate__y0RtU",commentContent:"home_commentContent__uzL9r",replyContent:"home_replyContent__HFiXM",commentControls:"home_commentControls__ebC_D",likeButton:"home_likeButton__gtW9b",replyButton:"home_replyButton__e_FYj",toggleRepliesButton:"home_toggleRepliesButton__UC2Rk",deleteButton:"home_deleteButton__VEIPc",liked:"home_liked__LMNuR",replyForm:"home_replyForm__CpHFF",replyInputContainer:"home_replyInputContainer__3_T0M",repliesList:"home_repliesList__TjSoC",replyItem:"home_replyItem__TadHa",profileHeader:"home_profileHeader__N2hD3",profileAvatar:"home_profileAvatar__zAfHf",avatarPlaceholder:"home_avatarPlaceholder__mh9Xc",profileInfo:"home_profileInfo__tQtas",profileName:"home_profileName__7mtlO",profileUsername:"home_profileUsername__ACE_Q",profileBio:"home_profileBio__pKxZ3",sectionHeading:"home_sectionHeading__F_a8F",profileContent:"home_profileContent__a6u08",emptyState:"home_emptyState__0oCVS",sidebarSection:"home_sidebarSection__cyQHn",backLink:"home_backLink__Anavd","article-image":"home_article-image__mOEoE",searchContainer:"home_searchContainer__NcXe2",searchInputWrapper:"home_searchInputWrapper__jDfiT",searchInput:"home_searchInput__D6QYE",clearSearchButton:"home_clearSearchButton__XEPTo",searchResultsContainer:"home_searchResultsContainer__aOrYe",searchResultsTitle:"home_searchResultsTitle__KjT7N",backToAllButton:"home_backToAllButton__ShJnS",searchResults:"home_searchResults__sWgqy",searchResultItem:"home_searchResultItem__CuGQu",searchResultAvatar:"home_searchResultAvatar__QRukz",adminAvatar:"home_adminAvatar__5I7Wp",developerAvatar:"home_developerAvatar__YWLjR",userAvatar:"home_userAvatar__sJEnc",searchResultInfo:"home_searchResultInfo__vOptx",searchResultName:"home_searchResultName__yMZVz",searchResultUsername:"home_searchResultUsername__oQ4tk",searchResultRole:"home_searchResultRole__E5rB8",searchResultRoleAdmin:"home_searchResultRoleAdmin__58nmi",searchResultRoleDeveloper:"home_searchResultRoleDeveloper__D6KaE",searchResultRoleUser:"home_searchResultRoleUser__P_B5t",roleTag:"home_roleTag__X3nyq",noResults:"home_noResults__VKSke",tabContainer:"home_tabContainer__WiCFt",tabButton:"home_tabButton___0LSM",activeTab:"home_activeTab___peId",docsContainer:"home_docsContainer__uFnrg",userManagementContainer:"home_userManagementContainer__d8zKX",sectionTitle:"home_sectionTitle___LoW8",statsContainer:"home_statsContainer__Ecxt0",statBox:"home_statBox__sOuzf",statNumber:"home_statNumber__0HaRO",statLabel:"home_statLabel___lx3s",usersTableContainer:"home_usersTableContainer__xgtQE",usersTable:"home_usersTable__UQjnE",roleSelect:"home_roleSelect__85R__",documentationContainer:"home_documentationContainer__3hhXs",docSidebar:"home_docSidebar__NjNVF",docSearchContainer:"home_docSearchContainer__2oA__",docSearchInput:"home_docSearchInput__YwfD7",docNav:"home_docNav__TyBYN",docNavItem:"home_docNavItem__wzbPN",docNavItemActive:"home_docNavItemActive__2G1E0",docContent:"home_docContent__HO1_Q",docTitle:"home_docTitle__IElVr",docSubheading:"home_docSubheading__qezFR",docText:"home_docText__pOq_f",codeBlock:"home_codeBlock__2XLSi",codeBlockContainer:"home_codeBlockContainer__m8biO",codeLineNumbers:"home_codeLineNumbers___g0z3",codeContent:"home_codeContent__8Ufq0",keyword:"home_keyword__xcIYJ",string:"home_string__IDzCq",comment:"home_comment___nq3w",function:"home_function__lPtv4",type:"home_type__Ot2EV",variable:"home_variable__V9b_I",number:"home_number__EdK6u",operator:"home_operator__4A6PV",copyButton:"home_copyButton__FJrSq",alertInfo:"home_alertInfo__DNxOh",alertWarning:"home_alertWarning__h5lMU",alertSuccess:"home_alertSuccess__VNous",userTableCell:"home_userTableCell__EfMXq","tag-header":"home_tag-header__V7Fnc",highlight:"home_highlight__wsiMU","tag-description":"home_tag-description___G1Ky","back-link":"home_back-link__nWn7j","no-results":"home_no-results__lv_Xi","explore-header":"home_explore-header__EECf8","explore-title":"home_explore-title__FCgPB","explore-subtitle":"home_explore-subtitle__n2Hy_","explore-container":"home_explore-container__RUVLK","explore-section":"home_explore-section__kWWcA","featured-articles-grid":"home_featured-articles-grid__Fow9u","feature-large":"home_feature-large__V74KX","tags-selector":"home_tags-selector__Bw1Pi","tag-button":"home_tag-button__xESQB","tag-button-active":"home_tag-button-active__cuvxR",fullWidthContainer:"home_fullWidthContainer__bH7VI",editorHeader:"home_editorHeader__nxAUv",backButton:"home_backButton__7YWR2",editorContainer:"home_editorContainer__TTjO_","glass-container":"home_glass-container__DeqYo","glass-highlight":"home_glass-highlight__M6PuC","glass-content":"home_glass-content__1NgZn","glass-button":"home_glass-button__CVS9T","glass-button-primary":"home_glass-button-primary__o3Eea","glass-button-success":"home_glass-button-success__Tju00","glass-button-danger":"home_glass-button-danger__QrAXi","glass-card":"home_glass-card__xqfi9","glass-card-highlight":"home_glass-card-highlight__U_WWE","glass-modal-overlay":"home_glass-modal-overlay__P9nln","glass-modal":"home_glass-modal__ujLH0","glass-nav-container":"home_glass-nav-container__s_3lM","glass-nav-button":"home_glass-nav-button___HD46","glass-notification-unread":"home_glass-notification-unread__Ddf3D","glass-notification-read":"home_glass-notification-read__Bz8wx","glass-tag":"home_glass-tag__ic8iV","glass-tag-warning":"home_glass-tag-warning__1z0Xj","glass-loading":"home_glass-loading___OOS7","glass-empty-state":"home_glass-empty-state__ngWuT","glass-profile-container":"home_glass-profile-container__Ofhd4","glass-profile-header":"home_glass-profile-header__0xqky","hero-section":"home_hero-section__Y_MsR","hero-content":"home_hero-content__qSy8f","hero-actions":"home_hero-actions__4N0MP","cta-primary":"home_cta-primary__JWvSf","cta-secondary":"home_cta-secondary__a82JD","welcome-section":"home_welcome-section__ps188","welcome-content":"home_welcome-content__uyEqH","welcome-title":"home_welcome-title__F3lwk","welcome-subtitle":"home_welcome-subtitle__q_Mxl","quick-actions":"home_quick-actions__xRocK","action-button":"home_action-button__odKHJ","action-icon":"home_action-icon__Z0oDA","featured-section":"home_featured-section__EY05E","section-header":"home_section-header__J4AZr","view-all-link":"home_view-all-link__W_xyn","featured-grid":"home_featured-grid__hEAIa","featured-article-card":"home_featured-article-card__lFaF9","source-badge-container":"home_source-badge-container__2VoJ1","source-badge":"home_source-badge__qWpaZ","article-actions":"home_article-actions__P1IW0","read-button":"home_read-button__YIoFw","share-button":"home_share-button__IITaK","features-section":"home_features-section__nhGfY","features-title":"home_features-title__iMJJd","features-grid":"home_features-grid__cfKV9","feature-card":"home_feature-card__Wk2KA","feature-icon":"home_feature-icon__FQHqE","feature-description":"home_feature-description__Vg3Yo"}},9052:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>h});var r=t(5155),o=t(6121),a=t(5695),i=t(5112),s=t(3201),l=t(6597),c=t(8163),d=t.n(c);let u=[{id:"project-structure",title:"Project Structure",content:"\n## Directory Structure\n\n```tsx\n/src\n  /app                  # Next.js App Router pages\n    /articles           # Article-related routes\n    /dev                # Developer documentation (this page)\n    /login              # Authentication pages\n    /my-profile         # User profile pages\n    /user               # User public profile pages\n  /components           # Reusable React components\n    ArticleForm.tsx     # Form for creating/editing articles\n    CommentSection.tsx  # Comment functionality for articles\n    LeftSidebar.tsx     # Navigation sidebar\n    UserSearch.tsx      # Search functionality for users\n  /firebase             # Firebase configuration and utilities\n    articles.ts         # Article-related Firebase functions\n    clientApp.ts        # Firebase initialization\n    notifications.ts    # Notification system\n  /services             # Business logic services\n    articleService.ts   # Article-related business logic\n    userService.ts      # User-related business logic\n    audioService.ts     # Audio feature functionality\n  /styles               # Global and component styles\n  /types                # TypeScript type definitions\n```\n\n## Key Files Explained\n\n- `app/layout.tsx`: Main application layout with authentication context\n  - Wraps the entire app with auth providers\n  - Contains global navigation components\n  - Handles theme and responsiveness\n\n- `app/page.tsx`: Homepage with article feed\n  - Fetches and displays latest articles\n  - Shows featured content\n  - Handles different user states (authenticated vs guest)\n\n- `firebase/clientApp.ts`: Firebase configuration and initialization\n  - Sets up Firebase SDK with environment variables\n  - Initializes Firestore, Auth, and Storage\n  - Provides exported instances to the rest of the app\n\n- `components/LeftSidebar.tsx`: Main navigation with user search\n  - Collapsible sidebar with responsive behavior\n  - Integrates user search functionality\n  - Shows different options based on auth state\n\n- `components/ArticleForm.tsx`: Form for creating/editing articles\n  - Rich text editor integration\n  - Image upload capabilities\n  - Draft saving and publishing options\n  "},{id:"firebase-logic",title:"Firebase Logic",content:"\n## Authentication\n\nThe app uses Firebase Authentication with email/password and supports:\n- User registration with email verification\n- Password reset flows\n- Session persistence across browser sessions\n- Protected routes with role-based access\n\n### Authentication Flow\n\n```tsx\n// Example from login page\nimport { signInWithEmailAndPassword } from 'firebase/auth';\nimport { auth } from '@/firebase/clientApp';\n\n// Sign in\nconst signIn = async (email, password) => {\n  try {\n    // Attempt to authenticate with Firebase\n    await signInWithEmailAndPassword(auth, email, password);\n    \n    // Redirect to home page after successful login\n    router.push('/');\n  } catch (error) {\n    // Handle specific error codes\n    const errorCode = error.code;\n    switch(errorCode) {\n      case 'auth/user-not-found':\n        setError('No user found with this email');\n        break;\n      case 'auth/wrong-password':\n        setError('Incorrect password');\n        break;\n      default:\n        setError('Failed to sign in: ' + error.message);\n    }\n  }\n};\n```\n\n## Firestore Database\n\nData is organized in the following collections:\n\n1. `users/{uid}`\n   - User profile data\n   - Role-based access control\n   - References to created articles\n\n2. `articles/{articleId}`\n   - Article content, metadata\n   - Author reference\n   - Publication status (draft/published)\n   - Read count and likes\n\n3. `comments/{commentId}`\n   - Comment content\n   - References to articles and authors\n   - Timestamp and like count\n\n4. `notifications/{notificationId}`\n   - User notifications\n   - References to triggering events\n   - Read status tracking\n\n### Example Firestore Query\n\n```tsx\n// Fetch user articles\nimport { collection, query, where, getDocs, orderBy } from 'firebase/firestore';\nimport { db } from '@/firebase/clientApp';\n\nconst fetchUserArticles = async (userId) => {\n  try {\n    // Reference to articles collection\n    const articlesRef = collection(db, 'articles');\n    \n    // Create query for the user's articles, ordered by date\n    const q = query(\n      articlesRef, \n      where('authorId', '==', userId),\n      orderBy('createdAt', 'desc')\n    );\n    \n    // Execute the query\n    const querySnapshot = await getDocs(q);\n    \n    // Map the results to a more usable format\n    return querySnapshot.docs.map(doc => ({ \n      id: doc.id, \n      ...doc.data() \n    }));\n  } catch (error) {\n    console.error('Error fetching user articles:', error);\n    throw error;\n  }\n};\n```\n  "},{id:"user-onboarding-improvements",title:"User Onboarding Flow & Interest Selection",content:"\n## User Onboarding Flow & Interest Selection\n\nThe user onboarding process has been enhanced to include an interest selection step, aiming to personalize the user\\'s initial experience. This is a new area and is open to future tweaks and improvements.\n\n### Onboarding Steps:\n\n1.  **Registration (`/register`):**\n    *   Users can sign up via Email/Password or Google.\n    *   **Email/Password:** Upon successful form submission and profile data creation (`firstName`, `lastName`, `username`, `email`), users are redirected to `/select-interests`. Email verification is still sent but is a parallel step.\n    *   **Google Sign-up:**\n        *   If a new user\\'s Google email can be used to form an available username, their basic profile is created, and they are redirected to `/select-interests`.\n        *   If the auto-generated username is taken, a temporary profile is created, and the user is redirected to `/profile-setup` to choose a username. Upon completion, they are then redirected to `/select-interests`.\n\n2.  **Profile Setup (`/profile-setup`):**\n    *   This page is primarily for users (especially new Google sign-ups with clashing usernames) to set or confirm their `firstName`, `lastName`, and `username`.\n    *   Their `email` is pre-filled.\n    *   Upon successful submission, the user profile is updated/created in Firestore, and the user is redirected to `/select-interests`.\n\n3.  **Interest Selection (`/select-interests`):**\n    *   Accessible at `/select-interests`.\n    *   Users are prompted to select a minimum number of interests (e.g., 3) from a predefined list.\n    *   Selected interests are saved to the user\\'s profile in Firestore via the `updateUserInterests` function in `userService.ts`. The `UserProfile` interface now includes an `interests?: string[]` field.\n    *   After submitting interests, users are redirected to the homepage (`/`).\n\n### Key Files & Logic:\n\n*   **`src/app/register/page.tsx`**: Handles initial registration and redirection logic.\n*   **`src/app/profile-setup/page.tsx`**: Handles user profile finalization.\n*   **`src/app/select-interests/page.tsx`**: New page for interest selection UI and logic.\n*   **`src/services/userService.ts`**:\n    *   `UserProfile` interface updated with `interests`.\n    *   `updateUserInterests(uid, interests)` function added.\n*   **Redirection Flow:** Carefully orchestrated to guide new users through profile creation/confirmation and then interest selection before landing on the main application.\n\n### Future Considerations:\n\n*   Making the list of interests dynamic (fetched from Firestore).\n*   Allowing users to skip interest selection.\n*   Enabling users to edit their interests later (e.g., in their profile settings).\n*   Refining the email verification step in relation to the new flow.\n  "},{id:"auth-styling-enhancements",title:"Authentication UI & Styling Enhancements",content:'\n## Authentication UI & Styling Enhancements\n\nThe authentication pages (Login, Register, Forgot Password, Reset Password) have been significantly redesigned for a more modern, user-friendly, and consistent look and feel.\n\n### Key Changes:\n\n1.  **Centralized Layout (`AuthLayout.tsx`):**\n    *   A new `AuthLayout` component (`src/components/AuthLayout.tsx`) has been created to provide a consistent wrapper for all auth-related pages.\n    *   This layout includes:\n        *   A clean, centered card for the form content.\n        *   The Journalite logo.\n        *   A brief introductory text or page title.\n        *   Links for alternative actions (e.g., "Don\'t have an account? Sign Up" or "Back to Login").\n    *   The layout uses CSS Modules (`AuthLayout.module.css`) for styling.\n\n2.  **Modernized Form Styling (`AuthForm.module.css`):**\n    *   A dedicated CSS Module (`AuthForm.module.css`) is used to style the forms within auth pages.\n    *   Inputs, buttons, and error messages now have a more refined and modern appearance.\n    *   Focus states are improved for better accessibility.\n    *   The color scheme aligns with the Journalite theme (amber and stone).\n\n3.  **Improved User Experience:**\n    *   Clearer visual hierarchy and spacing.\n    *   Consistent branding across all auth screens.\n    *   Responsive design ensures a good experience on all device sizes.\n\n4.  **Page-Specific Updates:**\n    *   **Login (`src/app/login/page.tsx`):** Uses `AuthLayout` and `AuthForm` styles.\n    *   **Register (`src/app/register/page.tsx`):** Updated to use `AuthLayout`. Form fields (First Name, Last Name, Username, Email, Password) are styled consistently.\n    *   **Forgot Password (`src/app/forgot-password/page.tsx`):** Uses `AuthLayout`.\n    *   **Reset Password (`src/app/reset-password/page.tsx`):** Uses `AuthLayout`.\n\n### Implementation Details:\n\n*   Each auth page (e.g., `login/page.tsx`) now wraps its content with `<AuthLayout title="..." description="...">...</AuthLayout>`.\n*   Form elements within these pages use class names from `AuthForm.module.css`.\n*   The global `globals.css` and `home.module.css` might still apply some base styles, but auth-specific styling is largely encapsulated.\n\n### Example Usage (Login Page):\n\n```tsx\n// src/app/login/page.tsx\nimport AuthLayout from \'@/components/AuthLayout\';\nimport styles from \'@/styles/AuthForm.module.css\'; // For form elements\n\nexport default function LoginPage() {\n  // ... login logic ...\n  return (\n    <AuthLayout title="Welcome Back" description="Log in to continue to Journalite.">\n      <form onSubmit={handleLogin} className={styles.form}>\n        {/* ... form inputs and button ... */}\n      </form>\n    </AuthLayout>\n  );\n}\n```\n  '},{id:"feature-updates",title:"Feature Updates",content:'\n## Explore Page Implementation\n\nA new "Explore" page has been added to Journalite, designed to help users discover a wide range of articles.\n\n### Key Features:\n\n*   **Route:** Accessible at `/explore`.\n*   **Layout:** Utilizes the existing three-column layout (Left Sidebar, Main Content, Right Sidebar).\n*   **Content Fetching:** Fetches up to 30 articles using the `getArticles` function from `src/firebase/articles.ts`.\n*   **Categorization:** Articles are organized into sections:\n    *   **Featured Stories:** Displays the first 4 articles, with the first article highlighted in a larger format.\n    *   **Trending Now:** Shows up to 6 articles, sorted by a combination of view counts and likes.\n    *   **Recently Published:** Displays up to 8 of the latest articles.\n    *   **Explore by Topic:** Allows users to select a tag (e.g., Technology, Writing) and view up to 6 articles related to that tag. The `getArticlesByTag` function is used here.\n*   **Structure:**\n    *   `src/app/explore/page.tsx`: The main page component, acts as a wrapper.\n    *   `src/app/explore/ExploreClient.tsx`: A client component that handles all the logic, data fetching, state management (selected tags, loading states, etc.), and rendering of the explore page sections and article cards.\n*   **Styling:** New CSS styles have been added to `src/styles/home.module.css` to support the layout and appearance of the Explore page, including:\n    *   `.explore-header`, `.explore-title`, `.explore-subtitle`\n    *   `.explore-container`, `.explore-section`, `.section-title`\n    *   `.featured-articles-grid`, `.feature-large` (for the prominent featured article)\n    *   `.tags-selector`, `.tag-button`, `.tag-button-active`\n    *   Responsive styles to ensure good display on various screen sizes.\n*   **Functionality:** Includes standard article card features like displaying author, reading time, excerpt, tags, and reaction buttons (like, share). The share modal functionality is also integrated.\n\n## Home Feed Differentiation\n\nWith the introduction of a comprehensive Explore page, the Home Feed (`/`) can now focus on a more personalized user experience.\n\n### Potential Home Feed Strategies:\n\n*   **Personalized Recommendations:** Articles based on reading history, liked content, or followed tags/authors.\n*   **"For You" Section:** A curated feed algorithmically tailored to individual user preferences.\n*   **Following Feed:** Content from authors or topics the user explicitly follows.\n*   **Community Activity:** Articles trending within the user\'s network or recently interacted with by people they follow.\n*   **Mixture:** A combination of personalized content, latest articles from followed sources, and some general trending/popular articles to ensure discovery.\n\nThe goal is to make the Home Feed a dynamic and relevant starting point for users, while the Explore page serves as a broader discovery tool.\n  '},{id:"article-system",title:"Article System",content:"\n## Article Lifecycle\n\nArticles in Journalite follow this lifecycle:\n1. **Creation**: Author creates content using the ArticleForm component\n2. **Draft**: Article is saved but not visible to other users\n3. **Published**: Article is made available to all users\n4. **Updated**: Author can edit and update the article after publishing\n5. **Deleted**: Article is removed from the system\n\n## Article Creation Flow\n\nThe `ArticleForm` component handles article creation with these features:\n- Rich text editor with formatting options\n- Draft saving with auto-save capability\n- Image upload and embedding\n- Form validation\n- Tag selection and categorization\n\n```tsx\n// ArticleForm.tsx - Core submission logic\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { createArticle } from '@/services/articleService';\nimport { useAuth } from '@/hooks/useAuth';\n\nconst ArticleForm = () => {\n  const { user } = useAuth();\n  const router = useRouter();\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [tags, setTags] = useState([]);\n  const [coverImage, setCoverImage] = useState(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState(null);\n  \n  // Handle form submission\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!title || !content) {\n      setError('Title and content are required');\n      return;\n    }\n    \n    setIsSubmitting(true);\n    setError(null);\n    \n    try {\n      // Create article in Firestore\n      const newArticleRef = await createArticle({\n        title,\n        content,\n        authorId: user.uid,\n        status: 'published',\n        tags,\n        coverImage: coverImage ? await uploadImage(coverImage) : null,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        readCount: 0,\n        likes: 0,\n      });\n      \n      // Redirect to the new article\n      router.push(`/articles/${newArticleRef.id}`);\n    } catch (error) {\n      console.error('Error creating article:', error);\n      setError('Failed to create article. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  \n  // Save as draft functionality\n  const saveDraft = async () => {\n    // Similar to handleSubmit but with status: 'draft'\n  };\n  \n  return (\n    <form onSubmit={handleSubmit}>\n      {/* Form fields for title, content, tags, image upload */}\n      {/* Submit and Save Draft buttons */}\n    </form>\n  );\n};\n```\n\n## Article Feed Population\n\nThe home feed is populated with articles using these key techniques:\n- Querying published articles sorted by date\n- Pagination using Firebase query cursors\n- Optional filtering by tags or categories\n- Featured articles with special prominence\n\n```tsx\n// Home page article fetching\nimport { collection, query, where, orderBy, limit, getDocs, startAfter } from 'firebase/firestore';\nimport { db } from '@/firebase/clientApp';\n\n// Initial article fetch\nconst fetchArticles = async (pageSize = 10) => {\n  try {\n    const articlesRef = collection(db, 'articles');\n    \n    // Get published articles, ordered by date\n    const q = query(\n      articlesRef,\n      where('status', '==', 'published'),\n      orderBy('createdAt', 'desc'),\n      limit(pageSize)\n    );\n    \n    const querySnapshot = await getDocs(q);\n    const articles = querySnapshot.docs.map(doc => ({ \n      id: doc.id, \n      ...doc.data() \n    }));\n    \n    // Store the last document for pagination\n    const lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];\n    \n    return { articles, lastVisible };\n  } catch (error) {\n    console.error('Error fetching articles:', error);\n    throw error;\n  }\n};\n\n// Load more articles (pagination)\nconst loadMoreArticles = async (lastVisible, pageSize = 10) => {\n  try {\n    const articlesRef = collection(db, 'articles');\n    \n    const q = query(\n      articlesRef,\n      where('status', '==', 'published'),\n      orderBy('createdAt', 'desc'),\n      startAfter(lastVisible), // Start after the last article we fetched\n      limit(pageSize)\n    );\n    \n    const querySnapshot = await getDocs(q);\n    const newArticles = querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n    \n    const newLastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];\n    \n    return { articles: newArticles, lastVisible: newLastVisible };\n  } catch (error) {\n    console.error('Error loading more articles:', error);\n    throw error;\n  }\n};\n```\n\n## Article Rendering\n\nArticles are rendered using the `RenderArticle` component that handles:\n- Markdown or rich text formatting\n- Embedded images and media\n- Code highlighting for technical content\n- Comment section integration\n- Social sharing options\n\n## Comment System\n\nEach article has a comment section allowing:\n- Nested comments (replies)\n- User avatars and profile links\n- Markdown formatting in comments\n- Likes and other reactions\n  "},{id:"user-profiles",title:"User Profiles & Social Features",content:'\n## User Profile System\n\nThe user profile system in Journalite provides comprehensive functionality for viewing user information, their published articles, and social connections.\n\n### Profile Pages Structure\n\n- **Main Profile Page**: Displays user info, articles, and sidebar with followers/following\n- **Followers Page**: Shows all users who follow the profile owner\n- **Following Page**: Shows all users the profile owner follows\n\n### Components Structure\n\n1. `ProfileClient`: Main profile page client component\n   - Fetches and displays user data and their articles\n   - Includes sidebar with followers/following preview\n\n2. `FollowersClient` & `FollowingClient`: Full pages for followers/following\n   - Show complete lists with pagination\n   - Include follow buttons for each user\n\n3. `FollowersList` & `FollowingList`: Reusable components for profile sidebar\n   - Show preview of followers/following (limited to 5)\n   - Include "See all" links to full pages\n   - Handle proper truncation of long usernames\n\n### Profile Page Implementation\n\n```tsx\n// Simple version of the profile page server component\nimport ProfileClient from \'@/components/ProfileClient\';\n\nexport default function UserProfilePage({ params }: { params: { username: string } }) {\n  return <ProfileClient username={params.username} />;\n}\n```\n\n## Following System\n\nThe following system allows users to follow other users, creating a social network aspect to the platform.\n\n### Database Structure\n\n1. `users/{userId}/following/{followedUserId}`: Documents tracking who a user follows\n2. `users/{userId}/followers/{followerUserId}`: Documents tracking who follows a user\n3. `users/{userId}.followingCount` & `users/{userId}.followersCount`: Counter fields for quick access\n\n### Following List Component\n\n```tsx\n// Simplified FollowingList component\nconst FollowingList = ({ userId, maxDisplay = 5, username }) => {\n  const [following, setFollowing] = useState([]);\n  const [totalCount, setTotalCount] = useState(0);\n  \n  // Fetch following users\n  useEffect(() => {\n    const fetchFollowing = async () => {\n      try {\n        const followingList = await getFollowing(userId, maxDisplay);\n        setFollowing(followingList);\n        \n        // Get total count for "See all" logic\n        if (followingList.length > 0 && \'followingCount\' in followingList[0]) {\n          setTotalCount(followingList[0].followingCount || 0);\n        } else {\n          setTotalCount(Math.max(maxDisplay, followingList.length));\n        }\n      } catch (err) {\n        console.error(\'Error fetching following:\', err);\n      }\n    };\n\n    fetchFollowing();\n  }, [userId, maxDisplay]);\n  \n  // Get the display username for the See More link\n  const displayUsername = username || (following.length > 0 ? following[0].username : \'\');\n  \n  return (\n    <div className="space-y-4">\n      {following.map((user) => (\n        <div key={user.uid} className="flex items-center justify-between">\n          {/* User info */}\n          <Link href={`/user/${user.username}`} className="flex items-center group flex-1 min-w-0 mr-2 overflow-hidden">\n            <div className="avatar">\n              {user.firstName.charAt(0)}{user.lastName.charAt(0)}\n            </div>\n            <div className="overflow-hidden max-w-[calc(100%-45px)]">\n              <div className="truncate">{user.firstName} {user.lastName}</div>\n              <div className="truncate">@{user.username}</div>\n            </div>\n          </Link>\n          \n          {/* Follow button */}\n          <FollowButton \n            targetUserId={user.uid} \n            targetUsername={user.username}\n            className="flex-shrink-0 min-w-[70px]"\n          />\n        </div>\n      ))}\n      \n      {/* "See all" link when there are more to show */}\n      {displayUsername && totalCount > maxDisplay && (\n        <Link href={`/user/${displayUsername}/following`} className="text-blue-600">\n          See all {totalCount} following â†’\n        </Link>\n      )}\n    </div>\n  );\n};\n```\n\n### Follow Button Implementation\n\n```tsx\n// Simplified FollowButton component\nconst FollowButton = ({ targetUserId, targetUsername }) => {\n  const [currentUserId, setCurrentUserId] = useState(null);\n  const [isCurrentUserFollowing, setIsCurrentUserFollowing] = useState(false);\n  \n  // Check if current user is signed in and get their ID\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        setCurrentUserId(user.uid);\n        // Check if current user is following the target user\n        const following = await isFollowing(user.uid, targetUserId);\n        setIsCurrentUserFollowing(following);\n      }\n    });\n\n    return () => unsubscribe();\n  }, [targetUserId]);\n\n  // Follow/unfollow handler\n  const handleFollowAction = async () => {\n    if (!currentUserId) {\n      router.push(\'/login\');\n      return;\n    }\n\n    try {\n      if (isCurrentUserFollowing) {\n        await unfollowUser(currentUserId, targetUserId);\n        setIsCurrentUserFollowing(false);\n      } else {\n        await followUser(currentUserId, targetUserId);\n        setIsCurrentUserFollowing(true);\n      }\n    } catch (error) {\n      console.error(\'Error with follow/unfollow action:\', error);\n    }\n  };\n  \n  return (\n    <button \n      onClick={handleFollowAction} \n      className={isCurrentUserFollowing ? \'following-style\' : \'follow-style\'}\n    >\n      {isCurrentUserFollowing ? \'Following\' : \'Follow\'}\n    </button>\n  );\n};\n```\n\n### Responsive Design Considerations\n\nThe followers/following lists implement these key responsive features:\n1. **Proper text truncation**: Long usernames are truncated with ellipsis\n2. **Min-width on buttons**: Follow buttons maintain consistent size\n3. **Flexible containers**: Use of flexbox for proper alignment\n4. **Responsive spacing**: Different padding on mobile vs. desktop\n5. **Overflow handling**: Proper containment of overflowing text\n\nThese considerations ensure a good user experience across all device sizes.\n  '},{id:"routing",title:"Routing",content:"\n## Next.js App Router Architecture\n\nJournalite uses Next.js App Router for all routing with a clean, logical structure:\n\n```\n/app\n  /page.tsx              # Home page\n  /layout.tsx            # Root layout with providers\n  /articles\n    /[articleId]         # Dynamic article page\n    /page.tsx            # Articles index\n  /create-article\n    /page.tsx            # Article creation form\n  /edit-article\n    /[articleId]         # Dynamic article editing\n  /user\n    /[username]          # Public user profile\n  /my-profile            # Current user's profile\n  /login                 # Authentication pages\n  /register\n  /dev                   # Developer documentation (this page)\n```\n\n## Key Routes Explained\n\n### Home Page (`/`)\n\n- Displays trending articles\n- Shows personalized feed for logged-in users\n- Contains featured content section\n\n### Article Page (`/articles/[articleId]`)\n\n- Displays full article content\n- Shows author information\n- Includes comment section\n- Provides related articles\n\n```tsx\n// app/articles/[articleId]/page.tsx\nimport { getArticleById } from '@/services/articleService';\nimport { notFound } from 'next/navigation';\n\n// This function generates static paths for articles at build time\nexport async function generateStaticParams() {\n  // Get popular article IDs to pre-render\n  const popularArticleIds = await getPopularArticleIds();\n  \n  return popularArticleIds.map(id => ({\n    articleId: id\n  }));\n}\n\n// Main article page component\nexport default async function ArticlePage({ params }) {\n  const { articleId } = params;\n  \n  try {\n    // Get article data\n    const article = await getArticleById(articleId);\n    \n    // If article doesn't exist or isn't published\n    if (!article || article.status !== 'published') {\n      notFound();\n    }\n    \n    return (\n      <div className=\"article-container\">\n        <article>\n          <h1>{article.title}</h1>\n          <ArticleContent content={article.content} />\n          <CommentSection articleId={articleId} />\n        </article>\n      </div>\n    );\n  } catch (error) {\n    console.error('Error loading article:', error);\n    notFound();\n  }\n}\n```\n\n### User Profile (`/user/[username]`)\n\n- Public user profile accessible by username\n- Shows user's articles and bio\n- Different from private profile dashboard\n\n```tsx\n// app/user/[username]/page.tsx\nimport { getUserByUsername } from '@/services/userService';\nimport { getUserArticles } from '@/services/articleService';\nimport { notFound } from 'next/navigation';\n\nexport default async function UserProfilePage({ params }) {\n  const { username } = params;\n  \n  try {\n    // Get user data by username\n    const user = await getUserByUsername(username);\n    \n    if (!user) {\n      notFound();\n    }\n    \n    // Get user's published articles\n    const articles = await getUserArticles(user.id, {\n      status: 'published',\n      limit: 10\n    });\n    \n    return (\n      <div className=\"profile-container\">\n        <UserProfileHeader user={user} />\n        <UserArticlesGrid articles={articles} />\n      </div>\n    );\n  } catch (error) {\n    console.error('Error loading profile:', error);\n    notFound();\n  }\n}\n```\n\n## Route Protection & Authentication\n\nRoutes are protected using:\n- Client-side authentication checks\n- Server-side authentication status verification\n- Role-based access control for admin areas\n\n```tsx\n// Example of protected route wrapper\n'use client';\n\nimport { useAuth } from '@/hooks/useAuth';\nimport { useRouter } from 'next/navigation';\nimport { useEffect } from 'react';\n\nexport default function ProtectedRoute({ children }) {\n  const { user, loading } = useAuth();\n  const router = useRouter();\n  \n  useEffect(() => {\n    if (!loading && !user) {\n      // User is not authenticated, redirect to login\n      router.push('/login?redirect=' + encodeURIComponent(window.location.pathname));\n    }\n  }, [user, loading, router]);\n  \n  if (loading) {\n    return <LoadingSpinner />;\n  }\n  \n  if (!user) {\n    return null; // Don't render anything while redirecting\n  }\n  \n  return children;\n}\n```\n\n## Dynamic Routes & Server Components\n\nJournalite uses both static and dynamic rendering:\n- Static rendering for content that doesn't change often\n- Dynamic rendering for personalized content\n- Streaming for improved user experience with large pages\n\n## Error Handling\n\nError boundaries are used to gracefully handle route errors:\n- Custom 404 page for content not found\n- Error pages for server errors\n- Fallback UI components for partial failures\n  "},{id:"deployment",title:"Deployment & Build Modes",content:"\n## Deployment Overview\n\nJournalite is configured for seamless deployment to Vercel with:\n- Optimized production builds\n- Environment variable configuration\n- Image optimization\n- Edge caching for improved performance\n\n### Deployment Process\n\n```bash\n# Build the application for production\nnpm run build\n\n# Test the production build locally\nnpm run start\n\n# Deploy to Vercel (if CLI is installed)\nvercel --prod\n```\n\n## Environment Configuration\n\nThe application requires these environment variables:\n\n```\n# Firebase configuration\nNEXT_PUBLIC_FIREBASE_API_KEY=your-api-key\nNEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-auth-domain\nNEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id\nNEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your-storage-bucket\nNEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your-messaging-sender-id\nNEXT_PUBLIC_FIREBASE_APP_ID=your-app-id\n\n# Optional analytics\nNEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=your-measurement-id\n\n# Optional for custom domains\nNEXT_PUBLIC_BASE_URL=https://your-domain.com\n```\n\n## Next.js Configuration\n\nThe Next.js configuration in `next.config.js` is optimized for production:\n\n```js\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  // Optimize for containerized deployments (Docker)\n  output: 'standalone', \n  \n  // Configure allowed image domains for optimization\n  images: {\n    domains: [\n      'firebasestorage.googleapis.com',\n      'lh3.googleusercontent.com' // For Google profile photos\n    ],\n    // Image optimization settings\n    formats: ['image/webp'],\n  },\n  \n  // Handle TypeScript and ESLint errors gracefully in production\n  typescript: {\n    // Prevents TypeScript errors from breaking production builds\n    ignoreBuildErrors: process.env.NODE_ENV === 'production',\n  },\n  \n  eslint: {\n    // Prevents ESLint errors from breaking production builds\n    ignoreDuringBuilds: process.env.NODE_ENV === 'production',\n  },\n  \n  // Configure redirects and rewrites\n  async redirects() {\n    return [\n      {\n        source: '/profile',\n        destination: '/my-profile',\n        permanent: true,\n      },\n    ];\n  },\n  \n  // Enable experimental features as needed\n  experimental: {\n    serverActions: true,\n  },\n};\n\nmodule.exports = nextConfig;\n```\n\n## Build Optimization\n\nThe build process is optimized for performance:\n- Code splitting for reduced bundle sizes\n- Image optimization with Next.js Image component\n- Font optimization with next/font\n- Server component usage for reduced client JS\n\n## Caching Strategy\n\nJournalite implements a hybrid caching strategy:\n- Static generation for non-personalized content\n- Incremental Static Regeneration (ISR) for semi-dynamic content\n- Client-side fetching for user-specific data\n\n```tsx\n// Example of ISR implementation for article pages\nexport const revalidate = 3600; // Revalidate this page every hour\n\nexport async function generateStaticParams() {\n  // Get most popular articles for static generation\n  const topArticles = await getTopArticles(50);\n  \n  return topArticles.map(article => ({\n    articleId: article.id,\n  }));\n}\n```\n\n## Production Monitoring\n\nOnce deployed, monitor your application with:\n- Vercel Analytics for performance metrics\n- Firebase Performance Monitoring\n- Error tracking via Sentry integration\n- Custom logging for critical operations\n\n## Scaling Considerations\n\nAs your application grows:\n- Implement database indexing for common queries\n- Consider Firebase collection sharding for large datasets\n- Use Firebase Functions for background processing\n- Enable Edge caching for frequently accessed content\n  "},{id:"best-practices",title:"Best Practices",content:'\n## Coding Standards\n\n### Component Structure\n\nComponents should follow this consistent pattern:\n\n```tsx\n// Example component structure\nimport { useState, useEffect } from \'react\';\nimport { SomeType } from \'@/types\';\n\n// Types at the top\ninterface Props {\n  title: string;\n  onAction: () => void;\n}\n\n// Component with named export\nexport default function ExampleComponent({ title, onAction }: Props) {\n  // 1. State declarations\n  const [loading, setLoading] = useState(false);\n  const [data, setData] = useState<SomeType | null>(null);\n  \n  // 2. Effects\n  useEffect(() => {\n    fetchData();\n  }, []);\n  \n  // 3. Event handlers and helper functions\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      // Fetch data\n      const result = await someApiCall();\n      setData(result);\n    } catch (error) {\n      console.error("Error fetching data:", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const handleClick = () => {\n    onAction();\n  };\n  \n  // 4. Conditional rendering\n  if (loading) return <LoadingSpinner />;\n  if (!data) return <EmptyState />;\n  \n  // 5. Main render\n  return (\n    <div className="example-component">\n      <h2>{title}</h2>\n      <div className="content">\n        {data.items.map(item => (\n          <div key={item.id}>{item.name}</div>\n        ))}\n      </div>\n      <button onClick={handleClick}>Action</button>\n    </div>\n  );\n}\n```\n\n### Naming Conventions\n\n- **Components**: PascalCase (e.g., `ArticleCard.tsx`)\n- **Hooks**: camelCase with \'use\' prefix (e.g., `useArticle.ts`)\n- **Utilities**: camelCase (e.g., `formatDate.ts`)\n- **Types**: PascalCase with descriptive names (e.g., `ArticleData`)\n- **CSS Modules**: ComponentName.module.css (e.g., `ArticleCard.module.css`)\n\n### File Organization\n\nFollow these patterns for organizing files:\n\n```\n/components\n  /Article                    # Component folder\n    ArticleCard.tsx           # Main component\n    ArticleCard.module.css    # Component styles\n    useArticleActions.ts      # Component-specific hook\n    index.ts                  # Re-export for clean imports\n  /ui                         # Reusable UI components\n    Button.tsx\n    Input.tsx\n/hooks                        # Global hooks\n  useAuth.ts\n  useFirestore.ts\n/types                        # Type definitions\n  article.types.ts\n  user.types.ts\n```\n\n### State Management\n\nFor state management, follow this hierarchy:\n1. **Local component state**: For UI-specific state\n2. **Context API**: For shared state across components\n3. **Custom hooks**: For reusable state logic\n4. **URL state**: For shareable/bookmarkable state\n\n### Firebase Best Practices\n\n1. **Security Rules**\n   - Always implement restrictive security rules\n   - Test rules thoroughly before deployment\n   - Use role-based permissions\n\n2. **Query Optimization**\n   - Use compound queries with appropriate indexes\n   - Limit query results to avoid excessive reads\n   - Add pagination for large data sets\n\n3. **Data Modeling**\n   - Keep documents small and focused\n   - Use subcollections for one-to-many relationships\n   - Denormalize data when needed for read performance\n\n```tsx\n// Example of optimized Firestore query\nconst getArticlesForHome = async (limit = 10) => {\n  try {\n    const articlesRef = collection(db, "articles");\n    const q = query(\n      articlesRef,\n      where("status", "==", "published"),\n      orderBy("publishedAt", "desc"),\n      limit(limit)\n    );\n    \n    // Execute query with proper error handling\n    const querySnapshot = await getDocs(q);\n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error("Error fetching articles:", error);\n    throw new Error("Failed to fetch articles");\n  }\n};\n```\n\n### Performance Optimization\n\n1. **Code Splitting**\n   - Use dynamic imports for large components\n   - Implement route-based code splitting\n   - Lazy load below-the-fold content\n\n2. **Image Optimization**\n   - Always use Next.js Image component\n   - Choose appropriate sizes and formats\n   - Implement responsive images with srcset\n\n3. **Rendering Strategies**\n   - Use Server Components for static content\n   - Implement Client Components only when needed\n   - Consider Streaming for large pages\n\n```tsx\n// Example of optimized image usage\nimport Image from \'next/image\';\n\nfunction OptimizedImage({ src, alt }) {\n  return (\n    <Image\n      src={src}\n      alt={alt}\n      width={800}\n      height={500}\n      placeholder="blur"\n      blurDataURL="data:image/png;base64,iVBORw0KGgoAAAANSU..."\n      priority={true}\n      sizes="(max-width: 768px) 100vw, 800px"\n    />\n  );\n}\n```\n\n### Error Handling\n\nImplement comprehensive error handling:\n- Use try/catch for async operations\n- Provide user-friendly error messages\n- Log errors for debugging\n- Implement error boundaries for UI resilience\n\n### Accessibility\n\nAlways follow accessibility best practices:\n- Use semantic HTML elements\n- Include proper ARIA attributes\n- Ensure keyboard navigation\n- Maintain sufficient color contrast\n- Test with screen readers\n  '},{id:"tag-feature",title:"Tag Feature Integration",content:"\n## Tag Feature Integration\n\nThe application now supports a tag feature that allows users to categorize and filter articles based on tags. This feature enhances content discoverability and user engagement.\n\n### Key Components\n\n- **Tag Page**: A dedicated page for each tag that displays all articles associated with that tag.\n- **Clickable Tags**: Tags are now clickable links that redirect users to the respective tag page.\n\n### Implementation Details\n\n- **Firebase Query**: Articles are fetched from Firestore using a query that filters by the selected tag.\n- **UI Components**: The tag page and article components have been updated to support and display tags effectively.\n- **Static Generation**: Tag pages are statically generated at build time using `generateStaticParams()`.\n- **Scheduled Rebuilds**: The site is automatically rebuilt weekly to capture new tags created by users.\n\n### Usage\n\n- Users can click on any tag in an article to view all related articles.\n- Developers can extend this feature by adding more tag-related functionalities, such as trending tags or tag-based notifications.\n- New tags created by users will be available after the next scheduled rebuild (weekly).\n\n### Example\n\n`tsx\n// Example of fetching articles by tag\nimport { getArticlesByTag } from '@/firebase/articles';\n\nconst fetchArticles = async (tag: string) => {\n  const articles = await getArticlesByTag(tag);\n  console.log(articles);\n};\n`\n  "},{id:"mood-features",title:"Mood & Reflection Features",content:"\n## Overview\n\nThe Mood & Reflection system provides an immersive reading experience by analyzing article content and adapting the visual atmosphere accordingly. It includes sentiment analysis, dynamic backgrounds, interactive reflections, and mood-aware comment styling.\n\n## Mood Detection Algorithm\n\n### Sentiment Analysis Engine\n\n```tsx[src/utils/getMoodFromText.ts]\nimport sentiment from 'sentiment';\n\nexport function getMoodFromText(text: string): MoodType {\n  const analyzer = new sentiment();\n  const result = analyzer.analyze(text);\n  \n  // 6-mood system: joyful, angry, energetic, peaceful, reflective, sad\n  // Keywords take precedence over sentiment score for accuracy\n  \n  const words = text.toLowerCase().split(/s+/);\n  \n  // Calculate keyword scores for each mood\n  const joyfulScore = countKeywords(words, joyfulWords);\n  const angryScore = countKeywords(words, angryWords);\n  const energeticScore = countKeywords(words, energeticWords);\n  const peacefulScore = countKeywords(words, peacefulWords);\n  const sadScore = countKeywords(words, sadWords);\n  \n  // Political content detection\n  const politicalWords = ['trump', 'biden', 'politics', 'election', 'government'];\n  const isPolitical = words.some(word => politicalWords.includes(word));\n  \n  if (isPolitical) {\n    return result.score > 2 ? 'energetic' : result.score < -2 ? 'angry' : 'reflective';\n  }\n  \n  // Return mood with highest keyword score\n  const maxScore = Math.max(joyfulScore, angryScore, energeticScore, peacefulScore, sadScore);\n  if (maxScore === 0) return 'reflective'; // Default\n  \n  // Return corresponding mood\n  if (maxScore === joyfulScore) return 'joyful';\n  if (maxScore === angryScore) return 'angry';\n  if (maxScore === energeticScore) return 'energetic';\n  if (maxScore === peacefulScore) return 'peaceful';\n  return 'sad';\n}\n```\n\n### Keyword Categories\n\nEach mood has extensive keyword lists:\n\n- **Joyful**: celebration, success, love, achievement, happiness (200+ words)\n- **Angry**: frustrated, furious, outraged, betrayed, injustice (150+ words)\n- **Energetic**: exciting, dynamic, breakthrough, innovation, passionate (180+ words)\n- **Peaceful**: calm, serene, meditation, nature, harmony (120+ words)\n- **Reflective**: contemplation, thoughts, philosophy, introspection (100+ words)\n- **Sad**: loss, grief, disappointment, tragedy, melancholy (130+ words)\n\n## Visual Theming System\n\n### Color Palettes\n\n```tsx[src/utils/moodThemes.ts]\nexport const moodThemes = {\n  joyful: {\n    gradientStart: '#FFD700',\n    gradientEnd: '#FF6B6B',\n    accent: '#FF4757',\n    textColor: '#2C2C54'\n  },\n  angry: {\n    gradientStart: '#FF4757',\n    gradientEnd: '#C44569',\n    accent: '#B33771',\n    textColor: '#FFFFFF'\n  },\n  // ... 4 more moods\n};\n```\n\n### Multi-Layer Background System\n\n```tsx\n{/* Four animated layers for immersive experience */}\n{moodFeatureEnabled && isAuthenticated && (\n  <>\n    {/* Primary flowing gradient */}\n    <div style={{\n      backgroundImage: `linear-gradient(45deg, \n        ${moodThemes[mood].gradientStart}40, \n        ${moodThemes[mood].gradientEnd}60)`,\n      animation: 'gradientFlow 8s ease-in-out infinite'\n    }} />\n    \n    {/* Secondary wave layer */}\n    <div style={{\n      backgroundImage: `radial-gradient(circle, \n        ${moodThemes[mood].gradientEnd}25 0%, transparent 50%)`,\n      animation: 'moodFloat 12s ease-in-out infinite alternate'\n    }} />\n    \n    {/* Floating orbs */}\n    <div style={{\n      backgroundImage: `radial-gradient(circle, \n        ${moodThemes[mood].gradientStart}20 0%, transparent 25%)`,\n      animation: 'orbitalFloat 20s linear infinite'\n    }} />\n    \n    {/* Grain texture overlay */}\n    <div style={{\n      backgroundImage: `repeating-linear-gradient(90deg,\n        transparent, ${moodThemes[mood].gradientStart}02 2px)`,\n      mixBlendMode: 'overlay'\n    }} />\n  </>\n)}\n```\n\n## Authentication-Gated Features\n\n### Feature Access Control\n\n```tsx\n// Mood features only work for authenticated users\nconst isAuthenticated = !!currentUser;\n\n// Reflection bar shows different content\n{isAuthenticated ? (\n  <div>\uD83C\uDFA8 Atmosphere adapted - âœ¨ Reflections saved: {count}</div>\n) : (\n  <div>\uD83D\uDD12 Sign in for enhanced features</div>\n)}\n\n// Toggles are disabled for non-auth users\n<button \n  disabled={!isAuthenticated}\n  onClick={isAuthenticated ? toggleMood : undefined}\n>\n  {(isAuthenticated && moodEnabled) ? 'ON' : 'OFF'}\n</button>\n```\n\n### User Preferences\n\n- **localStorage persistence**: Mood preferences saved per user\n- **Toggle controls**: Users can disable mood backgrounds\n- **Default behavior**: New users get mood features enabled\n\n## Interactive Reflections\n\n### Prompt Generation System\n\n```tsx\n// Base prompts + topic-specific prompts\nconst getTopicBasedPrompts = (text: string) => {\n  const topicPrompts = [];\n  \n  // Technology content\n  if (text.includes('AI') || text.includes('technology')) {\n    topicPrompts.push(\"How might this technology impact your daily life?\");\n    topicPrompts.push(\"What ethical considerations does this raise?\");\n  }\n  \n  // Social issues\n  if (text.includes('social') || text.includes('justice')) {\n    topicPrompts.push(\"What role should individuals play in addressing this?\");\n    topicPrompts.push(\"How might different communities view this differently?\");\n  }\n  \n  return [...basePrompts, ...topicPrompts];\n};\n```\n\n### Floating Action Button\n\n- **Fixed positioning**: Always accessible during reading\n- **Smooth animations**: Scale and glow effects on hover\n- **Context awareness**: Shows reflection count and state\n\n## Comment System Integration\n\n### Glass-Morphism Design\n\n```tsx\n// Comments adapt to detected mood\n<div style={{\n  background: `linear-gradient(135deg, \n    rgba(255, 255, 255, 0.25) 0%, \n    ${moodThemes[mood].gradientStart}15 100%)`,\n  backdropFilter: 'blur(20px) saturate(180%)',\n  border: `1px solid ${moodThemes[mood].gradientStart}25`,\n  borderRadius: '24px'\n}}>\n  {/* Comment content */}\n</div>\n```\n\n### Mood-Themed Elements\n\n- **Input forms**: Dynamic focus states with mood colors\n- **Submit buttons**: Animated with mood gradients  \n- **Loading states**: Mood-colored progress indicators\n- **Reply cards**: Slide animations on hover\n- **Empty states**: \"Be the first to share\" cards with mood styling\n\n## Performance Optimizations\n\n### Efficient Rendering\n\n- **Conditional rendering**: Mood effects only for authenticated users\n- **CSS-in-JS**: Dynamic styles without layout thrashing\n- **Animation performance**: GPU-accelerated transforms only\n- **Memory management**: Cleanup of event listeners and timers\n\n### Code Splitting\n\n```tsx\n// Mood utilities loaded only when needed\nconst { getMoodFromText } = await import('@/utils/getMoodFromText');\nconst { moodThemes } = await import('@/utils/moodThemes');\n```\n\n## Implementation Guide\n\n### Adding Mood to New Components\n\n1. **Import utilities**:\n   ```tsx\n   import { getMoodFromText } from '@/utils/getMoodFromText';\n   import { moodThemes } from '@/utils/moodThemes';\n   ```\n\n2. **Detect mood from content**:\n   ```tsx\n   const detectedMood = getMoodFromText(textContent);\n   ```\n\n3. **Apply conditional styling**:\n   ```tsx\n   style={isAuthenticated && moodEnabled ? {\n     background: moodThemes[mood].gradientStart + '20',\n     borderColor: moodThemes[mood].accent\n   } : {}}\n   ```\n\n4. **Pass mood props to children**:\n   ```tsx\n   <ChildComponent \n     {...(isAuthenticated && { mood, moodFeatureEnabled })}\n   />\n   ```\n\n### CSS Animations Required\n\nEnsure these keyframes exist in `globals.css`:\n- `@keyframes gradientFlow`\n- `@keyframes moodFloat`  \n- `@keyframes orbitalFloat`\n\n## Future Enhancements\n\n- **Machine learning**: More sophisticated mood detection\n- **User training**: Let users correct mood detection\n- **Seasonal themes**: Holiday and seasonal mood variations\n- **Accessibility**: High contrast mode for mood themes\n- **Analytics**: Track mood preferences and effectiveness\n  "},{id:"journa-color",title:"Journa Color - Advanced Theme Customization",content:"\n## Overview\n\nJourna Color is an advanced theme customization system that allows users to create personalized gradients, colors, and visual effects for their reading experience. Inspired by modern design tools, it provides real-time visual customization with intuitive controls.\n\n## Core Features\n\n### \uD83C\uDFA8 Interactive Gradient Editor\n\n```tsx[src/components/GradientPanel.tsx]\nconst GradientPanel: React.FC<GradientPanelProps> = ({\n  currentMood,\n  isVisible,\n  moodFeatureEnabled\n}) => {\n  const [themeConfig, setThemeConfig] = useState<ThemeConfig>({\n    colorStops: [\n      { id: '1', color: '#007AFF', x: 30, y: 40, isSelected: true }\n    ],\n    opacity: 80,\n    grain: 30,\n    mode: 'auto'\n  });\n  \n  // Generate real-time gradients with grain effects\n  const generateJournaColorGradient = (config: ThemeConfig) => {\n    // Multi-layer gradient generation with grain overlay\n    // Supports 1-3 color stops with advanced blending\n  };\n};\n```\n\n### \uD83C\uDF9Bï¸ Tactile Rotary Controls\n\n- **Grain Control**: Rotary knob with 24 detent positions for tactile feedback\n- **Opacity Slider**: Squiggly line design for transparency control\n- **Color Stops**: Draggable colored circles (up to 3) in canvas area\n- **Theme Modes**: Auto, Light, Dark toggles\n\n```tsx\n// Tactile knob with detents every 15 degrees\nconst detentSize = 15; // degrees per detent\nconst rawGrain = (angle / 360) * 100;\nconst detentIndex = Math.round(rawGrain / (100 / (360 / detentSize)));\nconst snappedGrain = Math.max(0, Math.min(100, (detentIndex * (100 / (360 / detentSize)))));\n\n// Haptic feedback on mobile devices\nif (navigator.vibrate) {\n  navigator.vibrate(10); // Short vibration on detent hit\n}\n```\n\n## Visual Components\n\n### \uD83C\uDF08 Multi-Stop Gradient System\n\n```tsx\ninterface ColorStop {\n  id: string;\n  color: string;\n  x: number; // 0-100 canvas position\n  y: number; // 0-100 canvas position\n  isSelected: boolean;\n}\n\n// Supports 1-3 color stops with different blending modes\nif (colorStops.length === 1) {\n  return `radial-gradient(circle at ${stop.x}% ${stop.y}%, \n    ${stop.color}${alpha}, transparent 70%)`;\n} else if (colorStops.length === 2) {\n  // Dual-radial blend\n} else if (colorStops.length === 3) {\n  // Triple-radial blend\n}\n```\n\n### \uD83D\uDD18 Grain & Texture Effects\n\n```tsx\n// Realistic film grain overlay\nconst grainPattern = `\n  radial-gradient(circle at 15% 15%, rgba(255,255,255,${grainOpacity}) 0.5px, transparent ${grainSize}px),\n  radial-gradient(circle at 85% 25%, rgba(0,0,0,${grainOpacity * 0.8}) 0.5px, transparent ${grainSize * 0.7}px),\n  radial-gradient(circle at 45% 85%, rgba(255,255,255,${grainOpacity * 0.6}) 0.5px, transparent ${grainSize * 1.1}px)\n`;\n\nreturn grainPattern ? `${grainPattern}${baseGradient}` : baseGradient;\n```\n\n## Real-Time Application System\n\n### \uD83C\uDFAF Smart Element Targeting\n\n```tsx\nconst updateThemeRealTime = (config: ThemeConfig) => {\n  const gradientCSS = generateJournaColorGradient(config);\n  const clearerGradientCSS = generateClearerGradient(config);\n  \n  // Update background mood elements\n  const moodElements = document.querySelectorAll('[data-mood-element]');\n  moodElements.forEach(element => {\n    element.style.backgroundImage = gradientCSS;\n    element.style.transition = 'background-image 0.2s ease';\n  });\n\n  // Update UI bars with clearer version\n  const toggleBar = document.querySelector('[data-toggle-bar=\"true\"]');\n  if (toggleBar) {\n    toggleBar.style.backgroundImage = clearerGradientCSS;\n  }\n};\n```\n\n### \uD83D\uDCF1 Responsive Design\n\n```tsx\n// Floating button with dynamic gradient background\n<button\n  style={{\n    width: '56px',\n    height: '56px',\n    borderRadius: '50%',\n    background: currentGradient || '#007AFF',\n    position: 'fixed',\n    bottom: '20px',\n    left: '20px',\n    zIndex: 9999\n  }}\n>\n  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n    <circle cx=\"8\" cy=\"8\" r=\"3\" fill=\"url(#iconGradient)\"/>\n    <circle cx=\"16\" cy=\"12\" r=\"2.5\" fill=\"url(#iconGradient)\"/>\n    <circle cx=\"12\" cy=\"18\" r=\"2\" fill=\"url(#iconGradient)\"/>\n  </svg>\n</button>\n```\n\n## Architecture & Performance\n\n### \uD83D\uDCBE Persistent Storage\n\n```tsx\n// Configuration automatically saved to localStorage\nlocalStorage.setItem('journaColorThemeConfig', JSON.stringify(config));\n\n// Restored on page load\nuseEffect(() => {\n  const saved = localStorage.getItem('journaColorThemeConfig');\n  if (saved) {\n    const config = JSON.parse(saved);\n    setThemeConfig(config);\n    updateThemeRealTime(config);\n  }\n}, []);\n```\n\n### âš¡ Optimized Rendering\n\n- **Direct DOM manipulation** for performance (no React re-renders)\n- **Debounced updates** during dragging operations\n- **CSS transitions** for smooth visual changes\n- **Hardware acceleration** via CSS transforms\n\n### \uD83C\uDFA8 Color Palette Integration\n\n```tsx\nconst presetColors = [\n  '#FFFFFF', '#FFB3D9', '#B19CD9', '#FF6B6B', \n  '#FF8E53', '#FFD93D', '#6BCF7F', '#4ECDC4', '#45B7D1'\n];\n\n// Quick color application to selected stop\nconst changeSelectedColor = (color: string) => {\n  const selectedStop = themeConfig.colorStops.find(stop => stop.isSelected);\n  if (!selectedStop) return;\n  \n  const newConfig = {\n    ...themeConfig,\n    colorStops: themeConfig.colorStops.map(stop => \n      stop.isSelected ? { ...stop, color } : stop\n    )\n  };\n  \n  setThemeConfig(newConfig);\n  updateThemeRealTime(newConfig);\n};\n```\n\n## User Experience Features\n\n### \uD83C\uDF9Aï¸ Intuitive Controls\n\n- **Visual feedback**: Selected elements have enlarged appearance\n- **Color harmony**: Smart color suggestions based on current palette\n- **Undo/Redo**: State management for experimentation\n- **Preview mode**: See changes before applying\n\n### \uD83D\uDD04 Integration with Mood System\n\n- **Mood-aware defaults**: Starting colors based on detected article mood\n- **Seamless transitions**: Smooth blending between mood and custom themes\n- **Context preservation**: Custom themes respect reading context\n\n### \uD83D\uDCCA Usage Analytics\n\n```tsx\n  // Track user interactions for UX improvements\n  const trackCustomization = (action: string, value: any) => {\n    if (process.env.NODE_ENV === 'development') {\n      console.log('Journa Color:', action, value);\n    }\n    // Can be extended with analytics service\n  };\n\n// Example usage\ntrackCustomization('color_changed', { from: oldColor, to: newColor });\ntrackCustomization('grain_adjusted', grainValue);\ntrackCustomization('preset_selected', presetIndex);\n```\n\n## Technical Implementation\n\n### \uD83C\uDFD7ï¸ Component Structure\n\n```\nGradientPanel/\nâ”œâ”€â”€ ThemeConfig interface\nâ”œâ”€â”€ ColorStop management\nâ”œâ”€â”€ Real-time gradient generation\nâ”œâ”€â”€ Tactile control handlers\nâ”œâ”€â”€ localStorage persistence\nâ””â”€â”€ DOM manipulation utilities\n```\n\n### \uD83C\uDFAF Performance Optimizations\n\n- **RAF-based updates**: Smooth 60fps interactions\n- **Memoized calculations**: Cached gradient computations\n- **Efficient selectors**: Minimal DOM queries\n- **CSS-only animations**: Hardware-accelerated transitions\n\nThis system provides users with professional-grade theme customization while maintaining optimal performance and intuitive user experience.\n  "},{id:"enhanced-highlights",title:"Enhanced Highlight Features",content:"\n## Overview\n\nThe Enhanced Highlight system transforms basic text highlighting into an engaging, social, and semantic experience. Users can now categorize highlights, react to them, and share specific highlights via direct URLs.\n\n## \uD83C\uDFA8 Color-Coded Highlights by Theme\n\n### Four Semantic Categories\n\n```tsx[src/services/highlightService.ts]\nexport type HighlightTag = 'insight' | 'question' | 'quote' | 'important';\n\nconst highlightTags = [\n  { tag: 'insight', label: 'Insight', color: '#3B82F6', icon: '\uD83D\uDCA1' },\n  { tag: 'question', label: 'Question', color: '#F59E0B', icon: 'â“' },\n  { tag: 'quote', label: 'Quote', color: '#10B981', icon: '\uD83D\uDCAC' },\n  { tag: 'important', label: 'Important', color: '#EF4444', icon: 'â­' }\n];\n```\n\n### Enhanced Highlight Interface\n\n```tsx\nexport interface Highlight {\n  id: string;\n  articleId: string;\n  userId: string;\n  text: string;\n  prefix: string;\n  suffix: string;\n  tag: HighlightTag;                    // NEW: Semantic category\n  reactions?: { [emoji: string]: number };  // NEW: Reaction counts\n  userReactions?: { [userId: string]: string }; // NEW: User reaction tracking\n  createdAt: any;\n  comments?: Comment[];\n}\n```\n\n### CSS Color Styling\n\n```css[src/styles/highlight.css]\n.article-highlight.highlight-insight {\n  background-color: rgba(59, 130, 246, 0.3); /* Blue */\n}\n\n.article-highlight.highlight-question {\n  background-color: rgba(245, 158, 11, 0.3); /* Amber */\n}\n\n.article-highlight.highlight-quote {\n  background-color: rgba(16, 185, 129, 0.3); /* Emerald */\n}\n\n.article-highlight.highlight-important {\n  background-color: rgba(239, 68, 68, 0.3); /* Red */\n}\n```\n\n## \uD83D\uDD17 Highlight & Share Links\n\n### URL Generation\n\n```tsx\nexport const generateHighlightShareUrl = (\n  articleSlug: string,\n  highlightId: string,\n  baseUrl: string = window.location.origin\n): string => {\n  return `${baseUrl}/articles?slug=${articleSlug}#highlight=${highlightId}`;\n};\n\n// Usage example\nconst shareUrl = generateHighlightShareUrl('my-article', 'highlight123');\n// Result: https://journalite.com/articles?slug=my-article#highlight=highlight123\n```\n\n### Auto-Scroll & Flash Animation\n\n```tsx\n// Check URL fragment and scroll to highlight\nuseEffect(() => {\n  if (typeof window !== 'undefined') {\n    const urlFragment = window.location.hash;\n    if (urlFragment === `#highlight=${highlight.id}`) {\n      setIsFlashing(true);\n      setTimeout(() => setIsFlashing(false), 1000);\n      \n      // Smooth scroll to highlight\n      const element = document.querySelector(`[data-highlight-id=\"${highlight.id}\"]`);\n      if (element) {\n        element.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }\n    }\n  }\n}, [highlight.id]);\n```\n\n### Share Functionality\n\n```tsx\nconst handleShare = () => {\n  const shareUrl = generateHighlightShareUrl(articleSlug, highlight.id);\n  \n  if (navigator.share) {\n    // Native share API (mobile)\n    navigator.share({\n      title: 'Check out this highlight',\n      text: `\"${highlight.text}\"`,\n      url: shareUrl,\n    });\n  } else {\n    // Fallback: copy to clipboard\n    navigator.clipboard.writeText(shareUrl);\n    showTooltip('Link copied to clipboard!');\n  }\n};\n```\n\n## \uD83D\uDC4D Quick Reactions System\n\n### Available Reactions\n\n```tsx\nconst availableReactions = ['\uD83D\uDC4D', 'â¤ï¸', '\uD83E\uDD14', '\uD83D\uDCA1'];\n```\n\n### Reaction Management\n\n```tsx\nexport const addReactionToHighlight = async (\n  highlightId: string,\n  userId: string,\n  emoji: string\n): Promise<void> => {\n  const highlightRef = doc(db, 'highlights', highlightId);\n  \n  await updateDoc(highlightRef, {\n    [`reactions.${emoji}`]: increment(1),\n    [`userReactions.${userId}`]: emoji\n  });\n};\n\nexport const removeReactionFromHighlight = async (\n  highlightId: string,\n  userId: string,\n  emoji: string\n): Promise<void> => {\n  const highlightRef = doc(db, 'highlights', highlightId);\n  \n  await updateDoc(highlightRef, {\n    [`reactions.${emoji}`]: increment(-1),\n    [`userReactions.${userId}`]: null\n  });\n};\n```\n\n### Reaction UI Component\n\n```tsx\nconst ReactionButton = ({ emoji, count, isActive, onReact }) => (\n  <button\n    onClick={() => onReact(emoji)}\n    className={`highlight-reaction-btn ${isActive ? 'active' : ''}`}\n  >\n    <span className=\"highlight-reaction-emoji\">{emoji}</span>\n    {count > 0 && (\n      <span className=\"highlight-reaction-count\">{count}</span>\n    )}\n  </button>\n);\n```\n\n## \uD83D\uDEE0ï¸ Enhanced Toolbar Implementation\n\n### Color Selection Interface\n\n```tsx\nconst HighlightToolbar = ({ selection, onHighlight }) => {\n  const [showColorOptions, setShowColorOptions] = useState(false);\n  \n  return (\n    <div className=\"highlight-toolbar\">\n      {!showColorOptions ? (\n        <button onClick={() => setShowColorOptions(true)}>\n          Highlight\n        </button>\n      ) : (\n        <div className=\"highlight-color-options\">\n          <span>Choose highlight type:</span>\n          {highlightTags.map((tagInfo) => (\n            <button\n              key={tagInfo.tag}\n              onClick={() => handleHighlight(selection, tagInfo.tag)}\n              style={{ backgroundColor: tagInfo.color }}\n            >\n              {tagInfo.icon} {tagInfo.label}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n```\n\n## \uD83D\uDCCA Performance & Data Structure\n\n### Lightweight Implementation\n\n- **Storage**: Only added 3 fields to existing Highlight object\n- **Reactions**: Simple integer increments, no complex aggregation\n- **Colors**: CSS-only styling, no JavaScript color calculations\n- **URLs**: Fragment-based routing, no server-side changes needed\n\n### Database Structure\n\n```\nhighlights/{highlightId}\nâ”œâ”€â”€ tag: 'insight' | 'question' | 'quote' | 'important'\nâ”œâ”€â”€ reactions: { '\uD83D\uDC4D': 5, 'â¤ï¸': 2, '\uD83E\uDD14': 1 }\nâ”œâ”€â”€ userReactions: { 'user1': '\uD83D\uDC4D', 'user2': 'â¤ï¸' }\nâ””â”€â”€ ...existing fields\n```\n\n### Query Optimization\n\n```tsx\n// Reactions use Firestore increment for atomic updates\nawait updateDoc(highlightRef, {\n  [`reactions.${emoji}`]: increment(1)  // Atomic operation\n});\n\n// No need for read-then-write patterns\n// No race conditions with multiple users reacting simultaneously\n```\n\n## \uD83C\uDFAF User Experience Enhancements\n\n### Visual Feedback\n\n- **Hover states**: Show reaction/share options on highlight hover\n- **Flash animation**: Shared highlights flash when visited via URL\n- **Instant feedback**: Reactions update immediately with optimistic UI\n- **Color coding**: Instant visual categorization of highlight types\n\n### Mobile Optimization\n\n- **Touch-friendly**: Large tap targets for reaction buttons\n- **Native sharing**: Uses device's native share sheet when available\n- **Responsive toolbar**: Adapts to screen size constraints\n\n## \uD83D\uDE80 Implementation Guide\n\n### Adding to Existing Articles\n\n1. **Update highlight service**:\n   ```tsx\n   import { HighlightTag } from '@/services/highlightService';\n   ```\n\n2. **Modify highlight creation**:\n   ```tsx\n   const handleHighlight = (text: string, range: Range, tag: HighlightTag) => {\n     saveHighlight(text, prefix, suffix, articleId, tag);\n   };\n   ```\n\n3. **Apply color classes**:\n   ```tsx\n   <span className={`article-highlight highlight-${highlight.tag}`}>\n     {highlight.text}\n   </span>\n   ```\n\n4. **Add reaction handling**:\n   ```tsx\n   <HighlightDisplay \n     highlight={highlight} \n     articleSlug={articleSlug}\n     onUpdate={refreshHighlights}\n   />\n   ```\n\n### Required CSS\n\nEnsure these styles exist in `highlight.css`:\n- `.highlight-color-options` - Color selection toolbar\n- `.highlight-reaction-btn` - Reaction buttons\n- `.highlight-shared-flash` - Flash animation\n- `.highlight-[tag]` - Color variants for each tag\n\n## \uD83D\uDCA1 Future Enhancement Ideas\n\n### Highlight Heatmap Bar (Next Phase)\n\n```tsx\n// Break article into segments and show highlight density\nconst HighlightHeatmap = ({ highlights, articleLength }) => {\n  const segments = 20;\n  const segmentCounts = calculateHighlightDensity(highlights, segments);\n  \n  return (\n    <div className=\"highlight-heatmap\">\n      {segmentCounts.map((count, index) => (\n        <div \n          key={index}\n          className=\"heatmap-segment\"\n          style={{ opacity: count / maxCount }}\n        />\n      ))}\n    </div>\n  );\n};\n```\n\n### Offline-First Highlighting\n\n```tsx\n// Buffer highlights in localStorage when offline\nconst saveHighlightOffline = (highlight) => {\n  const pending = JSON.parse(localStorage.getItem('pendingHighlights') || '[]');\n  pending.push(highlight);\n  localStorage.setItem('pendingHighlights', JSON.stringify(pending));\n};\n\n// Sync when online\nconst syncPendingHighlights = async () => {\n  const pending = JSON.parse(localStorage.getItem('pendingHighlights') || '[]');\n  \n  for (const highlight of pending) {\n    await saveHighlight(...highlight);\n  }\n  \n  localStorage.removeItem('pendingHighlights');\n};\n```\n\n### Analytics & Insights\n\n- Track most popular highlight types per article\n- Identify engaging content sections via highlight density\n- User highlighting patterns and preferences\n- Social sharing metrics for highlighted content\n\n## \uD83D\uDCC8 Impact Metrics\n\n### Engagement Benefits\n\n- **Increased Time on Page**: Categorized highlights encourage deeper reading\n- **Social Sharing**: Direct highlight URLs drive referral traffic\n- **User Retention**: Reaction system creates social connection\n- **Content Insights**: Highlight patterns reveal reader interests\n\n### Technical Benefits\n\n- **Zero Complexity**: No new microservices or complex infrastructure\n- **High Performance**: Client-side routing and CSS-only visuals\n- **Scalable**: Firestore handles concurrent reactions efficiently\n- **Maintainable**: Clean separation of concerns, minimal code changes\n  "},{id:"realtime-presence",title:"Real-Time Presence System",content:'\n## Real-Time Presence Feature\n\nA Google Docs-style real-time presence system that shows overlapping user avatars of people currently reading the same article.\n\n### \uD83C\uDFD7ï¸ High-Level Architecture\n\n```\nUser Opens Article â†’ Authentication Check â†’ Start Presence Tracking â†’ Real-time Updates â†’ Cleanup\n```\n\n### \uD83D\uDD27 Core Components\n\n#### 1. PresenceService (Backend Logic)\n- **Purpose**: Manages all Firebase operations and user tracking  \n- **Location**: `src/services/presenceService.ts`\n- **Responsibilities**:\n  - Start/stop presence tracking\n  - Manage heartbeat updates\n  - Handle real-time subscriptions\n  - Clean up stale data\n\n#### 2. ActiveReaders Component (Frontend Display)\n- **Purpose**: Renders the overlapping user avatars\n- **Location**: `src/components/ActiveReaders.tsx`\n- **Responsibilities**:\n  - Display user avatars and count\n  - Handle authentication checks\n  - Subscribe to presence updates\n\n#### 3. Firebase Database Structure\n```\narticlePresence/\nâ”œâ”€â”€ {articleId}_{userId1}\nâ”‚   â”œâ”€â”€ uid: "user123"\nâ”‚   â”œâ”€â”€ username: "john_doe"\nâ”‚   â”œâ”€â”€ firstName: "John"\nâ”‚   â”œâ”€â”€ lastName: "Doe"\nâ”‚   â”œâ”€â”€ lastSeen: timestamp\nâ”‚   â””â”€â”€ articleId: "article456"\nâ”œâ”€â”€ {articleId}_{userId2}\nâ””â”€â”€ ...\n```\n\n## \uD83D\uDD04 Complete Data Flow\n\n### Phase 1: User Enters Article\n```javascript\n1. ActiveReaders component mounts\n2. Checks if user is authenticated\n3. If authenticated â†’ calls presenceService.startPresence(articleId)\n4. PresenceService creates document: articlePresence/{articleId}_{userId}\n5. Sets up heartbeat interval (every 15 seconds)\n6. Adds cleanup event listeners (beforeunload, pagehide, etc.)\n```\n\n### Phase 2: Real-time Synchronization\n```javascript\n1. Component subscribes to presenceService.subscribeToActiveUsers()\n2. Firebase query: "Get all users where lastSeen > 45 seconds ago"\n3. For each presence document:\n   - Fetch full user profile\n   - Add to active users list\n   - Exclude current user from display\n4. Update UI with new user list\n5. Heartbeat updates lastSeen timestamp every 15s\n```\n\n### Phase 3: User Activity Monitoring\n```javascript\n// Heartbeat Logic\nsetInterval(() => {\n  if (auth.currentUser && !document.hidden) {\n    // Update presence timestamp\n    updatePresenceDocument()\n  }\n}, 15000)\n\n// Tab Visibility\ndocument.addEventListener(\'visibilitychange\', () => {\n  if (hidden for > 30s) {\n    stopPresence()\n  }\n})\n```\n\n### Phase 4: Cleanup Scenarios\n\n| **Scenario** | **Detection Method** | **Cleanup Time** |\n|--------------|---------------------|------------------|\n| User closes tab | `beforeunload` event | Immediate |\n| User switches tabs | `visibilitychange` + timeout | 30 seconds |\n| User logs out | `auth.onAuthStateChanged` | Immediate |\n| Browser crash | Background cleanup service | 60 seconds |\n| Network disconnect | Heartbeat failure | 45 seconds |\n\n## \uD83C\uDFAF Key Logic Patterns\n\n### 1. Optimistic Presence Tracking\n```javascript\n// Assume user is active until proven otherwise\nstartPresence() â†’ immediate UI update\nheartbeat() â†’ keep alive signal\nnoHeartbeat(45s) â†’ assume user left\n```\n\n### 2. Multi-layer Cleanup\n```javascript\n// Layer 1: Immediate cleanup\nwindow.addEventListener(\'beforeunload\', cleanup)\n\n// Layer 2: Tab switching\ndocument.hidden + setTimeout(30s)\n\n// Layer 3: Background sweeper\nsetInterval(cleanupStale, 30s) // Removes anything > 60s old\n```\n\n### 3. Defensive Programming\n```javascript\n// Always check authentication\nif (!auth.currentUser) return;\n\n// Always handle Firebase errors\ntry { updatePresence() } \ncatch { stopHeartbeat() }\n\n// Always validate data\nif (!userProfile) return;\n```\n\n## \uD83D\uDD04 Real-time Update Cycle\n\n```\nUser A opens article\n     â†“\nDocument created: articlePresence/article123_userA\n     â†“\nUser B opens same article  \n     â†“\nDocument created: articlePresence/article123_userB\n     â†“\nBoth users subscribe to: "WHERE articleId = \'article123\' AND lastSeen > now-45s"\n     â†“\nFirebase sends real-time updates to both users\n     â†“\nEach user sees the other in their ActiveReaders component\n```\n\n## \uD83C\uDFA8 UI Rendering Logic\n\n```javascript\n// Authentication Gate\nif (!isAuthenticated) return null;\n\n// Empty State\nif (activeUsers.length === 0) return null;\n\n// Render State\nreturn (\n  <Stack>\n    {users.slice(0,5).map((user, index) => (\n      <Avatar \n        left={index * 20px}  // 20px overlap\n        zIndex={5 - index}   // First user on top\n        color={colors[index % 8]}\n      />\n    ))}\n    <GreenDot position="after-last-avatar" />\n    <Text>{users.length} people reading</Text>\n  </Stack>\n)\n```\n\n## âš¡ Performance Optimizations\n\n### 1. Efficient Queries\n```javascript\n// Only get recent users (45s window)\nwhere(\'lastSeen\', \'>\', cutoffTime)\n// Limit results\n.limit(10)\n// Order by recency  \n.orderBy(\'lastSeen\', \'desc\')\n```\n\n### 2. Smart Heartbeat\n```javascript\n// Only update if conditions are met\nif (auth.currentUser && !document.hidden) {\n  updatePresence()\n}\n```\n\n### 3. Automatic Cleanup\n```javascript\n// Background service removes stale data\nsetInterval(removeOldDocuments, 30000)\n```\n\n## \uD83D\uDD10 Security & Privacy\n\n```javascript\n// Authentication Required\nif (!user) return "Cannot start presence";\n\n// Profile Data Required  \nif (!userProfile) return "No profile found";\n\n// Firebase Security Rules (recommended)\nrules_version = \'2\';\nservice cloud.firestore {\n  match /articlePresence/{document} {\n    allow read, write: if request.auth != null \n      && request.auth.uid == resource.data.uid;\n  }\n}\n```\n\n## \uD83C\uDFAF Why This Design?\n\n1. **Resilient**: Multiple cleanup mechanisms handle edge cases\n2. **Real-time**: Firebase listeners provide instant updates\n3. **Efficient**: Short heartbeat + aggressive cleanup = minimal database load\n4. **Scalable**: Works with 1 user or 1000 users per article\n5. **Private**: Only authenticated users with profiles participate\n6. **Accurate**: 45-second window ensures users are actually active\n\n## \uD83D\uDE80 Integration\n\nThe feature is integrated into both article routes:\n- `/articles/[id]` - Individual article pages\n- `/articles?slug=` - Slug-based article pages\n\n### Example Usage\n```tsx\nimport ActiveReaders from \'@/components/ActiveReaders\';\n\n// In article header\n<div className={styles.articleHeaderWithReaders}>\n  <div className={styles.titleSection}>\n    <h1>{article.title}</h1>\n  </div>\n  <div className={styles.readersSection}>\n    <ActiveReaders articleId={article.id} />\n  </div>\n</div>\n```\n\nThis creates a Google Docs-like experience where you can see who\'s actively reading the same content as you in real-time! \uD83D\uDE80\n\n**Result**: Users will disappear from the "reading" indicator within **45 seconds** of actually leaving, with no ghost users showing as "active" when they\'ve logged out or closed their browser.\n  '},{id:"messaging-system",title:"Advanced Messaging System",content:"\n## Comprehensive Messaging Features\n\nOur messaging system includes advanced features like @mentions, profile card sharing, real-time notifications, and WhatsApp-style avatars. Here's a complete breakdown for new interns:\n\n### 1. @Mention Functionality with Profile Card Sharing\n\nUsers can type `@username` to search for and send profile cards in messages.\n\n#### Implementation Details:\n\n```tsx\n// In ChatView.tsx - Real-time @mention detection\nconst handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n  const value = e.target.value;\n  setMessage(value);\n\n  // Detect @mention patterns\n  const mentionMatch = value.match(/@([a-zA-Z0-9_.]*)$/);\n  \n  if (mentionMatch) {\n    const searchTerm = mentionMatch[1];\n    if (searchTerm.length > 0) {\n      // Debounced search to avoid excessive API calls\n      debouncedSearch(searchTerm);\n    } else {\n      setMentionUsers([]);\n      setShowMentions(false);\n    }\n  } else {\n    setMentionUsers([]);\n    setShowMentions(false);\n  }\n};\n\n// Debounced search function (300ms delay)\nconst debouncedSearch = useMemo(\n  () => debounce(async (searchTerm: string) => {\n    if (!searchTerm.trim()) return;\n    \n    try {\n      const users = await searchUsers(searchTerm);\n      setMentionUsers(users.slice(0, 5)); // Limit to 5 results\n      setShowMentions(true);\n    } catch (error) {\n      console.error('Error searching users:', error);\n    }\n  }, 300),\n  []\n);\n```\n\n#### Profile Card Message Type:\n\n```tsx\n// Message interface supports profile attachments\nexport interface Message {\n  id: string;\n  conversationId: string;\n  senderId: string;\n  receiverId: string;\n  content: string;\n  type: 'text' | 'image' | 'profile'; // Profile type for profile cards\n  timestamp: Timestamp;\n  read: boolean;\n  profileAttachment?: {\n    uid: string;\n    username: string;\n    firstName: string;\n    lastName: string;\n    bio?: string;\n  };\n}\n\n// Sending profile messages\nexport async function sendProfileMessage(\n  conversationId: string,\n  receiverId: string,\n  profileData: ProfileData\n): Promise<string> {\n  const currentUser = auth.currentUser;\n  if (!currentUser) throw new Error('User must be authenticated');\n\n  const messagesRef = collection(db, 'messages');\n  const newMessage = {\n    conversationId,\n    senderId: currentUser.uid,\n    receiverId,\n    content: `Shared ${profileData.firstName} ${profileData.lastName}'s profile`,\n    type: 'profile',\n    timestamp: serverTimestamp(),\n    read: false,\n    profileAttachment: profileData\n  };\n\n  return await addDoc(messagesRef, newMessage);\n}\n```\n\n### 2. WhatsApp-Style Avatar System\n\nMessages display user avatars with smart grouping logic - only showing avatars for the other person's messages and only on the last message in a consecutive group.\n\n#### Avatar Logic Implementation:\n\n```tsx\n// Smart avatar grouping in ChatView.tsx\nconst shouldShowAvatar = (message: Message, index: number, messages: Message[]) => {\n  // Only show avatars for other person's messages (not your own)\n  if (message.senderId === currentUser?.uid) return false;\n  \n  // Show avatar if this is the last message in a group from the same sender\n  const nextMessage = messages[index + 1];\n  \n  // Show if: no next message OR next message is from different sender\n  return !nextMessage || nextMessage.senderId !== message.senderId;\n};\n\n// Avatar rendering with gradient backgrounds\nconst renderAvatar = (message: Message) => {\n  if (message.senderId === currentUser?.uid) {\n    // Own messages: green-blue gradient\n    return (\n      <div style={{\n        width: '32px',\n        height: '32px',\n        borderRadius: '50%',\n        background: 'linear-gradient(135deg, #10b981, #3b82f6)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        color: 'white',\n        fontSize: '14px',\n        fontWeight: '600'\n      }}>\n        {getInitials(currentUser.displayName)}\n      </div>\n    );\n  } else {\n    // Other person's messages: blue-purple gradient\n    return (\n      <div style={{\n        width: '32px',\n        height: '32px',\n        borderRadius: '50%',\n        background: 'linear-gradient(135deg, #3b82f6, #8b5cf6)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        color: 'white',\n        fontSize: '14px',\n        fontWeight: '600'\n      }}>\n        {getInitials(otherUser?.firstName, otherUser?.lastName)}\n      </div>\n    );\n  }\n};\n```\n\n### 3. Real-Time Message Notifications\n\nMessage notification bells appear in headers across the app with real-time unread count updates.\n\n#### Implementation in Headers:\n\n```tsx\n// MessageNotificationBell component with real-time updates\nimport { subscribeToConversations } from '@/services/messagesService';\n\nconst MessageNotificationBell: React.FC = () => {\n  const [user] = useAuthState(auth);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  useEffect(() => {\n    if (!user) return;\n\n    // Real-time subscription to conversations\n    const unsubscribe = subscribeToConversations(user.uid, (conversations) => {\n      const totalUnread = conversations.reduce((total, conv) => total + conv.unreadCount, 0);\n      setUnreadCount(totalUnread);\n    });\n    \n    // Fallback periodic update every 30 seconds\n    const interval = setInterval(async () => {\n      try {\n        const count = await getTotalUnreadCount(user.uid);\n        setUnreadCount(count);\n      } catch (error) {\n        console.error('Error getting message unread count:', error);\n      }\n    }, 30000);\n    \n    return () => {\n      unsubscribe();\n      clearInterval(interval);\n    };\n  }, [user]);\n\n  return (\n    <Link href=\"/messages\">\n      <button className={styles.button}>\n        <MessageIcon />\n        {unreadCount > 0 && (\n          <span className={styles.badge}>{unreadCount}</span>\n        )}\n      </button>\n    </Link>\n  );\n};\n```\n\n#### Badge Positioning CSS:\n\n```css\n/* Proper notification badge positioning */\n.badge {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  background-color: #e53935;\n  color: white;\n  font-size: 10px;\n  font-weight: 600;\n  min-width: 16px;\n  height: 16px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 3px;\n  border: 2px solid white;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  z-index: 10;\n  transform: translate(50%, -50%); /* Positions at icon edge */\n}\n```\n\n### 4. Real-Time Message Updates\n\nThe system uses Firestore's `onSnapshot` for real-time message updates:\n\n```tsx\n// Real-time message subscription\nexport function subscribeToMessages(\n  conversationId: string,\n  callback: (messages: Message[]) => void,\n  messageLimit: number = 50\n): () => void {\n  const messagesRef = collection(db, 'messages');\n  const q = query(\n    messagesRef,\n    where('conversationId', '==', conversationId),\n    orderBy('timestamp', 'desc'),\n    limit(messageLimit)\n  );\n\n  return onSnapshot(q, (snapshot) => {\n    const messages = snapshot.docs\n      .map(doc => ({ id: doc.id, ...doc.data() } as Message))\n      .reverse(); // Reverse to show oldest first\n    \n    callback(messages);\n  });\n}\n\n// Real-time conversation updates\nexport function subscribeToConversations(\n  userId: string,\n  callback: (conversations: ConversationWithUser[]) => void\n): () => void {\n  const conversationsRef = collection(db, 'conversations');\n  const q = query(\n    conversationsRef,\n    where('participants', 'array-contains', userId),\n    orderBy('updatedAt', 'desc')\n  );\n\n  return onSnapshot(q, async (snapshot) => {\n    const conversationsWithUsers = await Promise.all(\n      snapshot.docs.map(async (doc) => {\n        const conversation = { id: doc.id, ...doc.data() } as Conversation;\n        const otherUserId = conversation.participants.find(id => id !== userId);\n        \n        if (!otherUserId) return null;\n        \n        const otherUser = await getCachedUserProfile(otherUserId);\n        const unreadCount = await getCachedUnreadCount(conversation.id, userId);\n        \n        return {\n          conversation,\n          otherUser,\n          unreadCount\n        };\n      })\n    );\n    \n    callback(conversationsWithUsers.filter(Boolean) as ConversationWithUser[]);\n  });\n}\n```\n\n### 5. Performance Optimizations\n\n#### Caching Strategy:\n\n```tsx\n// User profile cache to reduce Firebase queries\nconst userProfileCache = new Map<string, { profile: any; timestamp: number }>();\nconst unreadCountCache = new Map<string, { count: number; timestamp: number }>();\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\nconst UNREAD_CACHE_DURATION = 30 * 1000; // 30 seconds for unread counts\n\nasync function getCachedUserProfile(userId: string) {\n  const cached = userProfileCache.get(userId);\n  const now = Date.now();\n\n  if (cached && (now - cached.timestamp) < CACHE_DURATION) {\n    return cached.profile;\n  }\n\n  const profile = await getUserProfile(userId);\n  if (profile) {\n    userProfileCache.set(userId, { profile, timestamp: now });\n  }\n\n  return profile;\n}\n```\n\n### 6. Mobile Navigation Integration\n\nMessages tab integrated into mobile bottom navigation:\n\n```tsx\n// MobileBottomNav.tsx - Updated navigation\nconst navigationItems = [\n  { name: 'Home', href: '/', icon: HomeIcon },\n  { name: 'Explore', href: '/explore', icon: CompassIcon },\n  { name: 'Compose', href: '/create-article', icon: PenIcon },\n  { name: 'Messages', href: '/messages', icon: MessageIcon }, // New Messages tab\n  { name: 'Profile', href: '/my-profile', icon: UserIcon },\n];\n```\n\n### 7. File Structure for Messaging\n\n```\n/src\n  /components\n    /messages\n      ChatView.tsx              # Main chat interface\n      ConversationsList.tsx     # List of conversations\n      ProfileCard.tsx           # Profile card component\n      UserMentionDropdown.tsx   # @mention dropdown\n    MessageNotificationBell.tsx # Notification bell component\n  /services\n    messagesService.ts          # Core messaging logic\n  /app\n    /messages\n      page.tsx                  # Messages page layout\n```\n\n### Key Features Summary:\n\nâœ… **@Mention Functionality**: Type @username to share profile cards  \nâœ… **WhatsApp-Style Avatars**: Smart avatar grouping (other person only, last in group)  \nâœ… **Real-Time Notifications**: Instant unread count updates across the app  \nâœ… **Profile Card Sharing**: Rich profile cards with user info and \"View Profile\" button  \nâœ… **Performance Optimization**: Intelligent caching and debounced searches  \nâœ… **Mobile Integration**: Dedicated Messages tab in mobile navigation  \nâœ… **Real-Time Updates**: Instant message delivery and read status updates  \n\nThis messaging system provides a modern, feature-rich communication experience similar to popular social media platforms! \uD83D\uDE80\n  "},{id:"memory-optimization",title:"Memory Optimization Guide",content:'\n## Memory Optimization Strategies\n\nDuring development, we successfully reduced memory usage from 2GB+ to 500-600MB (70% reduction) using proven optimization techniques. Here\'s what interns should know:\n\n### \uD83C\uDFAF **Problem Identification**\n\nBefore optimization, our dev server was consuming excessive memory due to:\n- 25+ Firebase onSnapshot subscriptions running simultaneously\n- Presence service with 15-second heartbeat intervals  \n- Multiple notification polling at 30-60 second intervals\n- DOM event listeners not properly cleaned up\n- Heavy development dependencies (Storybook 54MB, Firebase SDK 33MB)\n- Performance-heavy components with memory leaks\n\n### \uD83D\uDD27 **Applied Solutions**\n\n#### 1. **Firebase Service Optimization**\n\n```typescript\n// Before: Aggressive polling\nconst HEARTBEAT_INTERVAL = 15000; // 15 seconds\nconst CLEANUP_INTERVAL = 30000;   // 30 seconds\n\n// After: Optimized intervals\nconst HEARTBEAT_INTERVAL = 30000; // 30 seconds (2x reduction)  \nconst CLEANUP_INTERVAL = 60000;   // 60 seconds (2x reduction)\n\n// Added cleanup flag to prevent memory leaks\nexport class PresenceService {\n  private isDestroyed = false;\n  \n  destroy() {\n    this.isDestroyed = true;\n    // Cleanup all subscriptions and timers\n  }\n  \n  private updatePresence() {\n    if (this.isDestroyed) return; // Prevent updates after cleanup\n    // ... presence logic\n  }\n}\n```\n\n#### 2. **Component Memory Leak Prevention**\n\n```typescript\n// GradientPanel.tsx - Throttled DOM updates\nconst updateThemeRealTime = useMemo(() => {\n  let lastUpdate = 0;\n  return (config: ThemeConfig) => {\n    const now = Date.now();\n    // Throttle updates to max once every 100ms\n    if (now - lastUpdate < 100) return;\n    lastUpdate = now;\n    \n    // Batch DOM updates using requestAnimationFrame\n    requestAnimationFrame(() => {\n      const elements = document.querySelectorAll(\'[data-mood-element]\');\n      elements.forEach(element => {\n        if (element) {\n          element.style.backgroundImage = gradientCSS;\n          element.style.transition = \'background-image 0.2s ease\';\n        }\n      });\n\n      // Debounced localStorage saves (500ms)\n      clearTimeout(saveTimeout.current);\n      saveTimeout.current = setTimeout(() => {\n        localStorage.setItem(\'config\', JSON.stringify(config));\n      }, 500);\n    });\n  };\n}, []);\n\n// Cleanup on unmount\nuseEffect(() => {\n  return () => {\n    if (saveTimeout.current) {\n      clearTimeout(saveTimeout.current);\n    }\n  };\n}, []);\n```\n\n#### 3. **Next.js Memory Configuration**\n\n```javascript\n// next.config.js - Conservative memory limits\nconst nextConfig = {\n  experimental: {\n    turbo: {\n      memoryLimit: 1024 // 1GB limit for turbopack\n    }\n  }\n};\n\n// package.json - Memory-optimized scripts  \n{\n  "scripts": {\n    "dev": "next dev --turbopack",\n    "dev:memory": "NODE_OPTIONS=\'--max-old-space-size=1024\' next dev",\n    "dev:minimal": "NODE_OPTIONS=\'--max-old-space-size=1024\' next dev --turbopack"\n  }\n}\n```\n\n### \uD83D\uDCCA **Results Achieved**\n\n| Metric | Before | After | Improvement |\n|--------|--------|-------|-------------|\n| **RAM Usage** | 2GB+ | 500-600MB | **70% reduction** |\n| **next-server** | ~800MB | 226MB | **72% reduction** |\n| **node dev** | ~300MB | 81MB | **73% reduction** |\n| **Transform workers** | ~400MB | ~200MB | **50% reduction** |\n\n### \uD83D\uDEE1ï¸ **Key Principles Applied**\n\n1. **Throttling Over Elimination**\n   - Reduce frequency instead of removing functionality\n   - Use `requestAnimationFrame` for DOM updates\n   - Implement debouncing for expensive operations\n\n2. **Proper Cleanup Patterns**\n   ```typescript\n   useEffect(() => {\n     const subscription = service.subscribe(callback);\n     const timer = setInterval(update, 1000);\n     \n     return () => {\n       subscription.unsubscribe();\n       clearInterval(timer);\n     };\n   }, []);\n   ```\n\n3. **Memory-Conscious Event Handling**\n   ```typescript\n   // Bad: Creates new function on every render\n   <button onClick={() => handleClick(id)}>Click</button>\n   \n   // Good: Stable reference with useCallback\n   const handleClick = useCallback((id) => {\n     // Handle click\n   }, []);\n   ```\n\n4. **Development vs Production Separation**\n   - All optimizations target development mode only\n   - Production builds remain unchanged\n   - Use environment-specific configurations\n\n### \uD83D\uDD0D **Monitoring Commands**\n\n```bash\n# Monitor memory usage during development\nps aux | grep node | grep -v grep\n\n# Check specific process memory\ntop -pid $(pgrep -f "next-server")\n\n# Monitor in real-time\nwatch -n 2 "ps aux | grep next | grep -v grep"\n```\n\n### âš ï¸ **Common Pitfalls to Avoid**\n\n1. **Over-optimization**: Don\'t sacrifice functionality for minor memory gains\n2. **Aggressive Cleanup**: Some services need persistence across page changes  \n3. **Production Impact**: Never apply development optimizations to production\n4. **Premature Optimization**: Profile first, optimize based on data\n\n### \uD83D\uDE80 **Best Practices for New Features**\n\n- **Profile Before Building**: Use browser dev tools to identify bottlenecks\n- **Implement Cleanup**: Always clean up subscriptions, timers, and event listeners\n- **Use React Profiler**: Identify expensive re-renders and optimize accordingly\n- **Monitor Memory**: Regularly check memory usage during development\n- **Test Optimizations**: Verify that optimizations don\'t break functionality\n\n### \uD83D\uDCC8 **Recommended Development Workflow**\n\n1. **Start Development**: `npm run dev:memory` (uses 1GB memory limit)\n2. **Monitor Performance**: Use browser dev tools and terminal commands\n3. **Identify Issues**: Look for memory leaks, excessive re-renders, or polling\n4. **Apply Optimizations**: Use throttling, debouncing, and proper cleanup\n5. **Test & Verify**: Ensure functionality remains intact\n6. **Document Changes**: Update this guide with new optimization techniques\n\nThis memory optimization work demonstrates that with careful analysis and targeted improvements, significant performance gains are achievable without sacrificing functionality! \uD83C\uDFAF\n  '},{id:"security-audit",title:"Security Audit & Hardening",content:"\n## Security Audit Results âœ…\n\n### **API Key Security**\n- âœ… All API keys use environment variables\n- âœ… GitHub Secrets configured for CI/CD\n- âœ… No hardcoded secrets in codebase\n- âœ… Production console logs sanitized\n\n### **Security Headers Implemented**\n```javascript\n// next.config.js security headers\nX-Frame-Options: DENY\nX-Content-Type-Options: nosniff\nReferrer-Policy: strict-origin-when-cross-origin\nContent-Security-Policy: Comprehensive CSP rules\nPermissions-Policy: Disabled unnecessary permissions\n```\n\n### **Content Security Policy**\n- **Scripts**: Self, Google Analytics only\n- **Styles**: Self, Google Fonts\n- **Images**: Self, HTTPS, data URLs, blob\n- **Connect**: Firebase, Guardian API, NewsAPI\n- **Frame**: Completely disabled\n\n### **Production Hardening**\n- Console logs removed in production (except errors/warnings)\n- Powered-by header disabled\n- SWC minification enabled\n- Bundle splitting optimized\n\n### **Environment Variables**\n```bash\n# Required in GitHub Secrets\nGUARDIAN_API_KEY=your_guardian_key\nNEWS_API_KEY=your_news_key\nNEXT_PUBLIC_FIREBASE_API_KEY=your_firebase_key\n# ... other Firebase config\n```\n  "},{id:"performance-optimization",title:"Performance Optimization",content:"\n## Performance Enhancements \uD83D\uDE80\n\n### **Bundle Optimization**\n- **Code Splitting**: Vendor, Firebase, ProseMirror chunks\n- **Tree Shaking**: Unused code elimination\n- **Dynamic Imports**: Lazy loading for heavy components\n- **SWC Minification**: Faster than Terser\n\n### **Caching Strategy**\n```typescript\n// API Response Caching (5 minutes)\nimport { apiCache } from '@/utils/performance';\n\n// Cache Guardian articles\nconst cacheKey = `guardian-${section}-${page}`;\nconst cached = apiCache.get(cacheKey);\nif (cached) return cached;\n\nconst data = await guardianService.searchArticles(...);\napiCache.set(cacheKey, data);\n```\n\n### **Image Optimization**\n```typescript\n// Automatic WebP conversion for Unsplash\ngetOptimizedImageUrl(url, 800, 600, 80);\n// Outputs: url?w=800&h=600&q=80&fm=webp\n```\n\n### **Lazy Loading**\n- **Components**: Editor, ArticleComposer, ReflectionRoom\n- **Services**: Guardian, NewsAPI\n- **Images**: Intersection Observer with 50px margin\n- **Routes**: Next.js automatic code splitting\n\n### **Memory Management**\n- **Cache Cleanup**: Auto-clear when >100 entries\n- **Garbage Collection**: Development mode optimization\n- **Resource Preloading**: Critical CSS/JS\n\n### **Performance Monitoring**\n```typescript\nimport { measurePerformance } from '@/utils/performance';\n\nmeasurePerformance('API Call', () => {\n  return fetchArticles();\n});\n// Logs: Performance [API Call]: 245ms\n```\n\n### **Debouncing & Throttling**\n```typescript\n// Search input debouncing (300ms)\nconst debouncedSearch = debounce(handleSearch, 300);\n\n// Scroll event throttling (100ms)\nconst throttledScroll = throttle(handleScroll, 100);\n```\n  "},{id:"external-articles",title:"External Article Integration",content:"\n## Multi-Source Content System \uD83C\uDF10\n\n### **Integrated News Sources**\n1. **The Guardian API** - High-quality journalism\n2. **NewsAPI.org** - Global news aggregation  \n3. **Journalite** - Internal articles\n\n### **Content Distribution Strategy**\n```typescript\n// Homepage: 2 Journalite + 1 Guardian + 1 NewsAPI\n// Explore: Balanced mix with external priority\n// Categories: Interest-based article matching\n```\n\n### **Guardian API Integration**\n```typescript\n// Service: /src/services/guardianService.ts\nawait guardianService.searchArticles(\n  'climate change',  // query\n  'environment',     // section\n  1,                 // page\n  10                 // limit\n);\n\n// Features:\n- Article search by keywords\n- Section filtering (technology, science, etc.)\n- Full HTML content with images\n- Proper image positioning preservation\n- Author and metadata extraction\n```\n\n### **NewsAPI Integration**\n```typescript\n// Service: /src/services/newsService.ts\nawait newsService.getTopHeadlines('technology');\nawait newsService.searchArticles('artificial intelligence');\n\n// Features:\n- Top headlines by category\n- Global news search\n- Source attribution\n- Image optimization\n```\n\n### **Content Adaptation**\nAll external articles are converted to Journalite format:\n```typescript\ninterface BaseArticle {\n  id: string;\n  title: string;\n  slug: string;\n  authorName: string;\n  excerpt: string; // HTML cleaned\n  coverImageUrl?: string;\n  tags: string[];\n  source: 'journalite' | 'guardian' | 'newsapi';\n  isExternal: boolean;\n  externalUrl?: string;\n}\n```\n\n### **HTML Content Cleaning**\n```typescript\n// Removes HTML tags from previews\nconst cleanHtmlText = (html: string) => {\n  return html\n    .replace(/<[^>]*>/g, ' ')      // Remove tags\n    .replace(/s+/g, ' ')          // Clean whitespace\n    .replace(/&amp;/g, '&')        // Decode entities\n    .trim()\n    .substring(0, 200) + '...';    // Limit length\n};\n```\n\n### **Smart Content Categorization**\n```typescript\nconst INTEREST_MAPPING = {\n  'Technology': {\n    newsCategory: 'technology',\n    guardianSections: ['technology', 'science'],\n    keywords: ['tech', 'AI', 'software', 'digital']\n  },\n  // ... 20+ interest mappings\n};\n```\n\n### **Source Identification**\n- **Visual Badges**: Color-coded source indicators\n- **Guardian**: Dark blue (#052962)  \n- **NewsAPI**: Green (#10B981)\n- **Journalite**: Purple (#7C3AED)\n\n### **Error Handling**\n- Graceful API failures\n- Fallback to Journalite content\n- Retry mechanisms for network issues\n- Cache-first strategy\n  "},{id:"homepage-redesign",title:"Homepage Redesign",content:'\n## Modern Homepage Experience \uD83C\uDFA8\n\n### **Dual-Purpose Design**\n**Unauthenticated Users**: Landing page with hero section\n**Authenticated Users**: Personalized dashboard\n\n### **Hero Section (Unauthenticated)**\n```tsx\n<section className="hero-section">\n  <h1>Welcome to Journalite</h1>\n  <p>Where stories come alive through reflection</p>\n  <div className="cta-buttons">\n    <Link href="/register">Get Started</Link>\n    <Link href="/login">Sign In</Link>\n  </div>\n</section>\n```\n\n### **Welcome Dashboard (Authenticated)**\n```tsx\n<section className="welcome-section">\n  <h2>Welcome back, {user.displayName}</h2>\n  <div className="quick-actions">\n    <Link href="/explore">\uD83D\uDD0D Explore</Link>\n    <Link href="/compose">âœï¸ Write</Link>\n    <Link href="/my-thoughts">\uD83D\uDCAD My Thoughts</Link>\n  </div>\n</section>\n```\n\n### **Featured Articles**\n- **Mixed Content**: 2 Journalite + 1 Guardian + 1 NewsAPI\n- **Smart Image Selection**: Content-aware Unsplash images\n- **Glassmorphism Design**: Backdrop blur effects\n- **Hover Animations**: Smooth transitions\n\n### **Platform Features (Unauthenticated)**\n```tsx\nconst features = [\n  {\n    icon: <GlobeIcon />, // Professional SVG\n    title: "Diverse Sources",\n    description: "Curated content from trusted sources"\n  },\n  {\n    icon: <LightBulbIcon />,\n    title: "Personalized Feed", \n    description: "AI-powered content recommendations"\n  },\n  {\n    icon: <DocumentCheckIcon />,\n    title: "Reflection Tools",\n    description: "Deep thinking and mindful reading"\n  }\n];\n```\n\n### **Design System**\n```css\n/* Glassmorphism Effects */\n.glass-card {\n  background: rgba(255, 255, 255, 0.25);\n  backdrop-filter: blur(20px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  border-radius: 20px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n}\n\n/* Gradient Backgrounds */\n.gradient-bg {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n}\n\n/* Hover Animations */\n.hover-lift:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);\n}\n```\n\n### **Content-Aware Image Selection**\n```typescript\nconst imageCategories = {\n  \'Tech & Innovation\': [\n    \'https://images.unsplash.com/photo-1518709268805-4e9042af2176\',\n    \'https://images.unsplash.com/photo-1451187580459-43490279c0fa\'\n  ],\n  \'Culture & Society\': [\n    \'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d\',\n    \'https://images.unsplash.com/photo-1517077304055-6e89abbf09b0\'\n  ]\n  // ... more categories\n};\n\n// Smart matching based on article tags/content\nconst selectImageForArticle = (article) => {\n  const category = matchContentToCategory(article.tags, article.title);\n  return getRandomImage(imageCategories[category]);\n};\n```\n  '},{id:"explore-enhancements",title:"Explore Page Enhancements",content:"\n## Advanced Content Discovery \uD83D\uDD0D\n\n### **Multi-Source Content Strategy**\n```typescript\n// Content Distribution\nconst contentSources = {\n  journalite: 8,    // Reduced from 12\n  guardian: 18,     // 6 per interest \xd7 3 interests  \n  newsapi: 18,      // 6 per interest \xd7 3 interests\n  total: 44         // Before deduplication\n};\n```\n\n### **Intelligent Categorization**\n1. **Discover Stories** (Priority 100)\n   - 8 external articles + 4 Journalite\n   - Balanced source mixing\n   \n2. **For You/Featured** (Priority 95)\n   - Personalized based on interests\n   - Engagement scoring algorithm\n   \n3. **Latest News** (Priority 90)\n   - External articles only\n   - Guardian + NewsAPI content\n   \n4. **Interest Categories** (Priority 85)\n   - User's top 2 interests\n   - Mixed source content\n   \n5. **Trending on Journalite** (Priority 80)\n   - High engagement articles\n   - Journalite exclusive\n   \n6. **Latest Updates** (Priority 75)\n   - Recent from all sources\n\n### **Content Scoring Algorithm**\n```typescript\nconst scoreArticle = (article, userInterests) => {\n  let score = 0;\n  \n  // Interest keyword matching (+10 per match)\n  userInterests.forEach(interest => {\n    const keywords = INTEREST_MAPPING[interest].keywords;\n    keywords.forEach(keyword => {\n      if (article.content.includes(keyword)) score += 10;\n    });\n  });\n  \n  // Tag relevance (+15 per match)\n  article.tags.forEach(tag => {\n    if (userInterests.includes(tag)) score += 15;\n  });\n  \n  // Recency bonus\n  const daysSince = getDaysSincePublished(article.createdAt);\n  if (daysSince < 1) score += 5;\n  else if (daysSince < 7) score += 3;\n  \n  // Engagement metrics\n  score += (article.likes?.length || 0);\n  score += Math.log(article.viewCount || 1);\n  \n  return score;\n};\n```\n\n### **Deduplication System**\n```typescript\nconst deduplicateArticles = (articles) => {\n  const seen = new Set();\n  \n  return articles.filter(article => {\n    // Create unique key from title + URL\n    const titleKey = article.title.toLowerCase()\n      .replace(/[^ws]/g, '')\n      .replace(/s+/g, ' ')\n      .trim();\n    const key = `${titleKey}|${article.url || ''}`;\n    \n    // Check for similar titles (first 50 chars)\n    const isDuplicate = Array.from(seen).some(existingKey => {\n      const existingTitle = existingKey.split('|')[0].substring(0, 50);\n      const currentTitle = titleKey.substring(0, 50);\n      return existingTitle === currentTitle;\n    });\n    \n    if (!seen.has(key) && !isDuplicate) {\n      seen.add(key);\n      return true;\n    }\n    return false;\n  });\n};\n```\n\n### **Performance Monitoring**\n```typescript\n// Detailed logging for debugging\nconsole.log('\uD83D\uDCCA Final categories:', categoriesData.map(cat => ({\n  name: cat.name,\n  count: cat.articles.length,\n  sources: {\n    journalite: cat.articles.filter(a => a.source === 'journalite').length,\n    guardian: cat.articles.filter(a => a.source === 'guardian').length,\n    newsapi: cat.articles.filter(a => a.source === 'newsapi').length\n  }\n})));\n```\n\n### **Fallback Strategies**\n1. **API Failure**: Fall back to Journalite only\n2. **No External Content**: Try general categories\n3. **Empty Categories**: Hide from UI\n4. **Network Issues**: Show cached content\n\n### **Interest Mapping System**\n```typescript\n// 20+ interest categories mapped to:\nconst INTEREST_MAPPING = {\n  'Technology': {\n    newsCategory: 'technology',           // NewsAPI category\n    guardianSections: ['technology'],     // Guardian sections\n    keywords: ['tech', 'AI', 'software'] // Search keywords\n  }\n  // ... comprehensive mapping\n};\n```\n  "},{id:"guardian-integration",title:"Guardian API Deep Dive",content:"\n## The Guardian Integration \uD83D\uDCF0\n\n### **API Configuration**\n```typescript\nclass GuardianService {\n  private apiKey: string;\n  private baseUrl = 'https://content.guardianapis.com';\n  \n  // Rate limiting: 1 req/sec, 500/day\n  // Free tier: Non-commercial use only\n}\n```\n\n### **Content Preservation**\n**Problem**: Original implementation added images at the bottom\n**Solution**: Preserve Guardian's original HTML structure\n\n```typescript\nconvertToArticleFormat(article: GuardianArticle) {\n  let bodyContent = article.fields?.body || '';\n  \n  if (bodyContent) {\n    // Enhance existing images without moving them\n    bodyContent = bodyContent.replace(\n      /<img([^>]*?)>/g,\n      (match, attrs) => {\n        return `<img ${attrs} style=\"max-width: 100%; height: auto; margin: 2em auto; display: block; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);\" />`;\n      }\n    );\n    \n    // Enhance figure elements\n    bodyContent = bodyContent.replace(\n      /<figure([^>]*?)>/g,\n      (match, attrs) => {\n        return `<figure ${attrs} style=\"margin: 2em auto; text-align: center;\">`;\n      }\n    );\n  }\n  \n  // Only add fallback images if body has none\n  const hasImagesInBody = bodyContent.includes('<img');\n  if (!hasImagesInBody && article.elements) {\n    // Add main image at top, not bottom\n    const mainImage = article.elements.find(el => el.type === 'image');\n    if (mainImage) {\n      bodyContent = `<figure>${imageHtml}</figure>` + bodyContent;\n    }\n  }\n}\n```\n\n### **Article Fields Available**\n```typescript\ninterface GuardianArticle {\n  id: string;                    // Unique identifier\n  webTitle: string;              // Article title\n  webUrl: string;                // Original URL\n  webPublicationDate: string;    // ISO date\n  sectionName: string;           // e.g., \"Technology\"\n  pillarName: string;            // e.g., \"News\"\n  \n  fields?: {\n    headline?: string;           // Often better than webTitle\n    standfirst?: string;         // Article summary\n    body?: string;               // Full HTML content\n    bodyText?: string;           // Plain text version\n    trailText?: string;          // Preview text\n    main?: string;               // Main image URL\n    thumbnail?: string;          // Thumbnail URL\n    byline?: string;             // Author info\n  };\n  \n  elements?: Array<{             // Media elements\n    type: 'image' | 'video';\n    assets: Array<{\n      type: string;\n      file: string;              // Media URL\n      typeData: {\n        secureFile?: string;     // HTTPS URL\n        caption?: string;        // Image caption\n        alt?: string;            // Alt text\n        width?: number;\n        height?: number;\n      };\n    }>;\n  }>;\n  \n  tags: Array<{                  // Article tags\n    id: string;\n    type: 'contributor' | 'keyword';\n    webTitle: string;\n  }>;\n}\n```\n\n### **Search Capabilities**\n```typescript\n// Keyword search\nawait guardianService.searchArticles('climate change');\n\n// Section filtering\nawait guardianService.searchArticles('', 'environment');\n\n// Combined search\nawait guardianService.searchArticles('renewable energy', 'environment');\n\n// Boolean search\nawait guardianService.searchArticles('climate AND (warming OR change)');\n\n// Date range\nawait guardianService.searchArticles('brexit', 'politics', 1, 10, {\n  fromDate: '2023-01-01',\n  toDate: '2023-12-31'\n});\n```\n\n### **Available Sections**\n- `world` - World news\n- `politics` - Politics  \n- `business` - Business\n- `technology` - Technology\n- `science` - Science\n- `environment` - Environment & climate\n- `sport` - Sports\n- `culture` - Arts, books, music, film\n- `lifeandstyle` - Lifestyle\n- `opinion` - Opinion & commentary\n\n### **Image Handling Strategy**\n1. **Preserve Original Layout**: Keep images where Guardian placed them\n2. **Enhance Styling**: Add responsive CSS, shadows, borders\n3. **Fallback Images**: Only add if body content has no images\n4. **Caption Support**: Maintain figcaption elements\n5. **Performance**: Lazy loading with intersection observer\n  "}];function m(){let[e,n]=(0,o.J0)([]),[t,a]=(0,o.J0)([]),[l,c]=(0,o.J0)(!0),[u,m]=(0,o.J0)(null),[g,h]=(0,o.J0)(""),[p,f]=(0,o.J0)(!1),[_,y]=(0,o.J0)({total:0,admins:0,developers:0,regular:0});(0,o.vJ)(()=>{!async function(){try{c(!0);let e=(0,i.query)((0,i.collection)(s.db,"users"),(0,i.limit)(50)),t=(await (0,i.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()})),r=t.filter(e=>"admin"===e.role).length,o=t.filter(e=>"developer"===e.role).length,l=t.filter(e=>!e.role||"user"===e.role).length;y({total:t.length,admins:r,developers:o,regular:l}),n(t),a(t)}catch(e){console.error("Error fetching users:",e),m("Failed to load users")}finally{c(!1)}}()},[]),(0,o.vJ)(()=>{if(g.trim()){let n=g.toLowerCase();a(e.filter(e=>{var t,r,o;return(null==(t=e.name)?void 0:t.toLowerCase().includes(n))||(null==(r=e.email)?void 0:r.toLowerCase().includes(n))||(null==(o=e.username)?void 0:o.toLowerCase().includes(n))||!1})),f(!0)}else a(e),f(!1)},[g,e]);let b=async(t,r)=>{try{let o=(0,i.doc)(s.db,"users",t);await (0,i.updateDoc)(o,{role:r});let l=e.map(e=>e.id===t?{...e,role:r}:e);if(n(l),g.trim()){let e=g.toLowerCase();a(l.filter(n=>{var t,r,o;return(null==(t=n.name)?void 0:t.toLowerCase().includes(e))||(null==(r=n.email)?void 0:r.toLowerCase().includes(e))||(null==(o=n.username)?void 0:o.toLowerCase().includes(e))||!1}))}else a(l);let c=l.filter(e=>"admin"===e.role).length,d=l.filter(e=>"developer"===e.role).length,u=l.filter(e=>!e.role||"user"===e.role).length;y({total:l.length,admins:c,developers:d,regular:u})}catch(e){console.error("Error updating user role:",e),alert("Failed to update user role")}},v=e=>e?e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().substring(0,2):"?",w=e=>e?e.charAt(0).toUpperCase():"?",x=e=>{switch(e){case"admin":return d().adminAvatar;case"developer":return d().developerAvatar;default:return""}},S=e=>{switch(e){case"admin":return d().searchResultRoleAdmin;case"developer":return d().searchResultRoleDeveloper;default:return d().searchResultRoleUser}},C=()=>{h(""),f(!1)};return l?(0,r.jsxs)("div",{className:d().loading,children:[(0,r.jsx)("div",{className:d().loadingSpinner}),"Loading users..."]}):u?(0,r.jsx)("div",{className:d().errorMessage,children:u}):(0,r.jsxs)("div",{className:d().userManagementContainer,children:[(0,r.jsx)("h2",{className:d().sectionTitle,children:"User Management"}),(0,r.jsxs)("div",{className:d().statsContainer,children:[(0,r.jsxs)("div",{className:d().statBox,children:[(0,r.jsx)("span",{className:d().statNumber,children:_.total}),(0,r.jsx)("span",{className:d().statLabel,children:"Total Users"})]}),(0,r.jsxs)("div",{className:d().statBox,children:[(0,r.jsx)("span",{className:d().statNumber,children:_.admins}),(0,r.jsx)("span",{className:d().statLabel,children:"Admins"})]}),(0,r.jsxs)("div",{className:d().statBox,children:[(0,r.jsx)("span",{className:d().statNumber,children:_.developers}),(0,r.jsx)("span",{className:d().statLabel,children:"Developers"})]}),(0,r.jsxs)("div",{className:d().statBox,children:[(0,r.jsx)("span",{className:d().statNumber,children:_.regular}),(0,r.jsx)("span",{className:d().statLabel,children:"Regular Users"})]})]}),(0,r.jsx)("div",{className:d().searchContainer,children:(0,r.jsxs)("div",{className:d().searchInputWrapper,children:[(0,r.jsx)("input",{type:"text",placeholder:"Search users by name, email, or username...",value:g,onChange:e=>h(e.target.value),className:d().searchInput}),g&&(0,r.jsx)("button",{onClick:C,className:d().clearSearchButton,"aria-label":"Clear search",children:"\xd7"})]})}),p?(0,r.jsxs)("div",{className:d().searchResultsContainer,children:[(0,r.jsxs)("h3",{className:d().searchResultsTitle,children:["Search Results (",t.length,")",t.length>0&&(0,r.jsx)("button",{className:d().backToAllButton,onClick:C,children:"Back to all users"})]}),0===t.length?(0,r.jsxs)("div",{className:d().noResults,children:['No users found matching "',g,'"']}):(0,r.jsx)("div",{className:d().searchResults,children:t.map(e=>(0,r.jsxs)("div",{className:d().searchResultItem,children:[(0,r.jsx)("div",{className:"".concat(d().searchResultAvatar," ").concat(x(e.role)),"data-initial":w(e.name),children:v(e.name)}),(0,r.jsxs)("div",{className:d().searchResultInfo,children:[(0,r.jsx)("div",{className:d().searchResultName,children:e.name||"Unnamed User"}),(0,r.jsx)("div",{className:d().searchResultUsername,children:e.email||e.username||"No contact info"})]}),(0,r.jsx)("div",{className:"".concat(d().searchResultRole," ").concat(S(e.role)),children:e.role||"user"}),(0,r.jsxs)("select",{value:e.role||"user",onChange:n=>b(e.id,n.target.value),className:d().roleSelect,children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"developer",children:"Developer"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})]},e.id))})]}):(0,r.jsx)("div",{className:d().usersTableContainer,children:(0,r.jsxs)("table",{className:d().usersTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Name"}),(0,r.jsx)("th",{children:"Email"}),(0,r.jsx)("th",{children:"Username"}),(0,r.jsx)("th",{children:"Role"}),(0,r.jsx)("th",{children:"Actions"})]})}),(0,r.jsx)("tbody",{children:0===t.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:d().noResults,children:"No users found"})}):t.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsxs)("div",{className:d().userTableCell,children:[(0,r.jsx)("span",{className:"".concat(d().userAvatar," ").concat(x(e.role)),"data-initial":w(e.name),children:v(e.name)}),e.name||"N/A"]})}),(0,r.jsx)("td",{children:e.email||"N/A"}),(0,r.jsx)("td",{children:e.username||"N/A"}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"".concat(d().roleTag," ").concat(S(e.role)),children:e.role||"user"})}),(0,r.jsx)("td",{children:(0,r.jsxs)("select",{value:e.role||"user",onChange:n=>b(e.id,n.target.value),className:d().roleSelect,children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"developer",children:"Developer"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]})})]},e.id))})]})})]})}function g(){let[e,n]=(0,o.J0)(""),[t,a]=(0,o.J0)(u[0].id),[i,s]=(0,o.J0)(u);(0,o.vJ)(()=>{if(!e.trim())return void s(u);let n=e.toLowerCase(),r=u.filter(e=>e.title.toLowerCase().includes(n)||e.content.toLowerCase().includes(n));s(r),r.length>0&&!r.some(e=>e.id===t)&&a(r[0].id)},[e,t]);let l=e=>{a(e),window.scrollTo(0,0)};(0,o.vJ)(()=>{document.querySelectorAll(".".concat(d().copyButton)).forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();let t=e.closest(".".concat(d().codeBlock));if(!t)return;let r=t.querySelector(".".concat(d().codeContent));if(!r)return;let o=r.textContent||"";navigator.clipboard.writeText(o).then(()=>{let n=e.innerText;e.innerText="Copied!",setTimeout(()=>{e.innerText=n},2e3)})})})},[t,i]);let c=i.find(e=>e.id===t)||i[0],m="doc-content-".concat((null==c?void 0:c.id)||"empty","-").concat(Date.now());return(0,r.jsxs)("div",{className:d().documentationContainer,children:[(0,r.jsxs)("div",{className:d().docSidebar,children:[(0,r.jsx)("div",{className:d().docSearchContainer,children:(0,r.jsx)("input",{type:"text",placeholder:"Search documentation...",value:e,onChange:e=>n(e.target.value),className:d().docSearchInput})}),(0,r.jsx)("nav",{className:d().docNav,children:i.map(e=>(0,r.jsx)("button",{onClick:()=>l(e.id),className:"".concat(d().docNavItem," ").concat(t===e.id?d().docNavItemActive:""),children:e.title},e.id))})]}),(0,r.jsx)("div",{className:d().docContent,children:0===i.length?(0,r.jsx)("div",{className:d().noResults,children:"No documentation sections match your search."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:d().docTitle,children:c.title}),(0,r.jsx)("div",{className:d().docText,dangerouslySetInnerHTML:{__html:function(e){let n=e=>{switch(e){case"tsx":return"Component.tsx";case"ts":return"index.ts";case"js":return"script.js";case"jsx":return"Component.jsx";case"html":return"index.html";case"css":return"styles.css";case"json":return"config.json";default:return"example.code"}},t=(e,n)=>["ts","tsx","js","jsx"].includes(n)?e.replace(/\b(const|let|var|function|class|interface|type|enum|import|export|from|as|return|if|else|for|while|switch|case|break|default|try|catch|finally|async|await|new|this|extends|implements|private|public|protected|static|get|set|super|void|yield)\b/g,'<span class="'+d().keyword+'">$1</span>').replace(/(["'`])((?:\\\1|(?!\1).)*?)\1/g,'<span class="'+d().string+'">$1$2$1</span>').replace(/(`)((?:[^`]|\\.)*?)(`)/g,function(e,n,t,r){let o=t.replace(/(\${)(.*?)(})/g,'<span class="'+d().operator+'">$1</span><span class="'+d().variable+'">$2</span><span class="'+d().operator+'">$3</span>');return'<span class="'+d().string+'">'+n+o+r+"</span>"}).replace(/(\/\/.*?)($|\n)/g,'<span class="'+d().comment+'">$1</span>$2').replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="'+d().comment+'">$1</span>').replace(/(&lt;|\<)([A-Z][A-Za-z0-9]*|[a-z][A-Za-z0-9]*|\/?&gt;|\/?>\s*$)/g,function(e,n,t){return'<span class="'+d().operator+'">'+n+'</span><span class="'+d().type+'">'+t+"</span>"}).replace(/(\s)([A-Za-z_$][A-Za-z0-9_$]*)(\s*\()/g,'$1<span class="'+d().function+'">$2</span>$3').replace(/\b(string|number|boolean|any|void|null|undefined|never|object|Symbol|Array|Promise|Record|Partial|Readonly|Required|Pick|Omit|Exclude|Extract|NonNullable|ReturnType)\b/g,'<span class="'+d().type+'">$1</span>').replace(/(\.)([A-Za-z_$][A-Za-z0-9_$]*)/g,'$1<span class="'+d().variable+'">$2</span>').replace(/([A-Za-z_$][A-Za-z0-9_$]*)(\s*:\s*)/g,'<span class="'+d().variable+'">$1</span>$2').replace(/\b(0[xX][0-9a-fA-F]+|0[bB][01]+|0[oO][0-7]+|\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)\b/g,'<span class="'+d().number+'">$1</span>').replace(/([=!<>+\-*/%&|^~?:;,.]|=&gt;|=&lt;|&amp;&amp;|\|\|)/g,'<span class="'+d().operator+'">$1</span>').split("\n").map((e,n)=>'<span class="code-line" data-line="'+(n+1)+'">'+(e||"&nbsp;")+"</span>").join("\n"):"html"===n?e.replace(/(&lt;|<)(\/?)([\w\-]+)([^>]*?)(\/?)(>|&gt;)/g,'<span class="'+d().operator+'">$1$2</span><span class="'+d().type+'">$3</span>$4<span class="'+d().operator+'">$5$6</span>').replace(/(\s+)([a-zA-Z\-:_]+)(=)/g,'$1<span class="'+d().variable+'">$2</span><span class="'+d().operator+'">$3</span>').replace(/(=)(["'])((?:\\\2|(?!\2).)*?)(\2)/g,'<span class="'+d().operator+'">$1</span><span class="'+d().string+'">$2$3$4</span>').replace(/(&lt;!--|<!--)([\s\S]*?)(--&gt;|-->)/g,'<span class="'+d().comment+'">$1$2$3</span>').split("\n").map((e,n)=>'<span class="code-line" data-line="'+(n+1)+'">'+(e||"&nbsp;")+"</span>").join("\n"):"css"===n?e.replace(/([.#]?[\w\-_]+)(?=\s*\{)/g,'<span class="'+d().type+'">$1</span>').replace(/([\w\-]+)(\s*:\s*)/g,'<span class="'+d().variable+'">$1</span>$2').replace(/(:)([^;{}]*)([;}])/g,function(e,n,t,r){return n+t.replace(/([#](?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})\b|((?:\d*\.)?\d+(?:px|em|rem|vh|vw|%|s|ms|deg|pt)?)\b)/g,'<span class="'+d().number+'">$1$2</span>')+r}).replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="'+d().comment+'">$1</span>').replace(/({|})/g,'<span class="'+d().operator+'">$1</span>').split("\n").map((e,n)=>'<span class="code-line" data-line="'+(n+1)+'">'+(e||"&nbsp;")+"</span>").join("\n"):"json"===n?e.replace(/"([^"]+)"\s*:/g,'<span class="'+d().variable+'">"$1"</span>:').replace(/:\s*"([^"]+)"/g,': <span class="'+d().string+'">"$1"</span>').replace(/:\s*(-?\d+(?:\.\d+)?)/g,': <span class="'+d().number+'">$1</span>').replace(/:\s*(true|false|null)\b/g,': <span class="'+d().keyword+'">$1</span>').replace(/([{}\[\]])/g,'<span class="'+d().operator+'">$1</span>').split("\n").map((e,n)=>'<span class="code-line" data-line="'+(n+1)+'">'+(e||"&nbsp;")+"</span>").join("\n"):e.split("\n").map((e,n)=>'<span class="code-line" data-line="'+(n+1)+'">'+(e||"&nbsp;")+"</span>").join("\n"),r=e,o=(r=(r=(r=(r=(r=(r=r.replace(/:::info\s+([^:]+):::/g,'<div class="'+d().alertInfo+'">$1</div>')).replace(/:::warning\s+([^:]+):::/g,'<div class="'+d().alertWarning+'">$1</div>')).replace(/:::success\s+([^:]+):::/g,'<div class="'+d().alertSuccess+'">$1</div>')).replace(/`([^`]+)`/g,(e,n)=>"<code>"+n.replace(/\${/g,"\\${")+"</code>")).replace(/```(tsx|js|jsx|ts|html|css|json)?\s*(?:\[([^\]]+)\])?(?:\n)([\s\S]+?)```/g,(e,r,o,a)=>{let i=o||n(r||""),s=a.replace(/\${/g,"___TEMPLATE_START___").replace(/}/g,"___TEMPLATE_END___").replace(/`/g,"___BACKTICK___"),l=s.trim().split("\n").map((e,n)=>'<span class="'.concat(d().lineNumber,'">').concat(n+1,"</span>")).join(""),c=t(s,r||"").replace(/___TEMPLATE_START___/g,"${").replace(/___TEMPLATE_END___/g,"}").replace(/___BACKTICK___/g,"`");return'\n        <div class="'.concat(d().codeBlockContainer,'">\n          <pre class="').concat(d().codeBlock,'" data-filename="').concat(i,'">\n            <div class="').concat(d().codeLineNumbers,'">').concat(l,'</div>\n            <div class="').concat(d().codeContent,'">').concat(c,'</div>\n            <button class="').concat(d().copyButton,'" title="Copy to clipboard">Copy</button>\n          </pre>\n        </div>\n      ')})).replace(/## ([^\n]+)/g,'<h2 class="'+d().docSubheading+'">$1</h2>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/- ([^\n]+)/g,"<li>$1</li>").replace(/(<li>[^<]+<\/li>(\s*)?)+/g,"<ul>$&</ul>")).split(/<pre class=/);for(let e=0;e<o.length;e++)0!==e&&o[e].includes("codeBlock")||(o[e]=o[e].replace(/\n\n/g,"<br><br>"));return o.join("<pre class=")}(c.content)}},m)]})})]})}function h(){let e=(0,a.useRouter)(),[n,t]=(0,o.J0)(!0),[c,u]=(0,o.J0)(!1),[h,p]=(0,o.J0)(""),[f,_]=(0,o.J0)("docs");return((0,o.vJ)(()=>{let n=(0,l.onAuthStateChanged)(s.j2,async n=>{if(!n)return void e.push("/login");try{let t=(0,i.doc)(s.db,"users",n.uid),r=await (0,i.getDoc)(t);if(r.exists()){let t=r.data(),o=t.role;"developer"===o||"admin"===o?(u(!0),p(t.name||n.displayName||n.email||"Developer")):e.push("/")}else e.push("/")}catch(n){console.error("Error checking user role:",n),e.push("/")}finally{t(!1)}});return()=>n()},[e]),n)?(0,r.jsx)("div",{className:d().container,children:(0,r.jsxs)("div",{className:d().loadingContainer,children:[(0,r.jsx)("div",{className:d().loadingSpinner}),(0,r.jsx)("p",{children:"Verifying access..."})]})}):c?(0,r.jsx)("div",{className:d().container,children:(0,r.jsxs)("div",{className:d().devDocsContainer,children:[(0,r.jsx)("h1",{className:d().devDocsTitle,children:"Developer Portal"}),(0,r.jsxs)("p",{className:d().devDocsWelcome,children:["Welcome, ",h,"! This page contains developer tools and documentation."]}),(0,r.jsxs)("div",{className:d().tabContainer,children:[(0,r.jsx)("button",{className:"".concat(d().tabButton," ").concat("docs"===f?d().activeTab:""),onClick:()=>_("docs"),children:"Documentation"}),(0,r.jsx)("button",{className:"".concat(d().tabButton," ").concat("users"===f?d().activeTab:""),onClick:()=>_("users"),children:"User Management"})]}),"docs"===f?(0,r.jsx)(g,{}):(0,r.jsx)(m,{})]})}):null}}},e=>{var n=n=>e(e.s=n);e.O(0,[1708,8096,7358],()=>n(1112)),_N_E=e.O()}]);