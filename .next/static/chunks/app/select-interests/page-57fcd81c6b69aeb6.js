(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8657],{1692:(e,t,r)=>{Promise.resolve().then(r.bind(r,7551))},3201:(e,t,r)=>{"use strict";r.d(t,{db:()=>l,j2:()=>c});var o=r(3915),a=r(6864),n=r(6203),s=r(5317);let i=(0,o.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,a.P5)(i)}catch(e){}let c=(0,n.getAuth)(i),l=(0,s.getFirestore)(i);window.location.origin},4744:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>d,Ci:()=>b,E$:()=>w,OQ:()=>i,Qt:()=>h,SR:()=>y,VM:()=>l,Vz:()=>c,e_:()=>u,mH:()=>g,pV:()=>m,x5:()=>f});var o=r(5317),a=r(6203),n=r(3201),s=r(9995);async function i(e){try{let t=(0,o.query)((0,o.collection)(n.db,"users"),(0,o.where)("username","==",e.toLowerCase()));return!(await (0,o.getDocs)(t)).empty}catch(e){throw console.error("Error checking username:",e),e}}async function c(e,t){try{let r=await l(e);if(r){console.log("User profile already exists, updating instead of creating");let s=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(s,{firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||r.bio||""}),n.j2.currentUser&&await (0,a.updateProfile)(n.j2.currentUser,{displayName:t.username});return}let s=(0,o.query)((0,o.collection)(n.db,"users"),(0,o.where)("email","==",t.email.toLowerCase()));if(!(await (0,o.getDocs)(s)).empty)throw Error("Email is already associated with another account");if(await i(t.username))throw Error("Username is already taken");let c=(0,o.doc)(n.db,"users",e);await (0,o.setDoc)(c,{uid:e,firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||"",createdAt:(0,o.serverTimestamp)()}),n.j2.currentUser&&await (0,a.updateProfile)(n.j2.currentUser,{displayName:t.username})}catch(e){throw console.error("Error creating user profile:",e),e}}async function l(e){try{let t=(0,o.doc)(n.db,"users",e),r=await (0,o.getDoc)(t);if(r.exists())return r.data();return null}catch(e){throw console.error("Error fetching user profile:",e),e}}async function u(e){if(!e)return null;try{let t=(0,o.query)((0,o.collection)(n.db,"users"),(0,o.where)("email","==",e.toLowerCase()),(0,o.limit)(1)),r=await (0,o.getDocs)(t);if(!r.empty)return r.docs[0].data();return null}catch(e){throw console.error("Error fetching user profile by email:",e),e}}async function d(e,t){try{let r=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(r,{interests:t}),console.log("Interests updated for user ".concat(e,":"),t)}catch(e){throw console.error("Error updating user interests:",e),e}}async function f(e){try{if(!e||e.trim().length<2)return[];let t=e.toLowerCase().trim(),r=(0,o.collection)(n.db,"users");return(await (0,o.getDocs)(r)).docs.map(e=>e.data()).filter(e=>{let r=e.username.toLowerCase(),o=e.firstName.toLowerCase(),a=e.lastName.toLowerCase(),n="".concat(o," ").concat(a);return r.includes(t)||o.includes(t)||a.includes(t)||n.includes(t)})}catch(e){return console.error("Error searching users:",e),[]}}async function m(e,t){try{if(e===t)throw Error("You cannot follow yourself");let r=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(r,{following:(0,o.arrayUnion)(t),followingCount:(0,o.increment)(1)});let a=(0,o.doc)(n.db,"users",t);await (0,o.updateDoc)(a,{followers:(0,o.arrayUnion)(e),followersCount:(0,o.increment)(1)});let i=await (0,o.getDoc)(r);if(i.exists()){let r=i.data();await (0,s.N9)(t,"".concat(r.firstName," ").concat(r.lastName),e,r.username)}}catch(e){throw console.error("Error following user:",e),e}}async function h(e,t){try{let r=(0,o.doc)(n.db,"users",e);await (0,o.updateDoc)(r,{following:(0,o.arrayRemove)(t),followingCount:(0,o.increment)(-1)});let a=(0,o.doc)(n.db,"users",t);await (0,o.updateDoc)(a,{followers:(0,o.arrayRemove)(e),followersCount:(0,o.increment)(-1)})}catch(e){throw console.error("Error unfollowing user:",e),e}}async function w(e,t){try{var r;let a=(0,o.doc)(n.db,"users",e),s=await (0,o.getDoc)(a);if(!s.exists())return!1;return(null==(r=s.data().following)?void 0:r.includes(t))||!1}catch(e){throw console.error("Error checking follow status:",e),e}}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let r=(0,o.doc)(n.db,"users",e),a=await (0,o.getDoc)(r);if(!a.exists())return[];let s=a.data().following||[];if(0===s.length)return[];let i=[],c=Math.min(s.length,t);for(let e=0;e<c;e++){let t=s[e],r=(0,o.doc)(n.db,"users",t),a=await (0,o.getDoc)(r);a.exists()&&i.push(a.data())}return i}catch(e){throw console.error("Error getting following list:",e),e}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let r=(0,o.doc)(n.db,"users",e),a=await (0,o.getDoc)(r);if(!a.exists())return[];let s=a.data().followers||[];if(0===s.length)return[];let i=[],c=Math.min(s.length,t);for(let e=0;e<c;e++){let t=s[e],r=(0,o.doc)(n.db,"users",t),a=await (0,o.getDoc)(r);a.exists()&&i.push(a.data())}return i}catch(e){throw console.error("Error getting followers list:",e),e}}async function b(e){try{let t=(0,o.doc)(n.db,"users",e);await (0,o.deleteDoc)(t),console.log("User profile for UID ".concat(e," deleted from Firestore."));let r=n.j2.currentUser;if(r&&r.uid===e)await (0,a.deleteUser)(r),console.log("User account for UID ".concat(e," deleted from Firebase Authentication."));else if(r)throw console.error("Current authenticated user does not match UID to be deleted."),Error("Mismatch between authenticated user and account to be deleted.");else throw console.error("No current user authenticated. Cannot delete Firebase Auth user."),Error("Authentication required to delete account.")}catch(e){if(console.error("Error deleting user account:",e),"auth/requires-recent-login"===e.code)throw Error("This operation is sensitive and requires recent authentication. Please sign out and sign back in, then try again.");throw Error("Failed to delete user account. "+e.message)}}},5695:(e,t,r)=>{"use strict";var o=r(8999);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},7551:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var o=r(5155),a=r(2115),n=r(5695),s=r(3201),i=r(6203),c=r(4744);let l=["Technology","Science","Art & Design","Books & Literature","Travel","Food & Cooking","Health & Wellness","Sports","Music","Movies & TV","Gaming","Fashion","Business & Finance","History","Politics","Photography"];function u(){let[e,t]=(0,a.useState)([]),[r,u]=(0,a.useState)(!1),[d,f]=(0,a.useState)(""),[m,h]=(0,a.useState)(s.j2.currentUser),[w,g]=(0,a.useState)(!0),y=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=(0,i.onAuthStateChanged)(s.j2,e=>{e?h(e):y.push("/login"),g(!1)});return()=>e()},[y]);let b=e=>{t(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},p=async()=>{if(!m)return void f("No user logged in. Please log in again.");if(e.length<3)return void f("Please select at least 3 interests to continue.");u(!0),f("");try{await (0,c.Ay)(m.uid,e),y.push("/")}catch(e){console.error("Failed to save interests:",e),f("Failed to save interests. Please try again.")}finally{u(!1)}};return w?(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-stone-100 to-amber-100 flex items-center justify-center font-sans",children:(0,o.jsx)("div",{className:"animate-spin h-10 w-10 border-4 border-amber-500 rounded-full border-t-transparent"})}):(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-stone-100 to-amber-100 flex flex-col items-center justify-center p-4 sm:p-6 md:p-8 font-sans",children:(0,o.jsxs)("div",{className:"w-full max-w-2xl text-center",children:[(0,o.jsx)("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-serif font-medium text-stone-800 mb-3",children:"What sparks your curiosity?"}),(0,o.jsx)("p",{className:"text-stone-600 text-lg sm:text-xl mb-8 md:mb-12",children:"Select at least 3 interests to personalize your Journalite experience."}),(0,o.jsx)("div",{className:"flex flex-wrap justify-center gap-3 sm:gap-4 mb-10 md:mb-14",children:l.map(t=>(0,o.jsx)("button",{className:"\n                px-5 py-2.5 sm:px-6 sm:py-3 rounded-full text-sm sm:text-base font-medium transition-all duration-200 ease-in-out transform focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 \n                ".concat(e.includes(t)?"bg-amber-500 text-white shadow-md scale-105":"bg-white text-stone-700 border border-stone-300 hover:bg-stone-50 hover:border-stone-400 hover:shadow-sm active:scale-95"),onClick:()=>b(t),children:t},t))}),d&&(0,o.jsx)("p",{className:"mb-6 p-3.5 bg-red-100 text-red-700 text-sm rounded-lg border border-red-200 animate-fadeIn",children:d}),(0,o.jsx)("button",{className:"w-full max-w-xs mx-auto flex items-center justify-center px-6 py-3.5 bg-stone-800 text-white rounded-lg shadow-md hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-all duration-200 ease-in-out transform hover:scale-[1.01] active:scale-[0.99] disabled:opacity-70 disabled:cursor-not-allowed",onClick:p,disabled:r||e.length<3,children:r?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving preferences..."]}):"Continue to Journalite"})]})})}},9995:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>d,N9:()=>s,Ss:()=>i,bA:()=>c,fP:()=>u,fZ:()=>n,he:()=>l});var o=r(5317),a=r(3201);async function n(e,t,r,n,s,i){try{let t=a.j2.currentUser;if(!t||t.uid===e)return null;let c={userId:e,type:"comment",read:!1,sourceId:s,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(i.substring(0,50)).concat(i.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:o.Timestamp.now(),articleSlug:r,articleTitle:n};return{id:(await (0,o.addDoc)((0,o.collection)(a.db,"notifications"),c)).id,...c}}catch(e){return console.error("Error creating notification:",e),null}}async function s(e,t,r,n){try{if(e===r)return null;let s={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(n,") started following you"),fromUser:{id:r,name:t,username:n},createdAt:o.Timestamp.now()};return{id:(await (0,o.addDoc)((0,o.collection)(a.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating follow notification:",e),null}}async function i(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=a.j2.currentUser;if(!r)throw Error("User not authenticated");let n=(0,o.collection)(a.db,"notifications");t=e?(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.where)("read","==",!1),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100)):(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100));let s=await (0,o.getDocs)(t),i=[];return s.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){throw console.error("Error fetching notifications:",e),e}}async function c(e){try{let t=a.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(a.db,"notifications",e),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function l(){try{let e=a.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.collection)(a.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1)),n=await (0,o.getDocs)(r),s=n.docs.map(e=>(0,o.updateDoc)(e.ref,{read:!0}));return await Promise.all(s),{success:!0,count:n.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function u(e){try{let t=a.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(a.db,"notifications",e),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.deleteDoc)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function d(){try{let e=a.j2.currentUser;if(!e)return 0;let t=(0,o.collection)(a.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1));return(await (0,o.getDocs)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7158,7117,8441,1684,7358],()=>t(1692)),_N_E=e.O()}]);