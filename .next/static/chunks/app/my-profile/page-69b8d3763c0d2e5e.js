(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{19:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(5155),s=a(2115),l=a(5695),n=a(6203),i=a(3201),o=a(4744),m=a(6874),u=a.n(m);function c(){let[e,t]=(0,s.useState)(""),[a,m]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[f,x]=(0,s.useState)(""),[h,b]=(0,s.useState)(""),[p,N]=(0,s.useState)(!0),[g,y]=(0,s.useState)(!1),[j,v]=(0,s.useState)(""),[w,S]=(0,s.useState)(!1),[k,U]=(0,s.useState)({}),[P,C]=(0,s.useState)({}),[E,T]=(0,s.useState)(null),[B,F]=(0,s.useState)(!1),[L,_]=(0,s.useState)(null),[M,I]=(0,s.useState)(""),[z,G]=(0,s.useState)(0),O=(0,l.useRouter)();(0,s.useEffect)(()=>{let e=(0,n.hg)(i.j2,async e=>{if(e){_(e.uid),I(e.email||"");try{var a,r,s;let l=await (0,o.VM)(e.uid);if(l)t(l.firstName),m(l.lastName),d(l.username),b(l.username),x(l.bio||""),G((null==(a=l.bio)?void 0:a.length)||0),T(!0);else{let a=(e.displayName||"").split(" ");t(a[0]||""),m(a.slice(1).join(" ")||""),d((null==(r=e.email)?void 0:r.split("@")[0])||""),b((null==(s=e.email)?void 0:s.split("@")[0])||"")}}catch(e){console.error("Error fetching user profile:",e),v("Failed to load your profile. Please try refreshing the page.")}finally{N(!1)}}else O.push("/login")});return()=>e()},[O]);let R=e=>{let{name:t,value:a,validity:r}=e.target;if(U({...k,[t]:!0}),C({...P,[t]:""}),r.valueMissing){let e="This field is required";"firstName"===t&&(e="Please enter your first name"),"lastName"===t&&(e="Please enter your last name"),"username"===t&&(e="Please choose a username"),C({...P,[t]:e})}},q=async e=>{if(e===h)return void T(!0);if(e.length<2)return void T(null);try{F(!0);let t=await (0,o.OQ)(e);T(!t)}catch(e){console.error("Error checking username:",e)}finally{F(!1)}},H=()=>{let t={},r={},s=!0;return r.firstName=!0,e.trim()||(t.firstName="Please enter your first name",s=!1),r.lastName=!0,a.trim()||(t.lastName="Please enter your last name",s=!1),r.username=!0,c.trim()?c.length<2?(t.username="Username must be at least 2 characters",s=!1):c!==h&&!1===E&&(t.username="This username is already taken",s=!1):(t.username="Please choose a username",s=!1),U({...k,...r}),C({...P,...t}),s},V=async t=>{if(t.preventDefault(),H()&&L){y(!0),v(""),S(!1);try{await (0,o.Vz)(L,{firstName:e,lastName:a,username:c,email:M,bio:f}),i.j2.currentUser&&await (0,n.r7)(i.j2.currentUser,{displayName:c}),b(c),S(!0),setTimeout(()=>{S(!1)},3e3)}catch(t){let e="Failed to update your profile";t instanceof Error&&t.message.includes("Username is already taken")&&(e="This username is already taken",C({...P,username:"This username is already taken"})),v(e),console.error(t)}finally{y(!1)}}},Y=e=>{let t="w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md focus:outline-none focus:ring-1 focus:ring-slate-500";return k[e]&&P[e]?"".concat(t," border-red-300 bg-red-50"):"username"===e&&c.length>=2&&!0===E?"".concat(t," border-green-300 bg-green-50"):t};return p?(0,r.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-slate-500 rounded-full border-t-transparent"})}):(0,r.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex flex-col",children:(0,r.jsx)("div",{className:"py-12 px-6 flex-1 flex flex-col items-center",children:(0,r.jsxs)("div",{className:"w-full max-w-lg mx-auto",children:[(0,r.jsxs)("div",{className:"mb-12 text-center",children:[(0,r.jsx)("h1",{className:"text-4xl md:text-5xl font-serif font-normal text-slate-900",children:"My Profile"}),(0,r.jsx)("p",{className:"mt-2 text-slate-700",children:"Update your personal information"})]}),(0,r.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"firstName",className:"block mb-2 text-sm font-medium text-slate-700",children:"First Name"}),(0,r.jsx)("input",{id:"firstName",name:"firstName",type:"text",required:!0,value:e,onChange:e=>t(e.target.value),onBlur:R,className:Y("firstName")}),k.firstName&&P.firstName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:P.firstName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"lastName",className:"block mb-2 text-sm font-medium text-slate-700",children:"Last Name"}),(0,r.jsx)("input",{id:"lastName",name:"lastName",type:"text",required:!0,value:a,onChange:e=>m(e.target.value),onBlur:R,className:Y("lastName")}),k.lastName&&P.lastName&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:P.lastName})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-slate-700",children:"Username"}),B&&(0,r.jsxs)("div",{className:"text-xs text-slate-500 flex items-center",children:[(0,r.jsx)("div",{className:"mr-1 w-3 h-3 border-2 border-slate-500 border-t-transparent rounded-full animate-spin"}),"Checking..."]})]}),(0,r.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:c,onChange:e=>{let t=e.target.value;if(d(t),t===h)return void T(!0);let a=setTimeout(()=>{t.length>=2?q(t):T(null)},500);return()=>clearTimeout(a)},onBlur:R,className:Y("username")}),k.username&&P.username?(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:P.username}):c&&c.length>=2&&!0===E?(0,r.jsx)("p",{className:"mt-1 text-sm text-green-600",children:"Username is available"}):c&&c.length>=2&&!1===E?(0,r.jsx)("p",{className:"mt-1 text-sm text-red-500",children:"Username is already taken"}):null]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-slate-700",children:"Bio"}),(0,r.jsxs)("span",{className:"text-xs ".concat(z>=225?"text-amber-600":"text-slate-500"),children:[z,"/",250]})]}),(0,r.jsx)("textarea",{id:"bio",name:"bio",value:f,onChange:e=>{let t=e.target.value;t.length<=250&&(x(t),G(t.length))},onBlur:R,placeholder:"Tell us a little about yourself...",rows:4,maxLength:250,className:"w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md focus:outline-none focus:ring-1 focus:ring-slate-500 resize-none"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Your bio will be displayed on your public profile and articles"})]}),j&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-600",children:j}),w&&(0,r.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md text-sm text-green-600",children:"Your profile has been updated successfully!"}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-8",children:[(0,r.jsx)(u(),{href:"/",className:"inline-flex justify-center py-3 px-5 border border-slate-300 rounded-md bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500",children:"Back to Home"}),(0,r.jsx)("button",{type:"submit",disabled:g,className:"inline-flex justify-center py-3 px-5 border border-transparent rounded-md shadow-sm text-sm font-medium text-white \n                  ".concat(g?"bg-slate-400 cursor-not-allowed":"bg-slate-800 hover:bg-slate-700"," \n                  focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500"),children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})})}},3201:(e,t,a)=>{"use strict";a.d(t,{db:()=>m,j2:()=>o});var r=a(3915),s=a(6864),l=a(6203),n=a(5317);let i=(0,r.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,s.P5)(i)}catch(e){}let o=(0,l.xI)(i),m=(0,n.aU)(i);window.location.origin},4744:(e,t,a)=>{"use strict";a.d(t,{OQ:()=>n,VM:()=>o,Vz:()=>i});var r=a(5317),s=a(6203),l=a(3201);async function n(e){try{let t=(0,r.P)((0,r.rJ)(l.db,"users"),(0,r._M)("username","==",e.toLowerCase()));return!(await (0,r.GG)(t)).empty}catch(e){throw console.error("Error checking username:",e),e}}async function i(e,t){try{let a=await o(e);if(a){console.log("User profile already exists, updating instead of creating");let n=(0,r.H9)(l.db,"users",e);await (0,r.mZ)(n,{firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||a.bio||""}),l.j2.currentUser&&await (0,s.r7)(l.j2.currentUser,{displayName:t.username});return}let i=(0,r.P)((0,r.rJ)(l.db,"users"),(0,r._M)("email","==",t.email.toLowerCase()));if(!(await (0,r.GG)(i)).empty)throw Error("Email is already associated with another account");if(await n(t.username))throw Error("Username is already taken");let m=(0,r.H9)(l.db,"users",e);await (0,r.BN)(m,{uid:e,firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||"",createdAt:(0,r.O5)()}),l.j2.currentUser&&await (0,s.r7)(l.j2.currentUser,{displayName:t.username})}catch(e){throw console.error("Error creating user profile:",e),e}}async function o(e){try{let t=(0,r.H9)(l.db,"users",e),a=await (0,r.x7)(t);if(a.exists())return a.data();return null}catch(e){throw console.error("Error fetching user profile:",e),e}}},5136:(e,t,a)=>{Promise.resolve().then(a.bind(a,19))},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[992,158,874,117,441,684,358],()=>t(5136)),_N_E=e.O()}]);