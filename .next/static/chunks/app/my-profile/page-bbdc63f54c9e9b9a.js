(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{19:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),s=r(2115),l=r(5695),n=r(6203),i=r(3201),o=r(4744),m=r(6874),u=r.n(m);function c(){let[e,t]=(0,s.useState)(""),[r,m]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[f,x]=(0,s.useState)(""),[h,b]=(0,s.useState)(""),[p,N]=(0,s.useState)(!0),[g,y]=(0,s.useState)(!1),[j,w]=(0,s.useState)(""),[v,S]=(0,s.useState)(!1),[k,C]=(0,s.useState)({}),[U,P]=(0,s.useState)({}),[E,L]=(0,s.useState)(null),[T,B]=(0,s.useState)(!1),[F,_]=(0,s.useState)(null),[G,M]=(0,s.useState)(""),[I,z]=(0,s.useState)(0),O=(0,l.useRouter)();(0,s.useEffect)(()=>{let e=(0,n.hg)(i.j2,async e=>{if(e){_(e.uid),M(e.email||"");try{var r,a,s;let l=await (0,o.VM)(e.uid);if(l)t(l.firstName),m(l.lastName),d(l.username),b(l.username),x(l.bio||""),z((null==(r=l.bio)?void 0:r.length)||0),L(!0);else{let r=(e.displayName||"").split(" ");t(r[0]||""),m(r.slice(1).join(" ")||""),d((null==(a=e.email)?void 0:a.split("@")[0])||""),b((null==(s=e.email)?void 0:s.split("@")[0])||"")}}catch(e){console.error("Error fetching user profile:",e),w("Failed to load your profile. Please try refreshing the page.")}finally{N(!1)}}else O.push("/login")});return()=>e()},[O]);let R=e=>{let{name:t,value:r,validity:a}=e.target;if(C({...k,[t]:!0}),P({...U,[t]:""}),a.valueMissing){let e="This field is required";"firstName"===t&&(e="Please enter your first name"),"lastName"===t&&(e="Please enter your last name"),"username"===t&&(e="Please choose a username"),P({...U,[t]:e})}},q=async e=>{if(e===h)return void L(!0);if(e.length<2)return void L(null);try{B(!0);let t=await (0,o.OQ)(e);L(!t)}catch(e){console.error("Error checking username:",e)}finally{B(!1)}},H=()=>{let t={},a={},s=!0;return a.firstName=!0,e.trim()||(t.firstName="Please enter your first name",s=!1),a.lastName=!0,r.trim()||(t.lastName="Please enter your last name",s=!1),a.username=!0,c.trim()?c.length<2?(t.username="Username must be at least 2 characters",s=!1):c!==h&&!1===E&&(t.username="This username is already taken",s=!1):(t.username="Please choose a username",s=!1),C({...k,...a}),P({...U,...t}),s},V=async t=>{if(t.preventDefault(),H()&&F){y(!0),w(""),S(!1);try{await (0,o.Vz)(F,{firstName:e,lastName:r,username:c,email:G,bio:f}),i.j2.currentUser&&await (0,n.r7)(i.j2.currentUser,{displayName:c}),b(c),S(!0),setTimeout(()=>{S(!1)},3e3)}catch(t){let e="Failed to update your profile";t instanceof Error&&t.message.includes("Username is already taken")&&(e="This username is already taken",P({...U,username:"This username is already taken"})),w(e),console.error(t)}finally{y(!1)}}},Y=e=>{let t="w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md focus:outline-none focus:ring-1 focus:ring-slate-500";return k[e]&&U[e]?"".concat(t," border-red-300 bg-red-50"):"username"===e&&c.length>=2&&!0===E?"".concat(t," border-green-300 bg-green-50"):t};return p?(0,a.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-slate-500 rounded-full border-t-transparent"})}):(0,a.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex flex-col",children:(0,a.jsx)("div",{className:"py-12 px-6 flex-1 flex flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full max-w-lg mx-auto",children:[(0,a.jsxs)("div",{className:"mb-12 text-center",children:[(0,a.jsx)("h1",{className:"text-4xl md:text-5xl font-serif font-normal text-slate-900",children:"My Profile"}),(0,a.jsx)("p",{className:"mt-2 text-slate-700",children:"Update your personal information"})]}),(0,a.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"firstName",className:"block mb-2 text-sm font-medium text-slate-700",children:"First Name"}),(0,a.jsx)("input",{id:"firstName",name:"firstName",type:"text",required:!0,value:e,onChange:e=>t(e.target.value),onBlur:R,className:Y("firstName")}),k.firstName&&U.firstName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:U.firstName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"lastName",className:"block mb-2 text-sm font-medium text-slate-700",children:"Last Name"}),(0,a.jsx)("input",{id:"lastName",name:"lastName",type:"text",required:!0,value:r,onChange:e=>m(e.target.value),onBlur:R,className:Y("lastName")}),k.lastName&&U.lastName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:U.lastName})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-slate-700",children:"Username"}),T&&(0,a.jsxs)("div",{className:"text-xs text-slate-500 flex items-center",children:[(0,a.jsx)("div",{className:"mr-1 w-3 h-3 border-2 border-slate-500 border-t-transparent rounded-full animate-spin"}),"Checking..."]})]}),(0,a.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:c,onChange:e=>{let t=e.target.value;if(d(t),t===h)return void L(!0);let r=setTimeout(()=>{t.length>=2?q(t):L(null)},500);return()=>clearTimeout(r)},onBlur:R,className:Y("username")}),k.username&&U.username?(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:U.username}):c&&c.length>=2&&!0===E?(0,a.jsx)("p",{className:"mt-1 text-sm text-green-600",children:"Username is available"}):c&&c.length>=2&&!1===E?(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:"Username is already taken"}):null]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-slate-700",children:"Bio"}),(0,a.jsxs)("span",{className:"text-xs ".concat(I>=225?"text-amber-600":"text-slate-500"),children:[I,"/",250]})]}),(0,a.jsx)("textarea",{id:"bio",name:"bio",value:f,onChange:e=>{let t=e.target.value;t.length<=250&&(x(t),z(t.length))},onBlur:R,placeholder:"Tell us a little about yourself...",rows:4,maxLength:250,className:"w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md focus:outline-none focus:ring-1 focus:ring-slate-500 resize-none"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Your bio will be displayed on your public profile and articles"})]}),j&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-sm text-red-600",children:j}),v&&(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md text-sm text-green-600",children:"Your profile has been updated successfully!"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-8",children:[(0,a.jsx)(u(),{href:"/",className:"inline-flex justify-center py-3 px-5 border border-slate-300 rounded-md bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500",children:"Back to Home"}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"inline-flex justify-center py-3 px-5 border border-transparent rounded-md shadow-sm text-sm font-medium text-white \n                  ".concat(g?"bg-slate-400 cursor-not-allowed":"bg-slate-800 hover:bg-slate-700"," \n                  focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500"),children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})})}},3201:(e,t,r)=>{"use strict";r.d(t,{db:()=>m,j2:()=>o});var a=r(3915),s=r(6864),l=r(6203),n=r(5317);let i=(0,a.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,s.P5)(i)}catch(e){}let o=(0,l.xI)(i),m=(0,n.aU)(i);window.location.origin},4744:(e,t,r)=>{"use strict";r.d(t,{OQ:()=>n,VM:()=>o,Vz:()=>i,x5:()=>m});var a=r(5317),s=r(6203),l=r(3201);async function n(e){try{let t=(0,a.P)((0,a.rJ)(l.db,"users"),(0,a._M)("username","==",e.toLowerCase()));return!(await (0,a.GG)(t)).empty}catch(e){throw console.error("Error checking username:",e),e}}async function i(e,t){try{let r=await o(e);if(r){console.log("User profile already exists, updating instead of creating");let n=(0,a.H9)(l.db,"users",e);await (0,a.mZ)(n,{firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||r.bio||""}),l.j2.currentUser&&await (0,s.r7)(l.j2.currentUser,{displayName:t.username});return}let i=(0,a.P)((0,a.rJ)(l.db,"users"),(0,a._M)("email","==",t.email.toLowerCase()));if(!(await (0,a.GG)(i)).empty)throw Error("Email is already associated with another account");if(await n(t.username))throw Error("Username is already taken");let m=(0,a.H9)(l.db,"users",e);await (0,a.BN)(m,{uid:e,firstName:t.firstName,lastName:t.lastName,username:t.username.toLowerCase(),email:t.email.toLowerCase(),bio:t.bio||"",createdAt:(0,a.O5)()}),l.j2.currentUser&&await (0,s.r7)(l.j2.currentUser,{displayName:t.username})}catch(e){throw console.error("Error creating user profile:",e),e}}async function o(e){try{let t=(0,a.H9)(l.db,"users",e),r=await (0,a.x7)(t);if(r.exists())return r.data();return null}catch(e){throw console.error("Error fetching user profile:",e),e}}async function m(e){try{if(!e||e.trim().length<2)return[];let t=e.toLowerCase().trim(),r=(0,a.rJ)(l.db,"users");return(await (0,a.GG)(r)).docs.map(e=>e.data()).filter(e=>{let r=e.username.toLowerCase(),a=e.firstName.toLowerCase(),s=e.lastName.toLowerCase(),l="".concat(a," ").concat(s);return r.includes(t)||a.includes(t)||s.includes(t)||l.includes(t)})}catch(e){return console.error("Error searching users:",e),[]}}},5136:(e,t,r)=>{Promise.resolve().then(r.bind(r,19))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[992,158,874,117,441,684,358],()=>t(5136)),_N_E=e.O()}]);