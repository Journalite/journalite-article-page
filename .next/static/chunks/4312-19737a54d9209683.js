"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4312],{4312:(e,t,s)=>{s.d(t,{A:()=>f});var r=s(5155),o=s(2115),l=s(5695),a=s(621),n=s(9210),i=s(3201),c=s(5671),d=s(9122),u=s(4814),m=s(8163),g=s.n(m);let h=e=>{let{onInsert:t}=e,[s,l]=(0,o.useState)(!1),[a,n]=(0,o.useState)([]),[i,c]=(0,o.useState)([]),[m,h]=(0,o.useState)(!1),[x,p]=(0,o.useState)("inspirations"),f=async()=>{h(!0);try{let[e,t]=await Promise.all([(0,d.Aq)(),(0,d.Gy)()]);n(e),c(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{h(!1)}},b=e=>{t&&t(e),l(!1)},y=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||"Write about ".concat(e,"...");return s?(0,r.jsx)("div",{className:"fixed bottom-8 right-8 z-40 w-96",children:(0,r.jsxs)("div",{className:"".concat(g()["glass-modal"]," max-h-96 overflow-hidden"),children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("div",{className:g()["glass-content"],children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold text-stone-800 flex items-center gap-2 font-serif",children:[(0,r.jsx)(u.TG,{size:18,color:"#f59e0b"}),"Your Reflection Insights"]}),(0,r.jsx)("button",{onClick:()=>l(!1),className:"text-stone-500 hover:text-stone-700 text-xl font-bold leading-none",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"flex p-4 gap-2",children:[(0,r.jsxs)("button",{className:"".concat(g()["glass-tag"]," flex-1 text-center py-2 text-sm font-semibold transition-all ").concat("inspirations"===x?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"),onClick:()=>p("inspirations"),children:["Recent Thoughts (",a.length,")"]}),(0,r.jsxs)("button",{className:"".concat(g()["glass-tag"]," flex-1 text-center py-2 text-sm font-semibold transition-all ").concat("themes"===x?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"),onClick:()=>p("themes"),children:["Writing Themes (",i.length,")"]})]}),(0,r.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:m?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-stone-600",children:"Loading your insights..."})]}):"inspirations"===x?(0,r.jsx)("div",{children:0===a.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,r.jsx)(u.d3,{size:16,color:"#6b7280"}),(0,r.jsx)("p",{className:"font-semibold",children:"No reflections yet!"})]}),(0,r.jsx)("p",{className:"text-sm text-stone-500",children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Your past reflections that might spark new ideas:"}),(0,r.jsx)("div",{className:"space-y-3",children:a.map((e,t)=>(0,r.jsxs)("div",{className:"".concat(g()["glass-card"]," p-4"),children:[(0,r.jsx)("div",{className:g()["glass-card-highlight"]}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("p",{className:"text-sm text-stone-700 italic mb-2",children:['"',e.response,'"']}),e.articleTitle&&(0,r.jsxs)("p",{className:"text-xs text-stone-500 mb-3",children:["From: ",e.articleTitle]}),(0,r.jsx)("button",{onClick:()=>{let t=e.articleTitle?' (inspired by "'.concat(e.articleTitle,'")'):"";b('"'.concat(e.response,'"').concat(t," - This reminds me of..."))},className:"".concat(g()["glass-button"]," ").concat(g()["glass-button-primary"]," text-xs px-3 py-1 w-full"),children:"Use as starting point"})]})]},t))})]})}):(0,r.jsx)("div",{children:0===i.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,r.jsx)(u.v1,{size:16,color:"#6b7280"}),(0,r.jsx)("p",{className:"font-semibold",children:"No themes identified yet!"})]}),(0,r.jsx)("p",{className:"text-sm text-stone-500",children:"Keep reflecting on articles to discover your writing themes."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Writing prompts based on your reflection patterns:"}),(0,r.jsx)("div",{className:"space-y-3",children:i.map((e,t)=>(0,r.jsxs)("div",{className:"".concat(g()["glass-card"]," p-4"),children:[(0,r.jsx)("div",{className:g()["glass-card-highlight"]}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsx)("div",{className:"".concat(g()["glass-tag"]," inline-block mb-2 text-xs"),children:e}),(0,r.jsx)("p",{className:"text-sm text-stone-700 mb-3",children:y(e)}),(0,r.jsx)("button",{onClick:()=>b(y(e)),className:"".concat(g()["glass-button"]," ").concat(g()["glass-button-primary"]," text-xs px-3 py-1 w-full"),children:"Start writing"})]})]},t))})]})})}),(0,r.jsx)("div",{className:"p-4 border-t border-white/20",children:(0,r.jsx)("button",{onClick:f,className:"".concat(g()["glass-button"]," text-sm px-4 py-2 w-full disabled:opacity-50"),disabled:m,children:"\uD83D\uDD04 Refresh insights"})})]})]})}):(0,r.jsx)("div",{className:"fixed bottom-8 right-8 z-40",children:(0,r.jsxs)("button",{onClick:()=>{s||f(),l(!s)},className:"".concat(g()["glass-button"]," ").concat(g()["glass-button-primary"]," flex items-center gap-2 px-6 py-4 text-sm font-semibold"),title:"Get inspiration from your reflections",children:[(0,r.jsx)(u.Y_,{size:16,color:"currentColor"}),"Inspiration"]})})};var x=s(5049);function p(e){let{onImageUpload:t,disabled:s=!1,className:l="",acceptedFormats:a=["image/jpeg","image/png","image/gif","image/webp"],maxFileSize:n=10,useServerUpload:i=!1}=e,[c,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(0),[g,h]=(0,o.useState)(null),p=(0,o.useRef)(null),f=e=>a.includes(e.type)?e.size/1048576>n?"File size must be less than ".concat(n,"MB"):null:"Please select a valid image file (".concat(a.join(", "),")"),b=async e=>{var s;let r=null==(s=e.target.files)?void 0:s[0];if(!r)return;h(null);let o=f(r);if(o)return void h(o);d(!0),m(0);try{let e=setInterval(()=>{m(t=>t>=90?(clearInterval(e),90):t+10)},200),s=i?await (0,x.uploadImageViaAPI)(r):await (0,x.V)(r);clearInterval(e),m(100),setTimeout(()=>{t(s),d(!1),m(0),p.current&&(p.current.value="")},300)}catch(e){console.error("Upload failed:",e),h("Failed to upload image. Please try again."),d(!1),m(0)}};return(0,r.jsxs)("div",{className:"relative ".concat(l),children:[(0,r.jsx)("input",{ref:p,type:"file",accept:a.join(","),onChange:b,className:"hidden",disabled:s||c}),(0,r.jsx)("button",{type:"button",onClick:()=>{if(!s&&!c){var e;null==(e=p.current)||e.click()}},disabled:s||c,className:"\n          relative overflow-hidden border-2 border-dashed border-gray-300 \n          rounded-lg p-6 text-center hover:border-gray-400 \n          transition-colors duration-200 w-full\n          ".concat(s||c?"opacity-50 cursor-not-allowed":"cursor-pointer","\n          ").concat(g?"border-red-300 bg-red-50":"bg-gray-50 hover:bg-gray-100","\n        "),children:c?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-blue-600",children:(0,r.jsxs)("svg",{className:"animate-spin h-8 w-8 mx-auto",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Uploading... ",u,"%"]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(u,"%")}})})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-gray-400",children:(0,r.jsx)("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-medium text-blue-600",children:"Click to upload"})," or drag and drop"]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[a.map(e=>e.split("/")[1]).join(", ").toUpperCase()," up to ",n,"MB"]})]})}),g&&(0,r.jsx)("div",{className:"mt-2 text-sm text-red-600 bg-red-50 border border-red-200 rounded p-2",children:g})]})}let f=e=>{let{articleId:t,onUpdateComplete:s,backToArticleAction:d,editingTitle:u}=e,m=(0,l.useRouter)(),[x,f]=(0,o.useState)(""),[b,y]=(0,o.useState)(""),[v,w]=(0,o.useState)([]),[j,N]=(0,o.useState)(""),[k,C]=(0,o.useState)(!1),[E,A]=(0,o.useState)(!1),[D,I]=(0,o.useState)(!1),[S,T]=(0,o.useState)(""),[U,z]=(0,o.useState)(!!t),[L,R]=(0,o.useState)(null),[B,Y]=(0,o.useState)(""),F=(0,o.useRef)(null),W=(0,o.useRef)(null),P=(0,o.useRef)(null),q=(0,o.useCallback)(()=>{F.current&&(F.current.style.height="auto",F.current.style.height="".concat(F.current.scrollHeight,"px"),!x&&F.current&&F.current.focus())},[x]);(0,o.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{R(e),e||m.push("/login?redirect=compose")});return()=>e()},[m]),(0,o.useEffect)(()=>{console.log("ArticleComposer useEffect - articleId:",t,"user:",null==L?void 0:L.uid),t&&L?(async()=>{try{var e;console.log("Fetching article for editing, ID:",t),z(!0);let s=await (0,n.getArticleById)(t);if(console.log("Fetched article:",null==s?void 0:s.title,"Body length:",null==s||null==(e=s.body)?void 0:e.length),!s){console.log("Article not found"),T("Article not found"),m.push("/");return}if(s.authorId!==L.uid){console.log("User not authorized to edit this article"),T("You can only edit your own articles"),m.push("/");return}console.log("Setting title:",s.title),f(s.title);let r=s.body.replace(/data-[\w-]+="[^"]*"/g,"");console.log("Setting content, length:",r.length,"Preview:",r.substring(0,100)+"..."),y(r),w(s.tags||[]),N(s.coverImage||""),console.log("Article data loaded successfully for editing")}catch(e){console.error("Error loading article:",e),T("Failed to load article")}finally{z(!1)}})():t?console.log("User not logged in, waiting..."):(console.log("No articleId, starting with empty content"),z(!1))},[t,L,m]),(0,o.useEffect)(()=>{q()},[x,q]),(0,o.useEffect)(()=>{let e;return L&&x.trim()&&b.trim()&&!E&&!k&&(e=setTimeout(()=>{_("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[L,x,b,E,k]);let M=(0,o.useCallback)((e,t)=>{y(t=>e!==t?(D&&I(!1),e):t)},[D]),H=()=>{let e=B.trim().toLowerCase();e&&!v.includes(e)&&v.length<5&&(w([...v,e]),Y(""))},G=e=>{w(v.filter(t=>t!==e))},V=e=>{N(e.target.value)},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!L)return void T("You must be logged in to save articles");if(!x.trim())return void T("Title is required");try{T(""),A(!0);let r=x.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),o={title:x.trim(),body:b,tags:v,coverImage:j,status:e,authorId:L.uid,authorName:L.displayName||L.email||"Anonymous",slug:r};if(t)try{console.log("Updating article with ID:",t);let e=await (0,n.iZ)(t,o);console.log("Article updated successfully"),I(!0),s?(console.log("Calling onUpdateComplete callback instead of navigating"),s(e)):(console.log("No callback provided, navigating to article page"),setTimeout(()=>{m.push("/articles/?slug=".concat(r))},1e3))}catch(e){console.error("Error updating article:",e),T("Failed to update article. Please try again."),I(!1)}else await (0,n.N6)(o),"published"===e?m.push("/articles/?slug=".concat(r)):m.push("/dashboard")}catch(e){console.error("Error saving article:",e),T("Failed to save article. Please try again.")}finally{A(!1),C(!1)}},K=async()=>{if(!b.trim())return void T("Content is required");C(!0),await _("published")},Z=async()=>{await _("drafts")};return U?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed"},children:(0,r.jsxs)("div",{className:g()["glass-loading"],children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-stone-600 text-lg",children:"Loading your article..."})]})}):(0,r.jsxs)("div",{className:"".concat(g()["glass-container"]," min-h-screen w-full"),style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed",position:"relative",borderRadius:"0px",border:"none"},children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("header",{className:"".concat(g()["glass-container"]," fixed top-6 left-6 right-6 z-50 max-w-6xl mx-auto"),style:{backdropFilter:"blur(20px) saturate(180%)"},children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("div",{className:"".concat(g()["glass-content"]," flex items-center justify-between p-4"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[d?(0,r.jsxs)("button",{onClick:d,className:"".concat(g()["glass-button"]," flex items-center gap-2 px-3 py-2 text-sm font-medium text-stone-700 hover:text-stone-900 transition-colors"),children:[(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"})}),"Back to Article"]}):(0,r.jsx)("div",{className:"text-xl font-bold text-stone-800 font-serif",children:"Journalite"}),(0,r.jsx)("div",{className:"text-stone-500 text-sm",children:t?u?"Editing: ".concat(u):"Editing":"Writing"}),D&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{className:"".concat(g()["glass-button"]," px-4 py-2 text-sm font-semibold disabled:opacity-50"),onClick:Z,disabled:E||k,children:E?"Saving...":"Save Draft"}),(0,r.jsx)("button",{className:"".concat(g()["glass-button"]," ").concat(g()["glass-button-primary"]," px-4 py-2 text-sm font-semibold disabled:opacity-50"),onClick:K,disabled:E||k||!x.trim()||!b.trim(),children:k?"Publishing...":t?"Update":"Publish"})]})]})]}),(0,r.jsxs)("div",{className:"".concat(g()["glass-content"]," pt-32 pb-16 min-h-screen w-full max-w-4xl mx-auto"),style:{paddingLeft:"64px",paddingRight:"64px"},children:[(0,r.jsx)("textarea",{ref:F,value:x,onChange:e=>{f(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1,className:"w-full bg-transparent border-none outline-none resize-none overflow-hidden text-5xl font-bold text-stone-800 placeholder-stone-400 font-serif leading-tight mb-8 focus:outline-none",style:{minHeight:"60px"}}),(j||x.length>10)&&(0,r.jsxs)("div",{className:"mb-8",children:[!j&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("input",{type:"text",value:j,onChange:V,placeholder:"Add a cover image URL...",className:"w-full bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 py-2 border-b border-stone-200 focus:border-stone-400 transition-colors"}),(0,r.jsx)("div",{className:"text-center text-stone-400 text-sm",children:"or"}),(0,r.jsx)(p,{onImageUpload:e=>{N(e)},className:"max-w-md mx-auto"})]}),j&&(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:j,alt:"Cover",className:"w-full h-64 object-cover rounded-2xl mb-4"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("input",{type:"text",value:j,onChange:V,placeholder:"Cover image URL...",className:"flex-1 bg-white/80 backdrop-blur border border-stone-200 outline-none text-stone-600 placeholder-stone-400 py-2 px-4 rounded-lg focus:border-stone-400 transition-colors"}),(0,r.jsx)("button",{onClick:()=>N(""),className:"px-4 py-2 bg-red-100/80 backdrop-blur border border-red-200 text-red-700 rounded-lg hover:bg-red-200/80 transition-colors",children:"Remove"})]})]})]}),(v.length>0||x.length>5)&&(0,r.jsxs)("div",{className:"mb-8 flex flex-wrap gap-2 items-center",children:[v.map(e=>(0,r.jsxs)("div",{className:"px-3 py-1 bg-blue-100/60 backdrop-blur text-blue-700 rounded-full text-sm font-medium flex items-center gap-2",children:[e,(0,r.jsx)("button",{className:"text-blue-600 hover:text-blue-800 font-bold text-base leading-none",onClick:()=>G(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),v.length<5&&(0,r.jsx)("input",{ref:W,type:"text",value:B,onChange:e=>{Y(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),H())},onBlur:H,placeholder:0===v.length?"Add tags...":"Add tag...",className:"bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 min-w-24 py-1"})]}),S&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50/80 border border-red-200 rounded-xl text-red-700 text-sm",children:S}),(0,r.jsx)("div",{className:"min-h-[500px] w-full relative",style:{background:"transparent"},children:(0,r.jsx)(c.A,{ref:P,articleId:t||(0,a.A)(),initialContent:b,onChange:M,placeholder:"Write your story...",className:"seamless-editor medium-style-content",onImageInsert:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(P.current){let s='<p><img src="'.concat(e,'" alt="').concat(t,'" /></p>');P.current.insertText(s)}},onVideoInsert:e=>{P.current&&P.current.insertText("\n\n[\uD83D\uDCF9 Video: Click to view](".concat(e,")\n\n"))}})})]}),(0,r.jsx)(h,{onInsert:e=>{P.current&&P.current.insertText?P.current.insertText("\n\n"+e+"\n\n"):y(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{P.current&&P.current.focus&&P.current.focus()},100)}})]})}},9210:(e,t,s)=>{s.d(t,{BC:()=>m,GE:()=>a,N6:()=>c,Oe:()=>g,Tu:()=>x,a:()=>p,fz:()=>u,getArticleById:()=>n,iZ:()=>d,l6:()=>i,tT:()=>h,zE:()=>f});var r=s(5317),o=s(3201),l=s(9995);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:s=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,r.collection)(o.db,"articles"),l=[];s||l.push((0,r.where)("status","==","published")),l.push((0,r.orderBy)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),l.push((0,r.limit)(t)));let a=(0,r.query)(e,...l),n=await (0,r.getDocs)(a);console.log("Query returned document count:",n.size);let i=[];return n.forEach(e=>{let t=e.data();i.push({id:e.id,...t})}),i}catch(e){throw console.error("Error getting articles:",e),e}}async function n(e){try{let l=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(e," (time: ").concat(l,")"));let a=(0,r.doc)(o.db,"articles",e),n=await (0,r.getDoc)(a);if(!n.exists())return console.log("❌ Article not found for ID:",e),null;{var t,s;let e={id:n.id,...n.data()};return console.log("✅ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",(null==(t=e.body)?void 0:t.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(s=e.tags)?void 0:s.join(", "))||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function i(e){try{console.log("Getting article by slug: ".concat(e,", timestamp: ").concat(Date.now()));let s=0;for(;s<2;){s++,console.log("Attempt ".concat(s," to get article by slug")),s>1&&await new Promise(e=>setTimeout(e,500));let l=(0,r.collection)(o.db,"articles"),a=(0,r.query)(l,(0,r.where)("slug","==",e),(0,r.where)("status","==","published")),n=await (0,r.getDocs)(a);if(n.empty){if(s>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{var t;let e=n.docs[0],s={id:e.id,...e.data()};return console.log("Article found by slug:",s.title,"Content length:",(null==(t=s.body)?void 0:t.length)||0),s}console.log("Article not found by slug on attempt ".concat(s,", will retry..."))}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{var t;let s=o.j2.currentUser;if(!s)throw Error("You must be logged in to create an article");let l={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:r.Timestamp.now(),authorId:s.uid,authorName:s.displayName||(null==(t=s.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,r.addDoc)((0,r.collection)(o.db,"articles"),l)).id,...l}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let s=o.j2.currentUser;if(!s)throw Error("You must be logged in to edit an article");let l=(0,r.doc)(o.db,"articles",e),a=await (0,r.getDoc)(l);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==s.uid)throw Error("You can only edit your own articles");let n={...t};t.title&&(n.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",n.slug)),n.updatedAt=r.Timestamp.now(),await (0,r.updateDoc)(l,n);let i=await (0,r.getDoc)(l);return{id:i.id,...i.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,r.collection)(o.db,"articles",e,"comments"),s=(0,r.query)(t,(0,r.orderBy)("createdAt","desc")),l=await (0,r.getDocs)(s),a=[];return l.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function m(e,t){try{var s;let a=o.j2.currentUser;if(!a)throw Error("You must be logged in to comment");let i={userId:a.uid,userName:a.displayName||(null==(s=a.email)?void 0:s.split("@")[0])||"Anonymous",content:t,createdAt:r.Timestamp.now(),likes:[],replies:[]},c=await (0,r.addDoc)((0,r.collection)(o.db,"articles",e,"comments"),i),d=await n(e);return d&&d.authorId!==a.uid&&await (0,l.fZ)(d.authorId,e,d.slug||"",d.title||"Article",c.id,t),{id:c.id,commentId:c.id,...i}}catch(e){throw console.error("Error adding comment:",e),e}}async function g(e,t,s){try{var l;let a=o.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let i=(0,r.doc)(o.db,"articles",e,"comments",t),c=await (0,r.getDoc)(i);if(!c.exists())throw Error("Comment not found");let d={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||(null==(l=a.email)?void 0:l.split("@")[0])||"Anonymous",content:s,createdAt:r.Timestamp.now(),likes:[]};await (0,r.updateDoc)(i,{replies:(0,r.arrayUnion)(d)});let u=c.data();if(u.userId!==a.uid){let s=await n(e);console.log("User ".concat(a.uid," replied to comment ").concat(t," by ").concat(u.userId," on article ").concat(null==s?void 0:s.title))}return d}catch(e){throw console.error("Error adding reply:",e),e}}async function h(e,t){try{let s=o.j2.currentUser;if(!s)throw Error("You must be logged in to like a comment");let l=(0,r.doc)(o.db,"articles",e,"comments",t),a=await (0,r.getDoc)(l);if(!a.exists())throw Error("Comment not found");let n=a.data(),i=s.uid,c=(n.likes||[]).includes(i);await (0,r.updateDoc)(l,{likes:c?(0,r.arrayRemove)(i):(0,r.arrayUnion)(i)});let d=(await (0,r.getDoc)(l)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function x(e,t){try{let s=o.j2.currentUser;if(!s)throw Error("You must be logged in to delete a comment");let l=(0,r.doc)(o.db,"articles",e,"comments",t),a=await (0,r.getDoc)(l);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==s.uid)throw Error("You can only delete your own comments");return await (0,r.deleteDoc)(l),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function p(e){try{let t=o.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let s=(0,r.doc)(o.db,"articles",e),l=await (0,r.getDoc)(s);if(!l.exists())throw Error("Article not found");if(l.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,r.deleteDoc)(s),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:s}=t;try{let t=(0,r.collection)(o.db,"articles"),l=[(0,r.where)("tags","array-contains",e),(0,r.where)("status","==","published"),(0,r.orderBy)("createdAt","desc")];s&&s>0&&l.push((0,r.limit)(s));let a=(0,r.query)(t,...l),n=await (0,r.getDocs)(a),i=[];return n.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){throw console.error("Error getting articles by tag:",e),e}}}}]);