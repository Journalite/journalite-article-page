(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6955,9210],{3094:e=>{e.exports={inspirationButton:"InspirationWidget_inspirationButton__RMfVc",inspirationWidget:"InspirationWidget_inspirationWidget__q1gMO",header:"InspirationWidget_header__wZRt7",closeButton:"InspirationWidget_closeButton__qCHBN",tabs:"InspirationWidget_tabs__hfv7d",tab:"InspirationWidget_tab__7hEDY",active:"InspirationWidget_active__CK3jp",content:"InspirationWidget_content__X6qiV",loading:"InspirationWidget_loading__2pTEa",spinner:"InspirationWidget_spinner__Z8Ppp",spin:"InspirationWidget_spin__syiZE",empty:"InspirationWidget_empty__S_QN1",subtitle:"InspirationWidget_subtitle__c_Jph",inspirationItem:"InspirationWidget_inspirationItem__295J_",themeItem:"InspirationWidget_themeItem__oQ_6E",themeTag:"InspirationWidget_themeTag__66K0g",themePrompt:"InspirationWidget_themePrompt__m0Ebn",useButton:"InspirationWidget_useButton__aSW_t",footer:"InspirationWidget_footer__7guyU",refreshButton:"InspirationWidget_refreshButton__yTge0"}},5901:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",modernToolbar:"Editor_modernToolbar__VDG5b",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},6955:(e,t,r)=>{"use strict";r.d(t,{A:()=>W});var o=r(5155),n=r(2115),i=r(5695),a=r(621),l=r(9210),s=r(3201);r(4488);var c=r(2571),d=r(2695),u=r(290),h=r(1514),g=r(7729),m=r(6770),p=r(7421),f=r(8754),_=r(156);let v=new _.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>["h".concat(e.attrs.level),0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:o,width:n,height:i}=e.attrs,a={src:t};return null!=r&&(a.alt=r),null!=o&&(a.title=o),null!=n&&(a.width=n),null!=i&&(a.height=i),["img",a]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:o}=e.attrs,n={href:t};return null!=r&&(n.title=r),null!=o&&(n.target=o),["a",n,0]}}}}),b=(e,t)=>(r,o,n)=>{let i=!1;(0,h.T2)(t)(r,o,n)&&(r=n.state,i=!0);let a=e(r,o,n);return i||a},{heading:y,paragraph:w,list_item:x,blockquote:C}=v.nodes,j=e=>b((0,u.y_)(y,{level:e}),x),k=()=>b((0,u.y_)(w),x),I=(e,t,r)=>{let{from:o,to:n}=e.selection,i=!1;return(e.doc.nodesBetween(o,n,e=>e.type!==C||(i=!0,!1)),i)?!!(0,h.T2)(x)(e,t)||(0,u.yY)(e,t):((0,h.T2)(x)(e,t)&&(e=r.state),(0,u.Im)(C)(e,t,r))};new c.k_({key:new c.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:o}=e,{$from:n,empty:i}=r.selection,{heading:a,paragraph:l}=v.nodes;return!!i&&n.parent.type===a&&n.parentOffset===n.parent.content.size&&(t.preventDefault(),(0,u.y_)(l)(r,o,e))}}});var N=r(5901),A=r.n(N);let E=n.forwardRef((e,t)=>{let{articleId:r,initialContent:i="",onChange:a,placeholder:l="Tell your story...",className:s=""}=e,b=(0,n.useRef)(null),y=(0,n.useRef)(null),w=(0,n.useRef)(a),[x,C]=(0,n.useState)(!1);w.current=a;let N=(0,n.useCallback)(e=>{if(!y.current)return;let{state:t,dispatch:r}=y.current,{selection:o}=t,n=v.text(e);r(t.tr.replaceSelectionWith(n)),y.current.focus()},[]);n.useImperativeHandle(t,()=>({insertText:N,focus:()=>{var e;return null==(e=y.current)?void 0:e.focus()}}),[N]),(0,n.useEffect)(()=>{if(b.current&&!y.current){try{let e=v.node("doc",null,[v.node("paragraph")]),t=c.$t.create({doc:e,plugins:[(0,m.w)({"Mod-b":(0,u.wh)(v.marks.strong),"Mod-i":(0,u.wh)(v.marks.em),"Mod-z":g.tN,"Mod-y":g.ZS,Enter:(0,h.wn)(v.nodes.list_item),"Mod-[":(0,h.T2)(v.nodes.list_item),"Mod-]":(0,h.$B)(v.nodes.list_item),Space:(e,t)=>{let{$from:r}=e.selection;if(console.log("\uD83D\uDD75️‍♂️ Space handler triggered. beforeCursor:",r.parent.textContent.slice(0,r.parentOffset)),r.parent.type===v.nodes.paragraph){let o=r.parent.textContent.slice(0,r.parentOffset),n=o.match(/^(#{1,6})$/);if(n){let o=n[1].length,i=e.tr.delete(r.start(),r.pos).setBlockType(r.start(),r.start(),v.nodes.heading,{level:o});return t(i),!0}let i=o.match(/\*\*([^*]+)\*\*$/);if(i){let o=r.pos-i[0].length,n=e.tr.delete(o,r.pos).insertText(i[1]+" ",o).addMark(o,o+i[1].length,v.marks.strong);return t(n),!0}let a=o.match(RegExp("(?<!\\*)\\*([^*]+)\\*$"));if(a){let o=r.pos-a[0].length,n=e.tr.delete(o,r.pos).insertText(a[1]+" ",o).addMark(o,o+a[1].length,v.marks.em);return t(n),!0}let l=o.match(/`([^`]+)`$/);if(l){let o=r.pos-l[0].length,n=e.tr.delete(o,r.pos).insertText(l[1]+" ",o).addMark(o,o+l[1].length,v.marks.code);return t(n),!0}let s=o.match(/^[-*]$/);if(s){console.log("Bullet list match:",s[0]);try{let o=v.nodes.list_item.create(null,v.nodes.paragraph.create()),n=v.nodes.bullet_list.create(null,o),i=r.pos-1,a=e.tr.delete(i,r.pos).replaceWith(i,i,n);return a=a.setSelection(c.U3.create(a.doc,i+2)),t(a),console.log("Auto bullet list creation: success"),!0}catch(e){console.log("Auto bullet list creation failed:",e)}}let d=o.match(/^1\.$/);if(d){console.log("Ordered list match:",d[0]);try{let o=v.nodes.list_item.create(null,v.nodes.paragraph.create()),n=v.nodes.ordered_list.create(null,o),i=r.pos-2,a=e.tr.delete(i,r.pos).replaceWith(i,i,n);return a=a.setSelection(c.U3.create(a.doc,i+2)),t(a),console.log("Auto ordered list creation: success"),!0}catch(e){console.log("Auto ordered list creation failed:",e)}}}return!1}}),(0,m.w)(u.RV),(0,g.b6)(),(0,p.A)(),(0,f.z)()]}),r=new d.Lz(b.current,{state:t,editable:()=>!0,dispatchTransaction:e=>{let t=r.state.apply(e);if(r.updateState(t),e.docChanged&&w.current){let e=function(e){let t=document.createElement("div");return t.appendChild(_.ZF.fromSchema(v).serializeFragment(e.content)),t.innerHTML}(t.doc),r=t.doc.toJSON();w.current(e,r)}},attributes:{"data-placeholder":l||"Tell your story..."}});y.current=r,C(!0),setTimeout(()=>{r&&!r.isDestroyed&&r.focus()},100)}catch(e){console.error("Error initializing editor:",e),C(!0)}return()=>{y.current&&(y.current.destroy(),y.current=null)}}},[]);let E=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;(0,u.wh)(v.marks.strong)(e,t)&&y.current.focus()},[]),M=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;(0,u.wh)(v.marks.em)(e,t)&&y.current.focus()},[]),D=(0,n.useCallback)(e=>{if(!y.current)return;let{state:t,dispatch:r}=y.current;j(e)(t,r,y.current)&&y.current.focus()},[]);(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;k()(e,t,y.current)&&y.current.focus()},[]);let B=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;I(e,t,y.current)&&y.current.focus()},[]),S=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;(0,u.y_)(v.nodes.code_block)(e,t)&&y.current.focus()},[]),T=(0,n.useCallback)(()=>{if(!y.current)return;console.log("Bullet list button clicked");let{state:e,dispatch:t}=y.current,{$from:r,$to:o}=e.selection;try{let n=v.nodes.list_item.create(null,v.nodes.paragraph.create(null,r.parent.content)),i=v.nodes.bullet_list.create(null,n),a=e.tr.replaceWith(r.start(),o.end(),i);t(a),console.log("Manual bullet list creation: success"),y.current.focus()}catch(o){console.log("Manual bullet list creation failed:",o);let r=(0,h.Sd)(v.nodes.bullet_list)(e,t);console.log("wrapInList fallback result:",r),r&&y.current.focus()}},[]),H=(0,n.useCallback)(()=>{if(!y.current)return;console.log("Ordered list button clicked");let{state:e,dispatch:t}=y.current,{$from:r,$to:o}=e.selection;try{let n=v.nodes.list_item.create(null,v.nodes.paragraph.create(null,r.parent.content)),i=v.nodes.ordered_list.create(null,n),a=e.tr.replaceWith(r.start(),o.end(),i);t(a),console.log("Manual ordered list creation: success"),y.current.focus()}catch(o){console.log("Manual ordered list creation failed:",o);let r=(0,h.Sd)(v.nodes.ordered_list)(e,t);console.log("wrapInList fallback result:",r),r&&y.current.focus()}},[]),W=(0,n.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&y.current){let{state:t,dispatch:r}=y.current,o=v.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(o)),y.current.focus()}},[]),z=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;(0,g.tN)(e,t),y.current.focus()},[]),U=(0,n.useCallback)(()=>{if(!y.current)return;let{state:e,dispatch:t}=y.current;(0,g.ZS)(e,t),y.current.focus()},[]),O=(0,n.useCallback)(e=>{if(!y.current)return!1;let{from:t,$from:r,to:o,empty:n}=y.current.state.selection;return n?e.isInSet(y.current.state.storedMarks||r.marks()):y.current.state.doc.rangeHasMark(t,o,e)},[]),L=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!y.current)return!1;let{from:r,to:o}=y.current.state.selection,n=!0;return y.current.state.doc.nodesBetween(r,o,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(n=!1,!1)),n},[]),G=(0,n.useCallback)(()=>{if(!y.current)return!1;let{from:e,to:t}=y.current.state.selection,r=!1;return y.current.state.doc.nodesBetween(e,t,e=>e.type!==v.nodes.blockquote||(r=!0,!1)),r},[]);return(0,o.jsxs)("div",{className:A().editor,style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[x&&(0,o.jsx)("div",{className:A().modernToolbar,style:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,o.jsxs)("div",{className:A().toolbarContainer,children:[(0,o.jsxs)("div",{className:A().formatGroup,children:[(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(O(v.marks.strong)?A().active:""),onClick:E,title:"Bold (⌘B)","aria-label":"Bold",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(O(v.marks.em)?A().active:""),onClick:M,title:"Italic (⌘I)","aria-label":"Italic",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,o.jsx)("div",{className:A().divider}),(0,o.jsxs)("div",{className:A().formatGroup,children:[(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(L(v.nodes.heading,{level:1})?A().active:""),onClick:()=>D(1),title:"Large Heading (⌘⇧1)","aria-label":"Heading 1",children:(0,o.jsx)("span",{className:A().headingIcon,children:"H1"})}),(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(L(v.nodes.heading,{level:2})?A().active:""),onClick:()=>D(2),title:"Medium Heading (⌘⇧2)","aria-label":"Heading 2",children:(0,o.jsx)("span",{className:A().headingIcon,children:"H2"})}),(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(L(v.nodes.heading,{level:3})?A().active:""),onClick:()=>D(3),title:"Small Heading (⌘⇧3)","aria-label":"Heading 3",children:(0,o.jsx)("span",{className:A().headingIcon,children:"H3"})})]}),(0,o.jsx)("div",{className:A().divider}),(0,o.jsxs)("div",{className:A().formatGroup,children:[(0,o.jsx)("button",{className:A().toolBtn,onClick:T,title:"Bullet List","aria-label":"Bullet list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,o.jsx)("button",{className:A().toolBtn,onClick:H,title:"Numbered List","aria-label":"Numbered list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(G()?A().active:""),onClick:B,title:"Quote (⌘>)","aria-label":"Quote",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,o.jsx)("div",{className:A().divider}),(0,o.jsxs)("div",{className:A().formatGroup,children:[(0,o.jsx)("button",{className:A().toolBtn,onClick:W,title:"Add Image","aria-label":"Insert image",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,o.jsx)("button",{className:"".concat(A().toolBtn," ").concat(L(v.nodes.code_block)?A().active:""),onClick:S,title:"Code Block","aria-label":"Code block",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,o.jsx)("div",{className:A().divider}),(0,o.jsxs)("div",{className:A().formatGroup,children:[(0,o.jsx)("button",{className:A().toolBtn,onClick:z,title:"Undo (⌘Z)","aria-label":"Undo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,o.jsx)("button",{className:A().toolBtn,onClick:U,title:"Redo (⌘Y)","aria-label":"Redo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!x&&(0,o.jsxs)("div",{className:A().loading,children:[(0,o.jsx)("div",{className:A().loadingSpinner}),(0,o.jsx)("span",{children:"Loading editor..."})]}),(0,o.jsx)("div",{ref:b,className:A().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"400px",opacity:x?1:.3}})]})});E.displayName="Editor";var M=r(9122),D=r(3094),B=r.n(D);let S=e=>{let{onInsert:t}=e,[r,i]=(0,n.useState)(!1),[a,l]=(0,n.useState)([]),[s,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),[h,g]=(0,n.useState)("inspirations"),m=async()=>{u(!0);try{let[e,t]=await Promise.all([(0,M.Aq)(),(0,M.Gy)()]);l(e),c(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{u(!1)}},p=e=>{t&&t(e),i(!1)},f=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||"Write about ".concat(e,"...");return r?(0,o.jsxs)("div",{className:B().inspirationWidget,children:[(0,o.jsxs)("div",{className:B().header,children:[(0,o.jsx)("h3",{children:"\uD83D\uDCA1 Your Reflection Insights"}),(0,o.jsx)("button",{onClick:()=>i(!1),className:B().closeButton,children:"\xd7"})]}),(0,o.jsxs)("div",{className:B().tabs,children:[(0,o.jsxs)("button",{className:"".concat(B().tab," ").concat("inspirations"===h?B().active:""),onClick:()=>g("inspirations"),children:["Recent Thoughts (",a.length,")"]}),(0,o.jsxs)("button",{className:"".concat(B().tab," ").concat("themes"===h?B().active:""),onClick:()=>g("themes"),children:["Writing Themes (",s.length,")"]})]}),(0,o.jsx)("div",{className:B().content,children:d?(0,o.jsxs)("div",{className:B().loading,children:[(0,o.jsx)("div",{className:B().spinner}),(0,o.jsx)("p",{children:"Loading your insights..."})]}):"inspirations"===h?(0,o.jsx)("div",{className:B().inspirationsList,children:0===a.length?(0,o.jsxs)("div",{className:B().empty,children:[(0,o.jsx)("p",{children:"\uD83D\uDCAD No reflections yet!"}),(0,o.jsx)("p",{children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:B().subtitle,children:"Your past reflections that might spark new ideas:"}),a.map((e,t)=>(0,o.jsxs)("div",{className:B().inspirationItem,children:[(0,o.jsxs)("p",{children:['"',e.response,'"']}),e.articleTitle&&(0,o.jsxs)("p",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["From: ",e.articleTitle]}),(0,o.jsx)("button",{onClick:()=>{let t=e.articleTitle?' (inspired by "'.concat(e.articleTitle,'")'):"";p('"'.concat(e.response,'"').concat(t," - This reminds me of..."))},className:B().useButton,children:"Use as starting point"})]},t))]})}):(0,o.jsx)("div",{className:B().themesList,children:0===s.length?(0,o.jsxs)("div",{className:B().empty,children:[(0,o.jsx)("p",{children:"\uD83C\uDFA8 No themes identified yet!"}),(0,o.jsx)("p",{children:"Keep reflecting on articles to discover your writing themes."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:B().subtitle,children:"Writing prompts based on your reflection patterns:"}),s.map((e,t)=>(0,o.jsxs)("div",{className:B().themeItem,children:[(0,o.jsx)("div",{className:B().themeTag,children:e}),(0,o.jsx)("p",{className:B().themePrompt,children:f(e)}),(0,o.jsx)("button",{onClick:()=>p(f(e)),className:B().useButton,children:"Start writing"})]},t))]})})}),(0,o.jsx)("div",{className:B().footer,children:(0,o.jsx)("button",{onClick:m,className:B().refreshButton,disabled:d,children:"\uD83D\uDD04 Refresh insights"})})]}):(0,o.jsx)("button",{onClick:()=>{r||m(),i(!r)},className:B().inspirationButton,title:"Get inspiration from your reflections",children:"✨ Inspiration"})};var T=r(9396),H=r.n(T);let W=e=>{let{articleId:t,onUpdateComplete:r}=e,c=(0,i.useRouter)(),[d,u]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[m,p]=(0,n.useState)([]),[f,_]=(0,n.useState)(""),[v,b]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),[x,C]=(0,n.useState)(!1),[j,k]=(0,n.useState)(""),[I,N]=(0,n.useState)(!!t),[A,M]=(0,n.useState)(null),[D,B]=(0,n.useState)(""),T=(0,n.useRef)(null),W=(0,n.useRef)(null),z=(0,n.useRef)(null),U=(0,n.useCallback)(()=>{T.current&&(T.current.style.height="auto",T.current.style.height="".concat(T.current.scrollHeight,"px"),!d&&T.current&&T.current.focus())},[d]);(0,n.useEffect)(()=>{let e=s.j2.onAuthStateChanged(e=>{M(e),e||c.push("/login?redirect=compose")});return()=>e()},[c]),(0,n.useEffect)(()=>{t&&A?(async()=>{try{N(!0);let e=await (0,l.getArticleById)(t);if(!e){k("Article not found"),c.push("/");return}if(e.authorId!==A.uid){k("You can only edit your own articles"),c.push("/");return}u(e.title);let r=e.body.replace(/data-[\w-]+="[^"]*"/g,"");g(r),p(e.tags||[]),_(e.coverImage||"")}catch(e){console.error("Error loading article:",e),k("Failed to load article")}finally{N(!1)}})():t||N(!1)},[t,A,c]),(0,n.useEffect)(()=>{U()},[d,U]),(0,n.useEffect)(()=>{let e;return A&&d.trim()&&h.trim()&&!y&&!v&&(e=setTimeout(()=>{P("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[A,d,h,y,v]);let O=(0,n.useCallback)((e,t)=>{e!==h&&(g(e),x&&C(!1))},[h,x]),L=()=>{let e=D.trim().toLowerCase();e&&!m.includes(e)&&m.length<5&&(p([...m,e]),B(""))},G=e=>{p(m.filter(t=>t!==e))},P=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!A)return void k("You must be logged in to save an article");if(!d.trim())return void k("Title is required");if(!h.trim())return void k("Content is required");try{w(!0),k("");let o=h.replace(/data-[\w-]+="[^"]*"/g,""),n={title:d.trim(),body:o,tags:m,coverImage:f.trim(),status:e};if(console.log("Saving article data:",n),t)try{let e=await (0,l.iZ)(t,n);console.log("Article updated successfully:",null==e?void 0:e.title),C(!0),await new Promise(e=>setTimeout(e,500));let o=await (0,l.getArticleById)(t);console.log("Fetched updated article data:",null==o?void 0:o.title),r&&r(o),setTimeout(()=>{console.log("Applying changes immediately and redirecting to article ID page"),window.location.href="/articles/".concat(t,"/view?updated=true&time=").concat(Date.now()),setTimeout(()=>{window.location.pathname.includes("/edit")&&(console.log("Fallback navigation to ID-based article page"),window.location.href="/articles/".concat(t,"?updated=true&time=").concat(Date.now()))},2e3)},1e3)}catch(e){console.error("Error updating article:",e),k("Failed to update article. Please try again."),C(!1)}else{let t=await (0,l.N6)(n);"published"===e?c.push("/articles/".concat(t.id)):c.push("/dashboard")}}catch(e){console.error("Error saving article:",e),k("Failed to save article. Please try again.")}finally{w(!1),b(!1)}},R=async()=>{if(!h.trim())return void k("Content is required");b(!0),await P("published")},Y=async()=>{await P("drafts")};return I?(0,o.jsxs)("div",{className:H().composerLoading,children:[(0,o.jsx)("div",{className:H().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):(0,o.jsxs)("div",{className:H().articleComposer,children:[(0,o.jsxs)("header",{className:H().composerHeader,children:[(0,o.jsx)("div",{className:H().logoContainer,children:(0,o.jsx)("div",{className:H().logo,children:"Journalite"})}),(0,o.jsxs)("div",{className:H().actionButtons,children:[x&&(0,o.jsxs)("span",{className:H().savedIndicator,children:[(0,o.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,o.jsx)("button",{className:H().actionButton,onClick:Y,disabled:y||v,children:"Save draft"}),(0,o.jsx)("button",{className:H().publishButton,onClick:R,disabled:y||v||!d.trim()||!h.trim(),children:t?"Update":"Publish"})]})]}),(0,o.jsxs)("main",{className:H().composerContent,children:[(0,o.jsx)("textarea",{ref:T,className:H().titleInput,value:d,onChange:e=>{u(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1}),(0,o.jsxs)("div",{className:H().coverImageInput,children:[(0,o.jsx)("input",{type:"text",value:f,onChange:e=>{_(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:H().imageUrlInput}),f&&(0,o.jsx)("div",{className:H().coverImagePreview,children:(0,o.jsx)("img",{src:f,alt:"Cover preview"})})]}),(0,o.jsxs)("div",{className:H().tagContainer,children:[m.map(e=>(0,o.jsxs)("div",{className:H().tag,children:[e,(0,o.jsx)("button",{className:H().removeTagButton,onClick:()=>G(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),m.length<5&&(0,o.jsx)("input",{ref:W,type:"text",value:D,onChange:e=>{B(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),L())},onBlur:L,placeholder:0===m.length?"Add up to 5 tags...":"Add another tag...",className:H().tagInput})]}),j&&(0,o.jsx)("div",{className:H().errorMessage,children:j}),(0,o.jsx)("div",{className:H().editorContainer,children:(0,o.jsx)(E,{ref:z,articleId:t||(0,a.A)(),initialContent:h,onChange:O,placeholder:"Tell your story..."})})]}),(0,o.jsx)(S,{onInsert:e=>{z.current&&z.current.insertText?z.current.insertText("\n\n"+e+"\n\n"):g(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{z.current&&z.current.focus&&z.current.focus()},100)}})]})}},9210:(e,t,r)=>{"use strict";r.d(t,{BC:()=>h,GE:()=>a,N6:()=>c,Oe:()=>g,Tu:()=>p,a:()=>f,fz:()=>u,getArticleById:()=>l,iZ:()=>d,l6:()=>s,tT:()=>m,zE:()=>_});var o=r(5317),n=r(3201),i=r(9995);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,o.rJ)(n.db,"articles"),i=[];r||i.push((0,o._M)("status","==","published")),i.push((0,o.My)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),i.push((0,o.AB)(t)));let a=(0,o.P)(e,...i),l=await (0,o.GG)(a);console.log("Query returned document count:",l.size);let s=[];return l.forEach(e=>{let t=e.data();s.push({id:e.id,...t})}),s}catch(e){throw console.error("Error getting articles:",e),e}}async function l(e){try{let i=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(e," (time: ").concat(i,")"));let a=(0,o.doc)(n.db,"articles",e),l=await (0,o.x7)(a);if(!l.exists())return console.log("❌ Article not found for ID:",e),null;{var t,r;let e={id:l.id,...l.data()};return console.log("✅ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",(null==(t=e.body)?void 0:t.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(r=e.tags)?void 0:r.join(", "))||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function s(e){try{console.log("Getting article by slug: ".concat(e,", timestamp: ").concat(Date.now()));let r=0;for(;r<2;){r++,console.log("Attempt ".concat(r," to get article by slug")),r>1&&await new Promise(e=>setTimeout(e,500));let i=(0,o.rJ)(n.db,"articles"),a=(0,o.P)(i,(0,o._M)("slug","==",e),(0,o._M)("status","==","published")),l=await (0,o.GG)(a);if(l.empty){if(r>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{var t;let e=l.docs[0],r={id:e.id,...e.data()};return console.log("Article found by slug:",r.title,"Content length:",(null==(t=r.body)?void 0:t.length)||0),r}console.log("Article not found by slug on attempt ".concat(r,", will retry..."))}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{var t;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let i={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Dc.now(),authorId:r.uid,authorName:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"articles"),i)).id,...i}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let i=(0,o.doc)(n.db,"articles",e),a=await (0,o.x7)(i);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let l={...t};t.title&&(l.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",l.slug)),l.updatedAt=o.Dc.now(),await (0,o.updateDoc)(i,l);let s=await (0,o.x7)(i);return{id:s.id,...s.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,o.rJ)(n.db,"articles",e,"comments"),r=(0,o.P)(t,(0,o.My)("createdAt","desc")),i=await (0,o.GG)(r),a=[];return i.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function h(e,t){try{var r;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to comment");let s={userId:a.uid,userName:a.displayName||(null==(r=a.email)?void 0:r.split("@")[0])||"Anonymous",content:t,createdAt:o.Dc.now(),likes:[],replies:[]},c=await (0,o.gS)((0,o.rJ)(n.db,"articles",e,"comments"),s),d=await l(e);return d&&d.authorId!==a.uid&&await (0,i.fZ)(d.authorId,e,d.slug||"",d.title||"Article",c.id,t),{id:c.id,commentId:c.id,...s}}catch(e){throw console.error("Error adding comment:",e),e}}async function g(e,t,r){try{var i;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let s=(0,o.doc)(n.db,"articles",e,"comments",t),c=await (0,o.x7)(s);if(!c.exists())throw Error("Comment not found");let d={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||(null==(i=a.email)?void 0:i.split("@")[0])||"Anonymous",content:r,createdAt:o.Dc.now(),likes:[]};await (0,o.updateDoc)(s,{replies:(0,o.arrayUnion)(d)});let u=c.data();if(u.userId!==a.uid){let r=await l(e);console.log("User ".concat(a.uid," replied to comment ").concat(t," by ").concat(u.userId," on article ").concat(null==r?void 0:r.title))}return d}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let i=(0,o.doc)(n.db,"articles",e,"comments",t),a=await (0,o.x7)(i);if(!a.exists())throw Error("Comment not found");let l=a.data(),s=r.uid,c=(l.likes||[]).includes(s);await (0,o.updateDoc)(i,{likes:c?(0,o.arrayRemove)(s):(0,o.arrayUnion)(s)});let d=(await (0,o.x7)(i)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function p(e,t){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let i=(0,o.doc)(n.db,"articles",e,"comments",t),a=await (0,o.x7)(i);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.kd)(i),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=n.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(n.db,"articles",e),i=await (0,o.x7)(r);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,o.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=t;try{let t=(0,o.rJ)(n.db,"articles"),i=[(0,o._M)("tags","array-contains",e),(0,o._M)("status","==","published"),(0,o.My)("createdAt","desc")];r&&r>0&&i.push((0,o.AB)(r));let a=(0,o.P)(t,...i),l=await (0,o.GG)(a),s=[];return l.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting articles by tag:",e),e}}},9396:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},9995:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>a,Ss:()=>l,bA:()=>s,fP:()=>d,fZ:()=>i,he:()=>c});var o=r(5317),n=r(3201);async function i(e,t,r,i,a,l){try{let t=n.j2.currentUser;if(!t||t.uid===e)return null;let s={userId:e,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:"".concat(t.displayName||"Someone",' commented on your article: "').concat(l.substring(0,50)).concat(l.length>50?"...":"",'"'),fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:o.Dc.now(),articleSlug:r,articleTitle:i};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating notification:",e),null}}async function a(e,t,r,i){try{if(e===r)return null;let a={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(t," (@").concat(i,") started following you"),fromUser:{id:r,name:t,username:i},createdAt:o.Dc.now()};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),a)).id,...a}}catch(e){return console.error("Error creating follow notification:",e),null}}async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let i=(0,o.rJ)(n.db,"notifications");t=e?(0,o.P)(i,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1),(0,o.My)("createdAt","desc"),(0,o.AB)(100)):(0,o.P)(i,(0,o._M)("userId","==",r.uid),(0,o.My)("createdAt","desc"),(0,o.AB)(100));let a=await (0,o.GG)(t),l=[];return a.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error fetching notifications:",e),e}}async function s(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",e),i=await (0,o.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(t,(0,o._M)("userId","==",e.uid),(0,o._M)("read","==",!1)),i=await (0,o.GG)(r),a=i.docs.map(e=>(0,o.updateDoc)(e.ref,{read:!0}));return await Promise.all(a),{success:!0,count:i.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",e),i=await (0,o.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.kd)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=n.j2.currentUser;if(!e)return 0;let t=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(t,(0,o._M)("userId","==",e.uid),(0,o._M)("read","==",!1));return(await (0,o.GG)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}}}]);