(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1431],{239:(e,t,o)=>{var n={"./en/index":8021};function r(e){return o(i(e))}function i(e){if(!o.o(n,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=239},326:(e,t,o)=>{"use strict";o.d(t,{Qx:()=>n});let n={joyful:{gradientStart:"#fde047",gradientEnd:"#fb923c",accent:"#f59e0b"},angry:{gradientStart:"#f87171",gradientEnd:"#dc2626",accent:"#ef4444"},energetic:{gradientStart:"#34d399",gradientEnd:"#059669",accent:"#10b981"},peaceful:{gradientStart:"#60a5fa",gradientEnd:"#2563eb",accent:"#3b82f6"},reflective:{gradientStart:"#a78bfa",gradientEnd:"#7c3aed",accent:"#8b5cf6"},sad:{gradientStart:"#94a3b8",gradientEnd:"#475569",accent:"#64748b"},calm:{gradientStart:"#67e8f9",gradientEnd:"#0891b2",accent:"#06b6d4"}}},1780:(e,t,o)=>{"use strict";o.d(t,{J0:()=>n.useState,Kr:()=>n.useMemo,NT:()=>n.useContext,li:()=>n.useRef});var n=o(2115)},3112:(e,t,o)=>{"use strict";o.d(t,{Bi:()=>n.useId,I5:()=>n.useInsertionEffect,NT:()=>n.useContext,li:()=>n.useRef});var n=o(2115)},4570:(e,t,o)=>{"use strict";o.d(t,{Bi:()=>n.useId,Kr:()=>n.useMemo});var n=o(2115)},4655:e=>{e.exports={articleContainer:"ArticleWithHighlights_articleContainer__r1hgP",articleContent:"ArticleWithHighlights_articleContent__qrFhS",loadingContainer:"ArticleWithHighlights_loadingContainer__6cqbO",loadingIndicator:"ArticleWithHighlights_loadingIndicator__ymNyj",spin:"ArticleWithHighlights_spin__Olepl",errorContainer:"ArticleWithHighlights_errorContainer__njqpS",errorMessage:"ArticleWithHighlights_errorMessage__D4C7O"}},5343:(e,t,o)=>{"use strict";o.d(t,{vJ:()=>n.useEffect});var n=o(2115)},5377:e=>{e.exports={commentSection:"comment_commentSection__SP_jS",commentSectionTitle:"comment_commentSectionTitle__F_Jxe",commentError:"comment_commentError__A2v6U",commentForm:"comment_commentForm__U8b7X",commentInputContainer:"comment_commentInputContainer__3WsSp",loginPromptContainer:"comment_loginPromptContainer__X4aZr",commentAvatar:"comment_commentAvatar__uav6Q",replyAvatar:"comment_replyAvatar__dIlrw",commentInput:"comment_commentInput__4DHa1",replyInput:"comment_replyInput__8t_ho",commentSubmit:"comment_commentSubmit__UfvUF",replySubmit:"comment_replySubmit__2eCP7",loginButton:"comment_loginButton__4encR",loginModalOverlay:"comment_loginModalOverlay__Pk_AM",loginModal:"comment_loginModal__n984X",loginModalClose:"comment_loginModalClose__v02Rx",loginModalTitle:"comment_loginModalTitle__nZpZB",loginModalText:"comment_loginModalText__XwRn6",loginModalButtons:"comment_loginModalButtons__XdVNl",loginModalButton:"comment_loginModalButton__d8Bnr",primary:"comment_primary__1UIRJ",secondary:"comment_secondary__zc89j",commentLoading:"comment_commentLoading___WYvK",loadingDots:"comment_loadingDots___Lw2B",loadingDot:"comment_loadingDot__skUEk",pulse:"comment_pulse__czQlg",noComments:"comment_noComments__U9FG6",commentsList:"comment_commentsList__ZRMbc",commentItem:"comment_commentItem__Vx48l",commentHeader:"comment_commentHeader__3oOD6",commentUser:"comment_commentUser__QP5pY",commentDate:"comment_commentDate__5zfpn",commentContent:"comment_commentContent__DiE8h",commentActions:"comment_commentActions___Wpzi",commentLikeBtn:"comment_commentLikeBtn__wAYZO",replyToggle:"comment_replyToggle__bCRZg",commentDeleteBtn:"comment_commentDeleteBtn__BnLQc",liked:"comment_liked__2yWZ9",repliesToggle:"comment_repliesToggle__yepDc",repliesToggleIcon:"comment_repliesToggleIcon__EZRkK",open:"comment_open__cpLDc",replySection:"comment_replySection__mAqn4",replyItem:"comment_replyItem__ndhqf",replyHeader:"comment_replyHeader__Y2bUK",replyUser:"comment_replyUser__rw4V8",replyDate:"comment_replyDate__4Jafb",replyContent:"comment_replyContent__uV2jp",replyForm:"comment_replyForm__aYyum",inThread:"comment_inThread__lUoKT",replyButtons:"comment_replyButtons__KRGyv",replyCancel:"comment_replyCancel__od7Vq"}},5402:(e,t,o)=>{"use strict";o.d(t,{q6:()=>n.createContext});var n=o(2115)},6016:(e,t,o)=>{"use strict";o.d(t,{A:()=>g});var n=o(5155),r=o(2115),i=o(5317),a=o(6203),l=o(3201),s=o(5377),c=o.n(s),d=o(4814),m=o(8607);o(7041),o(326);let g=r.memo(e=>{let{articleId:t,className:o=""}=e,[s,g]=(0,r.useState)([]),[h,u]=(0,r.useState)(""),[p,x]=(0,r.useState)(null),[f,b]=(0,r.useState)(!1),[y,_]=(0,r.useState)(!1),[v,w]=(0,r.useState)(null),[S,j]=(0,r.useState)(""),[C,k]=(0,r.useState)(null),[A,N]=(0,r.useState)(""),[R,E]=(0,r.useState)(new Set),[F,T]=(0,r.useState)(!1),[M,I]=(0,r.useState)(0),B=(0,r.useMemo)(()=>({isMobile:M<=768,isTablet:M>768&&M<=1024,isSmallPhone:M<=480,bottomSafeArea:M<=768?120:40}),[M]);(0,r.useEffect)(()=>{let e,t=()=>I(window.innerWidth);t();let o=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),clearTimeout(e)}},[]),(0,r.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(l.j2,e=>{x(e),b(!!e)});return()=>e()},[]),(0,r.useEffect)(()=>{if(!t)return;let e=(0,i.collection)(l.db,"articles",t,"comments"),o=(0,i.query)(e,(0,i.orderBy)("createdAt","desc")),n=(0,i.onSnapshot)(o,e=>{let t=[];e.forEach(e=>{let o=e.data();t.push({id:e.id,...o})}),g(D(t))});return()=>n()},[t]);let D=(0,r.useCallback)(e=>{let t=e.filter(e=>!e.parentId),o=e.filter(e=>e.parentId);return t.map(e=>({...e,replies:o.filter(t=>t.parentId===e.id).sort((e,t)=>{var o,n;return(null==(o=e.createdAt)?void 0:o.toDate())-(null==(n=t.createdAt)?void 0:n.toDate())})}))},[]),L=(0,r.useMemo)(()=>"calm",[!1,h,S,A]),z=(0,r.useCallback)(async e=>{if(e.preventDefault(),h.trim()&&p&&!y){_(!0);try{let e=(0,i.collection)(l.db,"articles",t,"comments");await (0,i.addDoc)(e,{text:h.trim(),authorId:p.uid,authorName:p.displayName||"Anonymous",authorEmail:p.email||"",createdAt:new Date,likes:[],mood:void 0}),u(""),T(!1)}catch(e){console.error("Error adding comment:",e)}finally{_(!1)}}},[h,p,y,t,L,!1]),P=(0,r.useCallback)(async e=>{if(S.trim()&&p&&!y){_(!0);try{let o=(0,i.collection)(l.db,"articles",t,"comments");await (0,i.addDoc)(o,{text:S.trim(),authorId:p.uid,authorName:p.displayName||"Anonymous",authorEmail:p.email||"",createdAt:new Date,likes:[],parentId:e,mood:void 0}),j(""),w(null)}catch(e){console.error("Error adding reply:",e)}finally{_(!1)}}},[S,p,y,t,!1]),W=(0,r.useCallback)(async(e,o)=>{if(p)try{let n=(0,i.doc)(l.db,"articles",t,"comments",e),r=o.includes(p.uid)?o.filter(e=>e!==p.uid):[...o,p.uid];await (0,i.updateDoc)(n,{likes:r})}catch(e){console.error("Error updating like:",e)}},[p,t]),H=(0,r.useCallback)(async e=>{if(A.trim()&&p&&!y){_(!0);try{let o=(0,i.doc)(l.db,"articles",t,"comments",e);await (0,i.updateDoc)(o,{text:A.trim(),mood:void 0,editedAt:new Date}),k(null),N("")}catch(e){console.error("Error editing comment:",e)}finally{_(!1)}}},[A,p,y,t,!1]),O=(0,r.useCallback)(async e=>{if(p&&!y&&confirm("Are you sure you want to delete this comment?")){_(!0);try{let o=(0,i.doc)(l.db,"articles",t,"comments",e);await (0,i.deleteDoc)(o);let n=(0,i.query)((0,i.collection)(l.db,"articles",t,"comments"),(0,i.where)("parentId","==",e)),r=(await (0,i.getDocs)(n)).docs.map(e=>(0,i.deleteDoc)((0,i.doc)(l.db,"articles",t,"comments",e.id)));await Promise.all(r),E(t=>{let o=new Set(t);return o.delete(e),o})}catch(e){console.error("Error deleting comment:",e)}finally{_(!1)}}},[p,y,t]),U=(0,r.useCallback)(e=>{if(!e)return"Just now";let t=e.toDate?e.toDate():new Date(e),o=Math.floor((new Date().getTime()-t.getTime())/6e4);return o<1?"Just now":o<60?"".concat(o,"m ago"):o<1440?"".concat(Math.floor(o/60),"h ago"):"".concat(Math.floor(o/1440),"d ago")},[]),q=(0,r.useMemo)(()=>({marginBottom:B.isMobile?"max(".concat(B.bottomSafeArea+40,"px, calc(").concat(B.bottomSafeArea,"px + env(safe-area-inset-bottom)))"):"2rem",paddingBottom:B.isMobile?"20px":"0"}),[B]),J=(0,r.useCallback)(function(e){var t,o,r;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,n.jsxs)("div",{className:"".concat(c().comment," ").concat(i?c().reply:""),children:[(0,n.jsxs)("div",{className:c().commentContent,children:[(0,n.jsxs)("div",{className:c().commentHeader,children:[(0,n.jsx)("div",{className:c().commentAvatar,children:(0,m.d)(e.authorName,e.authorId)}),(0,n.jsxs)("div",{className:c().commentMeta,children:[(0,n.jsx)("span",{className:c().commentAuthor,children:e.authorName}),(0,n.jsx)("span",{className:c().commentTime,children:U(e.createdAt)})]}),(null==p?void 0:p.uid)===e.authorId&&(0,n.jsxs)("div",{className:c().commentActions,children:[(0,n.jsx)("button",{onClick:()=>{let t=new Set(R);R.has(e.id)?t.delete(e.id):t.add(e.id),E(t)},className:c().menuButton,"aria-label":"Comment options",children:(0,n.jsx)(d.Mg,{size:16,color:"#64748b"})}),R.has(e.id)&&(0,n.jsxs)("div",{className:c().dropdownMenu,children:[(0,n.jsxs)("button",{onClick:()=>{k(e.id),N(e.text),E(new Set)},className:c().menuItem,children:[(0,n.jsx)(d.qU,{size:14,color:"#3b82f6"}),"Edit"]}),(0,n.jsxs)("button",{onClick:()=>O(e.id),className:c().menuItem,disabled:y,children:[(0,n.jsx)(d.uc,{size:14,color:"#ef4444"}),"Delete"]})]})]})]}),C===e.id?(0,n.jsxs)("div",{className:c().editForm,children:[(0,n.jsx)("textarea",{value:A,onChange:e=>N(e.target.value),className:"".concat(c().editInput," mobile-optimized-input"),"data-mobile":"true",rows:3,autoFocus:!0}),(0,n.jsxs)("div",{className:c().editActions,children:[(0,n.jsx)("button",{onClick:()=>{k(null),N("")},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>H(e.id),className:c().saveButton,disabled:!A.trim()||y,children:y?"Saving...":"Save"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:c().commentText,children:e.text}),(0,n.jsxs)("div",{className:c().commentFooter,children:[(0,n.jsxs)("button",{onClick:()=>W(e.id,e.likes||[]),className:"".concat(c().likeButton," ").concat((null==(t=e.likes)?void 0:t.includes(null==p?void 0:p.uid))?c().liked:""),disabled:!f,children:[(0,n.jsx)(d.C3,{size:14,color:(null==(o=e.likes)?void 0:o.includes(null==p?void 0:p.uid))?"#ef4444":"#64748b"}),(null==(r=e.likes)?void 0:r.length)?e.likes.length:""]}),!i&&(0,n.jsxs)("button",{onClick:()=>w(e.id),className:c().replyButton,disabled:!f,children:[(0,n.jsx)(d.Sb,{size:14,color:"#64748b"}),"Reply"]})]})]})]}),v===e.id&&(0,n.jsxs)("div",{className:c().replyForm,children:[(0,n.jsxs)("div",{className:c().replyInputContainer,children:[(0,n.jsx)("div",{className:c().commentAvatar,children:(0,m.d)((null==p?void 0:p.displayName)||"User",null==p?void 0:p.uid)}),(0,n.jsx)("textarea",{value:S,onChange:e=>j(e.target.value),placeholder:"Write a reply...",className:"".concat(c().replyInput," mobile-optimized-input"),"data-mobile":"true",rows:2,autoFocus:!0})]}),(0,n.jsxs)("div",{className:c().replyActions,children:[(0,n.jsx)("button",{onClick:()=>{w(null),j("")},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>P(e.id),className:c().submitButton,disabled:!S.trim()||y,children:y?"Replying...":"Reply"})]})]}),e.replies&&e.replies.length>0&&(0,n.jsx)("div",{className:c().repliesContainer,children:e.replies.map(e=>J(e,!0))})]},e.id)},[p,R,C,A,v,S,y,f,U,W,O,H,P]);return(0,n.jsxs)("div",{className:"".concat(c().commentsSection," ").concat(o," comment-section"),style:q,children:[(0,n.jsxs)("h3",{className:c().commentsTitle,children:["Comments (",s.length,")"]}),(0,n.jsx)("form",{className:c().commentForm,onSubmit:z,children:(0,n.jsx)("div",{className:c().commentInputContainer,style:{background:"rgba(255, 255, 255, ".concat(F?"0.1":"0.05",")"),border:"1px solid rgba(255, 255, 255, ".concat(F?"0.2":"0.12",")"),borderRadius:"16px",boxShadow:F?"0 4px 20px rgba(0, 0, 0, 0.1),\n                     inset 0 1px 0 rgba(255, 255, 255, 0.2)":"0 2px 12px rgba(0, 0, 0, 0.06),\n                     inset 0 1px 0 rgba(255, 255, 255, 0.12)",backdropFilter:"blur(16px) saturate(180%)",WebkitBackdropFilter:"blur(16px) saturate(180%)",transform:F?"translateY(-1px)":"translateY(0)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",overflow:"hidden",padding:B.isMobile?"0.875rem":"1rem",marginBottom:B.isMobile?"20px":"0"},children:f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:c().commentAvatar,children:(0,m.d)(p.displayName||p.name,p.uid||p.id)}),(0,n.jsx)("textarea",{className:"".concat(c().commentInput," mobile-optimized-input comment-input"),placeholder:"Share your thoughts...",value:h,onChange:e=>u(e.target.value),onFocus:e=>{T(!0),B.isMobile&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},100)},onBlur:()=>{h.trim()||T(!1)},"data-mobile":"true",rows:B.isSmallPhone?3:4,style:{background:"rgba(255, 255, 255, 0.1)",border:"none",borderRadius:"20px",color:"#2d3748",fontSize:B.isMobile?"16px":"1rem",padding:B.isMobile?"0.875rem":"1rem",resize:"vertical",minHeight:B.isMobile?"80px":"120px",backdropFilter:"blur(8px)",transition:"all 0.3s ease",...{}}}),(F||h.trim())&&(0,n.jsxs)("div",{className:c().commentActions,children:[(0,n.jsx)("button",{type:"button",onClick:()=>{u(""),T(!1)},className:c().cancelButton,disabled:y,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:c().submitButton,disabled:!h.trim()||y,style:{minHeight:B.isMobile?"44px":"36px"},children:y?"Posting...":"Post Comment"})]})]}):(0,n.jsx)("div",{className:c().authPrompt,children:(0,n.jsx)("p",{children:"Please log in to join the conversation."})})})}),(0,n.jsx)("div",{className:c().commentsList,children:0===s.length?(0,n.jsx)("div",{className:c().emptyState,children:(0,n.jsx)("p",{children:"No comments yet. Be the first to share your thoughts!"})}):s.map(e=>J(e))})]})})},6648:(e,t,o)=>{"use strict";o.d(t,{d5:()=>n.createPortal});var n=o(7650)},7023:e=>{e.exports={reflectionRoomContainer:"ReflectionRoom_reflectionRoomContainer__6TmAa",backdrop:"ReflectionRoom_backdrop__KGxTG",sidebar:"ReflectionRoom_sidebar__dbvRa",mobileModal:"ReflectionRoom_mobileModal__7pRP5",header:"ReflectionRoom_header__0Ynj_",headerTitle:"ReflectionRoom_headerTitle__sMhoT",closeButton:"ReflectionRoom_closeButton__pqCgf",topicSection:"ReflectionRoom_topicSection__Iywnd",topicLabel:"ReflectionRoom_topicLabel__rhBKQ",topicText:"ReflectionRoom_topicText__tZ6jm",messagesContainer:"ReflectionRoom_messagesContainer__flbBi",messagesList:"ReflectionRoom_messagesList__XdeUo",message:"ReflectionRoom_message__IFqbO",ownMessage:"ReflectionRoom_ownMessage__21F3j",otherMessage:"ReflectionRoom_otherMessage__Azd_Z",messageHeader:"ReflectionRoom_messageHeader__8CyNx",messageHeaderRight:"ReflectionRoom_messageHeaderRight__bkPS2",userName:"ReflectionRoom_userName__B2m8R",messageTime:"ReflectionRoom_messageTime__HmW9V",messageContent:"ReflectionRoom_messageContent__TEe9D",authorMessage:"ReflectionRoom_authorMessage__ywPrb",authorName:"ReflectionRoom_authorName__wHiMA",authorBadge:"ReflectionRoom_authorBadge__uIGSy",messageForm:"ReflectionRoom_messageForm__IStCS",inputContainer:"ReflectionRoom_inputContainer__jICbm",messageInput:"ReflectionRoom_messageInput__xbHQv",sendButton:"ReflectionRoom_sendButton__Op965",characterCount:"ReflectionRoom_characterCount__Pgn4b",authPrompt:"ReflectionRoom_authPrompt__06gaE",loadingState:"ReflectionRoom_loadingState__mCkLq",errorState:"ReflectionRoom_errorState__lLBS3",emptyState:"ReflectionRoom_emptyState__O3Cs7",sendingSpinner:"ReflectionRoom_sendingSpinner__As_2t",spin:"ReflectionRoom_spin__9rYOC",loadingSpinner:"ReflectionRoom_loadingSpinner__dqZv4",emptyIcon:"ReflectionRoom_emptyIcon__jEtSv",reflectionSearchBar:"ReflectionRoom_reflectionSearchBar__pUXJI",reflectionSearchWrapper:"ReflectionRoom_reflectionSearchWrapper__CbCn1",focused:"ReflectionRoom_focused__LOk9v","holographic-shine":"ReflectionRoom_holographic-shine__YGlYP",reflectionIcon:"ReflectionRoom_reflectionIcon__UzCmu",reflectionText:"ReflectionRoom_reflectionText__vB9qw",reflectionLabel:"ReflectionRoom_reflectionLabel__7f_Nj",reflectionTopic:"ReflectionRoom_reflectionTopic__eWDD4",reflectionJoin:"ReflectionRoom_reflectionJoin__U6Usf",reflectionUnread:"ReflectionRoom_reflectionUnread__a6Wc7",reflectionJoinText:"ReflectionRoom_reflectionJoinText__4Z582",reflectionArrow:"ReflectionRoom_reflectionArrow__ST2X_",deleteButton:"ReflectionRoom_deleteButton___BxTC",deleteSpinner:"ReflectionRoom_deleteSpinner__rLa7d",messageDeleting:"ReflectionRoom_messageDeleting__z62yB"}},7041:(e,t,o)=>{"use strict";o.d(t,{H:()=>i});var n=o(7347),r=o.n(n);function i(e){let t=new(r())().analyze(e),o=e.toLowerCase(),n=["angry","furious","rage","mad","hate","disgusted","outraged","pissed","frustrated","livid","infuriated","enraged","trump","politician","corrupt","stupid","idiot","terrible","awful","worst","disgusting","pathetic"].filter(e=>o.includes(e)).length,i=["happy","joy","excited","amazing","wonderful","fantastic","great","awesome","brilliant","excellent","perfect","beautiful","love","celebrate","triumph","success","victory","delighted","cheerful","blissful"].filter(e=>o.includes(e)).length,a=["calm","peaceful","serene","tranquil","gentle","soothing","quiet","meditation","zen","harmony","balance","nature","garden","sunset","ocean","mindful","breathe","stillness"].filter(e=>o.includes(e)).length,l=["energy","power","strong","dynamic","intense","passionate","vibrant","bold","fierce","electric","explosive","powerful","charged","pumped","motivated","driven"].filter(e=>o.includes(e)).length,s=["sad","depressed","melancholy","grief","sorrow","tragic","heartbreak","crying","tears","lonely","despair","hopeless","miserable","devastated","broken"].filter(e=>o.includes(e)).length;return n>=2||n>=1&&t.score<-2?"angry":i>=2||i>=1&&t.score>3?"joyful":a>=2||a>=1&&t.score>0?"peaceful":l>=2||l>=1&&Math.abs(t.score)>2?"energetic":s>=2||s>=1&&t.score<-1?"sad":t.score>2?"joyful":t.score<-3?"angry":t.score<-1?"sad":"reflective"}},8501:e=>{e.exports={articlePageContainer:"ArticlePage_articlePageContainer__S9vO3",pageHeader:"ArticlePage_pageHeader__LpJc9",headerContainer:"ArticlePage_headerContainer__2_FTv",logoLink:"ArticlePage_logoLink__fMNNv",headerLogo:"ArticlePage_headerLogo__QZCOB",headerActions:"ArticlePage_headerActions__gK7Eo",profileMenu:"ArticlePage_profileMenu__LJeQ0",profileCircle:"ArticlePage_profileCircle__mpTwC",profileDropdown:"ArticlePage_profileDropdown__PnV9R",dropdownItem:"ArticlePage_dropdownItem__Lac2v",authButtons:"ArticlePage_authButtons__R_ANg",loginButton:"ArticlePage_loginButton__kpUQh",signupButton:"ArticlePage_signupButton__EvVWG",pageContainer:"ArticlePage_pageContainer__7QNUg",relatedTagsSection:"ArticlePage_relatedTagsSection__SvZ8y",relatedTagsHeading:"ArticlePage_relatedTagsHeading__Ys9Op",relatedTagsList:"ArticlePage_relatedTagsList__Xn3ds",relatedTag:"ArticlePage_relatedTag__DEwLe",writeButton:"ArticlePage_writeButton__yZp3x",articleHeader:"ArticlePage_articleHeader__LJolV",articleHeaderWithReaders:"ArticlePage_articleHeaderWithReaders__Ni9rZ",titleSection:"ArticlePage_titleSection__fYdJv",readersSection:"ArticlePage_readersSection__SRec1",articleTitle:"ArticlePage_articleTitle__euOmw",articleMeta:"ArticlePage_articleMeta__LXXWl",authorInfo:"ArticlePage_authorInfo__nnMSs",authorAvatar:"ArticlePage_authorAvatar__1S1bM",authorDetails:"ArticlePage_authorDetails__65w4B",authorNameLink:"ArticlePage_authorNameLink__c6fCN",authorName:"ArticlePage_authorName__o2DdL",articleDetails:"ArticlePage_articleDetails__mK6k_",articleActions:"ArticlePage_articleActions__IZLcw",editButton:"ArticlePage_editButton__Yl62q",tagContainer:"ArticlePage_tagContainer__kI5Py",tag:"ArticlePage_tag__F5Z0e",likeButton:"ArticlePage_likeButton__V0q84",liked:"ArticlePage_liked__Mzzkj",likeIcon:"ArticlePage_likeIcon__zOA_O",commentsContainer:"ArticlePage_commentsContainer__rpCTJ",loadingContainer:"ArticlePage_loadingContainer__v7RVf",loadingIndicator:"ArticlePage_loadingIndicator__E2bt3",spin:"ArticlePage_spin__yRZnI",errorContainer:"ArticlePage_errorContainer__pxRgD",errorMessage:"ArticlePage_errorMessage__quACi",editingHeader:"ArticlePage_editingHeader__nzcMi",cancelButton:"ArticlePage_cancelButton__V2ihM",articleContent:"ArticlePage_articleContent__NWe57",backLink:"ArticlePage_backLink__Cfs_B",moodControls:"ArticlePage_moodControls__iU3JZ",moodToggleButton:"ArticlePage_moodToggleButton__U3y0U",shareButton:"ArticlePage_shareButton__IgaGg"}},8593:(e,t,o)=>{"use strict";o.d(t,{NT:()=>n.useContext,Rf:()=>n.forwardRef});var n=o(2115)},8607:(e,t,o)=>{"use strict";o.d(t,{I:()=>i,d:()=>r});var n=o(2115);let r=function(e,t){var o;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=(null==e||null==(o=e.charAt(0))?void 0:o.toUpperCase())||"A",a=["#4f46e5","#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16"],l=t?Math.abs(t.charCodeAt(0)%a.length):0,s=a[l];return n.createElement("div",{style:{backgroundColor:s,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:r?"0.8rem":"1rem",width:r?"32px":"40px",height:r?"32px":"40px",borderRadius:"50%",flexShrink:0}},i)},i=(e,t)=>{var o,n;return((null==e||null==(o=e.charAt(0))?void 0:o.toUpperCase())||"")+((null==t||null==(n=t.charAt(0))?void 0:n.toUpperCase())||"")||"U"}},8660:(e,t,o)=>{"use strict";o.d(t,{NT:()=>n.useContext,uA:()=>n.Component});var n=o(2115)},9547:(e,t,o)=>{"use strict";o.d(t,{A:()=>J});var n=o(5155),r=o(2115),i=o(3201),a=o(5317);let l=async function(e,t,o,n,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"insight";try{let s={articleId:e,userId:t,text:o,prefix:n,suffix:r,tag:l,createdAt:(0,a.serverTimestamp)(),comments:[],reactions:{},userReactions:{}};return(await (0,a.addDoc)((0,a.collection)(i.db,"highlights"),s)).id}catch(e){throw console.error("Error saving highlight:",e),e}},s=async(e,t)=>{try{let o=(0,a.query)((0,a.collection)(i.db,"highlights"),(0,a.where)("articleId","==",e));return t&&(o=(0,a.query)((0,a.collection)(i.db,"highlights"),(0,a.where)("articleId","==",e),(0,a.where)("userId","==",t))),(await (0,a.getDocs)(o)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting highlights:",e),[]}},c=async e=>{try{await (0,a.deleteDoc)((0,a.doc)(i.db,"highlights",e))}catch(e){throw console.error("Error deleting highlight:",e),e}},d=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.location.origin;return"".concat(o,"/articles?slug=").concat(e,"#highlight=").concat(t)},m=(0,r.createContext)(void 0),g=e=>{let{children:t,articleId:o}=e,[a,d]=(0,r.useState)([]),[g,h]=(0,r.useState)(!0),[u,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{p(e)});return()=>e()},[]),(0,r.useEffect)(()=>{(async()=>{if(o&&u){h(!0);try{let e=await s(o,u.uid);d(e)}catch(e){console.error("Error loading highlights:",e)}finally{h(!1)}}else d([]),h(!1)})()},[o,u]);let x=async(e,t,o,n,r)=>{if(!u)return alert("You must be logged in to highlight text"),null;try{let i=await l(n,u.uid,e,t,o,r),a={id:i,articleId:n,userId:u.uid,text:e,prefix:t,suffix:o,tag:r,createdAt:new Date,reactions:{},userReactions:{}};return d(e=>[...e,a]),i}catch(e){return console.error("Error saving highlight:",e),null}},f=async e=>{try{await c(e),d(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error removing highlight:",e)}};return(0,n.jsx)(m.Provider,{value:{highlights:a,loading:g,saveHighlight:x,removeHighlight:f,highlightElement:(e,t)=>{var o,n,r;try{if(!e.toString())return;let n=document.createElement("mark");n.className="article-highlight highlight-".concat(t);try{e.surroundContents(n)}catch(t){try{let t=e.extractContents();n.appendChild(t),e.insertNode(n)}catch(o){let t=e.cloneContents();n.appendChild(t),e.deleteContents(),e.insertNode(n)}}null==(o=window.getSelection())||o.removeAllRanges()}catch(t){console.error("Error highlighting range:",t),null==(n=window.getSelection())||n.removeAllRanges(),null==(r=window.getSelection())||r.addRange(e)}}},children:t})},h=()=>{let e=(0,r.useContext)(m);if(void 0===e)throw Error("useHighlights must be used within a HighlightProvider");return e};var u=o(4814),p=o(6648);let x=[{tag:"insight",label:"Insight",color:"#3B82F6",icon:u.TG},{tag:"question",label:"Question",color:"#F59E0B",icon:u.Ko},{tag:"quote",label:"Quote",color:"#10B981",icon:u.Tw},{tag:"important",label:"Important",color:"#EF4444",icon:u.Gg}],f=e=>{let{selection:t,onHighlight:o,onResponse:i,onShare:a,onAiAssist:l}=e,[s,c]=(0,r.useState)({top:0,left:0}),[d,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e,o;if(!t||t.isCollapsed){m(!1),h(!1);return}let n=t.getRangeAt(0).getBoundingClientRect(),r=window.innerWidth,i=window.innerHeight,a=(null==(e=u.current)?void 0:e.offsetWidth)||280,l=(null==(o=u.current)?void 0:o.offsetHeight)||40,s=n.left+n.width/2;s-a/2<16?s=a/2+16:s+a/2>r-16&&(s=r-a/2-16);let d=n.top-l-10+window.scrollY;if(n.top-l-10<0&&(d=n.bottom+10+window.scrollY),r<=768){let e=window.scrollY,t=window.scrollY+i;d<e+16&&(d=e+16),d+l>t-16&&(d=t-l-16)}c({top:d,left:s}),m(!0)},[t]);let f=e=>{if(t&&!t.isCollapsed){var n;let r=t.getRangeAt(0);o(t.toString(),r,e),null==(n=window.getSelection())||n.removeAllRanges(),m(!1),h(!1)}},b=()=>{h(!g)};return d?(0,p.d5)((0,n.jsx)("div",{ref:u,className:"highlight-toolbar",style:{position:"absolute",top:"".concat(s.top,"px"),left:"".concat(s.left,"px"),transform:"translateX(-50%)",zIndex:1e3},children:g?(0,n.jsxs)("div",{className:"highlight-color-options",children:[(0,n.jsx)("span",{className:"highlight-color-label",children:"Choose highlight type:"}),x.map(e=>{let t=e.icon;return(0,n.jsxs)("button",{onClick:()=>f(e.tag),className:"highlight-color-btn",style:{backgroundColor:e.color},title:e.label,children:[(0,n.jsx)("span",{className:"highlight-icon",children:(0,n.jsx)(t,{size:14,color:"white"})}),(0,n.jsx)("span",{className:"highlight-label",children:e.label})]},e.tag)}),(0,n.jsx)("button",{onClick:b,className:"highlight-btn highlight-btn-cancel",children:"Cancel"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{onClick:b,className:"highlight-btn highlight-btn-main",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,n.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),(0,n.jsx)("span",{children:"Highlight"})]}),i&&(0,n.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&i){var e;i(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),m(!1)}},className:"highlight-btn",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),(0,n.jsx)("span",{children:"Response"})]}),a&&(0,n.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&a){var e;a(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),m(!1)}},className:"highlight-btn",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,n.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,n.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,n.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,n.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),(0,n.jsx)("span",{children:"Share"})]}),l&&(0,n.jsxs)("button",{onClick:()=>{if(t&&!t.isCollapsed&&l){var e;l(t.toString()),null==(e=window.getSelection())||e.removeAllRanges(),m(!1)}},className:"highlight-btn",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,n.jsx)("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),(0,n.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"16"})]}),(0,n.jsx)("span",{children:"Journa AI"})]})]})}),document.body):null};var b=o(9576);let y=e=>{let t={prefix:"",suffix:""};if(!e||0===e.rangeCount)return t;let o=e.getRangeAt(0),n=o.toString(),r=o.commonAncestorContainer,i=r.nodeType===Node.TEXT_NODE?r.parentElement:r;if(!i)return t;let a=i.textContent||"",l=a.indexOf(n);if(-1===l){let e=n.replace(/\s+/g," ").trim(),t=a.replace(/\s+/g," ").indexOf(e);-1!==t&&(l=t)}if(-1!==l){let e=Math.max(0,l-50),o=Math.min(a.length,l+n.length+50),r=a.substring(e,l),i=a.substring(l+n.length,o);r=r.replace(/^\S*\s/,""),i=i.replace(/\s\S*$/,""),t.prefix=r,t.suffix=i}return t},_=(e,t)=>{if(!e||!t)return;let o=t.querySelectorAll(".article-highlight"),n=Array.from(o).map(e=>e.getAttribute("data-highlight-id")).filter(Boolean),r=e.map(e=>e.id);if(n.length===r.length&&n.every(e=>r.includes(e)))return;o.forEach(e=>{let t=e.parentNode;if(t){let o=document.createTextNode(e.textContent||"");t.replaceChild(o,e),t.normalize()}});let i=[];if(e.forEach(e=>{let o=((e,o,n)=>{let r,i,a,l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);for(;r=l.nextNode();){let t=(r.textContent||"").indexOf(e);if(-1!==t){let o=document.createRange();return o.setStart(r,t),o.setEnd(r,t+e.length),o}}let s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),c=e=>RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\s+/g,"\\s+"),"i");for(;i=s.nextNode();){let t=i.textContent||"",o=c(e),n=t.match(o);if(n&&void 0!==n.index){let e=document.createRange();return e.setStart(i,n.index),e.setEnd(i,n.index+n[0].length),e}}if(o||n){let r,i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),a=c(o+e+n);for(;r=i.nextNode();){let t=(r.textContent||"").match(a);if(t&&void 0!==t.index){let n=t[0],i=c(o),a=n.match(i),l=a?a[0].length:0,s=document.createRange(),d=t.index+l,m=c(e),g=n.substring(l).match(m);if(g)return s.setStart(r,d),s.setEnd(r,d+g[0].length),s}}}let d=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),m=(o+e+n).replace(/\s+/g," ").trim();for(;a=d.nextNode();){let t=(a.textContent||"").replace(/\s+/g," ").indexOf(m);if(-1!==t){let n=document.createRange(),r=o.replace(/\s+/g," ").trim().length,i=t+(r>0?r+1:0);return n.setStart(a,i),n.setEnd(a,i+e.replace(/\s+/g," ").trim().length),n}}return null})(e.text,e.prefix||"",e.suffix||"");if(o)try{let t=document.createElement("mark");t.className="article-highlight highlight-".concat(e.tag||"insight"),t.dataset.highlightId=e.id;try{o.surroundContents(t)}catch(n){let e=o.extractContents();t.appendChild(e),o.insertNode(t)}console.log('✅ Applied highlight "'.concat(e.text.substring(0,30),'..." with ID: ').concat(e.id))}catch(t){console.error("Error applying highlight:",t,{text:e.text,id:e.id,tag:e.tag}),i.push(e.id)}else console.warn('❌ Could not find text for highlight: "'.concat(e.text.substring(0,30),'..." with ID: ').concat(e.id)),i.push(e.id)}),i.length>0){console.log("\uD83E\uDDF9 Found ".concat(i.length," highlights that couldn't be applied. These might be from old text formatting."));let e="failed-highlights-".concat(location.pathname),t=JSON.parse(sessionStorage.getItem(e)||"{}");i.forEach(e=>{t[e]=(t[e]||0)+1}),sessionStorage.setItem(e,JSON.stringify(t));let o=Object.entries(t).filter(e=>{let[t,o]=e;return o>=3}).map(e=>{let[t]=e;return t});o.length>0&&(console.log("\uD83D\uDDD1️  Suggesting cleanup of ".concat(o.length," persistently failed highlights")),sessionStorage.getItem("cleanup-notification-".concat(location.pathname))||(console.log("\uD83D\uDD04 Auto-cleaning broken highlights from text format change..."),setTimeout(()=>{o.forEach(async e=>{try{let t=new CustomEvent("cleanup-broken-highlight",{detail:{highlightId:e}});window.dispatchEvent(t)}catch(t){console.error("Failed to cleanup highlight:",e,t)}})},1e3),sessionStorage.setItem("cleanup-notification-".concat(location.pathname),"shown")))}},v=e=>{let{articleId:t,children:o,articleTitle:i="Article",articleSlug:a=""}=e,[l,s]=(0,r.useState)(null),{highlights:c,saveHighlight:m,removeHighlight:g,highlightElement:u}=h(),[p,x]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[S,j]=(0,r.useState)(""),[C,k]=(0,r.useState)(!1),[A,N]=(0,r.useState)(""),[R,E]=(0,r.useState)(null),[F,T]=(0,r.useState)(!1),[M,I]=(0,r.useState)(!1),[B,D]=(0,r.useState)({top:0,left:0}),[L,z]=(0,r.useState)(!1),[P,W]=(0,r.useState)(""),H=(0,r.useCallback)(()=>{I(!0),setTimeout(()=>{T(!1),I(!1)},150)},[]),O=(0,r.useCallback)(()=>{if(F)return;let e=window.getSelection();if(e&&!e.isCollapsed){let o=e.toString(),n=o.trim();if(n&&n.length>0&&o.length<1e3){var t;let o=e.getRangeAt(0).commonAncestorContainer;(o.nodeType===Node.TEXT_NODE?null==(t=o.parentElement)?void 0:t.closest(".article-highlight-container"):null==o?void 0:o.closest(".article-highlight-container"))?s(e):s(null)}else s(null)}else s(null)},[F]),U=(0,r.useCallback)((e,o,n)=>{if(e&&o){let r=y(window.getSelection());m(e,r.prefix,r.suffix,t,n),u(o,n)}},[t,m,u]),q=(0,r.useCallback)(e=>{let t=e.target;if(t.classList.contains("article-highlight")){e.preventDefault(),e.stopPropagation();let o=t.dataset.highlightId,n=t.textContent||"";if(o){I(!1),E({id:o,text:n});let e=t.getBoundingClientRect();D({top:e.top-40+window.scrollY,left:e.left+e.width/2}),T(!0),s(null)}}else F&&(H(),E(null))},[F,H]),J=(0,r.useCallback)(()=>{if(R&&R.id){H();let e=R.id;if(E(null),g(e),p){let t=p.querySelector('[data-highlight-id="'.concat(e,'"]'));if(t&&t.parentNode){let e=document.createTextNode(t.textContent||"");t.parentNode.replaceChild(e,t),t.parentNode.normalize()}}}},[R,g,p,H]),Y=(0,r.useCallback)(e=>{j(e),w(!0)},[]),X=(0,r.useCallback)(e=>{W(e),z(!0)},[]),Z=(0,r.useCallback)(e=>{N(e),k(!0)},[]);(0,r.useEffect)(()=>{document.addEventListener("selectionchange",O);let e=()=>{setTimeout(O,150)};return"ontouchstart"in window&&document.addEventListener("touchend",e),()=>{document.removeEventListener("selectionchange",O),"ontouchstart"in window&&document.removeEventListener("touchend",e)}},[O]),(0,r.useEffect)(()=>{if(p)return p.addEventListener("click",q),()=>{p.removeEventListener("click",q)}},[p,q]),(0,r.useEffect)(()=>{let e=e=>{if(F){let t=e.target;t.closest(".highlight-toolbar")||t.classList.contains("article-highlight")||(H(),E(null))}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[F,H]),(0,r.useEffect)(()=>{if(p){let e=setTimeout(()=>{console.log("\uD83C\uDFA8 Applying ".concat(c.length," highlights to content")),_(c,p)},100);return()=>clearTimeout(e)}},[c,p]),(0,r.useEffect)(()=>{let e=e=>{var t;let o=null==(t=e.detail)?void 0:t.highlightId;o&&(console.log("\uD83D\uDDD1️ Cleaning up broken highlight: ".concat(o)),g(o))};return window.addEventListener("cleanup-broken-highlight",e),()=>{window.removeEventListener("cleanup-broken-highlight",e)}},[g]);let V=(0,r.useCallback)(e=>{e&&e!==p&&x(e)},[p]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f,{selection:l,onHighlight:U,onResponse:Y,onShare:X,onAiAssist:Z}),F&&R&&(0,n.jsxs)("div",{className:"highlight-toolbar unhighlight-toolbar ".concat(M?"hiding":""),style:{position:"absolute",top:"".concat(B.top,"px"),left:"".concat(B.left,"px"),transform:M?"translateY(-10px) translateX(-50%)":"translateX(-50%)",zIndex:1e3},children:[(0,n.jsxs)("button",{onClick:J,className:"highlight-btn highlight-btn-danger",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"}),(0,n.jsx)("line",{x1:"18",y1:"9",x2:"12",y2:"15"}),(0,n.jsx)("line",{x1:"12",y1:"9",x2:"18",y2:"15"})]}),(0,n.jsx)("span",{children:"Unhighlight"})]}),(0,n.jsxs)("button",{onClick:()=>{X(R.text),H()},className:"highlight-btn",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,n.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,n.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,n.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,n.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),(0,n.jsx)("span",{children:"Share"})]}),(0,n.jsxs)("button",{onClick:()=>{Y(R.text),H()},className:"highlight-btn",children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),(0,n.jsx)("span",{children:"Response"})]})]}),(0,n.jsx)("div",{ref:V,className:"article-highlight-container",children:o}),v&&(0,n.jsx)("div",{className:"highlight-response-modal",children:(0,n.jsxs)("div",{className:"highlight-modal-content",children:[(0,n.jsx)("button",{className:"highlight-modal-close",onClick:()=>w(!1),children:"\xd7"}),(0,n.jsx)("h3",{children:"Respond to highlighted text"}),(0,n.jsxs)("div",{className:"highlight-selected-text",children:['"',S,'"']}),(0,n.jsx)("textarea",{className:"highlight-response-input",placeholder:"Write your response..."}),(0,n.jsx)("button",{className:"highlight-response-submit",children:"Submit"})]})}),C&&(0,n.jsx)("div",{className:"highlight-ai-modal",children:(0,n.jsxs)("div",{className:"highlight-modal-content",children:[(0,n.jsx)("button",{className:"highlight-modal-close",onClick:()=>k(!1),children:"\xd7"}),(0,n.jsx)("h3",{children:"Journa AI"}),(0,n.jsxs)("div",{className:"highlight-selected-text",children:['"',A,'"']}),(0,n.jsxs)("div",{className:"highlight-ai-options",children:[(0,n.jsx)("button",{children:"Explain this"}),(0,n.jsx)("button",{children:"Fact check"}),(0,n.jsx)("button",{children:"Provide context"}),(0,n.jsx)("button",{children:"Summarize"})]}),(0,n.jsx)("div",{className:"highlight-ai-response",children:(0,n.jsx)("div",{className:"highlight-ai-loading",children:"Journa AI is thinking..."})})]})}),L&&(0,n.jsx)(b.A,{isOpen:L,onClose:()=>z(!1),highlightText:P,articleTitle:i,shareUrl:d(a,t)})]})},w=e=>{let{currentMood:t,isVisible:o,moodFeatureEnabled:i}=e,[a,l]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),[d,m]=(0,r.useState)({colorStops:[{id:"1",color:"#007AFF",x:30,y:40,isSelected:!0}],opacity:80,grain:30,mode:"auto"}),g=(0,r.useRef)(null);(0,r.useRef)(null),(0,r.useRef)(null);let h=(0,r.useRef)(),p=e=>{let{colorStops:t,opacity:o,grain:n}=e,r=o/100,i=n/100,a="";if(i>.1){let e=.08*i,t=Math.max(15,25-8*i);a="\n        radial-gradient(ellipse at 12% 18%, rgba(255,255,255,".concat(e,") 3px, transparent ").concat(t,"px),\n        radial-gradient(ellipse at 87% 23%, rgba(0,0,0,").concat(.7*e,") 2px, transparent ").concat(1.2*t,"px),\n        radial-gradient(ellipse at 43% 82%, rgba(255,255,255,").concat(.5*e,") 4px, transparent ").concat(.9*t,"px),\n      ")}let l="";if(1===t.length){let e=t[0];l="radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(255*r).toString(16),", transparent 70%)")}else if(2===t.length){let[e,o]=t;l="\n        radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(.7*r*255).toString(16),", transparent 50%),\n        radial-gradient(circle at ").concat(o.x,"% ").concat(o.y,"%, ").concat(o.color).concat(Math.round(.7*r*255).toString(16),", transparent 50%)\n      ")}else if(3===t.length){let[e,o,n]=t;l="\n        radial-gradient(circle at ".concat(e.x,"% ").concat(e.y,"%, ").concat(e.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%),\n        radial-gradient(circle at ").concat(o.x,"% ").concat(o.y,"%, ").concat(o.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%),\n        radial-gradient(circle at ").concat(n.x,"% ").concat(n.y,"%, ").concat(n.color).concat(Math.round(.5*r*255).toString(16),", transparent 40%)\n      ")}return a?"".concat(a).concat(l):l||"transparent"},x=(0,r.useMemo)(()=>{let e=0;return t=>{let o=Date.now();if(o-e<100||(e=o,!i))return;let n=p(t);requestAnimationFrame(()=>{document.querySelectorAll("[data-mood-element]").forEach(e=>{e&&(e.style.backgroundImage=n,e.style.transition="background-image 0.2s ease")}),clearTimeout(h.current),h.current=setTimeout(()=>{localStorage.setItem("journaColorThemeConfig",JSON.stringify(t))},500)})}},[i,p]),f=(e,t)=>{e.preventDefault(),c(t),m({...d,colorStops:d.colorStops.map(e=>({...e,isSelected:e.id===t}))})},b=e=>{let t,o;if(!s||!g.current)return;let n=g.current.getBoundingClientRect();e instanceof MouseEvent?(t=e.clientX,o=e.clientY):(t=e.touches[0].clientX,o=e.touches[0].clientY);let r=Math.max(0,Math.min(100,(t-n.left)/n.width*100)),i=Math.max(0,Math.min(100,(o-n.top)/n.height*100)),a={...d,colorStops:d.colorStops.map(e=>e.id===s?{...e,x:r,y:i}:e)};m(a),x(a)},y=()=>{c(null)},_=e=>{if(!d.colorStops.find(e=>e.isSelected))return;let t={...d,colorStops:d.colorStops.map(t=>t.isSelected?{...t,color:e}:t)};m(t),x(t)};if((0,r.useEffect)(()=>{if(s)return document.addEventListener("mousemove",b),document.addEventListener("mouseup",y),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",y),()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",y),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",y)}},[s,d]),(0,r.useEffect)(()=>{let e=localStorage.getItem("journaColorThemeConfig");if(e)try{let t=JSON.parse(e);m(t),x(t)}catch(e){console.error("Failed to load theme config:",e)}},[]),(0,r.useEffect)(()=>()=>{h.current&&clearTimeout(h.current)},[]),!o||!i)return null;let v=p(d),w=d.colorStops.find(e=>e.isSelected)||d.colorStops[0];return(0,n.jsxs)("div",{style:{position:"fixed",bottom:"40px",left:"40px",zIndex:1001,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[(0,n.jsx)("button",{onClick:()=>l(!a),style:{width:"56px",height:"56px",borderRadius:"50%",border:"none",background:v||"#007AFF",color:"white",fontSize:"20px",cursor:"pointer",boxShadow:a?"0 8px 25px rgba(0, 122, 255, 0.4), 0 0 0 2px rgba(0, 122, 255, 0.2)":"0 6px 20px rgba(0, 122, 255, 0.3)",transform:a?"scale(1.05) rotate(45deg)":"scale(1) rotate(0deg)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},title:"Journa Color Editor",children:(0,n.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("circle",{cx:"8",cy:"8",r:"3",fill:"white"}),(0,n.jsx)("circle",{cx:"16",cy:"12",r:"2.5",fill:"white"}),(0,n.jsx)("circle",{cx:"12",cy:"18",r:"2",fill:"white"})]})}),a&&(0,n.jsxs)("div",{style:{position:"fixed",bottom:"110px",left:"40px",width:"380px",maxHeight:"500px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",borderRadius:"24px",padding:"24px",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",zIndex:999,overflow:"hidden"},children:[(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem"},children:[{mode:"auto",icon:u.R9,title:"Auto"},{mode:"light",icon:"☀️",title:"Light"},{mode:"dark",icon:"\uD83C\uDF19",title:"Dark"}].map(e=>{let{mode:t,icon:o,title:r}=e;return(0,n.jsx)("button",{onClick:()=>{let e={...d,mode:t};m(e),x(e)},style:{width:"48px",height:"48px",borderRadius:"12px",border:d.mode===t?"2px solid #007AFF":"2px solid rgba(0,0,0,0.1)",background:d.mode===t?"rgba(0, 122, 255, 0.1)":"rgba(0,0,0,0.05)",fontSize:"20px",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},title:r,children:"auto"===t?(0,n.jsx)(u.R9,{size:20,color:d.mode===t?"#007AFF":"#666"}):o},t)})}),(0,n.jsx)("div",{ref:g,style:{width:"100%",height:"180px",borderRadius:"16px",background:"linear-gradient(135deg, #f0f0f0, #e8e8e8)",position:"relative",cursor:"grab",marginBottom:"1.5rem",border:"1px solid rgba(0,0,0,0.1)",overflow:"hidden"},children:d.colorStops.map(e=>(0,n.jsx)("div",{onMouseDown:t=>f(t,e.id),onTouchStart:t=>f(t,e.id),style:{position:"absolute",top:"".concat(e.y,"%"),left:"".concat(e.x,"%"),transform:"translate(-50%, -50%)",width:e.isSelected?"24px":"20px",height:e.isSelected?"24px":"20px",borderRadius:"50%",background:e.color,border:e.isSelected?"3px solid white":"2px solid white",boxShadow:e.isSelected?"0 4px 12px rgba(0,0,0,0.4)":"0 2px 8px rgba(0,0,0,0.3)",cursor:s===e.id?"grabbing":"grab",transition:s===e.id?"none":"all 0.2s ease",zIndex:e.isSelected?10:5}},e.id))}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[(0,n.jsx)("button",{onClick:()=>{if(d.colorStops.length<=1)return;let e={...d,colorStops:d.colorStops.slice(0,-1)};m(e),x(e)},disabled:d.colorStops.length<=1,style:{width:"36px",height:"36px",borderRadius:"8px",border:"1px solid rgba(0,0,0,0.2)",background:d.colorStops.length<=1?"rgba(0,0,0,0.05)":"white",fontSize:"18px",cursor:d.colorStops.length<=1?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:d.colorStops.length<=1?.5:1},children:"-"}),(0,n.jsxs)("span",{style:{fontSize:"14px",color:"#666",minWidth:"80px",textAlign:"center"},children:[d.colorStops.length,"/3 colors"]}),(0,n.jsx)("button",{onClick:()=>{if(d.colorStops.length>=3)return;let e={id:Date.now().toString(),color:"#FF6B6B",x:50+15*d.colorStops.length,y:50+10*d.colorStops.length,isSelected:!1},t={...d,colorStops:[...d.colorStops,e]};m(t),x(t)},disabled:d.colorStops.length>=3,style:{width:"36px",height:"36px",borderRadius:"8px",border:"1px solid rgba(0,0,0,0.2)",background:d.colorStops.length>=3?"rgba(0,0,0,0.05)":"white",fontSize:"18px",cursor:d.colorStops.length>=3?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",opacity:d.colorStops.length>=3?.5:1},children:"+"})]}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:["#FFFFFF","#FFB3D9","#B19CD9","#FF6B6B","#FF8E53","#FFD93D","#6BCF7F","#4ECDC4","#45B7D1"].map((e,t)=>(0,n.jsx)("button",{onClick:()=>_(e),style:{width:"32px",height:"32px",borderRadius:"50%",border:w.color===e?"3px solid #007AFF":"2px solid rgba(0,0,0,0.1)",background:e,cursor:"pointer",transform:w.color===e?"scale(1.15)":"scale(1)",transition:"all 0.2s ease"}},t))})]})]})},S=r.memo(e=>{let{initialEnabled:t=!0,className:o="",style:a={},currentMood:l="joyful"}=e,[s,c]=(0,r.useState)(t),[d,m]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{if(m(e),e){let e=localStorage.getItem("moodFeatureEnabled");if(null!==e){let t=JSON.parse(e);c(t);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log("\uD83C\uDFA8 Applying initial mood state (attempt ".concat(e,"):"),t);let n=document.querySelectorAll("[data-mood-element]");if(console.log("\uD83C\uDFA8 Found mood elements on init:",n.length),0===n.length&&e<5)return void setTimeout(()=>o(e+1),200);n.forEach(e=>{e.style.transition="opacity 0.3s ease, transform 0.3s ease",t?(e.setAttribute("data-mood-active","true"),e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.style.transform="scale(1)",console.log("\uD83C\uDFA8 Initial show:",e.getAttribute("data-mood-element"))):(e.setAttribute("data-mood-active","false"),e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.style.transform="scale(0.95)",console.log("\uD83C\uDFA8 Initial hide:",e.getAttribute("data-mood-element")))}),document.querySelectorAll("[data-mood-header]").forEach(e=>{e.style.transition="background 0.4s ease, border 0.4s ease, box-shadow 0.4s ease",t||(e.style.background="rgba(255, 255, 255, 0.95)",e.style.border="1px solid rgba(0, 0, 0, 0.1)",e.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")})};setTimeout(()=>o(),100)}else c(!0)}else c(!1)});return()=>e()},[]),d)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>{if(console.log("\uD83C\uDFA8 MoodToggle clicked - should NOT trigger parent re-render"),!d)return;h(!0),setTimeout(()=>h(!1),300);let e=!s;c(e),localStorage.setItem("moodFeatureEnabled",JSON.stringify(e)),console.log("\uD83C\uDFA8 Mood feature toggled to:",e),console.log("\uD83C\uDFA8 Toggle clicked - searching for mood elements...");let t=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=document.querySelectorAll("[data-mood-element]");if(console.log("\uD83C\uDFA8 Found mood elements (attempt ".concat(o,"):"),n.length),0===n.length&&o<3)return void setTimeout(()=>t(o+1),100);n.forEach(t=>{t.style.transition="opacity 0.3s ease, transform 0.3s ease",e?(t.setAttribute("data-mood-active","true"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1",t.style.transform="scale(1)",console.log("\uD83C\uDFA8 Showing mood element:",t.getAttribute("data-mood-element"))):(t.setAttribute("data-mood-active","false"),t.style.opacity="0",t.style.transform="scale(0.95)",console.log("\uD83C\uDFA8 Hiding mood element:",t.getAttribute("data-mood-element")),setTimeout(()=>{"false"===t.getAttribute("data-mood-active")&&(t.style.display="none",t.style.visibility="hidden")},300))})};t(),document.querySelectorAll("[data-mood-header]").forEach(t=>{if(t.style.transition="background 0.4s ease, border 0.4s ease, box-shadow 0.4s ease",e){t.style.background="",t.style.border="",t.style.boxShadow="";let e=t.style.display;t.style.display="none",t.offsetHeight,t.style.display=e,console.log("\uD83C\uDFA8 Header mood styling restored - cleared overrides")}else t.setAttribute("data-mood-style",t.style.background),t.style.background="rgba(255, 255, 255, 0.95)",t.style.border="1px solid rgba(0, 0, 0, 0.1)",t.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)",console.log("\uD83C\uDFA8 Header mood styling removed")}),console.log("\uD83C\uDFA8 Mood backgrounds updated immediately. Enabled:",e)},className:o,style:{...a,transition:"all 0.3s ease",transform:g?"scale(1.1)":"scale(1)"},title:s?"Turn off mood feature":"Turn on mood feature",children:s?"ON":"OFF"}),(0,n.jsx)(w,{currentMood:l,isVisible:!!d,moodFeatureEnabled:s})]}):null}),j=r.memo(e=>{let{articleId:t,className:a,style:l}=e,[s,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[y,_]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),[S,j]=(0,r.useState)({width:0,height:0}),C=(0,r.useMemo)(()=>{let e=S.width;return{isMobile:e<=768,isTablet:e>768&&e<=1024,isDesktop:e>1024,isSmallPhone:e<=480,isLandscape:e>S.height,isIPad11:e>=820&&e<=1024,bottomSafeArea:Math.max(100,e<=768?120:80),sideMargin:e<=480?16:e<=768?20:40}},[S]);(0,r.useEffect)(()=>{let e,t=()=>{j({width:window.innerWidth,height:window.innerHeight})};t();let o=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),clearTimeout(e)}},[]),(0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{c(e)});return()=>e()},[]);let k=(0,r.useMemo)(()=>["How does this make you feel?","What questions does this raise for you?","How does this relate to your own experience?","What would you do differently?","What surprised you most about this?","What's your main takeaway from this?","How might this change your perspective?"],[]),A=(0,r.useCallback)(()=>{let e=Math.floor(Math.random()*k.length);return k[e]},[k]);(0,r.useEffect)(()=>{g||h(A())},[g,A]);let N=(0,r.useCallback)(()=>{w(!0),m(e=>!e),setTimeout(()=>w(!1),300),d&&(b(!1),x(""))},[d]),R=(0,r.useCallback)(()=>{b(!1),g.trim()||h(A())},[g,A]),E=(0,r.useCallback)(async()=>{if(p.trim()&&!y&&s){_(!0);try{let{saveReflectionResponse:e}=await Promise.resolve().then(o.bind(o,9122));await e(t,"custom_".concat(Date.now()),g,p.trim(),0,!0),x(""),m(!1),console.log("Reflection saved successfully")}catch(e){console.error("Error saving reflection:",e)}finally{_(!1)}}},[p,y,s,t,g]),F=(0,r.useMemo)(()=>({position:"fixed",bottom:C.isMobile?"max(".concat(C.bottomSafeArea+20,"px, calc(").concat(C.bottomSafeArea,"px + env(safe-area-inset-bottom)))"):"40px",right:"".concat(C.sideMargin,"px"),width:C.isSmallPhone?"48px":C.isMobile?"52px":"56px",height:C.isSmallPhone?"48px":C.isMobile?"52px":"56px",borderRadius:"50%",background:d?"linear-gradient(135deg, #1d4ed8, #7c3aed)":"linear-gradient(135deg, #3b82f6, #8b5cf6)",border:"none",boxShadow:d?"0 8px 25px rgba(59, 130, 246, 0.4), 0 0 0 2px rgba(59, 130, 246, 0.2)":"0 6px 20px rgba(59, 130, 246, 0.3)",cursor:"pointer",zIndex:1002,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"center",transform:v?"scale(1.1)":d?"scale(1.05)":"scale(1)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",contain:"layout style paint",willChange:v?"transform":"auto",...l}),[C,d,v,l]),T=(0,r.useMemo)(()=>({position:"fixed",bottom:C.isMobile?"max(".concat(C.bottomSafeArea+80,"px, calc(").concat(C.bottomSafeArea+60,"px + env(safe-area-inset-bottom)))"):"110px",right:C.isMobile?"".concat(C.sideMargin,"px"):"40px",left:C.isMobile?"".concat(C.sideMargin,"px"):"auto",width:C.isMobile?"auto":"380px",maxWidth:C.isMobile?"none":"380px",maxHeight:C.isLandscape&&C.isMobile?"60vh":C.isMobile?"50vh":"500px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:C.isSmallPhone?"16px":C.isMobile?"18px":"24px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.3)",zIndex:1001,padding:C.isSmallPhone?"16px":C.isMobile?"18px":"24px",overflow:"hidden auto",contain:"layout style paint",transform:"translateZ(0)"}),[C]);return s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{"data-reflection-element":"floating-button",onClick:N,className:"reflection-component hw-accelerated ".concat(a||""),style:F,title:d?"Close reflection":"Open reflection","aria-label":d?"Close reflection panel":"Open reflection panel",children:(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:d?(0,n.jsx)(u.US,{size:C.isSmallPhone?12:14,color:"#ffffff"}):(0,n.jsx)(u.zf,{size:C.isSmallPhone?12:14,color:"#ffffff"})})}),d&&(0,n.jsxs)("div",{className:"reflection-component floating-panel hw-accelerated",style:T,role:"dialog","aria-labelledby":"reflection-title","aria-modal":"true",children:[(0,n.jsx)("style",{children:"\n              @keyframes gentleSlideUp {\n                from {\n                  opacity: 0;\n                  transform: translateY(20px) scale(0.98);\n                }\n                to {\n                  opacity: 1;\n                  transform: translateY(0) scale(1);\n                }\n              }\n              \n              .reflection-panel-enter {\n                animation: gentleSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n              }\n            "}),(0,n.jsxs)("div",{style:{marginBottom:"20px",textAlign:"center"},children:[(0,n.jsxs)("h3",{id:"reflection-title",style:{margin:"0 0 12px 0",fontSize:C.isSmallPhone?"14px":"16px",fontWeight:"600",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,n.jsx)(u.uQ,{size:C.isSmallPhone?14:16,color:"#3b82f6"}),"Time to Reflect"]}),(0,n.jsx)("div",{style:{position:"relative"},children:f?(0,n.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),onBlur:R,onKeyDown:e=>{"Enter"===e.key&&R(),"Escape"===e.key&&(h(A()),b(!1))},autoFocus:!0,className:"mobile-optimized-input",style:{width:"100%",padding:"8px 12px",border:"2px solid #3b82f6",borderRadius:"12px",background:"white",fontSize:C.isSmallPhone?"13px":"14px",textAlign:"center",outline:"none"}}):(0,n.jsx)("button",{onClick:()=>b(!0),style:{background:"transparent",border:"2px solid transparent",borderRadius:"12px",padding:"8px 12px",fontSize:C.isSmallPhone?"13px":"14px",color:"#3b82f6",cursor:"pointer",transition:"all 0.2s ease",fontWeight:"500",textAlign:"center",width:"100%"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#e2e8f0",e.currentTarget.style.background="#f8fafc"},onMouseLeave:e=>{e.currentTarget.style.borderColor="transparent",e.currentTarget.style.background="transparent"},title:"Click to edit prompt",children:g})})]}),(0,n.jsx)("textarea",{value:p,onChange:e=>x(e.target.value),placeholder:"Share your thoughts...",className:"mobile-optimized-input reflection-input","data-mobile":"true",style:{width:"100%",height:C.isSmallPhone?"100px":"120px",padding:"12px",border:"2px solid #e2e8f0",borderRadius:"12px",background:"white",fontSize:C.isSmallPhone?"15px":"16px",fontFamily:"inherit",resize:"vertical",outline:"none",transition:"border-color 0.2s ease",marginBottom:"16px"},onFocus:e=>{e.target.style.borderColor="#3b82f6",C.isMobile&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},100)},onBlur:e=>{e.target.style.borderColor="#e2e8f0"}}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexDirection:C.isSmallPhone?"column":"row"},children:[(0,n.jsx)("button",{onClick:()=>m(!1),style:{background:"transparent",border:"2px solid #e2e8f0",borderRadius:"12px",padding:C.isSmallPhone?"12px 20px":"8px 16px",fontSize:C.isSmallPhone?"15px":"14px",color:"#64748b",cursor:"pointer",fontWeight:"500",transition:"all 0.2s ease",width:C.isSmallPhone?"100%":"auto",minHeight:"44px"},children:"Cancel"}),(0,n.jsx)("button",{onClick:E,disabled:!p.trim()||y,style:{background:p.trim()?"linear-gradient(135deg, #3b82f6, #8b5cf6)":"#e2e8f0",border:"none",borderRadius:"12px",padding:C.isSmallPhone?"12px 20px":"8px 20px",fontSize:C.isSmallPhone?"15px":"14px",color:p.trim()?"white":"#94a3b8",cursor:p.trim()?"pointer":"not-allowed",fontWeight:"600",transition:"all 0.2s ease",opacity:y?.7:1,width:C.isSmallPhone?"100%":"auto",minHeight:"44px"},children:y?"Saving...":"Save Reflection"})]})]})]}):null});var C=o(326);let k=r.memo(e=>{let{className:t="",style:o={}}=e,[a,l]=(0,r.useState)(!0),[s,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[g]=(0,r.useState)("reflective");return((0,r.useEffect)(()=>{let e=i.j2.onAuthStateChanged(e=>{if(c(e),e){let e=localStorage.getItem("reflectionsEnabled");if(null!==e){let t=JSON.parse(e);l(t),setTimeout(()=>{document.querySelectorAll("[data-reflection-element]").forEach(e=>{e.style.display=t?"":"none"})},100)}else l(!0)}else l(!1)});return()=>e()},[]),s)?(0,n.jsx)("button",{onClick:()=>{if(console.log("ReflectionModeToggle clicked - should NOT trigger parent re-render"),!s)return;m(!0),setTimeout(()=>m(!1),300);let e=!a;l(e),localStorage.setItem("reflectionsEnabled",JSON.stringify(e)),console.log("Reflection mode toggled to:",e),document.querySelectorAll("[data-reflection-element]").forEach(t=>{e?t.style.display="":t.style.display="none"}),window.dispatchEvent(new CustomEvent("reflectionModeToggle",{detail:{enabled:e}}))},className:t,style:{...o,transition:"all 0.3s ease",transform:d?"scale(1.1)":"scale(1)",background:a?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.2)",color:a?C.Qx[g].accent:"#F7FAFC"},title:a?"Turn off reflections":"Turn on reflections",children:a?"ON":"OFF"}):(0,n.jsx)("button",{style:{...o,opacity:.6,cursor:"not-allowed"},disabled:!0,title:"Sign in to use reflections",children:"OFF"})});var A=o(4655),N=o.n(A);async function R(e){let t="".concat("http://127.0.0.1:5001","/api/prototype/v1/article/").concat(e),o=await fetch(t);if(!o.ok)throw Error("Failed to fetch article: ".concat(o.status," ").concat(o.statusText));return o.json()}var E=o(3241),F=o.n(E);o(8042),o(5802),o(7846),o(1280),o(8496),o(941),o(3523),o(4495),o(1177),o(1990),o(3686),o(642),o(7867),o(3337),o(3435),o(1055),o(2103),o(255),o(9829),o(656);var T=o(5343);function M(){return(0,T.vJ)(()=>{let e=document.createElement("script");return e.textContent="\n// Simple syntax highlighting without external dependencies\nfunction highlightCode() {\n  const codeBlocks = document.querySelectorAll('pre code');\n  \n  codeBlocks.forEach(codeBlock => {\n    const pre = codeBlock.parentElement;\n    if (!pre) return;\n    \n    // Apply dark theme\n    pre.style.backgroundColor = '#1e1e1e';\n    pre.style.color = '#d4d4d4';\n    pre.style.border = '1px solid #333';\n    pre.style.borderRadius = '8px';\n    pre.style.padding = '16px';\n    pre.style.fontFamily = \"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace\";\n    pre.style.fontSize = '14px';\n    pre.style.lineHeight = '1.6';\n    pre.style.overflowX = 'auto';\n    pre.style.position = 'relative';\n    \n    const code = codeBlock.textContent || '';\n    let highlightedCode = code;\n    \n    // Simplified highlighting to avoid regex issues\n    try {\n      // Keywords\n      const keywords = ['const', 'let', 'var', 'function', 'class', 'interface', 'type', 'enum', 'import', 'export', 'from', 'as', 'return', 'if', 'else', 'for', 'while', 'switch', 'case', 'break', 'default', 'try', 'catch', 'finally', 'async', 'await', 'new', 'this', 'extends', 'implements', 'private', 'public', 'protected', 'static'];\n      keywords.forEach(keyword => {\n        const regex = new RegExp('\\\\b' + keyword + '\\\\b', 'g');\n        highlightedCode = highlightedCode.replace(regex, '<span style=\"color: #569cd6; font-weight: 500;\">' + keyword + '</span>');\n      });\n      \n      // Simple string highlighting\n      highlightedCode = highlightedCode.replace(/\"([^\"]*)\"/g, '<span style=\"color: #ce9178;\">\"$1\"</span>');\n      highlightedCode = highlightedCode.replace(/'([^']*)'/g, '<span style=\"color: #ce9178;\">'$1'</span>');\n      \n      // Numbers\n      highlightedCode = highlightedCode.replace(/\\b\\d+\\.?\\d*\\b/g, '<span style=\"color: #b5cea8;\">$&</span>');\n      \n      // Comments\n      highlightedCode = highlightedCode.replace(///.*$/gm, '<span style=\"color: #6a9955; font-style: italic;\">$&</span>');\n    } catch (e) {\n      console.warn('Syntax highlighting failed:', e);\n      // Keep original code if highlighting fails\n    }\n    \n    codeBlock.innerHTML = highlightedCode;\n    \n    // Add language indicator if available\n    let language = 'code';\n    const classNames = codeBlock.className.split(' ');\n    for (const className of classNames) {\n      if (className.startsWith('language-')) {\n        language = className.replace('language-', '');\n        break;\n      }\n    }\n    \n    if (pre.hasAttribute('data-language')) {\n      language = pre.getAttribute('data-language');\n    }\n    \n    // Add language badge\n    const badge = document.createElement('div');\n    badge.textContent = language.toUpperCase();\n    badge.style.position = 'absolute';\n    badge.style.top = '8px';\n    badge.style.right = '12px';\n    badge.style.background = 'rgba(255, 255, 255, 0.1)';\n    badge.style.color = '#a0a0a0';\n    badge.style.padding = '2px 8px';\n    badge.style.borderRadius = '4px';\n    badge.style.fontSize = '12px';\n    badge.style.fontWeight = '500';\n    badge.style.letterSpacing = '0.5px';\n    pre.appendChild(badge);\n  });\n}\n\n// Run when DOM is loaded\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', highlightCode);\n} else {\n  highlightCode();\n}\n\n// Also run on dynamic content changes\nconst observer = new MutationObserver(() => {\n  setTimeout(highlightCode, 100);\n});\n\nobserver.observe(document.body, {\n  childList: true,\n  subtree: true\n});\n",document.head.appendChild(e),()=>{try{document.head.removeChild(e)}catch(e){}}},[]),null}var I=o(7041),B=o(6203),D=o(6408),L=o(7023),z=o.n(L);let P=e=>{let{topic:t,unreadCount:o,isOpen:r,onClick:i}=e,a=t.length>60?"".concat(t.substring(0,60),"..."):t;return(0,n.jsx)(D.P.div,{className:z().reflectionSearchBar,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:i,children:(0,n.jsxs)("div",{className:"".concat(z().reflectionSearchWrapper," ").concat(r?z().focused:""),children:[(0,n.jsx)("div",{className:z().reflectionIcon,children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),(0,n.jsx)("path",{d:"M8 10h8"}),(0,n.jsx)("path",{d:"M8 14h6"})]})}),(0,n.jsxs)("div",{className:z().reflectionText,children:[(0,n.jsx)("span",{className:z().reflectionLabel,children:"Reflect on:"}),(0,n.jsxs)("span",{className:z().reflectionTopic,children:['"',a,'"']})]}),(0,n.jsxs)("div",{className:z().reflectionJoin,children:[o>0&&(0,n.jsx)("div",{className:z().reflectionUnread,children:o}),(0,n.jsx)("span",{className:z().reflectionJoinText,children:"Join discussion"}),(0,n.jsx)("svg",{className:z().reflectionArrow,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M9 18l6-6-6-6"})})]})]})})};var W=o(760),H=o(4744);let O=e=>{let[t,o]=(0,r.useState)([]),[n,l]=(0,r.useState)(""),[s,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),[g,h]=(0,r.useState)(0),u=i.j2.currentUser,p=(0,r.useCallback)(async()=>{try{let t=(0,a.doc)(i.db,"reflections",e,"metadata","main"),o=await (0,a.getDoc)(t);if(o.exists()){let e=o.data();l(e.topic)}}catch(e){console.error("Error loading reflection metadata:",e),m("Failed to load discussion topic")}},[e]);(0,r.useEffect)(()=>{if(!e)return;c(!0);let t=(0,a.collection)(i.db,"reflections",e,"messages"),n=(0,a.query)(t,(0,a.orderBy)("createdAt","asc")),r=(0,a.onSnapshot)(n,e=>{let t=[],n=0;e.forEach(e=>{let o=e.data(),r={id:e.id,userId:o.userId,userName:o.userName,content:o.content,createdAt:o.createdAt,read:o.read||!1};t.push(r),!r.read&&r.userId!==(null==u?void 0:u.uid)&&n++}),o(t),h(n),c(!1),m(null)},e=>{console.error("Error listening to messages:",e),m("Failed to load messages"),c(!1)});return p(),()=>r()},[e,null==u?void 0:u.uid,p]);let x=(0,r.useCallback)(async t=>{if(u&&t.trim())try{var o;let n=await (0,H.VM)(u.uid),r=n?"".concat(n.firstName," ").concat(n.lastName):u.displayName||(null==(o=u.email)?void 0:o.split("@")[0])||"Anonymous",l=(0,a.collection)(i.db,"reflections",e,"messages");await (0,a.addDoc)(l,{userId:u.uid,userName:r,content:t.trim(),createdAt:(0,a.serverTimestamp)(),read:!1})}catch(e){throw console.error("Error sending message:",e),e}},[u,e]),f=(0,r.useCallback)(async()=>{if(u)try{let t=(0,a.collection)(i.db,"reflections",e,"messages"),o=(await (0,a.getDocs)(t)).docs.filter(e=>{let t=e.data();return!t.read&&t.userId!==u.uid}).map(e=>(0,a.setDoc)(e.ref,{read:!0},{merge:!0}));await Promise.all(o)}catch(e){console.error("Error marking messages as read:",e)}},[u,e]),b=(0,r.useCallback)(async t=>{if(u)try{let o=(0,a.doc)(i.db,"reflections",e,"metadata","main");await (0,a.setDoc)(o,{topic:t,createdAt:(0,a.serverTimestamp)(),authorId:u.uid}),l(t)}catch(e){throw console.error("Error creating reflection room:",e),e}},[u,e]),y=(0,r.useCallback)(async t=>{if(u)try{let o=(0,a.doc)(i.db,"reflections",e,"messages",t),n=await (0,a.getDoc)(o);if(!n.exists())throw Error("Message not found");if(n.data().userId!==u.uid)throw Error("You can only delete your own messages");await (0,a.deleteDoc)(o)}catch(e){throw console.error("Error deleting message:",e),e}},[u,e]),_=(0,r.useCallback)(async()=>{if(u)try{let t=(0,a.collection)(i.db,"reflections",e,"messages"),o=(await (0,a.getDocs)(t)).docs.map(e=>(0,a.deleteDoc)(e.ref));await Promise.all(o)}catch(e){throw console.error("Error clearing messages:",e),e}},[u,e]),v=(0,r.useCallback)(async t=>{if(u)try{let o=(0,a.doc)(i.db,"reflections",e,"metadata","main"),n=await (0,a.getDoc)(o);if(!n.exists())throw Error("Reflection room not found");let r=n.data();if(r.authorId!==u.uid)throw Error("Only the author can update the topic");await _(),await (0,a.setDoc)(o,{...r,topic:t,updatedAt:(0,a.serverTimestamp)()}),l(t)}catch(e){throw console.error("Error updating reflection topic:",e),e}},[u,e,_]);return{messages:t,topic:n,loading:s,error:d,unreadCount:g,sendMessage:x,deleteMessage:y,clearAllMessages:_,updateReflectionTopic:v,markAllAsRead:f,createReflectionRoom:b}},U=e=>{let{articleId:t,isOpen:o,onClose:a,isMobile:l,authorId:s}=e,[c,d]=(0,r.useState)(""),[m,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),x=(0,r.useRef)(null),f=(0,r.useRef)(null),{messages:b,topic:y,loading:_,error:v,sendMessage:w,deleteMessage:S,unreadCount:j,markAllAsRead:C}=O(t),k=i.j2.currentUser,A=(0,r.useMemo)(()=>({closed:{x:"100%",opacity:0},open:{x:0,opacity:1}}),[]),N=(0,r.useMemo)(()=>({closed:{y:"100%",opacity:0},open:{y:0,opacity:1}}),[]),R=(0,r.useMemo)(()=>({type:"tween",duration:.3,ease:[.4,0,.2,1]}),[]);(0,r.useEffect)(()=>{let e=setTimeout(()=>{var e;null==(e=x.current)||e.scrollIntoView({behavior:"smooth",block:"end"})},100);return()=>clearTimeout(e)},[b.length]),(0,r.useEffect)(()=>{if(o&&j>0){let e=setTimeout(()=>{C()},500);return()=>clearTimeout(e)}},[o,j,C]);let E=(0,r.useCallback)(()=>{f.current&&(f.current.style.height="auto",f.current.style.height="".concat(f.current.scrollHeight,"px"))},[]);(0,r.useEffect)(()=>{E()},[c,E]);let F=(0,r.useCallback)(async e=>{if(e.preventDefault(),c.trim()&&!m&&k){g(!0);try{await w(c.trim()),d("")}catch(e){console.error("Error sending message:",e)}finally{g(!1)}}},[c,m,k,w]),T=(0,r.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),F(e))},[F]),M=(0,r.useCallback)(e=>{if(!e)return"";let t=e.toDate?e.toDate():new Date(e);return(new Date().getTime()-t.getTime())/36e5<24?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},[]),I=(0,r.useCallback)(async e=>{if(k&&!h){p(e);try{await S(e)}catch(e){console.error("Error deleting message:",e)}finally{p(null)}}},[k,S,h]),B=(0,r.useMemo)(()=>b.map(e=>{let t=e.userId===(null==k?void 0:k.uid),o=e.userId===s,r=h===e.id;return(0,n.jsxs)("div",{className:"".concat(z().message," ").concat(t?z().ownMessage:z().otherMessage," ").concat(o?z().authorMessage:""," ").concat(r?z().messageDeleting:""),children:[(0,n.jsxs)("div",{className:z().messageHeader,children:[(0,n.jsxs)("span",{className:"".concat(z().userName," ").concat(o?z().authorName:""),children:[e.userName,o&&(0,n.jsx)("span",{className:z().authorBadge,children:"Author"})]}),(0,n.jsxs)("div",{className:z().messageHeaderRight,children:[(0,n.jsx)("span",{className:z().messageTime,children:M(e.createdAt)}),t&&(0,n.jsx)("button",{className:z().deleteButton,onClick:()=>I(e.id),disabled:r,"aria-label":"Delete message",title:"Delete message",children:r?(0,n.jsx)("div",{className:z().deleteSpinner}):(0,n.jsx)(u.uc,{size:14})})]})]}),(0,n.jsx)("div",{className:z().messageContent,children:e.content})]},e.id)}),[b,null==k?void 0:k.uid,s,M,h,I]);return(0,n.jsx)(W.N,{mode:"wait",children:o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.P.div,{className:z().backdrop,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:a}),(0,n.jsxs)(D.P.div,{className:"".concat(z().sidebar," ").concat(l?z().mobileModal:""),variants:l?N:A,initial:"closed",animate:"open",exit:"closed",transition:R,children:[(0,n.jsxs)("div",{className:z().header,children:[(0,n.jsxs)("div",{className:z().headerTitle,children:[(0,n.jsx)("h3",{children:"Reflection Room"}),(0,n.jsx)("button",{className:z().closeButton,onClick:a,"aria-label":"Close reflection room",children:(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),y&&(0,n.jsxs)("div",{className:z().topicSection,children:[(0,n.jsx)("div",{className:z().topicLabel,children:"Discussion Topic"}),(0,n.jsx)("div",{className:z().topicText,children:y})]})]}),(0,n.jsx)("div",{className:z().messagesContainer,children:_?(0,n.jsxs)("div",{className:z().loadingState,children:[(0,n.jsx)("div",{className:z().loadingSpinner}),(0,n.jsx)("p",{children:"Loading messages..."})]}):v?(0,n.jsx)("div",{className:z().errorState,children:(0,n.jsxs)("p",{children:["Error loading messages: ",v]})}):0===b.length?(0,n.jsxs)("div",{className:z().emptyState,children:[(0,n.jsx)("div",{className:z().emptyIcon,children:"\uD83D\uDCAD"}),(0,n.jsx)("p",{children:"No messages yet. Be the first to share your thoughts!"})]}):(0,n.jsxs)("div",{className:z().messagesList,children:[B,(0,n.jsx)("div",{ref:x})]})}),k&&(0,n.jsxs)("form",{onSubmit:F,className:z().messageForm,children:[(0,n.jsxs)("div",{className:z().inputContainer,children:[(0,n.jsx)("textarea",{ref:f,value:c,onChange:e=>d(e.target.value),onKeyDown:T,placeholder:"Share your thoughts...",className:z().messageInput,rows:1,maxLength:1e3,disabled:m}),(0,n.jsx)("button",{type:"submit",className:z().sendButton,disabled:!c.trim()||m,children:m?(0,n.jsx)("div",{className:z().sendingSpinner}):(0,n.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,n.jsxs)("div",{className:z().characterCount,children:[c.length,"/1000"]})]}),!k&&(0,n.jsx)("div",{className:z().authPrompt,children:(0,n.jsx)("p",{children:"Please sign in to join the conversation"})})]})]})})},q=r.memo(e=>{let{articleId:t,hasReflectionRoom:o,authorId:a}=e,[l,s]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),{topic:h,unreadCount:u}=O(t),p=(0,r.useCallback)(()=>{s(e=>!e)},[]),x=(0,r.useCallback)(()=>{s(!1)},[]);(0,r.useEffect)(()=>{let e=(0,B.onAuthStateChanged)(i.j2,e=>{g(!!e)});return()=>e()},[]),(0,r.useEffect)(()=>{let e,t=()=>{d(window.innerWidth<=768)};t();let o=()=>{clearTimeout(e),e=setTimeout(t,100)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),clearTimeout(e)}},[]);let f=(0,r.useMemo)(()=>h||"Join the discussion",[h]);return o&&m?(0,n.jsxs)("div",{className:z().reflectionRoomContainer,children:[(0,n.jsx)(P,{topic:f,unreadCount:u,isOpen:l,onClick:p}),(0,n.jsx)(U,{articleId:t,isOpen:l,onClose:x,isMobile:c,authorId:a})]}):null},(e,t)=>e.articleId===t.articleId&&e.hasReflectionRoom===t.hasReflectionRoom&&e.authorId===t.authorId),J=e=>{let{articleId:t,initialHtml:o,isAuthenticated:i=!1,articleTitle:a="Article",articleSlug:l="",hasReflectionRoom:s=!1,authorId:c}=e,[d,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!o),[x,f]=(0,r.useState)(""),[b,y]=(0,r.useState)("reflective"),_=(0,r.useRef)(null);(0,r.useEffect)(()=>{_.current&&(o||d)&&setTimeout(()=>{_.current&&_.current.querySelectorAll("pre code").forEach(e=>{let t=e.parentElement,o="javascript";for(let t of e.className.split(" "))if(t.startsWith("language-")){o=t.replace("language-","");break}if(t.hasAttribute("data-language")&&(o=t.getAttribute("data-language")),F().languages[o])try{let n=e.textContent||"";e.innerHTML=F().highlight(n,F().languages[o],o),t.setAttribute("data-language",o),t.style.position="relative"}catch(e){console.warn("Syntax highlighting failed for language:",o,e)}})},100)},[o,d]),(0,r.useEffect)(()=>{let e=w();if(e){let t=e.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();t&&y((0,I.H)(t))}},[o,d]),(0,r.useEffect)(()=>{o||d||(async()=>{try{p(!0);let e=await R(t);if(!e)return void f("Article not found");let o="",n=("string"==typeof e.content?e.content:e.content.map(e=>"<p>".concat(e.text,"</p>")).join("\n")).replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");m({title:e.title,body:n})}catch(e){console.error("Error loading article:",e),f("Failed to load article")}finally{p(!1)}})()},[t,d,o]);let w=()=>o?o.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""):(null==d?void 0:d.body)||"";return h?(0,n.jsxs)("div",{className:N().loadingContainer,children:[(0,n.jsx)("div",{className:N().loadingIndicator}),(0,n.jsx)("p",{children:"Loading article..."})]}):x?(0,n.jsx)("div",{className:N().errorContainer,children:(0,n.jsx)("p",{className:N().errorMessage,children:x})}):(0,n.jsxs)(g,{articleId:t,children:[(0,n.jsx)(M,{}),(0,n.jsxs)("article",{className:N().articleContainer,children:[s&&i&&(0,n.jsx)(q,{articleId:t,hasReflectionRoom:s,authorId:c}),(0,n.jsx)("div",{"data-toggle-bar":"true",style:{display:"flex",justifyContent:window.innerWidth<=768?"center":"space-between",alignItems:"center",gap:window.innerWidth<=768?"0.5rem":"1rem",margin:window.innerWidth<=768?"0.5rem 0":"1rem 0",padding:window.innerWidth<=768?"0.5rem 0.75rem":"1rem",backgroundImage:i?"linear-gradient(270deg, ".concat(C.Qx[b].gradientStart,", ").concat(C.Qx[b].gradientEnd,")"):"linear-gradient(270deg, #9CA3AF, #6B7280)",backgroundSize:"200% 200%",animation:"slideGradient 8s ease infinite alternate",borderRadius:window.innerWidth<=768?"12px":"20px",border:"1px solid rgba(255, 255, 255, 0.5)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",fontSize:window.innerWidth<=768?"0.75rem":"0.875rem",flexWrap:window.innerWidth<=768?"wrap":"nowrap"},children:window.innerWidth<=768?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.65rem"},children:"\uD83C\uDFA8 Mood"}),(0,n.jsx)(S,{style:{padding:"0.25rem 0.5rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"12px",fontSize:"0.6rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",minHeight:"24px",minWidth:"32px"}})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.65rem"},children:"✨ Reflect"}),(0,n.jsx)(k,{style:{padding:"0.25rem 0.5rem",border:"none",borderRadius:"12px",fontSize:"0.6rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)",minHeight:"24px",minWidth:"32px"}})]}),i&&(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.6rem",opacity:.7,width:"100%",textAlign:"center",marginTop:"0.25rem"},children:"Enhanced active"})]}):window.innerWidth<=1024?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.8rem",opacity:.9},children:i?"\uD83C\uDFA8 Enhanced mode":"\uD83D\uDD12 Sign in for features"})}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.7rem"},children:"Mood"}),(0,n.jsx)(S,{style:{padding:"0.35rem 0.7rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"16px",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}}),(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.7rem"},children:"Reflect"}),(0,n.jsx)(k,{style:{padding:"0.35rem 0.7rem",border:"none",borderRadius:"16px",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.875rem",opacity:.9},children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.cL,{size:16,color:"#F7FAFC"}),"Atmosphere adapted"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.JD,{size:16,color:"#F7FAFC"}),"Sign in for enhanced features"]})}),i&&(0,n.jsxs)("span",{style:{color:"#F7FAFC",fontWeight:"600",fontSize:"0.875rem"},children:[(0,n.jsx)(u.gI,{size:16,color:"#F7FAFC"}),"Enhanced features active"]})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.75rem"},children:"Mood Background"}),(0,n.jsx)(S,{style:{padding:"0.4rem 0.8rem",border:"none",background:"rgba(255, 255, 255, 0.2)",color:"#F7FAFC",borderRadius:"20px",fontSize:"0.7rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}}),(0,n.jsx)("span",{style:{color:"#F7FAFC",fontWeight:"500",fontSize:"0.75rem"},children:"Interactive Reflections"}),(0,n.jsx)(k,{style:{padding:"0.4rem 0.8rem",border:"none",borderRadius:"20px",fontSize:"0.7rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 1px 4px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"}})]})]})}),(0,n.jsxs)(v,{articleId:t,articleTitle:a,articleSlug:l,children:[(0,n.jsx)("div",{className:N().articleContent,children:(0,n.jsx)("div",{ref:_,dangerouslySetInnerHTML:{__html:w()}})}),(0,n.jsx)(j,{articleId:t})]})]})]})}},9576:(e,t,o)=>{"use strict";o.d(t,{A:()=>c});var n=o(5155),r=o(9137),i=o.n(r),a=o(2115),l=o(4814),s=o(6648);let c=e=>{let{isOpen:t,onClose:o,highlightText:r,articleTitle:c,shareUrl:d}=e,[m,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(m){let e=setTimeout(()=>g(!1),3e3);return()=>clearTimeout(e)}},[m]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&o()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,o]);let h=async()=>{try{await navigator.clipboard.writeText(d),g(!0)}catch(e){console.error("Failed to copy link:",e)}},u=async()=>{if(navigator.share)try{await navigator.share({title:'Highlight from "'.concat(c,'"'),text:'"'.concat(r,'" - from "').concat(c,'"'),url:d}),o()}catch(e){"AbortError"!==e.name&&console.error("Error sharing:",e)}};return t?(0,s.d5)((0,n.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem"},onClick:o,className:"jsx-8795408d21c696e",children:[(0,n.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",padding:"2rem",maxWidth:"500px",width:"100%",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",position:"relative",animation:"modalSlideIn 0.3s ease-out"},onClick:e=>e.stopPropagation(),className:"jsx-8795408d21c696e",children:[(0,n.jsx)("button",{onClick:o,style:{position:"absolute",top:"1rem",right:"1rem",background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#6B7280",padding:"0.25rem",borderRadius:"0.375rem",transition:"color 0.2s ease"},onMouseOver:e=>e.currentTarget.style.color="#374151",onMouseOut:e=>e.currentTarget.style.color="#6B7280",className:"jsx-8795408d21c696e",children:"\xd7"}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,n.jsxs)("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1.25rem",fontWeight:"600",color:"#1F2937"},className:"jsx-8795408d21c696e",children:[(0,n.jsx)(l.uQ,{size:20,color:"#3b82f6"}),"Share Highlight"]}),(0,n.jsxs)("p",{style:{margin:0,color:"#6B7280",fontSize:"0.875rem"},className:"jsx-8795408d21c696e",children:['Share this highlight from "',c,'"']})]}),(0,n.jsxs)("div",{style:{backgroundColor:"#F9FAFB",border:"2px solid #E5E7EB",borderRadius:"0.75rem",padding:"1.25rem",marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,n.jsxs)("div",{style:{fontSize:"1rem",lineHeight:"1.6",color:"#374151",fontStyle:"italic",marginBottom:"0.75rem"},className:"jsx-8795408d21c696e",children:['"',r,'"']}),(0,n.jsxs)("div",{style:{fontSize:"0.875rem",color:"#6B7280",fontWeight:"500"},className:"jsx-8795408d21c696e",children:['— from "',c,'"']})]}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},className:"jsx-8795408d21c696e",children:[(0,n.jsx)("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},className:"jsx-8795408d21c696e",children:"Share Link"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},className:"jsx-8795408d21c696e",children:[(0,n.jsx)("input",{type:"text",value:d,readOnly:!0,style:{flex:1,padding:"0.75rem",border:"1px solid #D1D5DB",borderRadius:"0.5rem",fontSize:"0.875rem",backgroundColor:"#F9FAFB",fontFamily:"monospace"},className:"jsx-8795408d21c696e"}),(0,n.jsx)("button",{onClick:h,style:{padding:"0.75rem 1rem",backgroundColor:m?"#10B981":"#3B82F6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap"},className:"jsx-8795408d21c696e",children:m?"✓ Copied!":"\uD83D\uDCCB Copy"})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},className:"jsx-8795408d21c696e",children:["undefined"!=typeof navigator&&"share"in navigator&&(0,n.jsx)("button",{onClick:u,style:{padding:"0.75rem 1.5rem",backgroundColor:"#6366F1",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#5B21B6",onMouseOut:e=>e.currentTarget.style.backgroundColor="#6366F1",className:"jsx-8795408d21c696e",children:"\uD83D\uDCE4 Share"}),(0,n.jsx)("button",{onClick:o,style:{padding:"0.75rem 1.5rem",backgroundColor:"#F3F4F6",color:"#374151",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#E5E7EB",onMouseOut:e=>e.currentTarget.style.backgroundColor="#F3F4F6",className:"jsx-8795408d21c696e",children:"Close"})]})]}),(0,n.jsx)(i(),{id:"8795408d21c696e",children:"@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}"})]}),document.body):null}}}]);