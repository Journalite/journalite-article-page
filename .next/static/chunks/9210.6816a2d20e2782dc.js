"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9210],{9210:(t,e,r)=>{r.d(e,{BC:()=>g,GE:()=>a,N6:()=>l,Oe:()=>h,Tu:()=>m,a:()=>w,fz:()=>d,getArticleById:()=>c,iZ:()=>u,l6:()=>s,tT:()=>f,zE:()=>y});var o=r(5317),n=r(3201),i=r(9995);async function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:e,includeDrafts:r=!1}=t;console.log("getArticles called with limit:",e);try{let t=(0,o.rJ)(n.db,"articles"),i=[];r||i.push((0,o._M)("status","==","published")),i.push((0,o.My)("createdAt","desc")),e&&e>0&&(console.log("Adding limit constraint:",e),i.push((0,o.AB)(e)));let a=(0,o.P)(t,...i),c=await (0,o.GG)(a);console.log("Query returned document count:",c.size);let s=[];return c.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function c(t){try{let i=Date.now();console.log("\uD83D\uDD04 DIRECT FETCH: Getting article with ID: ".concat(t," (time: ").concat(i,")"));let a=(0,o.doc)(n.db,"articles",t),c=await (0,o.x7)(a);if(!c.exists())return console.log("❌ Article not found for ID:",t),null;{var e,r;let t={id:c.id,...c.data()};return console.log("✅ Article found:",t.title),console.log("\uD83D\uDCC4 Content length:",(null==(e=t.body)?void 0:e.length)||0),console.log("\uD83C\uDFF7️ Tags:",(null==(r=t.tags)?void 0:r.join(", "))||"none"),t}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function s(t){try{console.log("Getting article by slug: ".concat(t,", timestamp: ").concat(Date.now()));let r=0;for(;r<2;){r++,console.log("Attempt ".concat(r," to get article by slug")),r>1&&await new Promise(t=>setTimeout(t,500));let i=(0,o.rJ)(n.db,"articles"),a=(0,o.P)(i,(0,o._M)("slug","==",t),(0,o._M)("status","==","published")),c=await (0,o.GG)(a);if(c.empty){if(r>=2){console.log("Article not found for slug after multiple attempts:",t);break}}else{var e;let t=c.docs[0],r={id:t.id,...t.data()};return console.log("Article found by slug:",r.title,"Content length:",(null==(e=r.body)?void 0:e.length)||0),r}console.log("Article not found by slug on attempt ".concat(r,", will retry..."))}return null}catch(t){throw console.error("Error getting article by slug:",t),t}}async function l(t){try{var e;let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to create an article");let i={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Dc.now(),authorId:r.uid,authorName:r.displayName||(null==(e=r.email)?void 0:e.split("@")[0])||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"articles"),i)).id,...i}}catch(t){throw console.error("Error creating article:",t),t}}async function u(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let i=(0,o.doc)(n.db,"articles",t),a=await (0,o.x7)(i);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let c={...e};e.title&&(c.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",c.slug)),c.updatedAt=o.Dc.now(),await (0,o.updateDoc)(i,c);let s=await (0,o.x7)(i);return{id:s.id,...s.data()}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=(0,o.rJ)(n.db,"articles",t,"comments"),r=(0,o.P)(e,(0,o.My)("createdAt","desc")),i=await (0,o.GG)(r),a=[];return i.forEach(t=>{let e=t.data();a.push({id:t.id,commentId:t.id,...e,replies:e.replies||[]})}),a}catch(t){throw console.error("Error getting comments:",t),t}}async function g(t,e){try{var r;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to comment");let s={userId:a.uid,userName:a.displayName||(null==(r=a.email)?void 0:r.split("@")[0])||"Anonymous",content:e,createdAt:o.Dc.now(),likes:[],replies:[]},l=await (0,o.gS)((0,o.rJ)(n.db,"articles",t,"comments"),s),u=await c(t);return u&&u.authorId!==a.uid&&await (0,i.fZ)(u.authorId,t,u.slug||"",u.title||"Article",l.id,e),{id:l.id,commentId:l.id,...s}}catch(t){throw console.error("Error adding comment:",t),t}}async function h(t,e,r){try{var i;let a=n.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let s=(0,o.doc)(n.db,"articles",t,"comments",e),l=await (0,o.x7)(s);if(!l.exists())throw Error("Comment not found");let u={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||(null==(i=a.email)?void 0:i.split("@")[0])||"Anonymous",content:r,createdAt:o.Dc.now(),likes:[]};await (0,o.updateDoc)(s,{replies:(0,o.arrayUnion)(u)});let d=l.data();if(d.userId!==a.uid){let r=await c(t);console.log("User ".concat(a.uid," replied to comment ").concat(e," by ").concat(d.userId," on article ").concat(null==r?void 0:r.title))}return u}catch(t){throw console.error("Error adding reply:",t),t}}async function f(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let i=(0,o.doc)(n.db,"articles",t,"comments",e),a=await (0,o.x7)(i);if(!a.exists())throw Error("Comment not found");let c=a.data(),s=r.uid,l=(c.likes||[]).includes(s);await (0,o.updateDoc)(i,{likes:l?(0,o.arrayRemove)(s):(0,o.arrayUnion)(s)});let u=(await (0,o.x7)(i)).data();return{success:!0,action:l?"unliked":"liked",likes:u.likes,count:u.likes.length}}catch(t){throw console.error("Error liking comment:",t),t}}async function m(t,e){try{let r=n.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let i=(0,o.doc)(n.db,"articles",t,"comments",e),a=await (0,o.x7)(i);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.kd)(i),{success:!0,message:"Comment deleted successfully"}}catch(t){throw console.error("Error deleting comment:",t),t}}async function w(t){try{let e=n.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(n.db,"articles",t),i=await (0,o.x7)(r);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function y(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:r}=e;try{let e=(0,o.rJ)(n.db,"articles"),i=[(0,o._M)("tags","array-contains",t),(0,o._M)("status","==","published"),(0,o.My)("createdAt","desc")];r&&r>0&&i.push((0,o.AB)(r));let a=(0,o.P)(e,...i),c=await (0,o.GG)(a),s=[];return c.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}},9995:(t,e,r)=>{r.d(e,{Hs:()=>d,N9:()=>a,Ss:()=>c,bA:()=>s,fP:()=>u,fZ:()=>i,he:()=>l});var o=r(5317),n=r(3201);async function i(t,e,r,i,a,c){try{let e=n.j2.currentUser;if(!e||e.uid===t)return null;let s={userId:t,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:"".concat(e.displayName||"Someone",' commented on your article: "').concat(c.substring(0,50)).concat(c.length>50?"...":"",'"'),fromUser:{id:e.uid,name:e.displayName||"Anonymous"},createdAt:o.Dc.now(),articleSlug:r,articleTitle:i};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),s)).id,...s}}catch(t){return console.error("Error creating notification:",t),null}}async function a(t,e,r,i){try{if(t===r)return null;let a={userId:t,type:"follow",read:!1,sourceId:r,sourceType:"user",message:"".concat(e," (@").concat(i,") started following you"),fromUser:{id:r,name:e,username:i},createdAt:o.Dc.now()};return{id:(await (0,o.gS)((0,o.rJ)(n.db,"notifications"),a)).id,...a}}catch(t){return console.error("Error creating follow notification:",t),null}}async function c(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let e,r=n.j2.currentUser;if(!r)throw Error("User not authenticated");let i=(0,o.rJ)(n.db,"notifications");e=t?(0,o.P)(i,(0,o._M)("userId","==",r.uid),(0,o._M)("read","==",!1),(0,o.My)("createdAt","desc"),(0,o.AB)(100)):(0,o.P)(i,(0,o._M)("userId","==",r.uid),(0,o.My)("createdAt","desc"),(0,o.AB)(100));let a=await (0,o.GG)(e),c=[];return a.forEach(t=>{c.push({id:t.id,...t.data()})}),c}catch(t){throw console.error("Error fetching notifications:",t),t}}async function s(t){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",t),i=await (0,o.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(t){throw console.error("Error marking notification as read:",t),t}}async function l(){try{let t=n.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(e,(0,o._M)("userId","==",t.uid),(0,o._M)("read","==",!1)),i=await (0,o.GG)(r),a=i.docs.map(t=>(0,o.updateDoc)(t.ref,{read:!0}));return await Promise.all(a),{success:!0,count:i.size}}catch(t){throw console.error("Error marking all notifications as read:",t),t}}async function u(t){try{let e=n.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(n.db,"notifications",t),i=await (0,o.x7)(r);if(!i.exists())throw Error("Notification not found");if(i.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.kd)(r),{success:!0}}catch(t){throw console.error("Error deleting notification:",t),t}}async function d(){try{let t=n.j2.currentUser;if(!t)return 0;let e=(0,o.rJ)(n.db,"notifications"),r=(0,o.P)(e,(0,o._M)("userId","==",t.uid),(0,o._M)("read","==",!1));return(await (0,o.GG)(r)).size}catch(t){return console.error("Error counting unread notifications:",t),0}}}}]);