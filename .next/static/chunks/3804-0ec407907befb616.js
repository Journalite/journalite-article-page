(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3804],{3616:(e,t,a)=>{"use strict";a.d(t,{r:()=>l});var r=a(5112),i=a(3201);class l{static async getOrCreateSocialData(e,t,a,l){try{let s=encodeURIComponent(e),n="".concat(t,"-").concat(s),c=(0,r.doc)(i.db,"external_articles",n),o=await (0,r.getDoc)(c);if(o.exists())return{id:n,...o.data()};{let i={externalId:e,source:t,title:a,url:l,likes:[],createdAt:(0,r.serverTimestamp)(),lastActivity:(0,r.serverTimestamp)()};return await (0,r.setDoc)(c,i),{id:n,...i}}}catch(e){throw console.error("Error getting or creating social data:",e),e}}static async toggleLike(e,t,a,l,s){try{let n=encodeURIComponent(e),c="".concat(t,"-").concat(n),o=(0,r.doc)(i.db,"external_articles",c);await this.getOrCreateSocialData(e,t,l,s);let d=(await (0,r.getDoc)(o)).data().likes||[];if(d.includes(a))return await (0,r.updateDoc)(o,{likes:(0,r.arrayRemove)(a),lastActivity:(0,r.serverTimestamp)()}),{isLiked:!1,totalLikes:d.length-1};return await (0,r.updateDoc)(o,{likes:(0,r.arrayUnion)(a),lastActivity:(0,r.serverTimestamp)()}),{isLiked:!0,totalLikes:d.length+1}}catch(e){throw console.error("Error toggling like:",e),e}}static async getSocialData(e,t){try{let a=encodeURIComponent(e),l="".concat(t,"-").concat(a),s=(0,r.doc)(i.db,"external_articles",l),n=await (0,r.getDoc)(s);if(n.exists())return{id:l,...n.data()};return null}catch(e){return console.error("Error getting social data:",e),null}}}},3804:(e,t,a)=>{"use strict";a.d(t,{A:()=>v});var r=a(5155),i=a(2115),l=a(9547);let s=i.memo(e=>{let{articleId:t,articleHtml:a,isAuthenticated:i,articleTitle:s,articleSlug:n,hasReflectionRoom:c=!1,moodFeatureEnabled:o,onToggleMoodFeature:d,mood:u}=e;return(0,r.jsx)(l.A,{articleId:t,initialHtml:a||void 0,isAuthenticated:i,articleTitle:s,articleSlug:n,hasReflectionRoom:c,...i&&{moodFeatureEnabled:o,onToggleMoodFeature:d,mood:u}})},(e,t)=>e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&e.isAuthenticated===t.isAuthenticated&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.hasReflectionRoom===t.hasReflectionRoom&&e.moodFeatureEnabled===t.moodFeatureEnabled&&e.onToggleMoodFeature===t.onToggleMoodFeature&&e.mood===t.mood);var n=a(5405),c=a(3201),o=a(3616);let d=i.memo(e=>{let{externalId:t,source:a,title:l,url:s,initialLikes:n=[],className:d="",styles:u={}}=e,[h,m]=(0,i.useState)(n),[v,p]=(0,i.useState)(!1),[f,g]=(0,i.useState)(null),[x,w]=(0,i.useState)(!1),[N,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=c.j2.onAuthStateChanged(e=>{g(e),e?p(h.includes(e.uid)):p(!1)});return()=>e()},[h]),(0,i.useEffect)(()=>{m(n),f&&p(n.includes(f.uid))},[n,f]),(0,i.useEffect)(()=>{(async()=>{try{let e=await o.r.getSocialData(t,a);e&&(m(e.likes||[]),f&&p((e.likes||[]).includes(f.uid)))}catch(e){console.error("Error loading social data:",e)}})()},[t,a,f]);let k=async e=>{if(e.preventDefault(),e.stopPropagation(),!f)return void alert("Please login to like articles");if(!N){w(!0),y(!0),setTimeout(()=>w(!1),300);try{let e=await o.r.toggleLike(t,a,f.uid,l,s);p(e.isLiked),e.isLiked?m(e=>[...e.filter(e=>e!==f.uid),f.uid]):m(e=>e.filter(e=>e!==f.uid))}catch(e){console.error("Error updating like status:",e),p(e=>!e)}finally{y(!1)}}};return(0,r.jsxs)("button",{className:"".concat(d," ").concat(v?u.liked:""),onClick:k,disabled:N,"aria-label":v?"Unlike article":"Like article",style:{transition:"all 0.3s ease",transform:x?"scale(1.2)":"scale(1)",opacity:N?.6:1},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:v?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:u.likeIcon,style:{transition:"all 0.3s ease",filter:x?"drop-shadow(0 0 8px currentColor)":"none"},children:(0,r.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,r.jsx)("span",{children:h.length>0?h.length:""})]})});var u=a(3891),h=a(8501),m=a.n(h);let v=i.memo(e=>{let{articleId:t,articleHtml:a,article:i,initialLikes:l,currentUser:c,isAuthenticated:o,onEditClick:h,articleTitle:v,articleSlug:p,moodFeatureEnabled:f,onToggleMoodFeature:g,mood:x,isExternal:w=!1,externalSource:N,externalId:y,externalUrl:k}=e;return(0,r.jsxs)("div",{className:m().pageContainer,children:[i&&(0,r.jsxs)("header",{className:m().articleHeader,children:[(0,r.jsxs)("div",{className:m().articleHeaderWithReaders,children:[(0,r.jsx)("div",{className:m().titleSection,children:(0,r.jsx)("h1",{className:m().articleTitle,style:{margin:0},children:i.title})}),(0,r.jsx)("div",{className:m().readersSection,children:(0,r.jsx)(u.A,{articleId:t})})]}),(0,r.jsxs)("div",{className:m().articleMeta,children:[(0,r.jsxs)("div",{className:m().authorInfo,children:[(0,r.jsx)("div",{className:m().authorAvatar,children:i.authorName.charAt(0)}),(0,r.jsxs)("div",{className:m().authorDetails,children:[(0,r.jsx)("div",{className:m().authorName,children:i.authorName}),(0,r.jsxs)("div",{className:m().articleDetails,children:[i.createdAt," \xb7 ",i.readTime," min read"]})]})]}),(0,r.jsxs)("div",{className:m().articleActions,children:[w&&N&&y?(0,r.jsx)(d,{externalId:y,source:N,title:i.title,url:k||"",initialLikes:l,className:m().likeButton,styles:m()}):(0,r.jsx)(n.A,{articleId:t,initialLikes:l,className:m().likeButton,styles:m()}),c&&i.authorId===c.uid&&(0,r.jsx)("button",{className:m().editButton,onClick:h,children:"Edit"})]})]}),i.tags&&i.tags.length>0&&(0,r.jsx)("div",{className:m().tagContainer,children:i.tags.map((e,t)=>(0,r.jsx)("span",{className:m().tag,children:e},t))})]}),(0,r.jsx)(s,{articleId:t,articleHtml:a,isAuthenticated:o,articleTitle:v,articleSlug:p,hasReflectionRoom:(null==i?void 0:i.hasReflectionRoom)||!1,moodFeatureEnabled:f,onToggleMoodFeature:g,mood:x})]})},(e,t)=>{var a,r,i,l,s,n,c,o,d,u,h,m,v,p;return e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&(null==(a=e.article)?void 0:a.title)===(null==(r=t.article)?void 0:r.title)&&(null==(i=e.article)?void 0:i.authorName)===(null==(l=t.article)?void 0:l.authorName)&&(null==(s=e.article)?void 0:s.createdAt)===(null==(n=t.article)?void 0:n.createdAt)&&(null==(c=e.article)?void 0:c.readTime)===(null==(o=t.article)?void 0:o.readTime)&&(null==(d=e.article)?void 0:d.authorId)===(null==(u=t.article)?void 0:u.authorId)&&(null==(h=e.article)?void 0:h.hasReflectionRoom)===(null==(m=t.article)?void 0:m.hasReflectionRoom)&&e.isAuthenticated===t.isAuthenticated&&(null==(v=e.currentUser)?void 0:v.uid)===(null==(p=t.currentUser)?void 0:p.uid)&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.moodFeatureEnabled===t.moodFeatureEnabled&&e.mood===t.mood&&e.isExternal===t.isExternal&&e.externalSource===t.externalSource&&e.externalId===t.externalId&&e.externalUrl===t.externalUrl&&e.onEditClick===t.onEditClick&&e.onToggleMoodFeature===t.onToggleMoodFeature})},3891:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(5155),i=a(2115),l=a(3201),s=a(5112),n=a(4744);class c{async startPresence(e){if(this.isDestroyed)return;let t=l.j2.currentUser;if(t)try{let a=await (0,n.VM)(t.uid);if(!a)return;let r=(0,s.doc)(l.db,"articlePresence","".concat(e,"_").concat(t.uid));await (0,s.setDoc)(r,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,s.serverTimestamp)(),articleId:e});let i=setInterval(async()=>{if(l.j2.currentUser&&!document.hidden&&!this.isDestroyed)try{await (0,s.setDoc)(r,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,s.serverTimestamp)(),articleId:e})}catch(t){clearInterval(i),this.heartbeatIntervals.delete(e)}},3e4);this.heartbeatIntervals.set(e,i);let c=()=>{this.stopPresence(e)},o=()=>{document.hidden&&setTimeout(()=>{document.hidden&&!this.isDestroyed&&this.stopPresence(e)},6e4)};window.addEventListener("beforeunload",c),window.addEventListener("pagehide",c),document.addEventListener("visibilitychange",o);let d=l.j2.onAuthStateChanged(t=>{t||this.isDestroyed||this.stopPresence(e)});this.presenceRefs.set(e,()=>{window.removeEventListener("beforeunload",c),window.removeEventListener("pagehide",c),document.removeEventListener("visibilitychange",o),d()})}catch(e){}}async stopPresence(e){let t=l.j2.currentUser;if(t)try{let a=this.heartbeatIntervals.get(e);a&&(clearInterval(a),this.heartbeatIntervals.delete(e));let r=(0,s.doc)(l.db,"articlePresence","".concat(e,"_").concat(t.uid));await (0,s.deleteDoc)(r);let i=this.presenceRefs.get(e);i&&(window.removeEventListener("beforeunload",i),this.presenceRefs.delete(e))}catch(e){}}subscribeToActiveUsers(e,t){let a=new Date(Date.now()-45e3),r=(0,s.query)((0,s.collection)(l.db,"articlePresence"),(0,s.where)("articleId","==",e),(0,s.where)("lastSeen",">",s.Timestamp.fromDate(a)),(0,s.orderBy)("lastSeen","desc"),(0,s.limit)(10));return(0,s.onSnapshot)(r,async e=>{try{let a=[];for(let t of e.docs){let e=t.data();if(!l.j2.currentUser||e.uid!==l.j2.currentUser.uid)try{let t=await (0,n.VM)(e.uid);a.push({...e,profile:t||void 0})}catch(t){a.push({...e,profile:void 0})}}t(a)}catch(e){t([])}},e=>{t([])})}async cleanupStalePresence(){try{let e=new Date(Date.now()-6e4),t=(0,s.query)((0,s.collection)(l.db,"articlePresence"),(0,s.where)("lastSeen","<",s.Timestamp.fromDate(e))),a=(await (0,s.getDocs)(t)).docs.map(e=>(0,s.deleteDoc)(e.ref));a.length>0&&await Promise.all(a)}catch(e){}}cleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.heartbeatIntervals.forEach(e=>{clearInterval(e)}),this.heartbeatIntervals.clear(),this.presenceRefs.forEach(e=>{e()}),this.presenceRefs.clear(),this.isDestroyed=!0}constructor(){this.presenceRefs=new Map,this.heartbeatIntervals=new Map,this.cleanupInterval=null,this.isDestroyed=!1,this.cleanupInterval=setInterval(()=>{this.isDestroyed||this.cleanupStalePresence()},6e4)}}let o=new c;window.addEventListener("beforeunload",()=>{o.cleanup()});var d=a(6336),u=a.n(d);let h=e=>{var t,a;return(null==(t=e.profile)?void 0:t.firstName)&&(null==(a=e.profile)?void 0:a.lastName)?"".concat(e.profile.firstName[0]).concat(e.profile.lastName[0]).toUpperCase():e.firstName&&e.lastName?"".concat(e.firstName[0]).concat(e.lastName[0]).toUpperCase():e.username?e.username.slice(0,2).toUpperCase():"?"},m=e=>{var t,a;return(null==(t=e.profile)?void 0:t.firstName)&&(null==(a=e.profile)?void 0:a.lastName)?"".concat(e.profile.firstName," ").concat(e.profile.lastName):e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||"Anonymous"},v=e=>{let t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FECA57","#FF9FF3","#A8E6CF","#FFD93D"];return t[e%t.length]},p=e=>{let{articleId:t}=e,[a,s]=(0,i.useState)([]),[n,c]=(0,i.useState)(!1),[d,p]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{let e=l.j2.onAuthStateChanged(e=>{p(!!e)});return()=>e()},[]),(0,i.useEffect)(()=>{if(!t||!d)return;o.startPresence(t);let e=o.subscribeToActiveUsers(t,e=>{let t=e.slice(0,5);s(t),c(t.length>0)});return()=>{e(),o.stopPresence(t)}},[t,d]),d&&n&&0!==a.length)?(0,r.jsxs)("div",{className:u().activeReadersContainer,children:[(0,r.jsxs)("div",{className:u().avatarStack,children:[a.map((e,t)=>(0,r.jsx)("div",{className:u().avatar,style:{backgroundColor:v(t),zIndex:5-t,left:"".concat(20*t,"px")},title:m(e),children:h(e)},e.uid)),a.length>0&&(0,r.jsx)("div",{className:u().readingIndicator,style:{left:"".concat((a.length-1)*20+24,"px")},children:(0,r.jsx)("div",{className:u().pulse})})]}),(0,r.jsx)("div",{className:u().tooltip,children:1===a.length?(0,r.jsxs)("span",{children:[m(a[0])," is reading this"]}):(0,r.jsxs)("span",{children:[a.length," people are reading this"]})})]}):null}},5405:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(5155),i=a(2115),l=a(3201);let s=i.memo(e=>{let{articleId:t,initialLikes:s=[],className:n="",styles:c={}}=e,[o,d]=(0,i.useState)(s),[u,h]=(0,i.useState)(!1),[m,v]=(0,i.useState)(null),[p,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=l.j2.onAuthStateChanged(e=>{v(e),e?h(o.includes(e.uid)):h(!1)});return()=>e()},[o]),(0,i.useEffect)(()=>{d(s),m&&h(s.includes(m.uid))},[s,m]);let g=async e=>{if(e.preventDefault(),e.stopPropagation(),!m)return void alert("Please login to like articles");f(!0),setTimeout(()=>f(!1),300);try{if(u){let e=o.filter(e=>e!==m.uid);d(e),h(!1);let{doc:r,updateDoc:i,arrayRemove:l}=await Promise.resolve().then(a.bind(a,5112)),{db:s}=await Promise.resolve().then(a.bind(a,3201)),n=r(s,"articles",t);await i(n,{likes:l(m.uid)})}else{let e=[...o,m.uid];d(e),h(!0);let{doc:r,updateDoc:i,arrayUnion:l}=await Promise.resolve().then(a.bind(a,5112)),{db:s}=await Promise.resolve().then(a.bind(a,3201)),n=r(s,"articles",t);await i(n,{likes:l(m.uid)})}}catch(e){console.error("Error updating like status:",e),u?(d([...o,m.uid]),h(!0)):(d(o.filter(e=>e!==m.uid)),h(!1))}};return(0,r.jsxs)("button",{className:"".concat(n," ").concat(u?c.liked:""),onClick:g,"aria-label":u?"Unlike article":"Like article",style:{transition:"all 0.3s ease",transform:p?"scale(1.2)":"scale(1)"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:u?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:c.likeIcon,style:{transition:"all 0.3s ease",filter:p?"drop-shadow(0 0 8px currentColor)":"none"},children:(0,r.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,r.jsx)("span",{children:o.length>0?o.length:""})]})})},6336:e=>{e.exports={activeReadersContainer:"ActiveReaders_activeReadersContainer__kzDyK",avatarStack:"ActiveReaders_avatarStack__C0oAd",avatar:"ActiveReaders_avatar__dmRJ6",readingIndicator:"ActiveReaders_readingIndicator__aAJCN",pulse:"ActiveReaders_pulse__xIR81",tooltip:"ActiveReaders_tooltip__hAqNr",avatarAppear:"ActiveReaders_avatarAppear__UbwiK",slideIn:"ActiveReaders_slideIn__40eQ_"}}}]);