(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3249],{350:(t,e,i)=>{"use strict";i.d(e,{A:()=>u});var o=i(5155),a=i(9675),r=i(6874),n=i.n(r),c=i(9995),l=i(4814),s=i(912),d=i.n(s);let u=()=>{let[t,e]=(0,a.J0)(0),[i,r]=(0,a.J0)([]),[s,u]=(0,a.J0)(!1),f=(0,a.li)(null);(0,a.vJ)(()=>{let t=async()=>{e(await (0,c.Hs)())};t();let i=setInterval(t,6e4);return()=>clearInterval(i)},[]),(0,a.vJ)(()=>{let t=t=>{f.current&&!f.current.contains(t.target)&&u(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),(0,a.vJ)(()=>{s&&h()},[s]);let h=async()=>{try{let t=await (0,c.Ss)(!1);r(t)}catch(t){console.error("Error fetching notifications:",t)}},m=async t=>{try{!t.read&&t.id&&(await (0,c.bA)(t.id),e(t=>Math.max(t-1,0)),r(e=>e.map(e=>e.id===t.id?{...e,read:!0}:e)))}catch(t){console.error("Error marking notification as read:",t)}},g=t=>{if(!t)return"";let e=t.toDate?t.toDate():new Date(t),i=Math.floor((new Date().getTime()-e.getTime())/6e4);if(i<1)return"Just now";if(i<60)return"".concat(i,"m ago");let o=Math.floor(i/60);if(o<24)return"".concat(o,"h ago");let a=Math.floor(o/24);return a<7?"".concat(a,"d ago"):e.toLocaleDateString()},w=t=>{if("follow"===t.type){var e;return(null==(e=t.fromUser)?void 0:e.username)?"/user/".concat(t.fromUser.username):"/notifications"}return t.articleSlug?"/articles?slug=".concat(t.articleSlug):"/notifications"};return(0,o.jsxs)("div",{className:d().notificationContainer,ref:f,children:[(0,o.jsxs)("button",{className:d().bellButton,onClick:()=>{u(!s)},children:[(0,o.jsx)("span",{className:d().bellIcon,children:(0,o.jsx)(l.He,{size:20,color:"#6b7280"})}),t>0&&(0,o.jsx)("span",{className:d().unreadBadge,children:t})]}),s&&(0,o.jsxs)("div",{className:d().notificationDropdown,children:[(0,o.jsxs)("div",{className:d().notificationHeader,children:[(0,o.jsx)("h3",{children:"Notifications"}),i.length>0&&(0,o.jsx)(n(),{href:"/notifications",className:d().viewAllLink,children:"View All"})]}),(0,o.jsx)("div",{className:d().notificationList,children:0===i.length?(0,o.jsx)("div",{className:d().emptyState,children:"No notifications yet"}):i.slice(0,5).map(t=>(0,o.jsxs)(n(),{href:w(t),className:"".concat(d().notificationItem," ").concat(t.read?"":d().unread),onClick:()=>m(t),children:[(0,o.jsxs)("div",{className:d().notificationContent,children:[(0,o.jsx)("p",{className:d().notificationMessage,children:t.message}),(0,o.jsx)("span",{className:d().notificationTime,children:g(t.createdAt)})]}),!t.read&&(0,o.jsx)("div",{className:d().unreadDot})]},t.id))}),i.length>5&&(0,o.jsx)("div",{className:d().notificationFooter,children:(0,o.jsx)(n(),{href:"/notifications",className:d().seeMoreLink,children:"See more notifications"})})]})]})}},912:t=>{t.exports={notificationContainer:"NotificationBell_notificationContainer__TFGqP",bellButton:"NotificationBell_bellButton__PKB6r",bellIcon:"NotificationBell_bellIcon__ALAAB",unreadBadge:"NotificationBell_unreadBadge__cOn_b",notificationDropdown:"NotificationBell_notificationDropdown__p8Mv4",notificationHeader:"NotificationBell_notificationHeader__cPSyI",viewAllLink:"NotificationBell_viewAllLink__une1x",notificationList:"NotificationBell_notificationList__SBbvK",notificationItem:"NotificationBell_notificationItem__MW9MC",unread:"NotificationBell_unread__9c4op",notificationContent:"NotificationBell_notificationContent__2upmA",notificationMessage:"NotificationBell_notificationMessage__aqMDB",notificationTime:"NotificationBell_notificationTime__JQ2O9",unreadDot:"NotificationBell_unreadDot__qaEb7",notificationFooter:"NotificationBell_notificationFooter__l28sD",seeMoreLink:"NotificationBell_seeMoreLink__eh2qR",emptyState:"NotificationBell_emptyState___y1V2"}},9210:(t,e,i)=>{"use strict";i.d(e,{GE:()=>r,N6:()=>l,a:()=>d,getArticleById:()=>n,iZ:()=>s,l6:()=>c,zE:()=>u});var o=i(5112),a=i(3201);async function r(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{limit:e,includeDrafts:i=!1}=t;try{let t=(0,o.collection)(a.db,"articles"),r=[];i||r.push((0,o.where)("status","==","published")),r.push((0,o.orderBy)("createdAt","desc")),e&&e>0&&r.push((0,o.limit)(e));let n=(0,o.query)(t,...r),c=await (0,o.getDocs)(n),l=[];return c.forEach(t=>{let e=t.data();l.push({id:t.id,...e})}),l}catch(t){throw console.error("Error getting articles:",t),t}}async function n(t){Date.now();try{let e=(0,o.doc)(a.db,"articles",t),i=await (0,o.getDoc)(e);if(!i.exists())return null;return{id:i.id,...i.data()}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function c(t){let e=0;for(;e<3;){e++;try{let i=(0,o.collection)(a.db,"articles"),r=(0,o.query)(i,(0,o.where)("slug","==",t),(0,o.where)("status","==","published"),(0,o.limit)(1)),n=await (0,o.getDocs)(r);if(n.empty)if(3===e)break;else await new Promise(t=>setTimeout(t,1e3));else{let t=n.docs[0];return{id:t.id,...t.data()}}}catch(t){if(console.error("Error getting article by slug:",t),3===e)throw t}}return null}async function l(t){try{var e;let i=a.j2.currentUser;if(!i)throw Error("You must be logged in to create an article");let r={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:i.uid,authorName:i.displayName||(null==(e=i.email)?void 0:e.split("@")[0])||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[],hasReflectionRoom:t.hasReflectionRoom||!1};return{id:(await (0,o.addDoc)((0,o.collection)(a.db,"articles"),r)).id,...r}}catch(t){throw console.error("Error creating article:",t),t}}async function s(t,e){try{let i=a.j2.currentUser;if(!i)throw Error("You must be logged in to edit an article");let r=(0,o.doc)(a.db,"articles",t),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==i.uid)throw Error("You can only edit your own articles");let c={...e};e.title&&(c.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),c.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(r,c);let l=await (0,o.getDoc)(r);if(!l.exists())return{id:t,...c,createdAt:o.Timestamp.now(),updatedAt:o.Timestamp.now()};{let t=l.data();return{id:l.id,...t}}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=a.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let i=(0,o.doc)(a.db,"articles",t),r=await (0,o.getDoc)(i);if(!r.exists())throw Error("Article not found");if(r.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(i),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{limit:i}=e;try{let e=(0,o.collection)(a.db,"articles"),r=[(0,o.where)("tags","array-contains",t),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];i&&i>0&&r.push((0,o.limit)(i));let n=(0,o.query)(e,...r),c=await (0,o.getDocs)(n),l=[];return c.forEach(t=>{l.push({id:t.id,...t.data()})}),l}catch(t){throw console.error("Error getting articles by tag:",t),t}}i(9995)},9675:(t,e,i)=>{"use strict";i.d(e,{J0:()=>o.useState,li:()=>o.useRef,vJ:()=>o.useEffect});var o=i(2115)}}]);