exports.id=1179,exports.ids=[1179],exports.modules={10129:e=>{e.exports={activeReadersContainer:"ActiveReaders_activeReadersContainer__kzDyK",avatarStack:"ActiveReaders_avatarStack__C0oAd",avatar:"ActiveReaders_avatar__dmRJ6",readingIndicator:"ActiveReaders_readingIndicator__aAJCN",pulse:"ActiveReaders_pulse__xIR81",tooltip:"ActiveReaders_tooltip__hAqNr",avatarAppear:"ActiveReaders_avatarAppear__UbwiK",slideIn:"ActiveReaders_slideIn__40eQ_"}},28914:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(60687),i=a(43210),s=a(43649),l=a(75535),n=a(49048);class c{constructor(){this.presenceRefs=new Map,this.heartbeatIntervals=new Map,this.cleanupInterval=null,this.isDestroyed=!1,this.cleanupInterval=setInterval(()=>{this.isDestroyed||this.cleanupStalePresence()},6e4)}async startPresence(e){if(this.isDestroyed)return;let t=s.j2.currentUser;if(t)try{let a=await (0,n.VM)(t.uid);if(!a)return;let r=(0,l.doc)(s.db,"articlePresence",`${e}_${t.uid}`);await (0,l.setDoc)(r,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,l.serverTimestamp)(),articleId:e});let i=setInterval(async()=>{if(s.j2.currentUser&&!document.hidden&&!this.isDestroyed)try{await (0,l.setDoc)(r,{uid:t.uid,username:a.username,firstName:a.firstName,lastName:a.lastName,lastSeen:(0,l.serverTimestamp)(),articleId:e})}catch(t){clearInterval(i),this.heartbeatIntervals.delete(e)}},3e4);this.heartbeatIntervals.set(e,i);let c=()=>{this.stopPresence(e)},o=()=>{document.hidden&&setTimeout(()=>{document.hidden&&!this.isDestroyed&&this.stopPresence(e)},6e4)};window.addEventListener("beforeunload",c),window.addEventListener("pagehide",c),document.addEventListener("visibilitychange",o);let d=s.j2.onAuthStateChanged(t=>{t||this.isDestroyed||this.stopPresence(e)});this.presenceRefs.set(e,()=>{window.removeEventListener("beforeunload",c),window.removeEventListener("pagehide",c),document.removeEventListener("visibilitychange",o),d()})}catch(e){}}async stopPresence(e){let t=s.j2.currentUser;if(t)try{let a=this.heartbeatIntervals.get(e);a&&(clearInterval(a),this.heartbeatIntervals.delete(e));let r=(0,l.doc)(s.db,"articlePresence",`${e}_${t.uid}`);await (0,l.deleteDoc)(r);let i=this.presenceRefs.get(e);i&&(window.removeEventListener("beforeunload",i),this.presenceRefs.delete(e))}catch(e){}}subscribeToActiveUsers(e,t){let a=new Date(Date.now()-45e3),r=(0,l.query)((0,l.collection)(s.db,"articlePresence"),(0,l.where)("articleId","==",e),(0,l.where)("lastSeen",">",l.Timestamp.fromDate(a)),(0,l.orderBy)("lastSeen","desc"),(0,l.limit)(10));return(0,l.onSnapshot)(r,async e=>{try{let a=[];for(let t of e.docs){let e=t.data();if(!s.j2.currentUser||e.uid!==s.j2.currentUser.uid)try{let t=await (0,n.VM)(e.uid);a.push({...e,profile:t||void 0})}catch(t){a.push({...e,profile:void 0})}}t(a)}catch(e){t([])}},e=>{t([])})}async cleanupStalePresence(){try{let e=new Date(Date.now()-6e4),t=(0,l.query)((0,l.collection)(s.db,"articlePresence"),(0,l.where)("lastSeen","<",l.Timestamp.fromDate(e))),a=(await (0,l.getDocs)(t)).docs.map(e=>(0,l.deleteDoc)(e.ref));a.length>0&&await Promise.all(a)}catch(e){}}cleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.heartbeatIntervals.forEach(e=>{clearInterval(e)}),this.heartbeatIntervals.clear(),this.presenceRefs.forEach(e=>{e()}),this.presenceRefs.clear(),this.isDestroyed=!0}}let o=new c;var d=a(10129),u=a.n(d);let h=e=>e.profile?.firstName&&e.profile?.lastName?`${e.profile.firstName[0]}${e.profile.lastName[0]}`.toUpperCase():e.firstName&&e.lastName?`${e.firstName[0]}${e.lastName[0]}`.toUpperCase():e.username?e.username.slice(0,2).toUpperCase():"?",m=e=>e.profile?.firstName&&e.profile?.lastName?`${e.profile.firstName} ${e.profile.lastName}`:e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.username||"Anonymous",v=e=>{let t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FECA57","#FF9FF3","#A8E6CF","#FFD93D"];return t[e%t.length]},p=({articleId:e})=>{let[t,a]=(0,i.useState)([]),[l,n]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{let e=s.j2.onAuthStateChanged(e=>{d(!!e)});return()=>e()},[]),(0,i.useEffect)(()=>{if(!e||!c)return;o.startPresence(e);let t=o.subscribeToActiveUsers(e,e=>{let t=e.slice(0,5);a(t),n(t.length>0)});return()=>{t(),o.stopPresence(e)}},[e,c]),c&&l&&0!==t.length)?(0,r.jsxs)("div",{className:u().activeReadersContainer,children:[(0,r.jsxs)("div",{className:u().avatarStack,children:[t.map((e,t)=>(0,r.jsx)("div",{className:u().avatar,style:{backgroundColor:v(t),zIndex:5-t,left:`${20*t}px`},title:m(e),children:h(e)},e.uid)),t.length>0&&(0,r.jsx)("div",{className:u().readingIndicator,style:{left:`${(t.length-1)*20+24}px`},children:(0,r.jsx)("div",{className:u().pulse})})]}),(0,r.jsx)("div",{className:u().tooltip,children:1===t.length?(0,r.jsxs)("span",{children:[m(t[0])," is reading this"]}):(0,r.jsxs)("span",{children:[t.length," people are reading this"]})})]}):null}},51179:(e,t,a)=>{"use strict";a.d(t,{A:()=>p});var r=a(60687),i=a(43210),s=a.n(i),l=a(93924);let n=s().memo(({articleId:e,articleHtml:t,isAuthenticated:a,articleTitle:i,articleSlug:s,hasReflectionRoom:n=!1,moodFeatureEnabled:c,onToggleMoodFeature:o,mood:d})=>(0,r.jsx)(l.A,{articleId:e,initialHtml:t||void 0,isAuthenticated:a,articleTitle:i,articleSlug:s,hasReflectionRoom:n,...a&&{moodFeatureEnabled:c,onToggleMoodFeature:o,mood:d}}),(e,t)=>e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&e.isAuthenticated===t.isAuthenticated&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.hasReflectionRoom===t.hasReflectionRoom&&e.moodFeatureEnabled===t.moodFeatureEnabled&&e.onToggleMoodFeature===t.onToggleMoodFeature&&e.mood===t.mood);var c=a(85625),o=a(43649),d=a(70814);let u=s().memo(({externalId:e,source:t,title:a,url:s,initialLikes:l=[],className:n="",styles:c={}})=>{let[u,h]=(0,i.useState)(l),[m,v]=(0,i.useState)(!1),[p,f]=(0,i.useState)(null),[g,x]=(0,i.useState)(!1),[N,w]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=o.j2.onAuthStateChanged(e=>{f(e),e?v(u.includes(e.uid)):v(!1)});return()=>e()},[u]),(0,i.useEffect)(()=>{h(l),p&&v(l.includes(p.uid))},[l,p]),(0,i.useEffect)(()=>{(async()=>{try{let a=await d.r.getSocialData(e,t);a&&(h(a.likes||[]),p&&v((a.likes||[]).includes(p.uid)))}catch(e){console.error("Error loading social data:",e)}})()},[e,t,p]);let y=async r=>{if(r.preventDefault(),r.stopPropagation(),!p)return void alert("Please login to like articles");if(!N){x(!0),w(!0),setTimeout(()=>x(!1),300);try{let r=await d.r.toggleLike(e,t,p.uid,a,s);v(r.isLiked),r.isLiked?h(e=>[...e.filter(e=>e!==p.uid),p.uid]):h(e=>e.filter(e=>e!==p.uid))}catch(e){console.error("Error updating like status:",e),v(e=>!e)}finally{w(!1)}}};return(0,r.jsxs)("button",{className:`${n} ${m?c.liked:""}`,onClick:y,disabled:N,"aria-label":m?"Unlike article":"Like article",style:{transition:"all 0.3s ease",transform:g?"scale(1.2)":"scale(1)",opacity:N?.6:1},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:m?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:c.likeIcon,style:{transition:"all 0.3s ease",filter:g?"drop-shadow(0 0 8px currentColor)":"none"},children:(0,r.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,r.jsx)("span",{children:u.length>0?u.length:""})]})});var h=a(28914),m=a(36012),v=a.n(m);let p=s().memo(({articleId:e,articleHtml:t,article:a,initialLikes:i,currentUser:s,isAuthenticated:l,onEditClick:o,articleTitle:d,articleSlug:m,moodFeatureEnabled:p,onToggleMoodFeature:f,mood:g,isExternal:x=!1,externalSource:N,externalId:w,externalUrl:y})=>(0,r.jsxs)("div",{className:v().pageContainer,children:[a&&(0,r.jsxs)("header",{className:v().articleHeader,children:[(0,r.jsxs)("div",{className:v().articleHeaderWithReaders,children:[(0,r.jsx)("div",{className:v().titleSection,children:(0,r.jsx)("h1",{className:v().articleTitle,style:{margin:0},children:a.title})}),(0,r.jsx)("div",{className:v().readersSection,children:(0,r.jsx)(h.A,{articleId:e})})]}),(0,r.jsxs)("div",{className:v().articleMeta,children:[(0,r.jsxs)("div",{className:v().authorInfo,children:[(0,r.jsx)("div",{className:v().authorAvatar,children:a.authorName.charAt(0)}),(0,r.jsxs)("div",{className:v().authorDetails,children:[(0,r.jsx)("div",{className:v().authorName,children:a.authorName}),(0,r.jsxs)("div",{className:v().articleDetails,children:[a.createdAt," \xb7 ",a.readTime," min read"]})]})]}),(0,r.jsxs)("div",{className:v().articleActions,children:[x&&N&&w?(0,r.jsx)(u,{externalId:w,source:N,title:a.title,url:y||"",initialLikes:i,className:v().likeButton,styles:v()}):(0,r.jsx)(c.A,{articleId:e,initialLikes:i,className:v().likeButton,styles:v()}),s&&a.authorId===s.uid&&(0,r.jsx)("button",{className:v().editButton,onClick:o,children:"Edit"})]})]}),a.tags&&a.tags.length>0&&(0,r.jsx)("div",{className:v().tagContainer,children:a.tags.map((e,t)=>(0,r.jsx)("span",{className:v().tag,children:e},t))})]}),(0,r.jsx)(n,{articleId:e,articleHtml:t,isAuthenticated:l,articleTitle:d,articleSlug:m,hasReflectionRoom:a?.hasReflectionRoom||!1,moodFeatureEnabled:p,onToggleMoodFeature:f,mood:g})]}),(e,t)=>e.articleId===t.articleId&&e.articleHtml===t.articleHtml&&e.article?.title===t.article?.title&&e.article?.authorName===t.article?.authorName&&e.article?.createdAt===t.article?.createdAt&&e.article?.readTime===t.article?.readTime&&e.article?.authorId===t.article?.authorId&&e.article?.hasReflectionRoom===t.article?.hasReflectionRoom&&e.isAuthenticated===t.isAuthenticated&&e.currentUser?.uid===t.currentUser?.uid&&e.articleTitle===t.articleTitle&&e.articleSlug===t.articleSlug&&e.moodFeatureEnabled===t.moodFeatureEnabled&&e.mood===t.mood&&e.isExternal===t.isExternal&&e.externalSource===t.externalSource&&e.externalId===t.externalId&&e.externalUrl===t.externalUrl&&e.onEditClick===t.onEditClick&&e.onToggleMoodFeature===t.onToggleMoodFeature)},70814:(e,t,a)=>{"use strict";a.d(t,{r:()=>s});var r=a(75535),i=a(43649);class s{static async getOrCreateSocialData(e,t,a,s){try{let l=encodeURIComponent(e),n=`${t}-${l}`,c=(0,r.doc)(i.db,"external_articles",n),o=await (0,r.getDoc)(c);if(o.exists())return{id:n,...o.data()};{let i={externalId:e,source:t,title:a,url:s,likes:[],createdAt:(0,r.serverTimestamp)(),lastActivity:(0,r.serverTimestamp)()};return await (0,r.setDoc)(c,i),{id:n,...i}}}catch(e){throw console.error("Error getting or creating social data:",e),e}}static async toggleLike(e,t,a,s,l){try{let n=encodeURIComponent(e),c=`${t}-${n}`,o=(0,r.doc)(i.db,"external_articles",c);await this.getOrCreateSocialData(e,t,s,l);let d=(await (0,r.getDoc)(o)).data().likes||[];if(d.includes(a))return await (0,r.updateDoc)(o,{likes:(0,r.arrayRemove)(a),lastActivity:(0,r.serverTimestamp)()}),{isLiked:!1,totalLikes:d.length-1};return await (0,r.updateDoc)(o,{likes:(0,r.arrayUnion)(a),lastActivity:(0,r.serverTimestamp)()}),{isLiked:!0,totalLikes:d.length+1}}catch(e){throw console.error("Error toggling like:",e),e}}static async getSocialData(e,t){try{let a=encodeURIComponent(e),s=`${t}-${a}`,l=(0,r.doc)(i.db,"external_articles",s),n=await (0,r.getDoc)(l);if(n.exists())return{id:s,...n.data()};return null}catch(e){return console.error("Error getting social data:",e),null}}}},85625:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(60687),i=a(43210),s=a.n(i),l=a(43649);let n=s().memo(({articleId:e,initialLikes:t=[],className:s="",styles:n={}})=>{let[c,o]=(0,i.useState)(t),[d,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(null),[v,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=l.j2.onAuthStateChanged(e=>{m(e),e?u(c.includes(e.uid)):u(!1)});return()=>e()},[c]),(0,i.useEffect)(()=>{o(t),h&&u(t.includes(h.uid))},[t,h]);let f=async t=>{if(t.preventDefault(),t.stopPropagation(),!h)return void alert("Please login to like articles");p(!0),setTimeout(()=>p(!1),300);try{if(d){let t=c.filter(e=>e!==h.uid);o(t),u(!1);let{doc:r,updateDoc:i,arrayRemove:s}=await Promise.resolve().then(a.bind(a,75535)),{db:l}=await Promise.resolve().then(a.bind(a,43649)),n=r(l,"articles",e);await i(n,{likes:s(h.uid)})}else{let t=[...c,h.uid];o(t),u(!0);let{doc:r,updateDoc:i,arrayUnion:s}=await Promise.resolve().then(a.bind(a,75535)),{db:l}=await Promise.resolve().then(a.bind(a,43649)),n=r(l,"articles",e);await i(n,{likes:s(h.uid)})}}catch(e){console.error("Error updating like status:",e),d?(o([...c,h.uid]),u(!0)):(o(c.filter(e=>e!==h.uid)),u(!1))}};return(0,r.jsxs)("button",{className:`${s} ${d?n.liked:""}`,onClick:f,"aria-label":d?"Unlike article":"Like article",style:{transition:"all 0.3s ease",transform:v?"scale(1.2)":"scale(1)"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:d?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",className:n.likeIcon,style:{transition:"all 0.3s ease",filter:v?"drop-shadow(0 0 8px currentColor)":"none"},children:(0,r.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),(0,r.jsx)("span",{children:c.length>0?c.length:""})]})})}};