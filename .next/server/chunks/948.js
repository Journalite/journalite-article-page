exports.id=948,exports.ids=[948],exports.modules={663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let r=n(71866);class i{static createInsecure(){return new s}static createSsl(e,t,n=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof n)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let n=t[e];if(null===n||"object"!=typeof n)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(n.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(n.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(n.cert_chain),s.push(n.private_key)}return new a({ca:e||(0,r.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:n,ciphers:r.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},3076:(e,t,n)=>{"use strict";e.exports=o;var r=n(77968);((o.prototype=Object.create(r.prototype)).constructor=o).className="Service";var i=n(71202),s=n(93107),a=n(27236);function o(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var n=new o(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),s=0;s<r.length;++s)n.add(i.fromJSON(r[s],t.methods[r[s]]));return t.nested&&n.addJSON(t.nested),t.edition&&(n._edition=t.edition),n.comment=t.comment,n._defaultEdition="proto3",n},o.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},o.prototype.resolveAll=function(){r.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,r.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):r.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return r.prototype.remove.call(this,e)},o.prototype.create=function(e,t,n){for(var r,i=new a.Service(e,t,n),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((r=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},4189:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=n(20920),s=n(93122),a=n(70155),o=n(43801),l=n(30598),u=n(4976),c=n(70757),h=n(98387),d=n(58880),f=n(63038),p="outlier_detection";function m(e){f.trace(s.LogVerbosity.DEBUG,p,e)}let g="outlier_detection",y=(null!=(r=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?r:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function T(e,t,n,r){if(t in e&&typeof e[t]!==n){let i=r?`${r}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${n}, got ${typeof e[t]}`)}}function S(e,t,n){let r=n?`${n}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function w(e,t,n){let r=n?`${n}.${t}`:t;if(T(e,t,"number",n),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}class E{constructor(e,t,n,r,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=n?n:3e5,this.maxEjectionPercent=null!=r?r:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new E(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(S(e,"interval"),S(e,"base_ejection_time"),S(e,"max_ejection_time"),w(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");T(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),w(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),T(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),T(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");w(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),w(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),T(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),T(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new E(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=E;class C extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,n,r)=>{if(this.childSubchannelState=n,!this.ejected)for(let e of this.stateListeners)e(this,t,n,r)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function I(){return{success:0,failure:0}}class _{constructor(){this.activeBucket=I(),this.inactiveBucket=I()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=I()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class A{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,n=e.getMapEntry();if(!n)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let r=t.onCallEnded;return this.countCalls&&(r=e=>{var r;e===s.Status.OK?n.counter.addSuccess():n.counter.addFailure(),null==(r=t.onCallEnded)||r.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:r})}}}}class k{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,n)=>{let r=e.createSubchannel(t,n),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new C(r,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,n)=>{t===i.ConnectivityState.READY?e.updateState(t,new A(n,this.isCountingEnabled())):e.updateState(t,n)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let n=t.request_volume,r=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+n),s+a>=n&&(r+=1,i.push(s/(s+a)))}if(m("Found "+r+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),r<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[r,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<n)continue;let o=s/(s+a);if(m("Checking candidate "+r+" successRate="+o),o<l){let n=100*Math.random();m("Candidate "+r+" randomNumber="+n+" enforcement_percentage="+t.enforcement_percentage),n<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let n=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(n+=1);if(!(n<t.minimum_hosts))for(let[n,r]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=r.counter.getLastSuccesses(),s=r.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+n+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(r,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,n;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(n=(t=this.ejectionTimer).unref)||n.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,n]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===n.currentEjectionTimestamp)n.ejectionTimeMultiplier>0&&(n.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),r=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(n.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*n.ejectionTimeMultiplier,Math.max(e,r))),i<new Date&&(m("Unejecting "+t),this.uneject(n))}}updateAddressList(e,t,n){if(!(t instanceof E))return;let r=new Set;for(let t of e)r.add((0,h.subchannelAddressToString)(t));for(let e of r)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new _,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())r.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,n),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}t.OutlierDetectionLoadBalancer=k,t.setup=function(){y&&(0,o.registerLoadBalancerType)(g,k,E)}},4231:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(91645),i=n(93122),s=n(99978),a=n(98605),o=n(57213),l=n(63038),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",f=443;class p{constructor(e,t,n){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(e.scheme!==h&&e.scheme!==d){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let n=(0,o.splitHostPort)(t);if(null===n||e.scheme===h&&!(0,r.isIPv4)(n.host)||e.scheme===d&&!(0,r.isIPv6)(n.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:n.host,port:null!=(a=n.port)?a:f})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}t.setup=function(){(0,a.registerResolver)(h,p),(0,a.registerResolver)(d,p)}},4976:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let r=n(30598),i=n(20920),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var n;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(n=this.parent.currentChild)||n.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,n){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),n=(0,r.createLoadBalancer)(t,e);e.setChild(n),null===this.currentChild?(this.currentChild=n,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=n,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,n)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},6601:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let r=n(30598),i=n(20920),s=n(70757),a=n(63038),o=n(93122),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=d;class f{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function p(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t}t.shuffled=p;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,n,r,i)=>{this.onSubchannelStateUpdate(e,t,n,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new f(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,n,r){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){n!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){n===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),n===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,r&&(this.lastError=r),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,n]of this.children.entries())if(t>=e){let e=n.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,n;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(n=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)?void 0:n.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=p(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}t.PickFirstLoadBalancer=m,t.setup=function(){(0,r.registerLoadBalancerType)(c,m,d),(0,r.registerDefaultLoadBalancerType)(c)}},8707:function(e,t,n){"use strict";var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(75108),r.base64=n(35108),r.EventEmitter=n(84553),r.float=n(13127),r.inquire=n(89644),r.utf8=n(61996),r.pool=n(83273),r.LongBits=n(31156),r.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!!(null!=n&&e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;if(!e){r._Buffer_from=r._Buffer_allocUnsafe=null;return}r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},8920:(e,t,n)=>{"use strict";e.exports=i;var r=n(8707);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},10178:(e,t,n)=>{"use strict";let r,i,s,a;var o=n(31305),l=n(88060),u=n(52122),c=n(35545),h=n(62432);let d="@firebase/installations",f="0.6.13",p=1e4,m=`w:${f}`,g="FIS_v2",y="https://firebaseinstallations.googleapis.com/v1",v=36e5,b="installations",T="Installations",S={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},w=new u.FA(b,T,S);function E(e){return e instanceof u.g&&e.code.includes("request-failed")}function C({projectId:e}){return`${y}/projects/${e}/installations`}function I(e){return{token:e.token,requestStatus:2,expiresIn:D(e.expiresIn),creationTime:Date.now()}}async function _(e,t){let n=(await t.json()).error;return w.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function A({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function k(e,{refreshToken:t}){let n=A(e);return n.append("Authorization",N(t)),n}async function R(e){let t=await e();return t.status>=500&&t.status<600?e():t}function D(e){return Number(e.replace("s","000"))}function N(e){return`${g} ${e}`}async function O({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let r=C(e),i=A(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({fid:n,authVersion:g,appId:e.appId,sdkVersion:m})},o=await R(()=>fetch(r,a));if(o.ok){let e=await o.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:I(e.authToken)}}throw await _("Create Installation",o)}function x(e){return new Promise(t=>{setTimeout(t,e)})}function P(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")}let M=/^[cdef][\w-]{21}$/,L="";function F(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=B(e);return M.test(t)?t:L}catch(e){return L}}function B(e){return P(e).substr(0,22)}function U(e){return`${e.appName}!${e.appId}`}let V=new Map;function j(e,t){let n=U(e);q(n,t),z(n,t)}function q(e,t){let n=V.get(e);if(n)for(let e of n)e(t)}function z(e,t){let n=K();n&&n.postMessage({key:e,fid:t}),$()}let G=null;function K(){return!G&&"BroadcastChannel"in self&&((G=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{q(e.data.key,e.data.fid)}),G}function $(){0===V.size&&G&&(G.close(),G=null)}let H="firebase-installations-database",W=1,Q="firebase-installations-store",Y=null;function J(){return Y||(Y=(0,h.P2)(H,W,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Q)}})),Y}async function X(e,t){let n=U(e),r=(await J()).transaction(Q,"readwrite"),i=r.objectStore(Q),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||j(e,t.fid),t}async function Z(e){let t=U(e),n=(await J()).transaction(Q,"readwrite");await n.objectStore(Q).delete(t),await n.done}async function ee(e,t){let n=U(e),r=(await J()).transaction(Q,"readwrite"),i=r.objectStore(Q),s=await i.get(n),a=t(s);return void 0===a?await i.delete(n):await i.put(a,n),await r.done,a&&(!s||s.fid!==a.fid)&&j(e,a.fid),a}async function et(e){let t,n=await ee(e.appConfig,n=>{let r=er(e,en(n));return t=r.registrationPromise,r.installationEntry});return n.fid===L?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function en(e){return eo(e||{fid:F(),registrationStatus:0})}function er(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(w.create("app-offline"))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=ei(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:es(e)}:{installationEntry:t}}async function ei(e,t){try{let n=await O(e,t);return X(e.appConfig,n)}catch(n){throw E(n)&&409===n.customData.serverCode?await Z(e.appConfig):await X(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function es(e){let t=await ea(e.appConfig);for(;1===t.registrationStatus;)await x(100),t=await ea(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await et(e);return n||t}return t}function ea(e){return ee(e,e=>{if(!e)throw w.create("installation-not-found");return eo(e)})}function eo(e){return el(e)?{fid:e.fid,registrationStatus:0}:e}function el(e){return 1===e.registrationStatus&&e.registrationTime+p<Date.now()}async function eu({appConfig:e,heartbeatServiceProvider:t},n){let r=ec(e,n),i=k(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:m,appId:e.appId}})},o=await R(()=>fetch(r,a));if(o.ok)return I(await o.json());throw await _("Generate Auth Token",o)}function ec(e,{fid:t}){return`${C(e)}/${t}/authTokens:generate`}async function eh(e,t=!1){let n,r=await ee(e.appConfig,r=>{if(!em(r))throw w.create("not-registered");let i=r.authToken;if(!t&&eg(i))return r;if(1===i.requestStatus)return n=ed(e,t),r;{if(!navigator.onLine)throw w.create("app-offline");let t=ev(r);return n=ep(e,t),t}});return n?await n:r.authToken}async function ed(e,t){let n=await ef(e.appConfig);for(;1===n.authToken.requestStatus;)await x(100),n=await ef(e.appConfig);let r=n.authToken;return 0===r.requestStatus?eh(e,t):r}function ef(e){return ee(e,e=>{if(!em(e))throw w.create("not-registered");return eb(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ep(e,t){try{let n=await eu(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await X(e.appConfig,r),n}catch(n){if(E(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await Z(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await X(e.appConfig,n)}throw n}}function em(e){return void 0!==e&&2===e.registrationStatus}function eg(e){return 2===e.requestStatus&&!ey(e)}function ey(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+v}function ev(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function eb(e){return 1===e.requestStatus&&e.requestTime+p<Date.now()}async function eT(e){let t=e,{installationEntry:n,registrationPromise:r}=await et(t);return r?r.catch(console.error):eh(t).catch(console.error),n.fid}async function eS(e,t=!1){let n=e;return await ew(n),(await eh(n,t)).token}async function ew(e){let{registrationPromise:t}=await et(e);t&&await t}function eE(e,{fid:t}){return`${C(e)}/${t}`}function eC(e){if(!e||!e.options)throw eI("App Configuration");if(!e.name)throw eI("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw eI(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function eI(e){return w.create("missing-app-config-values",{valueName:e})}let e_="installations",eA="installations-internal",ek=e=>{let t=e.getProvider("app").getImmediate(),n=eC(t),r=(0,o.j6)(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},eR=e=>{let t=e.getProvider("app").getImmediate(),n=(0,o.j6)(t,e_).getImmediate();return{getId:()=>eT(n),getToken:e=>eS(n,e)}};(function(){(0,o.om)(new c.uA(e_,ek,"PUBLIC")),(0,o.om)(new c.uA(eA,eR,"PRIVATE"))})(),(0,o.KO)(d,f),(0,o.KO)(d,f,"esm2017");let eD="analytics",eN="firebase_id",eO="origin",ex=6e4,eP="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",eM="https://www.googletagmanager.com/gtag/js",eL=new l.Vy("@firebase/analytics"),eF={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},eB=new u.FA("analytics","Analytics",eF);function eU(e){if(!e.startsWith(eM)){let t=eB.create("invalid-gtag-resource",{gtagURL:e});return eL.warn(t.message),""}return e}function eV(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function ej(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}function eq(e,t){let n=ej("firebase-js-sdk-policy",{createScriptURL:eU}),r=document.createElement("script"),i=`${eM}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function ez(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function eG(e,t,n,r,i,s){let a=r[i];try{if(a)await t[a];else{let e=(await eV(n)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){eL.error(e)}e("config",i,s)}async function eK(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let r=await eV(n);for(let n of e){let e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(i)s.push(i);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){eL.error(e)}}function e$(e,t,n,r){return async function(i,...s){try{if("event"===i){let[r,i]=s;await eK(e,t,n,r,i)}else if("config"===i){let[i,a]=s;await eG(e,t,n,r,i,a)}else if("consent"===i){let[t,n]=s;e("consent",t,n)}else if("get"===i){let[t,n,r]=s;e("get",t,n,r)}else if("set"===i){let[t]=s;e("set",t)}else e(i,...s)}catch(e){eL.error(e)}}}function eH(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=e$(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}function eW(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(eM)&&t.src.includes(e))return t;return null}let eQ=30,eY=1e3;class eJ{constructor(e={},t=eY){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let eX=new eJ;function eZ(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function e0(e){var t;let{appId:n,apiKey:r}=e,i={method:"GET",headers:eZ(r)},s=eP.replace("{app-id}",n),a=await fetch(s,i);if(200!==a.status&&304!==a.status){let e="";try{let n=await a.json();(null==(t=n.error)?void 0:t.message)&&(e=n.error.message)}catch(e){}throw eB.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}async function e1(e,t=eX,n){let{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw eB.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw eB.create("no-api-key")}let a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new e5;return setTimeout(async()=>{o.abort()},void 0!==n?n:ex),e2({appId:r,apiKey:i,measurementId:s},a,o,t)}async function e2(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=eX){var s;let{appId:a,measurementId:o}=e;try{await e3(r,t)}catch(e){if(o)return eL.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:a,measurementId:o};throw e}try{let t=await e0(e);return i.deleteThrottleMetadata(a),t}catch(h){let t=h;if(!e6(t)){if(i.deleteThrottleMetadata(a),o)return eL.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:a,measurementId:o};throw h}let l=503===Number(null==(s=null==t?void 0:t.customData)?void 0:s.httpStatus)?(0,u.p9)(n,i.intervalMillis,eQ):(0,u.p9)(n,i.intervalMillis),c={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return i.setThrottleMetadata(a,c),eL.debug(`Calling attemptFetch again in ${l} millis`),e2(e,c,r,i)}}function e3(e,t){return new Promise((n,r)=>{let i=setTimeout(n,Math.max(t-Date.now(),0));e.addEventListener(()=>{clearTimeout(i),r(eB.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function e6(e){if(!(e instanceof u.g)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class e5{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function e4(e,t,n,r,i){if(i&&i.global)return void e("event",n,r);{let i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}function e8(e){i=e}function e7(e){r=e}async function e9(){if(!(0,u.zW)())return eL.warn(eB.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await (0,u.eX)()}catch(e){return eL.warn(eB.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function te(e,t,n,s,a,o,l){var u;let c=e1(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&eL.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>eL.error(e)),t.push(c);let h=e9().then(e=>e?s.getId():void 0),[d,f]=await Promise.all([c,h]);eW(o)||eq(o,d.measurementId),i&&(a("consent","default",i),e8(void 0)),a("js",new Date);let p=null!=(u=null==l?void 0:l.config)?u:{};return p[eO]="firebase",p.update=!0,null!=f&&(p[eN]=f),a("config",d.measurementId,p),r&&(a("set",r),e7(void 0)),d.measurementId}class tt{constructor(e){this.app=e}_delete(){return delete tn[this.app.options.appId],Promise.resolve()}}let tn={},tr=[],ti={},ts="dataLayer",ta="gtag",to=!1;function tl(){let e=[];if((0,u.sr)()&&e.push("This is a browser extension environment."),(0,u.dM)()||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=eB.create("invalid-analytics-context",{errorInfo:t});eL.warn(n.message)}}function tu(e,t,n){tl();let r=e.options.appId;if(!r)throw eB.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)eL.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw eB.create("no-api-key");if(null!=tn[r])throw eB.create("already-exists",{id:r});if(!to){ez(ts);let{wrappedGtag:e,gtagCore:t}=eH(tn,tr,ti,ts,ta);a=e,s=t,to=!0}return tn[r]=te(e,tr,ti,t,s,ts,n),new tt(e)}function tc(e,t,n,r){e=(0,u.Ku)(e),e4(a,tn[e.app.options.appId],t,n,r).catch(e=>eL.error(e))}let th="@firebase/analytics",td="0.10.12";!function(){function e(e){try{let t=e.getProvider(eD).getImmediate();return{logEvent:(e,n,r)=>tc(t,e,n,r)}}catch(e){throw eB.create("interop-component-reg-failed",{reason:e})}}(0,o.om)(new c.uA(eD,(e,{options:t})=>tu(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),(0,o.om)(new c.uA("analytics-internal",e,"PRIVATE")),(0,o.KO)(th,td),(0,o.KO)(th,td,"esm2017")}()},10561:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let r=n(18735),i=n(32090),s=n(98387),a=n(57213),o=n(96202),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let n=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());n.length>0&&(e=!1),this.pool[t]=n}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,n,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,r.channelOptionsEqual)(n,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,n,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:n,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;let c=new u;t.getSubchannelPool=function(e){return e?c:new u}},12630:(e,t,n)=>{"use strict";e.exports=a;var r=n(64824);((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=n(73267),s=n(93107);function a(e,t,n,i){if(Array.isArray(t)||(n=t,t=void 0),r.call(this,e,n),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=this,n=0;n<this.oneof.length;++n){var i=e.get(this.oneof[n]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){s.decorateType(t.constructor).add(new a(n,e)),Object.defineProperty(t,n,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},13127:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?!function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function o(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?a:o,e.readFloatBE=r?o:a}():!function(){function t(e,t,n,r){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,n,r);else if(isNaN(t))e(0x7fc00000,n,r);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,n,r)}}function a(e,t,n){var r=e(t,n),i=(r>>31)*2+1,s=r>>>23&255,a=8388607&r;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?!function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function o(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?a:o,e.readDoubleBE=r?o:a}():!function(){function t(e,t,n,r,i,s){var a,o=+(r<0);if(o&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:0x80000000,i,s+n);else if(isNaN(r))e(0,i,s+t),e(0x7ff80000,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+n);else if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=r*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}function a(e,t,n,r,i){var s=e(r,i+t),a=e(r,i+n),o=(a>>31)*2+1,l=a>>>20&2047,u=0x100000000*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+0x10000000000000)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},14778:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let r=n(93122),i=n(99978),s=n(63038),a="retrying_call";class o{constructor(e,t,n){this.maxTokens=e,this.tokenRatio=t,n?this.tokens=n.tokens*(e/n.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var n;let r=null!=(n=this.allocatedPerCall.get(t))?n:0;return!(this.limitPerCall-r<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,r+e),this.totalAllocated+=e,!0)}free(e,t){var n;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let r=null!=(n=this.allocatedPerCall.get(t))?n:0;if(r<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${r}`);this.allocatedPerCall.set(t,r-e)}freeAll(e){var t;let n=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<n)throw Error(`Invalid buffer allocation state: call ${e} allocated ${n} > total allocated ${this.totalAllocated}`);this.totalAllocated-=n,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,n,r,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(r.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:n}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))n.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(r.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[n,r]of this.underlyingCalls.entries())"ACTIVE"===r.state&&r.nextMessageToSend>e&&(e=r.nextMessageToSend,t=n);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===r.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let n=Math.random()*this.nextRetryBackoffSec*1e3,r=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,r),n}maybeRetryCall(e,t){let n;if("RETRY"!==this.state)return void t(!1);let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return void t(!1);if(null===e)n=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else n=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,n;if("RETRY"!==this.state)return void t(!1);(null==(n=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||n)&&(t(!0),this.attempts+=1,this.startNewAttempt())},n)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,n){var r,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(r=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?r:[],e.code)){let r;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===n)r=0;else if(n<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else r=n;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},r)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(n,n=>{n||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var n;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===r.Status.OK){null==(n=this.retryThrottler)||n.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,n;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let r=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(r.maxAttempts,5))return;let i=null!=(e=r.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(n=(t=this.hedgingTimer).unref)||n.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let n=this.attempts-1,r=this.initialMetadata.clone();n>0&&r.set(u,`${n}`);let i=!1;e.start(r,{onReceiveMetadata:r=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,n>0&&r.set(u,`${n}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(r)},onReceiveMessage:n=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(n)},onReceiveStatus:r=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&n>0&&r.metadata.set(u,`${n}`),this.handleChildStatus(r,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,n;let r=this.underlyingCalls[e],i=r.nextMessageToSend;null==(n=(t=this.getBufferEntry(i)).callback)||n.call(t),this.clearSentMessages(),r.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let n=this.getBufferEntry(t.nextMessageToSend);switch(n.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},n.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var n;this.trace("write() called with message of length "+t.length);let r={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:r,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[r,s]of(null==(n=e.callback)||n.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(r)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let n=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===n.state&&n.nextMessageToSend===i&&n.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},16497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let n=0;t.getNextCallNumber=function(){return n++}},16973:(e,t,n)=>{"use strict";e.exports=l;var r=n(32110),i=n(93107);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,n,i){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n=e.oneofsArray,r={};n.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===r[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),r[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},17757:(e,t,n)=>{"use strict";e.exports=s;var r=n(75108),i=n(89644)("fs");function s(e,t,n){return("function"==typeof t?(n=t,t={}):t||(t={}),n)?!t.xhr&&i&&i.readFile?i.readFile(e,function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,n):r(s,this,e,t)}s.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)}},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},17819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class n{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=n},18735:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=function(e,t){let n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let i=0;i<n.length;i+=1)if(n[i]!==r[i]||e[n[i]]!==t[r[i]])return!1;return!0}},19780:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let n=[];t.registerAdminService=function(e,t){n.push({getServiceDefinition:e,getHandlers:t})},t.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:r}of n)e.addService(t(),r())}},20040:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},20653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class n{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=n},20920:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(n||(t.ConnectivityState=n={}))},22487:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let r=n(21820),i=n(93122),s=n(30598),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let n={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)n.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");n.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");n.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let r=e.timeout.substring(0,e.timeout.length-1).split(".");n.timeout={seconds:0|r[0],nanos:(null!=(t=r[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");n.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else n.retryPolicy=u(e.retryPolicy);else"hedgingPolicy"in e&&(n.hedgingPolicy=c(e.hedgingPolicy));return n}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function f(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let n of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(n));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let n of e.methodConfig)t.methodConfig.push(h(n));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let n=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of n)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);n.push(t)}return t}function p(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:f(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let n of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof n)t.clientLanguage.push(n);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let n of(t.clientHostname=[],e.clientHostname))if("string"==typeof n)t.clientHostname.push(n);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let n=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!n.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let n of e){let e=p(n);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let n of e.clientHostname)n===r.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let n of e.clientLanguage)n===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}t.validateRetryThrottling=d,t.validateServiceConfig=f,t.extractAndSelectServiceConfig=function(e,t){for(let n of e)if(n.length>0&&n[0].startsWith("grpc_config="))return m(JSON.parse(n.join("").substring(12)),t);return null}},25585:(e,t,n)=>{"use strict";e.exports=a;var r=n(73267);((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=n(61810),s=n(93107);function a(e,t,n,i,a,o){if(r.call(this,e,t,i,void 0,void 0,a,o),!s.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(e,t,n){return"function"==typeof n?n=s.decorateType(n).name:n&&"object"==typeof n&&(n=s.decorateEnum(n).name),function(r,i){s.decorateType(r.constructor).add(new a(i,e,t,n))}}},25678:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(n||(n={}));class r{constructor(e){this.maxReadMessageLength=e,this.readState=n.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,r=0,i=[];for(;r<e.length;)switch(this.readState){case n.NO_DATA:this.readCompressFlag=e.slice(r,r+1),r+=1,this.readState=n.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case n.READING_SIZE:if(t=Math.min(e.length-r,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,r,r+t),this.readSizeRemaining-=t,r+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=n.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=n.NO_DATA,i.push(e)}}break;case n.READING_MESSAGE:if(t=Math.min(e.length-r,this.readMessageRemaining),this.readPartialMessage.push(e.slice(r,r+t)),this.readMessageRemaining-=t,r+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=n.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=r},26996:(e,t,n)=>{"use strict";e.exports=l;var r,i=n(8707),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var r=i.Buffer;return r?r.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},27236:(e,t,n)=>{"use strict";t.Service=n(86984)},27408:(e,t,n)=>{"use strict";e.exports=C,C.filename=null,C.defaults={keepCase:!1};var r=n(60158),i=n(82703),s=n(54351),a=n(73267),o=n(25585),l=n(12630),u=n(32110),c=n(3076),h=n(71202),d=n(64824),f=n(61810),p=n(93107),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,T=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,w=/^[a-zA-Z_][a-zA-Z_0-9]*$/,E=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function C(e,t,n){t instanceof i||(n=t,t=new i),n||(n=C.defaults);var I,_,A,k,R=n.preferTrailingComment||!1,D=r(e,n.alternateCommentMode||!1),N=D.next,O=D.push,x=D.peek,P=D.skip,M=D.cmnt,L=!0,F="proto2",B=t,U=[],V={},j=n.keepCase?function(e){return e}:p.camelCase;function q(){U.forEach(e=>{e._edition=F,Object.keys(V).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,V[t],!0)})})}function z(e,t,n){var r=C.filename;return n||(C.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(r?r+", ":"")+"line "+D.line+")")}function G(){var e,t=[];do{if('"'!==(e=N())&&"'"!==e)throw z(e);t.push(N()),P(e),e=x()}while('"'===e||"'"===e);return t.join("")}function K(e){var t=N();switch(t){case"'":case'"':return O(t),G();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return H(t,!0)}catch(n){if(e&&E.test(t))return t;throw z(t,"value")}}function $(e,t){do if(t&&('"'===(n=x())||"'"===n)){var n,r,i=G();if(e.push(i),F>=2023)throw z(i,"id")}else try{e.push([r=W(N()),P("to",!0)?W(N()):r])}catch(r){if(t&&E.test(n)&&F>=2023)e.push(n);else throw r}while(P(",",!0));var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)})}function H(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*n;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return n*parseInt(e,10);if(y.test(e))return n*parseInt(e,16);if(b.test(e))return n*parseInt(e,8);if(S.test(e))return n*parseFloat(e);throw z(e,"number",t)}function W(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw z(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(T.test(e))return parseInt(e,8);throw z(e,"id")}function Q(){if(void 0!==_)throw z("package");if(_=N(),!E.test(_))throw z(_,"name");B=B.define(_),P(";")}function Y(){var e,t=x();switch(t){case"weak":e=k||(k=[]),N();break;case"public":N();default:e=A||(A=[])}t=G(),P(";"),e.push(t)}function J(){if(P("="),(F=G())<2023)throw z(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=G()))throw z(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ef(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,n){var r,i=D.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=C.filename),P("{",!0)){for(;"}"!==(r=N());)t(r);P(";",!0)}else n&&n(),P(";"),e&&("string"!=typeof e.comment||R)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!w.test(t=N()))throw z(t,"type name");var n=new s(t);ee(n,function(e){if(!Z(n,e))switch(e){case"map":ei(n,e);break;case"required":if("proto2"!==F)throw z(e);case"repeated":en(n,e);break;case"optional":if("proto3"===F)en(n,"proto3_optional");else if("proto2"!==F)throw z(e);else en(n,"optional");break;case"oneof":es(n,e);break;case"extensions":$(n.extensions||(n.extensions=[]));break;case"reserved":$(n.reserved||(n.reserved=[]),!0);break;default:if("proto2"===F||!E.test(e))throw z(e);O(e),en(n,"optional")}}),e.add(n),e===B&&U.push(n)}function en(e,t,n){var r=N();if("group"===r)return void er(e,t);for(;r.endsWith(".")||x().startsWith(".");)r+=N();if(!E.test(r))throw z(r,"type");var i=N();if(!w.test(i))throw z(i,"name");i=j(i),P("=");var s=new a(i,W(N()),r,t,n);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw z(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&U.push(s)}function er(e,t){if(F>=2023)throw z("group");var n=N();if(!w.test(n))throw z(n,"name");var r=p.lcFirst(n);n===r&&(n=p.ucFirst(n)),P("=");var i=W(N()),o=new s(n);o.group=!0;var l=new a(r,i,n,t);l.filename=C.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":en(o,e);break;case"optional":"proto3"===F?en(o,"proto3_optional"):en(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;default:throw z(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=N();if(void 0===f.mapKey[t])throw z(t,"type");P(",");var n=N();if(!E.test(n))throw z(n,"type");P(">");var r=N();if(!w.test(r))throw z(r,"name");P("=");var i=new o(j(r),W(N()),t,n);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw z(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!w.test(t=N()))throw z(t,"name");var n=new l(j(t));ee(n,function(e){"option"===e?(el(n,e),P(";")):(O(e),en(n,"optional"))}),e.add(n)}function ea(e,t){if(!w.test(t=N()))throw z(t,"name");var n=new u(t);ee(n,function(e){switch(e){case"option":el(n,e),P(";");break;case"reserved":$(n.reserved||(n.reserved=[]),!0),void 0===n.reserved&&(n.reserved=[]);break;default:eo(n,e)}}),e.add(n),e===B&&U.push(n)}function eo(e,t){if(!w.test(t))throw z(t,"name");P("=");var n=W(N(),!0),r={options:void 0};r.getOption=function(e){return this.options[e]},r.setOption=function(e,t){d.prototype.setOption.call(r,e,t)},r.setParsedOption=function(){},ee(r,function(e){if("option"===e)el(r,e),P(";");else throw z(e)},function(){ed(r)}),e.add(t,n,r.comment,r.parsedOptions||r.options)}function el(e,t){var n,r,i=!0;for("option"===t&&(t=N());"="!==t;){if("("===t){var s=N();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");n=a[0]+".",t=a[1];continue}n=t}else r=r?r+=t:t;t=N()}var o=eu(e,r?n.concat(r):n);r=r&&"."===r[0]?r.slice(1):r,eh(e,n=n&&"."===n[n.length-1]?n.slice(0,-1):n,o,r)}function eu(e,t){if(P("{",!0)){for(var n={};!P("}",!0);){if(!w.test(I=N()))throw z(I,"name");if(null===I)throw z(I,"end of input");var r,i,s=I;if(P(":",!0),"{"===x())r=eu(e,t+"."+I);else if("["===x()){if(r=[],P("[",!0)){do i=K(!0),r.push(i);while(P(",",!0));P("]"),void 0!==i&&ec(e,t+"."+I,i)}}else r=K(!0),ec(e,t+"."+I,r);var a=n[s];a&&(r=[].concat(a).concat(r)),n[s]=r,P(",",!0),P(";",!0)}return n}var o=K(!0);return ec(e,t,o),o}function ec(e,t,n){if(B===e&&/^features\./.test(t)){V[t]=n;return}e.setOption&&e.setOption(t,n)}function eh(e,t,n,r){e.setParsedOption&&e.setParsedOption(t,n,r)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0));P("]")}return e}function ef(e,t){if(!w.test(t=N()))throw z(t,"service name");var n=new c(t);ee(n,function(e){if(!Z(n,e))if("rpc"===e)ep(n,e);else throw z(e)}),e.add(n),e===B&&U.push(n)}function ep(e,t){var n=M(),r=t;if(!w.test(t=N()))throw z(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!E.test(t=N())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!E.test(t=N())))throw z(t);a=t,P(")");var u=new h(l,r,i,a,s,o);u.comment=n,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw z(e)}),e.add(u)}function em(e,t){if(!E.test(t=N()))throw z(t,"reference");var n=t;ee(null,function(t){switch(t){case"required":case"repeated":en(e,t,n);break;case"optional":"proto3"===F?en(e,"proto3_optional",n):en(e,"optional",n);break;default:if("proto2"===F||!E.test(t))throw z(t);O(t),en(e,"optional",n)}})}for(;null!==(I=N());)switch(I){case"package":if(!L)throw z(I);Q();break;case"import":if(!L)throw z(I);Y();break;case"syntax":if(!L)throw z(I);J();break;case"edition":if(!L)throw z(I);X();break;case"option":el(B,I),P(";",!0);break;default:if(Z(B,I)){L=!1;continue}throw z(I)}return q(),C.filename=null,{package:_,imports:A,weakImports:k,root:t}}},27603:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let r=n(29021),i=n(33873),s=n(68474);function a(e,t){let n=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return r.accessSync(t,r.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),n(e,s)}}t.loadProtosWithOptions=async function(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(n,t.includeDirs)}let r=await n.load(e,t);return r.resolveAll(),r},t.loadProtosWithOptionsSync=function(e,t){let n=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(n,t.includeDirs)}let r=n.loadSync(e,t);return r.resolveAll(),r},t.addCommonProtos=function(){let e=n(82566),t=n(20040),r=n(56271),i=n(96138);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",r.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},27748:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let r=n(30598),i=n(22487),s=n(20920),a=n(98605),o=n(70757),l=n(86693),u=n(93122),c=n(99978),h=n(63038),d=n(93122),f=n(57213),p=n(4976),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,n,r){for(let i of n.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,n,r){for(let i of n)if(v(e,t,i,r))return i;return null}function T(e){return function(t,n){var r,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(r=s[0])?r:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let n=b(a,o,e.methodConfig,t);if(n)return{methodConfig:n,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class S{constructor(e,t,n,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,n["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(n["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new p.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,n,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===n?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(n):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],h=(0,r.getFirstUsableConfig)(l,!0);if(null===h)return void this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:T(d))},onError:e=>{this.handleResolutionFailure(e)}},n);let f={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},f),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,f.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=S},30598:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=function(e,t){var n,r,i,s,a,o,l,u,c,h;return{createSubchannel:null!=(r=null==(n=t.createSubchannel)?void 0:n.bind(t))?r:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(u=null==(l=t.addChannelzChild)?void 0:l.bind(t))?u:e.addChannelzChild.bind(e),removeChannelzChild:null!=(h=null==(c=t.removeChannelzChild)?void 0:c.bind(t))?h:e.removeChannelzChild.bind(e)}};let n={},r=null;t.registerLoadBalancerType=function(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}},t.registerDefaultLoadBalancerType=function(e){r=e},t.createLoadBalancer=function(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null},t.isLoadBalancerNameRegistered=function(e){return e in n},t.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in n)return t;return t&&r?new n[r].LoadBalancingConfig:null},t.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}},30847:(e,t,n)=>{"use strict";e.exports=o;var r=n(32110),i=n(61810),s=n(93107);function a(e,t,n,r){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}function o(e){for(var t,n,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof r?"int32":u.type,d=i.basic[h];n="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,n):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,n),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",n,n),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",h,n)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",n),void 0===d?a(o,u,c,n+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,n)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,u.name),void 0===d?a(o,u,c,n):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,n))}return o("return w")}},30948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let r=n(74075),i=n(75280),s=n(93122),a=n(20653),o=n(63038),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let n=e;t&&(n=await this.compressMessage(n));let r=Buffer.allocUnsafe(n.length+5);return r.writeUInt8(+!!t,0),r.writeUInt32BE(n.length,1),n.copy(r,5),r}async readMessage(e){let t=1===e.readUInt8(0),n=e.slice(5);return t&&(n=await this.decompressMessage(n)),n}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let n=Buffer.allocUnsafe(e.length+5);return n.writeUInt8(0,0),n.writeUInt32BE(e.length,1),e.copy(n,5),n}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,n)=>{r.deflate(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{let i=0,a=[],o=r.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),n({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,n)=>{r.gzip(e,(e,r)=>{e?n(e):t(r)})})}decompressMessage(e){return new Promise((t,n)=>{let i=0,a=[],o=r.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),n({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class f extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function p(e,t){switch(e){case"identity":return new c;case"deflate":return new h(t);case"gzip":return new d(t);default:return new f(e)}}class m extends a.BaseFilter{constructor(e,t){var n,r;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(n=e["grpc.max_receive_message_length"])?n:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){let e=i.CompressionAlgorithms[a],n=null==(r=t.serverSupportedEncodingHeader)?void 0:r.split(",");(!n||n.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=p(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=p(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let n=e.get("grpc-accept-encoding")[0];return n&&(this.sharedFilterConfig.serverSupportedEncodingHeader=n,n.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let n,r=await e;return n=!(this.sendCompression instanceof c)&&((null!=(t=r.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(r.message,n),flags:r.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=g},30959:(e,t,n)=>{"use strict";g={value:!0},g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=t.ex=g=g=g=g=g=g=t.OS=t.z3=void 0;let r=n(35628);g={enumerable:!0,get:function(){return r.CallCredentials}};let i=n(83232);g={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=n(75280);g={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=n(20920);g={enumerable:!0,get:function(){return a.ConnectivityState}};let o=n(36551);g={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=n(40300);g={enumerable:!0,get:function(){return l.Client}};let u=n(93122);g={enumerable:!0,get:function(){return u.LogVerbosity}},g={enumerable:!0,get:function(){return u.Status}},g={enumerable:!0,get:function(){return u.Propagate}};let c=n(63038),h=n(63865);Object.defineProperty(t,"ex",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),g={enumerable:!0,get:function(){return h.makeClientConstructor}},g={enumerable:!0,get:function(){return h.makeClientConstructor}};let d=n(99978);Object.defineProperty(t,"OS",{enumerable:!0,get:function(){return d.Metadata}});let f=n(68048);g={enumerable:!0,get:function(){return f.Server}};let p=n(663);g={enumerable:!0,get:function(){return p.ServerCredentials}};let m=n(17819);g={enumerable:!0,get:function(){return m.StatusBuilder}},t.z3={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:r.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:r.CallCredentials.createFromGoogleCredential,createEmpty:r.CallCredentials.createEmpty},g=e=>e.close(),g=(e,t,n)=>e.waitForReady(t,n),g=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=(e,t,n)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=e=>{c.setLogger(e)},g=e=>{c.setLoggerVerbosity(e)};var g=e=>l.Client.prototype.getChannel.call(e),y=n(90441);g={enumerable:!0,get:function(){return y.ListenerBuilder}},g={enumerable:!0,get:function(){return y.RequesterBuilder}},g={enumerable:!0,get:function(){return y.InterceptingCall}},g={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=n(37216);g={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},g={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=n(19780);g={enumerable:!0,get:function(){return b.addAdminServicesToServer}},g=n(43801);let T=n(42319),S=n(73322),w=n(4231),E=n(6601),C=n(58570),I=n(4189),_=n(37216);(()=>{T.setup(),S.setup(),w.setup(),E.setup(),C.setup(),I.setup(),_.setup()})()},31156:(e,t,n)=>{"use strict";e.exports=i;var r=n(8707);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/0x100000000>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>0xffffffff&&(n=0,++r>0xffffffff&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e))if(!r.Long)return i.fromNumber(parseInt(e,10));else e=r.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+0x100000000*n)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},31305:(e,t,n)=>{"use strict";n.d(t,{KO:()=>N,MF:()=>A,Sx:()=>R,Us:()=>S,Wp:()=>k,j6:()=>T,om:()=>b,xZ:()=>w});var r=n(35545),i=n(88060),s=n(52122),a=n(62432);class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!l(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function l(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}let u="@firebase/app",c="0.11.4",h=new i.Vy("@firebase/app"),d="11.6.0",f="[DEFAULT]",p={[u]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},m=new Map,g=new Map,y=new Map;function v(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function b(e){let t=e.name;if(y.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(y.set(t,e),m.values()))v(n,e);for(let t of g.values())v(t,e);return!0}function T(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function S(e,t,n=f){T(e,t).clearInstance(n)}function w(e){return null!=e&&void 0!==e.settings}let E={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},C=new s.FA("app","Firebase",E);class I{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw C.create("app-deleted",{appName:this._name})}}function _(e,t){let n=(0,s.u)(e.split(".")[1]);return null===n?void console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?void console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):void(1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`))}let A=d;function k(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:f,automaticDataCollectionEnabled:!1},t),a=i.name;if("string"!=typeof a||!a)throw C.create("bad-app-name",{appName:String(a)});if(n||(n=(0,s.T9)()),!n)throw C.create("no-options");let o=m.get(a);if(o)if((0,s.bD)(n,o.options)&&(0,s.bD)(i,o.config))return o;else throw C.create("duplicate-app",{appName:a});let l=new r.h1(a);for(let e of y.values())l.addComponent(e);let u=new I(n,i,l);return m.set(a,u),u}function R(e=f){let t=m.get(e);if(!t&&e===f&&(0,s.T9)())return k();if(!t)throw C.create("no-app",{appName:e});return t}async function D(e){let t=!1,n=e.name;m.has(n)?(t=!0,m.delete(n)):g.has(n)&&0>=e.decRefCount()&&(g.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function N(e,t,n){var i;let s=null!=(i=p[e])?i:e;n&&(s+=`-${n}`);let a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){let e=[`Unable to register library "${s}" with version "${t}":`];a&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),h.warn(e.join(" "));return}b(new r.uA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}let O="firebase-heartbeat-database",x=1,P="firebase-heartbeat-store",M=null;function L(){return M||(M=(0,a.P2)(O,x,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(P)}catch(e){console.warn(e)}}}).catch(e=>{throw C.create("idb-open",{originalErrorMessage:e.message})})),M}async function F(e){try{let t=(await L()).transaction(P),n=await t.objectStore(P).get(U(e));return await t.done,n}catch(e){if(e instanceof s.g)h.warn(e.message);else{let t=C.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}async function B(e,t){try{let n=(await L()).transaction(P,"readwrite"),r=n.objectStore(P);await r.put(t,U(e)),await n.done}catch(e){if(e instanceof s.g)h.warn(e.message);else{let t=C.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});h.warn(t.message)}}}function U(e){return`${e.name}!${e.options.appId}`}let V=1024,j=30;class q{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new K(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=z();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>j){let e=H(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){h.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=z(),{heartbeatsToSend:n,unsentEntries:r}=G(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return h.warn(e),""}}}function z(){return new Date().toISOString().substring(0,10)}function G(e,t=V){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),$(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),$(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class K{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await F(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return B(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return B(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function $(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}function H(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}!function(e){b(new r.uA("platform-logger",e=>new o(e),"PRIVATE")),b(new r.uA("heartbeat",e=>new q(e),"PRIVATE")),N(u,c,""),N(u,c,"esm2017"),N("fire-js","")}("")},32090:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let r=n(20920),i=n(86693),s=n(63038),a=n(93122),o=n(57213),l=n(98387),u=n(37216),c="subchannel",h=0x7fffffff;class d{constructor(e,t,n,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=n,this.credentials=s,this.connector=a,this.connectivityState=r.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;let c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=n["grpc.keepalive_time_ms"])?o:-1,0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(n,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING):this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([r.ConnectivityState.READY],r.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([r.ConnectivityState.CONNECTING],r.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,n){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(r.ConnectivityState[this.connectivityState]+" -> "+r.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+r.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case r.ConnectivityState.READY:this.stopBackoff();break;case r.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case r.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case r.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,n);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([r.ConnectivityState.CONNECTING,r.ConnectivityState.READY],r.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,n,r){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,n,r,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([r.ConnectivityState.IDLE],r.ConnectivityState.CONNECTING)||this.connectivityState!==r.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([r.ConnectivityState.TRANSIENT_FAILURE],r.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=d},32110:(e,t,n)=>{"use strict";e.exports=a;var r=n(64824);((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=n(77968),s=n(93107);function a(e,t,n,i,s,a){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,r.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var n=new a(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,t.edition&&(n._edition=t.edition),n._defaultEdition="proto3",n},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,n,r){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return r&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=r||null),this.comments[e]=n||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},34346:e=>{"use strict";e.exports=r;var t,n=/\/|\./;function r(e,t){n.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),r[e]=t}r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),r("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),r("timestamp",{Timestamp:t}),r("empty",{Empty:{fields:{}}}),r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),r.get=function(e){return r[e]||null}},34679:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=function(...e){let t=1/0;for(let n of e){let e=n instanceof Date?n.getTime():n;e<t&&(t=e)}return t};let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];t.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")};let r=0x7fffffff;t.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>r?1/0:t},t.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},35108:(e,t)=>{"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=Array(64),i=Array(123),s=0;s<64;)i[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,n){for(var i,s=null,a=[],o=0,l=0;t<n;){var u=e[t++];switch(l){case 0:a[o++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=r[i|u>>6],a[o++]=r[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=r[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";n.decode=function(e,t,n){for(var r,s=n,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:r=u,o=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,o=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,o=3;break;case 3:t[n++]=(3&r)<<6|u,o=0}}if(1===o)throw Error(a);return n-s},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},35545:(e,t,n)=>{"use strict";n.d(t,{h1:()=>u,uA:()=>i});var r=n(52122);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(l(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:o(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function o(e){return e===s?void 0:e}function l(e){return"EAGER"===e.instantiationMode}class u{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},35628:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let r=n(99978);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,n)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((n,r)=>{e.getRequestMetadata(t.service_url,(e,t)=>e?void r(e):t?void n(t):void r(Error("Headers not set by metadata plugin")))})).then(e=>{let t=new r.Metadata;for(let n of Object.keys(e))t.add(n,e[n]);n(null,t)},e=>{n(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new r.Metadata;for(let n of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(n);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,n)=>t._equals(e.creds[n]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,n)=>{this.metadataGenerator(e,(e,r)=>{void 0!==r?t(r):n(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new r.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},36551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let r=n(34631),i=n(35628),s=n(71866);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,n,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(n,"Certificate chain"),t&&!n)throw Error("Private key must be given with accompanying certificate chain");if(!t&&n)throw Error("Certificate chain must be given with accompanying private key");return new u((0,r.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=n?n:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},37216:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let r=n(91645),i=n(20920),s=n(93122),a=n(98387),o=n(19780),l=n(63865);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let f=32;class p{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,n){let r=new Date;this.events.push({description:t,severity:e,timestamp:r,childChannel:(null==n?void 0:n.kind)==="channel"?n:void 0,childSubchannel:(null==n?void 0:n.kind)==="subchannel"?n:void 0}),this.events.length>=2*f&&(this.events=this.events.slice(f)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:A(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:A(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=p;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,n,r;switch(e.kind){case"channel":{let n=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};n.count+=1,this.channelChildren.set(e.id,n);break}case"subchannel":{let t=null!=(n=this.subchannelChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(r=this.socketChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let n=[];for(let{ref:e}of this.socketChildren.values())n.push(e);return{channels:e,subchannels:t,sockets:n}}}t.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],T=[],S=[],w=[];function E(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function C(e){return""===e?[]:[].concat(...e.split(":").map(e=>E(e)))}function I(e){if((0,r.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,r.isIPv6)(e))return null;{let t,n,r=e.indexOf("::");-1===r?(t=e,n=""):(t=e.substring(0,r),n=e.substring(r+2));let i=Buffer.from(C(t)),s=Buffer.from(C(n)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function _(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function A(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function k(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:_(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:A(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function R(e,t){let n=Number.parseInt(e.request.channel_id),r=b[n];if(void 0===r)return void t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+n});t(null,{channel:k(r)})}function D(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(r.push(k(e)),r.length>=n))break}t(null,{channel:r,end:i>=S.length})}function N(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:A(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function O(e,t){let n=Number.parseInt(e.request.server_id),r=S[n];if(void 0===r)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});t(null,{server:N(r)})}function x(e,t){let n=Number.parseInt(e.request.max_results),r=[],i=Number.parseInt(e.request.start_server_id);for(;i<S.length;i++){let e=S[i];if(void 0!==e&&(r.push(N(e)),r.length>=n))break}t(null,{server:r,end:i>=S.length})}function P(e,t){let n=Number.parseInt(e.request.subchannel_id),r=T[n];if(void 0===r)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+n});let i=r.getInfo();t(null,{subchannel:{ref:c(r.ref),data:{target:i.target,state:_(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:A(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=I(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var n,r,i,a,o;let l=Number.parseInt(e.request.socket_id),u=w[l];if(void 0===u)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(n=c.security.cipherSuiteStandardName)?n:void 0,other_name:null!=(r=c.security.cipherSuiteOtherName)?r:void 0,local_certificate:null!=(i=c.security.localCertificate)?i:void 0,remote_certificate:null!=(a=c.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?M(c.localAddress):null,remote:c.remoteAddress?M(c.remoteAddress):null,remote_name:null!=(o=c.remoteName)?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:A(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:A(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:A(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:A(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function F(e,t){let n=Number.parseInt(e.request.server_id),r=S[n];if(void 0===r)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+n});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=r.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function B(){return{GetChannel:R,GetTopChannels:D,GetServer:O,GetServers:x,GetSubchannel:P,GetSocket:L,GetServerSockets:F}}t.registerChannelzChannel=function(e,t,n){let r=v(),i={id:r,name:e,kind:"channel"};return n&&(b[r]={ref:i,getInfo:t}),i},t.registerChannelzSubchannel=function(e,t,n){let r=v(),i={id:r,name:e,kind:"subchannel"};return n&&(T[r]={ref:i,getInfo:t}),i},t.registerChannelzServer=function(e,t){let n=v(),r={id:n,kind:"server"};return t&&(S[n]={ref:r,getInfo:e}),r},t.registerChannelzSocket=function(e,t,n){let r=v(),i={id:r,name:e,kind:"socket"};return n&&(w[r]={ref:i,getInfo:t}),i},t.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete T[e.id];return;case"server":delete S[e.id];return;case"socket":delete w[e.id];return}},t.getChannelzHandlers=B;let U=null;function V(){if(U)return U;let e=(0,n(97587).Yi)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return U=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}t.getChannelzServiceDefinition=V,t.setup=function(){(0,o.registerAdminService)(V,B)}},40300:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let r=n(59123),i=n(83232),s=n(20920),a=n(93122),o=n(99978),l=n(90441),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function f(e){return"function"==typeof e}function p(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,n={}){var r,s;if(n=Object.assign({},n),this[c]=null!=(r=n.interceptors)?r:[],delete n.interceptors,this[h]=null!=(s=n.interceptor_providers)?s:[],delete n.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=n.callInvocationTransformer,delete n.callInvocationTransformer,n.channelOverride)this[u]=n.channelOverride;else if(n.channelFactoryOverride){let r=n.channelFactoryOverride;delete n.channelFactoryOverride,this[u]=r(e,t,n)}else this[u]=new i.ChannelImplementation(e,t,n)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let n=r=>{let i;if(r)return void t(Error("Failed to connect before the deadline"));try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,n)}catch(e){t(Error("The channel has been closed"))}};setImmediate(n)}checkOptionalUnaryResponseArguments(e,t,n){if(f(e))return{metadata:new o.Metadata,options:{},callback:e};if(f(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&f(n)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:n}}makeUnaryRequest(e,t,n,i,s,o,f){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,f),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:n},b={argument:i,metadata:y.metadata,call:new r.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let T=b.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(m=b.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=b.callOptions.interceptor_providers)?g:[]},w=(0,l.getInterceptingCall)(S,b.methodDefinition,b.callOptions,b.channel);T.call=w;let E=null,C=!1,I=Error();return w.start(b.metadata,{onReceiveMetadata:e=>{T.emit("metadata",e)},onReceiveMessage(e){null!==E&&w.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),E=e},onReceiveStatus(e){if(!C){if(C=!0,e.code===a.Status.OK)if(null===E){let t=p(I);b.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,E);else{let t=p(I);b.callback((0,r.callErrorFromStatus)(e,t))}I=null,T.emit("status",e)}}}),w.sendMessage(i),w.halfClose(),T}makeClientStreamRequest(e,t,n,i,s,o){var f,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:n},v={metadata:g.metadata,call:new r.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},S=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=S;let w=null,E=!1,C=Error();return S.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==w&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK)if(null===w){let t=p(C);v.callback((0,r.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,w);else{let t=p(C);v.callback((0,r.callErrorFromStatus)(e,t))}C=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let n,r;return e instanceof o.Metadata?(n=e,r=t||{}):(r=e||{},n=new o.Metadata),{metadata:n,options:r}}makeServerStreamRequest(e,t,n,i,s,o){var f,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:n},v={argument:i,metadata:g.metadata,call:new r.ClientReadableStreamImpl(n),channel:this[u],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(f=v.callOptions.interceptors)?f:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},S=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=S;let w=!1,E=Error();return S.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!w){if(w=!0,b.push(null),e.code!==a.Status.OK){let t=p(E);b.emit("error",(0,r.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),b}makeBidiStreamRequest(e,t,n,i,s){var o,f;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:n},y={metadata:m.metadata,call:new r.ClientDuplexStreamImpl(t,n),channel:this[u],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(f=y.callOptions.interceptor_providers)?f:[]},T=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=T;let S=!1,w=Error();return T.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!S){if(S=!0,v.push(null),e.code!==a.Status.OK){let t=p(w);v.emit("error",(0,r.callErrorFromStatus)(e,t))}w=null,v.emit("status",e)}}}),v}}t.Client=m},42319:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.DEFAULT_PORT=void 0;let r=n(98605),i=n(37366),s=n(28354),a=n(22487),o=n(93122),l=n(99978),u=n(63038),c=n(93122),h=n(57213),d=n(91645),f=n(86693),p="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,p,e)}t.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let n=0;n<Math.max.apply(null,e.map(e=>e.length));n++)for(let r of e)n<r.length&&t.push(r[n]);return t}class T{constructor(e,n,r){var i,s,a;this.target=e,this.listener=n,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));let u=(0,h.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(u.host)||(0,d.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!=(i=u.port)?i:t.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!=(s=u.port)?s:t.DEFAULT_PORT),this.percentage=100*Math.random(),1===r["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};let c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new f.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=r["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),n=e.filter(e=>6===e.family);this.latestLookupResult=b(n,t).map(e=>({host:e.address,port:+this.port}));let r="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+r),0===this.latestLookupResult.length)return void this.listener.onError(this.defaultResolutionError);this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}t.setup=function(){(0,r.registerResolver)("dns",T),(0,r.registerDefaultScheme)("dns")}},42609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=n},43801:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var r=n(63038);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return r.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return r.log}});var i=n(98605);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=n(57213);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=n(70155);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=n(86693);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=n(30598);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=n(98387);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=n(4976);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=n(70757);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=n(20653);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var f=n(87988);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return f.FilterStackFactory}});var p=n(19780);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return p.registerAdminService}});var m=n(58880);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=n(4189);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},46642:e=>{"use strict";e.exports={}},47099:e=>{var t=1/0,n="[object Symbol]",r=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",h="\\ufe0e\\ufe0f",d="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",f="['’]",p="["+s+"]",m="["+d+"]",g="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",T="[^"+s+d+y+l+u+c+"]",S="\ud83c[\udffb-\udfff]",w="[^"+s+"]",E="(?:\ud83c[\udde6-\uddff]){2}",C="[\ud800-\udbff][\udc00-\udfff]",I="["+c+"]",_="\\u200d",A="(?:"+b+"|"+T+")",k="(?:"+I+"|"+T+")",R="(?:"+f+"(?:d|ll|m|re|s|t|ve))?",D="(?:"+f+"(?:D|LL|M|RE|S|T|VE))?",N="(?:"+g+"|"+S+")?",O="["+h+"]?",x="(?:"+_+"(?:"+[w,E,C].join("|")+")"+O+N+")*",P=O+N+x,M="(?:"+[v,E,C].join("|")+")"+P,L="(?:"+[w+g+"?",g,E,C,p].join("|")+")",F=RegExp(f,"g"),B=RegExp(g,"g"),U=RegExp(S+"(?="+S+")|"+L+P,"g"),V=RegExp([I+"?"+b+"+"+R+"(?="+[m,I,"$"].join("|")+")",k+"+"+D+"(?="+[m,I+A,"$"].join("|")+")",I+"?"+A+"+"+R,I+"+"+D,y,M].join("|"),"g"),j=RegExp("["+_+s+a+o+h+"]"),q=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,z={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},G="object"==typeof global&&global&&global.Object===Object&&global,K="object"==typeof self&&self&&self.Object===Object&&self,$=G||K||Function("return this")();function H(e,t,n,r){var i=-1,s=e?e.length:0;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function W(e){return e.split("")}function Q(e){return e.match(r)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(z);function J(e){return j.test(e)}function X(e){return q.test(e)}function Z(e){return J(e)?ee(e):W(e)}function ee(e){return e.match(U)||[]}function et(e){return e.match(V)||[]}var en=Object.prototype.toString,er=$.Symbol,ei=er?er.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function eo(e){if("string"==typeof e)return e;if(eh(e))return es?es.call(e):"";var n=e+"";return"0"==n&&1/e==-t?"-0":n}function el(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:ea(e,t,n)}function eu(e){return function(t){var n=J(t=ed(t))?Z(t):void 0,r=n?n[0]:t.charAt(0),i=n?el(n,1).join(""):t.slice(1);return r[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function eh(e){return"symbol"==typeof e||ec(e)&&en.call(e)==n}function ed(e){return null==e?"":eo(e)}var ef=function(e){return function(t){return H(ey(em(t).replace(F,"")),e,"")}}(function(e,t,n){return t=t.toLowerCase(),e+(n?ep(t):t)});function ep(e){return eg(ed(e).toLowerCase())}function em(e){return(e=ed(e))&&e.replace(i,Y).replace(B,"")}var eg=eu("toUpperCase");function ey(e,t,n){return(e=ed(e),void 0===(t=n?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ef},48436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let r=n(36551),i=n(27748),s=n(10561),a=n(70757),o=n(93122),l=n(87988),u=n(30948),c=n(98605),h=n(63038),d=n(77936),f=n(57213),p=n(20920),m=n(37216),g=n(65950),y=n(34679),v=n(51421),b=n(16497),T=n(53908),S=n(14778),w=n(58880),E=0x7fffffff,C=1e3,I=18e5,_=new Map,A=0x1000000,k=1048576;class R extends w.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,n,r,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class D{constructor(e,t,n){var g,y,v,b,w,D,N,O;if(this.credentials=t,this.options=n,this.connectivityState=p.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.originalTarget=e;let x=(0,f.parseUri)(e);if(null===x)throw Error(`Could not parse target name "${e}"`);let P=(0,c.mapUriDefaultScheme)(x);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},E),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);let M=(0,d.mapProxyName)(P,n);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=n["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new S.MessageBufferTracker(null!=(b=n["grpc.retry_buffer_size"])?b:A,null!=(w=n["grpc.per_rpc_retry_buffer_size"])?w:k),this.keepaliveTime=null!=(D=n["grpc.keepalive_time_ms"])?D:-1,this.idleTimeoutMs=Math.max(null!=(N=n["grpc.client_idle_timeout_ms"])?N:I,C);let L={createSubchannel:(e,t)=>{let n=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);n.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",n.getChannelzRef());let r=new R(n,this);return this.wrappedSubchannels.add(r),r},updateState:(e,t)=>{this.currentPicker=t;let n=this.pickQueue.slice();for(let e of(this.pickQueue=[],n.length>0&&this.callRefTimerUnref(),n))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,n,(e,t)=>{e.retryThrottling?_.set(this.getTarget(),new S.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,_.get(this.getTarget()))):_.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,T.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let n of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))n.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(n,void 0,2));let F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(O=F.stack)?void 0:O.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,n,r;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(r=(n=this.callRefTimer).ref)||r.call(n))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,f.uriToString)(this.target)+" "+p.ConnectivityState[this.connectivityState]+" -> "+p.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+p.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==p.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,n;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(n=(t=this.idleTimer).unref)||n.call(t)}maybeStartIdleTimer(){this.connectivityState===p.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,n,r,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,n,r,i,s)}createRetryingCall(e,t,n,r,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new S.RetryingCall(this,e,t,n,r,i,s,this.retryBufferTracker,_.get(this.getTarget()))}createInnerCall(e,t,n,r,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,n,r,i):this.createRetryingCall(e,t,n,r,i)}createResolvingCall(e,t,n,r,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=n?n:this.defaultAuthority,parentCall:r},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(p.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,f.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,n){if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let r=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(n,Error("Deadline passed without connectivity state change"));r=setTimeout(()=>{this.removeConnectivityStateWatcher(i),n(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:n,timer:r};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===p.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,n,r,i)}}t.InternalChannel=D},51421:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let r=n(93122),i=n(34679),s=n(99978),a=n(63038),o=n(53908),l="resolving_call";class u{constructor(e,t,n,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=n.deadline,this.host=n.host,n.parentCall&&(n.flags&r.Propagate.CANCELLATION&&n.parentCall.on("cancelled",()=>{this.cancelWithStatus(r.Status.CANCELLED,"Cancelled by parent call")}),n.flags&r.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+n.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,n.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(r.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(r.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let n=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,n.sendMessageWithContext(e,t.message),this.pendingHalfClose&&n.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==r.Status.OK){let{code:e,details:n}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:n,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(n=this.child)||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},52122:(e,t,n)=>{"use strict";n.d(t,{cY:()=>S,FA:()=>M,g:()=>P,dM:()=>O,u:()=>h,Uj:()=>c,p9:()=>J,Fy:()=>w,tD:()=>z,bD:()=>B,hp:()=>q,T9:()=>T,Tj:()=>v,yU:()=>b,Ku:()=>X,ZQ:()=>E,sr:()=>A,c1:()=>_,zW:()=>D,jZ:()=>C,lV:()=>k,nr:()=>R,Am:()=>V,I9:()=>j,eX:()=>N});let r=()=>void 0,i={NODE_CLIENT:!1},s=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},a=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new l;let u=i<<2|s>>4;if(r.push(u),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let u=function(e){let t=s(e);return o.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function d(e){return"__proto__"!==e}function f(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}let p=()=>f().__FIREBASE_DEFAULTS__,m=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},g=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},y=()=>{try{return r()||p()||m()||g()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},v=e=>{var t,n;return null==(n=null==(t=y())?void 0:t.emulatorHosts)?void 0:n[e]},b=e=>{let t=v(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},T=()=>{var e;return null==(e=y())?void 0:e.config};class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function w(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),o="";return[c(JSON.stringify(n)),c(JSON.stringify(a)),o].join(".")}function E(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function C(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(E())}function I(){var e;let t=null==(e=y())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function _(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function A(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function k(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function R(){return!I()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function D(){try{return"object"==typeof indexedDB}catch(e){return!1}}function N(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}function O(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}let x="FirebaseError";class P extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=x,Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,M.prototype.create)}}class M{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?L(i,n):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new P(r,a,n)}}function L(e,t){return e.replace(F,(e,n)=>{let r=t[n];return null!=r?String(r):`<${n}?>`})}let F=/\{\$([^}]+)}/g;function B(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(U(n)&&U(s)){if(!B(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function U(e){return null!==e&&"object"==typeof e}function V(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function j(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function q(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function z(e,t){let n=new G(e,t);return n.subscribe.bind(n)}class G{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=K(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=$),void 0===r.error&&(r.error=$),void 0===r.complete&&(r.complete=$);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function K(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}function $(){}let H=1e3,W=2,Q=144e5,Y=.5;function J(e,t=H,n=W){let r=t*Math.pow(n,e),i=Math.round(Y*r*(Math.random()-.5)*2);return Math.min(Q,r+i)}function X(e){return e&&e._delegate?e._delegate:e}i.NODE_CLIENT=!0},53908:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let r=n(93122),i=[r.Status.OK,r.Status.INVALID_ARGUMENT,r.Status.NOT_FOUND,r.Status.ALREADY_EXISTS,r.Status.FAILED_PRECONDITION,r.Status.ABORTED,r.Status.OUT_OF_RANGE,r.Status.DATA_LOSS];t.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:r.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${r.Status[e]} ${t}`}:{code:e,details:t}}},54351:(e,t,n)=>{"use strict";e.exports=v;var r=n(77968);((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=n(32110),s=n(12630),a=n(73267),o=n(25585),l=n(3076),u=n(8920),c=n(26996),h=n(96120),d=n(93107),f=n(30847),p=n(62823),m=n(16973),g=n(97659),y=n(63695);function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),v.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)n.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)n.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];n.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:r.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),t.edition&&(n._edition=t.edition),n._defaultEdition="proto3",n},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},v.prototype.resolveAll=function(){r.prototype.resolveAll.call(this);var e=this.oneofsArray;for(n=0;n<e.length;)e[n++].resolve();for(var t=this.fieldsArray,n=0;n<t.length;)t[n++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,r.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)}),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=f(this)({Writer:h,types:t,util:d}),this.decode=p(this)({Reader:c,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var r=y[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},54369:(e,t,n)=>{"use strict";e.exports=s;var r=n(96120);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(8707);function s(){r.call(this)}function a(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},56061:function(e,t){var n;!function(r,i){function s(e){return e.default||e}void 0===(n=(function(){var e={};return i(e),s(e)}).apply(t,[]))||(e.exports=n)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var s={},a={};function o(e,t){var n,r,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(r=a[e]))?r:(n=u(e,0,!0),i&&(a[e]=n),n);return(e|=0,(i=-128<=e&&e<128)&&(r=s[e]))?r:(n=u(e,e<0?-1:0,!1),i&&(s[e]=n),n)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=p)return E}else{if(e<=-m)return C;if(e+1>=m)return w}return e<0?l(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=l,n.fromBits=u;var c=Math.pow;function h(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return h(e.substring(1),t,n).neg();for(var r,i=l(c(n,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),n);if(o<8){var d=l(c(n,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=d;var f=0x100000000,p=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);n.ZERO=y;var v=o(0,!0);n.UZERO=v;var b=o(1);n.ONE=b;var T=o(1,!0);n.UONE=T;var S=o(-1);n.NEG_ONE=S;var w=u(-1,0x7fffffff,!1);n.MAX_VALUE=w;var E=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=E;var C=u(0,-0x80000000,!1);n.MIN_VALUE=C;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(C))return"-"+this.neg().toString(e);else{var t=l(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},I.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(1&this.low)==1},I.isEven=function(){return(1&this.low)==0},I.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return 0>this.comp(e)},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return 0>=this.comp(e)},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(b)},I.neg=I.negate,I.add=function(e){r(e)||(e=d(e));var t,n,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,m=0;return t=0+((n=0+(o+f))>>>16),n&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+c,p+=m>>>16,m&=65535,p+=i+l,u(t<<16|n,(p&=65535)<<16|m,this.unsigned)},I.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return this;if(r(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(C))return e.isOdd()?C:y;if(e.eq(C))return this.isOdd()?C:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,f=65535&e.high,p=e.low>>>16,m=65535&e.low,b=0,T=0;return n=0+((i=0+c*m)>>>16),i&=65535,n+=o*m,T+=n>>>16,n&=65535,n+=c*p,T+=n>>>16,n&=65535,T+=a*m,b+=T>>>16,T&=65535,T+=o*p,b+=T>>>16,T&=65535,T+=c*f,b+=T>>>16,T&=65535,b+=s*m+a*p+o*f+c*h,u(n<<16|i,(b&=65535)<<16|T,this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return T;s=v}else{if(this.eq(C))if(e.eq(b)||e.eq(S))return C;else return e.eq(C)?b:(n=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:S:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(C))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(n),f=h.mul(e);f.isNegative()||f.gt(i);)n-=o,f=(h=l(n,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(f)}return s},I.div=I.divide,I.modulo=function(e){return(r(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},I.clz=I.countLeadingZeros,I.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},I.ctz=I.countTrailingZeros,I.and=function(e){return r(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.rotateLeft=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},I.rotl=I.rotateLeft,I.rotateRight=function(e){var t;return(r(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},I.rotr=I.rotateRight,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(n.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},n.fromValue=function(e,t){return"bigint"==typeof e?n.fromBigInt(e,t):d(e,t)},I.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=n})},56271:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},57213:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let n=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;t.parseUri=function(e){let t=n.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let r=/^\d+$/;t.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let n=e.substring(1,t);if(-1===n.indexOf(":"))return null;if(!(e.length>t+1))return{host:n};if(":"!==e[t+1])return null;{let i=e.substring(t+2);return r.test(i)?{host:n,port:+i}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:r.test(t[1])?{host:t[0],port:+t[1]}:null}},t.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},58570:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let r=n(30598),i=n(20920),s=n(70757),a=n(98387),o=n(63038),l=n(93122),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class f{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class p{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,n,r,s)=>{this.calculateAndUpdateState(),(n===i.ConnectivityState.TRANSIENT_FAILURE||n===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new f(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}t.RoundRobinLoadBalancer=p,t.setup=function(){(0,r.registerLoadBalancerType)(h,p,d)}},58880:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class n{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=n},59123:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let r=n(94735),i=n(27910),s=n(93122);t.callErrorFromStatus=function(e,t){let n=`${e.code} ${s.Status[e.code]}: ${e.details}`,r=Error(n),i=`${r.stack}
for call at
${t}`;return Object.assign(Error(n),e,{stack:i})};class a extends r.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}t.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}t.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(r=this.call)||r.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}t.ClientWritableStreamImpl=l;class u extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,n){var r;let i={callback:n},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(r=this.call)||r.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}t.ClientDuplexStreamImpl=u},60158:e=>{"use strict";e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,n=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,r=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,f=0,p={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+d+")")}function v(){var t="'"===g?r:n;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,C(g),g=null,c(i[1])}function b(t){return e.charAt(t)}function T(t,n,r){var o,u={type:e.charAt(t++),lineEmpty:!1,leading:r},c=t-(l?2:3);do if(--c<0||"\n"===(o=e.charAt(c))){u.lineEmpty=!0;break}while(" "===o||"	"===o);for(var h=e.substring(t,n).split(a),m=0;m<h.length;++m)h[m]=h[m].replace(l?s:i,"").trim();u.text=h.join("\n").trim(),p[d]=u,f=d}function S(t){var n=w(t),r=e.substring(t,n);return/^\s*\/\//.test(r)}function w(e){for(var t=e;t<h&&"\n"!==b(t);)t++;return t}function E(){if(m.length>0)return m.shift();if(g)return v();var n,r,i,s,a,c=0===u;do{if(u===h)return null;for(n=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===b(u)){if(++u===h)throw y("comment");if("/"===b(u))if(l){if(s=u,a=!1,S(u-1)){a=!0;do if((u=w(u))===h||(u++,!c))break;while(S(u))}else u=Math.min(h,w(u)+1);a&&(T(s,u,c),c=!0),d++,n=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===h)return null;++u,a&&(T(s,u-1,c),c=!0),++d,n=!0}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++d,++u===h)throw y("comment");r=i,i=b(u)}while("*"!==r||"/"!==i);++u,a&&(T(s,u-2,c),c=!0),n=!0}}}while(n);var f=u;if(t.lastIndex=0,!t.test(b(f++)))for(;f<h&&!t.test(b(f));)++f;var p=e.substring(u,u=f);return('"'===p||"'"===p)&&(g=p),p}function C(e){m.push(e)}function I(){if(!m.length){var e=E();if(null===e)return null;C(e)}return m[0]}function _(e,t){var n=I();if(n===e)return E(),!0;if(!t)throw y("token '"+n+"', '"+e+"' expected");return!1}function A(e){var t,n=null;return void 0===e?(t=p[d-1],delete p[d-1],t&&(l||"*"===t.type||t.lineEmpty)&&(n=t.leading?t.text:null)):(f<e&&I(),t=p[e],delete p[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(n=t.leading?null:t.text)),n}return Object.defineProperty({next:E,peek:I,push:C,skip:_,cmnt:A},"line",{get:function(){return d}})}h.unescape=c},61614:(e,t,n)=>{"use strict";var r=n(68474);e.exports=t=r.descriptor=r.Root.fromJSON(n(20040)).lookup(".google.protobuf");var i=r.Namespace,s=r.Root,a=r.Enum,o=r.Type,l=r.Field,u=r.MapField,c=r.OneOf,h=r.Service,d=r.Method;function f(e,n,r){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});r&&(u.syntax=r),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(r)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(r)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&f(c,n,r);u.options=C(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&n.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var n=new s;if(e.file)for(var r,i,u,c=0;c<e.file.length;++c){if(i=n,(r=e.file[c]).package&&r.package.length&&(i=n.define(r.package)),r.name&&r.name.length&&n.files.push(i.filename=r.name),r.messageType)for(u=0;u<r.messageType.length;++u)i.add(o.fromDescriptor(r.messageType[u],r.syntax));if(r.enumType)for(u=0;u<r.enumType.length;++u)i.add(a.fromDescriptor(r.enumType[u]));if(r.extension)for(u=0;u<r.extension.length;++u)i.add(l.fromDescriptor(r.extension[u]));if(r.service)for(u=0;u<r.service.length;++u)i.add(h.fromDescriptor(r.service[u]));var d=E(r.options,t.FileOptions);if(d){var f=Object.keys(d);for(u=0;u<f.length;++u)i.setOption(f[u],d[f[u]])}}return n},s.prototype.toDescriptor=function(e){var n=t.FileDescriptorSet.create();return f(this,n.file,e),n};var p=0;o.fromDescriptor=function(e,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var r,i=new o(e.name.length?e.name:"Type"+p++,E(e.options,t.MessageOptions));if(e.oneofDecl)for(r=0;r<e.oneofDecl.length;++r)i.add(c.fromDescriptor(e.oneofDecl[r]));if(e.field)for(r=0;r<e.field.length;++r){var s=l.fromDescriptor(e.field[r],n);i.add(s),e.field[r].hasOwnProperty("oneofIndex")&&i.oneofsArray[e.field[r].oneofIndex].add(s)}if(e.extension)for(r=0;r<e.extension.length;++r)i.add(l.fromDescriptor(e.extension[r],n));if(e.nestedType)for(r=0;r<e.nestedType.length;++r)i.add(o.fromDescriptor(e.nestedType[r],n)),e.nestedType[r].options&&e.nestedType[r].options.mapEntry&&i.setOption("map_entry",!0);if(e.enumType)for(r=0;r<e.enumType.length;++r)i.add(a.fromDescriptor(e.enumType[r]));if(e.extensionRange&&e.extensionRange.length)for(r=0,i.extensions=[];r<e.extensionRange.length;++r)i.extensions.push([e.extensionRange[r].start,e.extensionRange[r].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(i.reserved=[],e.reservedRange)for(r=0;r<e.reservedRange.length;++r)i.reserved.push([e.reservedRange[r].start,e.reservedRange[r].end]);if(e.reservedName)for(r=0;r<e.reservedName.length;++r)i.reserved.push(e.reservedName[r])}return i},o.prototype.toDescriptor=function(e){var n,r,i=t.DescriptorProto.create({name:this.name});for(r=0;r<this.fieldsArray.length;++r)if(i.field.push(n=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof u){var s=w(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),c=w(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),h=11===c||14===c?this._fieldsArray[r].resolvedType&&I(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:n.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(r=0;r<this.oneofsArray.length;++r)i.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof l?i.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof o?i.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof a&&i.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)"string"==typeof this.reserved[r]?i.reservedName.push(this.reserved[r]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return i.options=C(this.options,t.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(r=e.typeName&&e.typeName.length?e.typeName:T(e.type),e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var r,i,s=e.extendee;void 0!==e.extendee&&(s=s.length?s:void 0);var a=new l(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(a.options=E(e.options,t.FieldOptions),e.defaultValue&&e.defaultValue.length){var o=e.defaultValue;switch(o){case"true":case"TRUE":o=!0;break;case"false":case"FALSE":o=!1;break;default:m.exec(o)&&(o=parseInt(o))}a.setOption("default",o)}return S(e.type)&&("proto3"===n?e.options&&!e.options.packed&&a.setOption("packed",!1):e.options&&e.options.packed||a.setOption("packed",!1)),a},l.prototype.toDescriptor=function(e){var n=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)n.type=11,n.typeName=r.util.ucFirst(this.name),n.label=3;else{switch(n.type=w(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:n.typeName=this.resolvedType?I(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":n.label=3;break;case"required":n.label=2;break;default:n.label=1}}if(n.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(n.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(n.options=C(this.options,t.FieldOptions),null!=this.options.default&&(n.defaultValue=String(this.options.default))),"proto3"===e?this.packed||((n.options||(n.options=t.FieldOptions.create())).packed=!1):this.packed&&((n.options||(n.options=t.FieldOptions.create())).packed=!0),n};var g=0;a.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var n={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;n[i&&i.length?i:"NAME"+s]=s}return new a(e.name&&e.name.length?e.name:"Enum"+g++,n,E(e.options,t.EnumOptions))},a.prototype.toDescriptor=function(){for(var e=[],n=0,r=Object.keys(this.values);n<r.length;++n)e.push(t.EnumValueDescriptorProto.create({name:r[n],number:this.values[r[n]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:C(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var n=new h(e.name&&e.name.length?e.name:"Service"+v++,E(e.options,t.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)n.add(d.fromDescriptor(e.method[r]));return n},h.prototype.toDescriptor=function(){for(var e=[],n=0;n<this.methodsArray.length;++n)e.push(this._methodsArray[n].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:C(this.options,t.ServiceOptions)})};var b=0;function T(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function w(e,t){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return t.group?10:11;throw Error("illegal type: "+e)}function E(e,t){if(e){for(var n,i,s,o=[],l=0;l<t.fieldsArray.length;++l)"uninterpretedOption"!==(i=(n=t._fieldsArray[l]).name)&&e.hasOwnProperty(i)&&(s=e[i],n.resolvedType instanceof a&&"number"==typeof s&&void 0!==n.resolvedType.valuesById[s]&&(s=n.resolvedType.valuesById[s]),o.push(_(i),s));return o.length?r.util.toObject(o):void 0}}function C(e,t){if(e){for(var n,i,s=[],a=0,o=Object.keys(e);a<o.length;++a)if(i=e[n=o[a]],"default"!==n){var l=t.fields[n];(l||(l=t.fields[n=r.util.camelCase(n)]))&&s.push(n,i)}return s.length?t.fromObject(r.util.toObject(s)):void 0}}function I(e,t){var n=e.fullName.split("."),r=t.fullName.split("."),a=0,o=0,l=r.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<n.length&&o<l&&n[a]===r[o];){var u=t.lookup(n[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<n.length&&o<l&&n[a]===r[o];++a,++o);return r.slice(o).join(".")}function _(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,E(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:C(this.options,t.MethodOptions)})}},61810:(e,t,n)=>{"use strict";var r=t,i=n(93107),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var n=0,r={};for(t|=0;n<e.length;)r[s[n+t]]=e[n++];return r}r.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=a([0,0,0,1,1],7),r.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},61996:(e,t)=>{"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(r+1))==56320?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],a=0;t<n;)(r=e[t++])<128?s[a++]=r:r>191&&r<224?s[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(r>>10),s[a++]=56320+(1023&r)):s[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,n){for(var r,i,s=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-s}},62432:(e,t,n)=>{"use strict";let r,i;n.d(t,{P2:()=>S});let s=(e,t)=>t.some(t=>e instanceof t);function a(){return r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let l=new WeakMap,u=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap;function f(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(b(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&l.set(t,e)}).catch(()=>{}),d.set(t,e),t}function p(e){if(u.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});u.set(e,t)}let m={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return b(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function g(e){m=e(m)}function y(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?o().includes(e)?function(...t){return e.apply(T(this),t),b(l.get(this))}:function(...t){return b(e.apply(T(this),t))}:function(t,...n){let r=e.call(T(this),t,...n);return c.set(r,t.sort?t.sort():[t]),b(r)}}function v(e){return"function"==typeof e?y(e):(e instanceof IDBTransaction&&p(e),s(e,a()))?new Proxy(e,m):e}function b(e){if(e instanceof IDBRequest)return f(e);if(h.has(e))return h.get(e);let t=v(e);return t!==e&&(h.set(e,t),d.set(t,e)),t}let T=e=>d.get(e);function S(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=b(a);return r&&a.addEventListener("upgradeneeded",e=>{r(b(a.result),e.oldVersion,e.newVersion,b(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let w=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],C=new Map;function I(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(C.get(t))return C.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||w.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return C.set(t,s),s}g(e=>({...e,get:(t,n,r)=>I(t,n)||e.get(t,n,r),has:(t,n)=>!!I(t,n)||e.has(t,n)}))},62823:(e,t,n)=>{"use strict";e.exports=o;var r=n(32110),i=n(61810),s=n(93107);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),n=0;n<e.fieldsArray.length;++n){var o=e._fieldsArray[n].resolve(),l=o.resolvedType instanceof r?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var c=e._fieldsArray[n];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},62841:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let r=n(94735),i=n(73496),s=n(27910),a=n(74075),o=n(93122),l=n(99978),u=n(25678),c=n(63038),h=n(82281),d="server_call";function f(e){c.trace(o.LogVerbosity.DEBUG,d,e)}let p="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},T={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},S={waitForTrailers:!0};class w extends r.EventEmitter{constructor(e,t,n){super(),this.call=e,this.metadata=t,this.request=n,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=w;class E extends s.Readable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=n,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,r)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=E;class C extends s.Writable{constructor(e,t,n,r){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.request=r,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,n){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",n)}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}n()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=C;class I extends s.Duplex{constructor(e,t,n,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=n,this.deserialize=r,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=I,I.prototype._read=E.prototype._read,I.prototype._write=C.prototype._write,I.prototype._final=C.prototype._final;class _ extends r.EventEmitter{constructor(e,t,n){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;f("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in n&&(this.maxSendMessageSize=n["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in n&&(this.maxReceiveMessageSize=n["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let n=e.subarray(5);if("identity"===t)return n;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,r)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(n),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,n=Object.assign(Object.assign(Object.assign({},T),b),t);this.stream.respond(n,S)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(d)&&f("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let n=t.get(g);if(n.length>0){let e=n[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let r=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+r),this.deadlineTimer=setTimeout(A,r,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,n)=>{let{stream:r}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(r.removeListener("data",u),r.removeListener("end",c),r.removeListener("error",c),void 0!==l)return void n({code:o.Status.INTERNAL,details:l.message});if(0===i)return void n({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",f=s.getDecompressedMessage(h,d);if(Buffer.isBuffer(f))return void t(s.deserializeMessageWithInternalError(f));f.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>n(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),n=t.byteLength,r=Buffer.allocUnsafe(n+5);return r.writeUInt8(0,0),r.writeUInt32BE(n,1),t.copy(r,5),r}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,n,r){if(!this.checkCancelled()){if(void 0===n&&(n=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&n&&(e.metadata=n),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:n})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,n;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(f("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let n=Object.assign({[m]:e.code,[p]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(n),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[p]:encodeURI(e.details)},T),null==(n=e.metadata)?void 0:n.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let n=new u.StreamDecoder(this.maxReceiveMessageSize),r=!1,i=!1,s=!1,a=async()=>{s||!r||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async r=>{let s;try{s=n.write(r)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let n of(i=!0,this.stream.pause(),s)){let r;this.emit("receiveMessage");let i=1===n.readUInt8(0)?t:"identity";try{r=await this.getDecompressedMessage(n,i)}catch(e){this.sendError(e);return}if(!r)return;await this.pushOrBufferMessage(e,r)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{r=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),n=e.push(t);if(null===t||!1===n){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){f("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}f("Received message of length "+t.length),this.isPushPending=!0;try{let n=await this.deserializeMessage(t);this.canPush?e.push(n)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(n)}catch(n){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(n);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(n),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function A(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=_},63038:(e,t,n)=>{"use strict";var r,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=n(93122),l=n(19771),u=n(86243).rE,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!=(i=null!=(r=process.env.GRPC_NODE_VERBOSITY)?r:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}t.getLogger=()=>c,t.setLogger=e=>{c=e},t.setLoggerVerbosity=e=>{h=e},t.log=(e,...t)=>{let n;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:n=c.debug;break;case o.LogVerbosity.INFO:n=c.info;break;case o.LogVerbosity.ERROR:n=c.error}n||(n=c.error),n&&n.bind(c)(...t)}};let d=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",f=new Set,p=new Set;for(let e of d.split(","))e.startsWith("-")?p.add(e.substring(1)):f.add(e);let m=f.has("all");function g(e,n,r){y(n)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+n+" | "+r)}function y(e){return!p.has(e)&&(m||f.has(e))}t.trace=g,t.isTracerEnabled=y},63695:(e,t,n)=>{"use strict";var r=t,i=n(8920);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="type.googleapis.com/",r="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),r=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===r&&(r=n),s=r+l,o["@type"]=s,o}return this.toObject(e,t)}}},63865:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let r=n(40300),i={unary:r.Client.prototype.makeUnaryRequest,server_stream:r.Client.prototype.makeServerStreamRequest,client_stream:r.Client.prototype.makeClientStreamRequest,bidi:r.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,n){n||(n={});class a extends r.Client{}return Object.keys(e).forEach(t=>{let n;if(s(t))return;let r=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");n=r.requestStream?r.responseStream?"bidi":"client_stream":r.responseStream?"server_stream":"unary";let l=r.requestSerialize,u=r.responseDeserialize,c=o(i[n],r.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],r),r.originalName&&!s(r.originalName)&&(a.prototype[r.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,n,r){return function(...i){return e.call(this,t,n,r,...i)}}function l(e){return"format"in e}t.makeClientConstructor=a,t.loadPackageDefinition=function(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n],i=n.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(r)?u[o]=r:u[o]=a(r,o,{})}return t}},64824:(e,t,n)=>{"use strict";e.exports=u,u.className="ReflectionObject";let r=n(12630);var i,s=n(93107),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this instanceof i&&(this._resolveFeaturesRecursive(this._edition),this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var n=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,n||{});return}if(this.partOf instanceof r){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,n||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,n||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features)},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,n){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,n):n&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var i=r.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,n,t)}else(i={})[e]=s.setProperty({},n,t),r.push(i)}else{var o={};o[e]=t,r.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},65950:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let r=n(20920),i=n(93122),s=n(34679),a=n(99978),o=n(70757),l=n(57213),u=n(63038),c=n(53908),h=n(73496),d="load_balancing_call";class f{constructor(e,t,n,r,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=n,this.host=r,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),h="";c.length>=2&&(h=c[1]);let d=null!=(u=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var n,r;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(n=this.listener)||n.onReceiveStatus(i),null==(r=this.onCallEnded)||r.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let n=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=n.subchannel?"("+n.subchannel.getChannelzRef().id+") "+n.subchannel.getAddress():""+n.subchannel;switch(this.trace("Pick result: "+o.PickResultType[n.pickResultType]+" subchannel: "+l+" status: "+(null==(e=n.status)?void 0:e.code)+" "+(null==(t=n.status)?void 0:t.details)),n.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),n.subchannel.getConnectivityState()!==r.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+r.ConnectivityState[n.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=n.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(u=n.onCallStarted)||u.call(n),this.onCallEnded=n.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:n}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:n,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:n.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(n.status.code,n.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:n.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var n;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(n=this.child)||n.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=f},66771:(e,t,n)=>{"use strict";var r=e.exports=n(89374);r.build="full",r.tokenize=n(60158),r.parse=n(27408),r.common=n(34346),r.Root._configure(r.Type,r.parse,r.common)},67989:(e,t,n)=>{"use strict";n.d(t,{Wp:()=>r.Wp});var r=n(31305),i="firebase",s="11.6.0";(0,r.KO)(i,s,"app")},68048:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let r=n(73496),i=n(93122),s=n(62841),a=n(663),o=n(98605),l=n(63038),u=n(98387),c=n(57213),h=n(37216),d=0x7fffffff,f=0x7fffffff,p=2e4,{HTTP2_HEADER_PATH:m}=r.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let n=v(t);switch(e){case"unary":return(e,t)=>{t(n,null)};case"clientStream":return(e,t)=>{t(n,null)};case"serverStream":return e=>{e.emit("error",n)};case"bidi":return e=>{e.emit("error",n)};default:throw Error(`Invalid handlerType ${e}`)}}class T{constructor(e){var t,n,r,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:d,this.maxConnectionAgeGraceMs=null!=(n=this.options["grpc.max_connection_age_grace_ms"])?n:d,this.keepaliveTimeMs=null!=(r=this.options["grpc.keepalive_time_ms"])?r:f,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:p,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,n,r;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,n=e.getCipher(),r=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=n.standardName)?t:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:r&&"raw"in r?r.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(n=e.state.localWindowSize)?n:null,remoteFlowControlWindow:null!=(r=e.state.remoteWindowSize)?r:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let n=Object.keys(e);if(0===n.length)throw Error("Cannot add an empty service to a server");n.forEach(n=>{let r,i,s=e[n];r=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[n];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(r,n),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,r))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let n=e[t];this.unregister(n.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,n){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof n)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let f={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?f.maxSessionMemory=this.options["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(f.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let p=(e,t)=>{process.nextTick(()=>n(e,t))},m=()=>{let e;if(t._isSecure()){let n=Object.assign(f,t._getSettings());n.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=r.createSecureServer(n)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=r.createServer(f);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,n)=>0===e.length?Promise.resolve({port:t,count:n}):Promise.all(e.map(e=>{let n;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),n=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let r=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};r.once("error",a),r.listen(n,()=>{let e;if(this.shutdown){r.close(),i(Error("bindAsync failed because server is shutdown"));return}let n=r.address();e="string"==typeof n?{path:n}:{host:n.address,port:n.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:r,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),r.removeListener("error",a)})})})).then(e=>{let r=0;for(let n of e)if("number"==typeof n&&(r+=1,n!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:r+n}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],n=m();return new Promise((r,i)=>{let s=n=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+n.message),r(v(e.slice(1)))};n.once("error",s),n.listen(t,()=>{if(this.shutdown){n.close(),r({port:0,count:0});return}let t=n.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:n,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),r(g(e.slice(1),t.port,1)),n.removeListener("error",s)})})},b={onSuccessfulResolution:(t,n,r)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&p(Error("bindAsync failed because server is shutdown"),0),0===t.length)return void p(Error(`No addresses resolved for port ${e}`),0);(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),p(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),p(null,e.port)},e=>{let n=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,n),p(Error(n),0)})},onError:e=>{p(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(r.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,n,r,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:n,deserialize:r,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},n=0;function r(){0==--n&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(n++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),r()}));this.sessions.forEach((e,t)=>{t.closed||(n+=1,t.close(r))}),0===n&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let n=t[r.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof n&&!!n.startsWith("application/grpc")||(e.respond({[r.constants.HTTP2_HEADER_STATUS]:r.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,n=null){let r=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed()),r.sendError(e)}_channelzHandler(e,t){let n=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==n||n.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed();return}let r=t[m],a=this._retrieveHandler(r);if(!a)return void this._respondWithError(v(r),e,n);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),n&&(o.once("streamEnd",e=>{e?n.streamTracker.addCallSucceeded():n.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{n.messagesSent+=1,n.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{n.messagesReceived+=1,n.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==n||n.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let n=t[m],r=this._retrieveHandler(n);if(!r)return void this._respondWithError(v(n),e,null);let a=new s.Http2ServerCallStream(e,r,this.options);this._runHandlerForCall(a,r,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${r.type}`})}_runHandlerForCall(e,t,n){var r;let i=e.receiveMetadata(n),s=null!=(r=i.get("grpc-encoding")[0])?r:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)S(e,t,i,s);else if("clientStream"===a)w(e,t,i,s);else if("serverStream"===a)E(e,t,i,s);else{if("bidi"!==a)return!1;C(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),n="null";t&&(n="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=n;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,n,i,s,a;if(!this.started)return void e.destroy();let o=(0,h.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,f=null,p=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null==(i=(n=setTimeout(()=>{var t,n;p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(r.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(f=null==(n=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:n.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(n)}let m=null==(a=(s=setInterval(()=>{var t,n;let r=null==(n=(t=setTimeout(()=>{p=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:n.call(t);try{e.ping((e,t,n)=>{clearTimeout(r)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(p||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),f&&clearTimeout(f),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function S(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,n,i);t.func(a,(t,n,r,i)=>{e.sendUnaryMessage(t,n,r,i)})}catch(t){e.sendError(t)}}function w(e,t,n,r){let i=new s.ServerReadableStreamImpl(e,n,t.deserialize,r);function a(t,n,r,s){i.destroy(),e.sendUnaryMessage(t,n,r,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function E(e,t,n,r){try{let i=await e.receiveUnaryMessage(r);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,n,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function C(e,t,n,r){let i=new s.ServerDuplexStreamImpl(e,n,t.serialize,t.deserialize,r);e.cancelled||t.func(i)}t.Server=T},68474:(e,t,n)=>{"use strict";e.exports=n(66771)},70155:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},t.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},t.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},70757:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=n(99978),s=n(93122);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(r||(t.PickResultType=r={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:r.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:r.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},71140:(e,t)=>{"use strict";var n=t,r=n.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=n.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):n?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};n.resolve=function(e,t,n){return(n||(t=i(t)),r(t))?t:(n||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},71202:(e,t,n)=>{"use strict";e.exports=s;var r=n(64824);((s.prototype=Object.create(r.prototype)).constructor=s).className="Method";var i=n(93107);function s(e,t,n,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},71866:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let r=n(29021);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;t.getDefaultRootsData=function(){return i?(null===s&&(s=r.readFileSync(i)),s):null}},73267:(e,t,n)=>{"use strict";e.exports=u;var r,i=n(64824);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=n(32110),a=n(61810),o=n(93107),l=/^required|optional|repeated$/;function u(e,t,n,r,s,u,c){if(o.isObject(r)?(c=s,u=r,r=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=s||void 0,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var n=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(n._edition=t.edition),n._defaultEdition="proto3",n},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof r&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,n){return i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};return this.resolve(),"required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.resolvedType instanceof r&&this.resolvedType.group&&(t.message_encoding="DELIMITED"),!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,n,r){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,n,{default:r}))}},u._configure=function(e){r=e}},73322:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let r=n(98605);class i{constructor(e,t,n){let r;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,r=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:r}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}t.setup=function(){(0,r.registerResolver)("unix",i)}},75108:e=>{"use strict";e.exports=function e(e,t){for(var n=Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,a(e))}})}},75280:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(n||(t.CompressionAlgorithms=n={}))},75535:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AbstractUserDataWriter:()=>gA,AggregateField:()=>my,AggregateQuerySnapshot:()=>mv,Bytes:()=>mb,CACHE_SIZE_UNLIMITED:()=>p7,CollectionReference:()=>pX,DocumentReference:()=>pJ,DocumentSnapshot:()=>gB,FieldPath:()=>mT,FieldValue:()=>mw,Firestore:()=>p9,FirestoreError:()=>M,GeoPoint:()=>mE,LoadBundleTask:()=>p8,PersistentCacheIndexManager:()=>yk,Query:()=>pY,QueryCompositeFilterConstraint:()=>ge,QueryConstraint:()=>m4,QueryDocumentSnapshot:()=>gU,QueryEndAtConstraint:()=>gh,QueryFieldFilterConstraint:()=>m7,QueryLimitConstraint:()=>gs,QueryOrderByConstraint:()=>gr,QuerySnapshot:()=>gV,QueryStartAtConstraint:()=>gl,SnapshotMetadata:()=>gF,Timestamp:()=>es,Transaction:()=>ym,VectorValue:()=>mC,WriteBatch:()=>yd,_AutoId:()=>Y,_ByteString:()=>ny,_DatabaseId:()=>nP,_DocumentKey:()=>ed,_EmptyAppCheckTokenProvider:()=>K,_EmptyAuthCredentialsProvider:()=>B,_FieldPath:()=>eh,_TestingHooks:()=>yF,_cast:()=>fJ,_debugAssert:()=>O,_internalAggregationQueryToProtoRunAggregationQueryRequest:()=>yL,_internalQueryToProtoQueryTarget:()=>yM,_isBase64Available:()=>ng,_logWarn:()=>k,_validateIsNotUsedTogether:()=>fK,addDoc:()=>g0,aggregateFieldEqual:()=>gx,aggregateQuerySnapshotEqual:()=>gP,and:()=>gn,arrayRemove:()=>yT,arrayUnion:()=>yb,average:()=>gN,clearIndexedDbPersistence:()=>ml,collection:()=>pZ,collectionGroup:()=>p0,connectFirestoreEmulator:()=>pQ,count:()=>gO,deleteAllPersistentCacheIndexes:()=>yO,deleteDoc:()=>gZ,deleteField:()=>yy,disableNetwork:()=>mh,disablePersistentCacheIndexAutoCreation:()=>yN,doc:()=>p1,documentId:()=>mS,enableIndexedDbPersistence:()=>ms,enableMultiTabIndexedDbPersistence:()=>ma,enableNetwork:()=>mc,enablePersistentCacheIndexAutoCreation:()=>yD,endAt:()=>gf,endBefore:()=>gd,ensureFirestoreConfigured:()=>mn,executeWrite:()=>g3,getAggregateFromServer:()=>g4,getCountFromServer:()=>g5,getDoc:()=>gG,getDocFromCache:()=>g$,getDocFromServer:()=>gH,getDocs:()=>gW,getDocsFromCache:()=>gQ,getDocsFromServer:()=>gY,getFirestore:()=>mt,getPersistentCacheIndexManager:()=>yR,increment:()=>yS,initializeFirestore:()=>me,limit:()=>ga,limitToLast:()=>go,loadBundle:()=>mf,memoryEagerGarbageCollector:()=>yn,memoryLocalCache:()=>yi,memoryLruGarbageCollector:()=>yr,namedQuery:()=>mp,onSnapshot:()=>g1,onSnapshotsInSync:()=>g2,or:()=>gt,orderBy:()=>gi,persistentLocalCache:()=>ys,persistentMultipleTabManager:()=>yu,persistentSingleTabManager:()=>yl,query:()=>m8,queryEqual:()=>p3,refEqual:()=>p2,runTransaction:()=>yg,serverTimestamp:()=>yv,setDoc:()=>gJ,setIndexConfiguration:()=>yC,setLogLevel:()=>I,snapshotEqual:()=>gz,startAfter:()=>gc,startAt:()=>gu,sum:()=>gD,terminate:()=>md,updateDoc:()=>gX,vector:()=>yw,waitForPendingWrites:()=>mu,where:()=>m9,writeBatch:()=>yE});var r,i,s,a,o=n(31305),l=n(35545),u=n(88060),c=n(28354),h=n(52122),d=n(55511),f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function n(e,t){var n=o;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}function s(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,n){void 0===n&&(n=e.length);for(var r=n-this.blockSize,i=this.B,s=this.h,a=0;a<n;){if(0==s)for(;a<=r;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<n;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<n;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=n},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var a,o={};function l(e){return -128<=e&&128>e?n(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return y(u(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new s(t,0)}function c(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return y(c(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=u(Math.pow(t,8)),r=h,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=u(Math.pow(t,s)),r=r.j(s).add(u(a))):r=(r=r.j(n)).add(u(a))}return r}var h=l(0),d=l(1),f=l(0x1000000);function m(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function y(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(d)}function v(e,t){return e.add(y(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function T(e,t){this.g=e,this.h=t}function S(e,t){if(m(t))throw Error("division by zero");if(m(e))return new T(h,h);if(g(e))return t=S(y(e),t),new T(y(t.g),y(t.h));if(g(t))return t=S(e,y(t)),new T(y(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=w(n),r=w(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!m(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=E(r,1),n=E(n,1)}return t=v(e,i.j(t)),new T(i,t)}for(i=h;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=u(n)).j(t);g(a)||0<a.l(e);)n-=r,a=(s=u(n)).j(t);m(s)&&(s=d),i=i.add(s),e=v(e,a)}return new T(i,e)}function w(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function E(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(i,e.h)}(a=s.prototype).m=function(){if(g(this))return-y(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},a.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(m(this))return"0";if(g(this))return"-"+y(this).toString(e);for(var t=u(Math.pow(e,6)),n=this,r="";;){var i=S(n,t).g,s=((0<(n=v(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(m(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},a.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},a.l=function(e){return g(e=v(this,e))?-1:+!m(e)},a.abs=function(){return g(this)?y(this):this},a.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new s(n,-0x80000000&n[n.length-1]?-1:0)},a.j=function(e){if(m(this)||m(e))return h;if(g(this))return g(e)?y(this).j(y(e)):y(y(this).j(e));if(g(e))return y(this.j(y(e)));if(0>this.l(f)&&0>e.l(f))return u(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(i)>>>16,c=65535&e.i(i);n[2*r+2*i]+=o*c,b(n,2*r+2*i),n[2*r+2*i+1]+=a*c,b(n,2*r+2*i+1),n[2*r+2*i+1]+=o*l,b(n,2*r+2*i+1),n[2*r+2*i+2]+=a*l,b(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},a.A=function(e){return S(this,e).h},a.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},a.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},a.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i=p.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=u,s.fromString=c,r=p.Integer=s}).apply(void 0!==f?f:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var m=n(30959),g=n(97587);let y="@firebase/firestore",v="4.7.10";class b{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let T="11.5.0";function S(e){T=e}function w(e){return(0,c.inspect)(e,{depth:100})}let E=new u.Vy("@firebase/firestore");function C(){return E.logLevel}function I(e){E.setLogLevel(e)}function _(e,...t){if(E.logLevel<=u.$b.DEBUG){let n=t.map(R);E.debug(`Firestore (${T}): ${e}`,...n)}}function A(e,...t){if(E.logLevel<=u.$b.ERROR){let n=t.map(R);E.error(`Firestore (${T}): ${e}`,...n)}}function k(e,...t){if(E.logLevel<=u.$b.WARN){let n=t.map(R);E.warn(`Firestore (${T}): ${e}`,...n)}}function R(e){if("string"==typeof e)return e;try{return w(e)}catch(t){return e}}function D(e="Unexpected state"){let t=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: `+e;throw A(t),Error(t)}function N(e,t){e||D()}function O(e,t){e||D()}function x(e,t){return e}let P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class M extends h.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class L{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class F{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class B{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(b.UNAUTHENTICATED))}shutdown(){}}class U{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class V{constructor(e){this.authProvider=e,this.currentUser=b.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){N(void 0===this.tokenListener);let n=this.tokenCounter,r=e=>this.tokenCounter!==n?(n=this.tokenCounter,t(e)):Promise.resolve(),i=new L;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new L,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new L)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(N("string"==typeof t.accessToken),new F(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return N(null===e||"string"==typeof e),new b(e)}}class j{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n,this.type="FirstParty",this.user=b.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class q{constructor(e,t,n){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=n}getToken(){return Promise.resolve(new j(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(b.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class z{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class G{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,o.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){N(void 0===this.tokenListener);let n=e=>{null!=e.error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,_("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?r(e):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new z(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(N("string"==typeof e.token),this.latestAppCheckToken=e.token,new z(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}class K{getToken(){return Promise.resolve(new z(""))}invalidateToken(){}start(e,t){}shutdown(){}}function $(e){if(!e)return new B;switch(e.type){case"firstParty":return new q(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new M(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function H(e){return(0,d.randomBytes)(e)}function W(){return new c.TextEncoder}function Q(){return new c.TextDecoder("utf-8")}class Y{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="",r=20;for(;n.length<r;){let i=H(40);for(let s=0;s<i.length;++s)n.length<r&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function J(e,t){return e<t?-1:+(e>t)}function X(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i)if(r<128&&i<128)return J(r,i);else{let s=W(),a=ee(s.encode(Z(e,n)),s.encode(Z(t,n)));if(0!==a)return a;return J(r,i)}n+=r>65535?2:1}return J(e.length,t.length)}function Z(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function ee(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return J(e[n],t[n]);return J(e.length,t.length)}function et(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function en(e){return e+"\0"}let er=-0xe7791f700,ei=1e6;class es{static now(){return es.fromMillis(Date.now())}static fromDate(e){return es.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*ei);return new es(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new M(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<er||e>=0x3afff44180)throw new M(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ei}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-er).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ea{static fromTimestamp(e){return new ea(e)}static min(){return new ea(new es(0,0))}static max(){return new ea(new es(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let eo="__name__";class el{constructor(e,t,n){void 0===t?t=0:t>e.length&&D(),void 0===n?n=e.length-t:n>e.length-t&&D(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===el.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof el?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=el.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return J(e.length,t.length)}static compareSegments(e,t){let n=el.isNumericId(e),r=el.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?el.extractNumericId(e).compare(el.extractNumericId(t)):X(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class eu extends el{construct(e,t,n){return new eu(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new M(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new eu(t)}static emptyPath(){return new eu([])}}let ec=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eh extends el{construct(e,t,n){return new eh(e,t,n)}static isValidIdentifier(e){return ec.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eh.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===eo}static keyField(){return new eh([eo])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new M(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new M(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new M(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new M(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eh(t)}static emptyPath(){return new eh([])}}class ed{constructor(e){this.path=e}static fromPath(e){return new ed(eu.fromString(e))}static fromName(e){return new ed(eu.fromString(e).popFirst(5))}static empty(){return new ed(eu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===eu.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return eu.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ed(new eu(e.slice()))}}let ef=-1,ep=0;class em{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function eg(e){return e.fields.find(e=>2===e.kind)}function ey(e){return e.fields.filter(e=>2!==e.kind)}function ev(e){let t=ey(e);return 0===t.length?0:t[t.length-1].kind}function eb(e,t){let n=J(e.collectionGroup,t.collectionGroup);if(0!==n)return n;for(let r=0;r<Math.min(e.fields.length,t.fields.length);++r)if(0!==(n=ew(e.fields[r],t.fields[r])))return n;return J(e.fields.length,t.fields.length)}function eT(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}em.UNKNOWN_ID=-1;class eS{constructor(e,t){this.fieldPath=e,this.kind=t}}function ew(e,t){let n=eh.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:J(e.kind,t.kind)}class eE{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eE(ep,e_.min())}}function eC(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new e_(ea.fromTimestamp(1e9===r?new es(n+1,0):new es(n,r)),ed.empty(),t)}function eI(e){return new e_(e.readTime,e.key,ef)}class e_{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new e_(ea.min(),ed.empty(),ef)}static max(){return new e_(ea.max(),ed.empty(),ef)}}function eA(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=ed.comparator(e.documentKey,t.documentKey))?n:J(e.largestBatchId,t.largestBatchId)}let ek="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eD(e){if(e.code===P.FAILED_PRECONDITION&&e.message===ek)_("LocalStore","Unexpectedly lost primary lease");else throw e}class eN{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eN((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof eN)return t;return eN.resolve(t)}catch(e){return eN.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eN.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eN.reject(t)}static resolve(e){return new eN((t,n)=>{t(e)})}static reject(e){return new eN((t,n)=>{n(e)})}static waitFor(e){return new eN((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=eN.resolve(!1);for(let n of e)t=t.next(e=>e?eN.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new eN((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new eN((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}let eO="SimpleDb",ex=3;class eP{static open(e,t,n,r){try{return new eP(t,e.transaction(r,n))}catch(e){throw new eB(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new L,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new eB(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let n=ez(t.target.error);this.completionDeferred.reject(new eB(e,n))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(_(eO,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eV(this.transaction.objectStore(e))}}class eM{static delete(e){return _(eO,"Removing database:",e),ej(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!(0,h.zW)())return!1;if(eM.isMockPersistence())return!0;let e=(0,h.ZQ)(),t=eM.getIOSVersion(e),n=0<t&&t<10,r=eL(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!n&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null==(e=process.env)?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.schemaConverter=n,12.2===eM.getIOSVersion((0,h.ZQ)())&&A("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(_(eO,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new eB(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new M(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new M(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new eB(e,r))},r.onupgradeneeded=e=>{_(eO,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,r.transaction,e.oldVersion,this.version).next(()=>{_(eO,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=eP.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),eN.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(n){let e=n,t="FirebaseError"!==e.name&&s<ex;if(_(eO,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eL(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eF{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ej(this.dbCursor.delete())}}class eB extends M{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eU(e){return"IndexedDbTransactionError"===e.name}class eV{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(_(eO,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(_(eO,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ej(n)}add(e){return _(eO,"ADD",this.store.name,e,e),ej(this.store.add(e))}get(e){return ej(this.store.get(e)).next(t=>(void 0===t&&(t=null),_(eO,"GET",this.store.name,e,t),t))}delete(e){return _(eO,"DELETE",this.store.name,e),ej(this.store.delete(e))}count(){return _(eO,"COUNT",this.store.name),ej(this.store.count())}loadAll(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new eN((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.iterateCursor(e,(e,n)=>{t.push(n)}).next(()=>t)}}loadFirst(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new eN((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){_(eO,"DELETE ALL",this.store.name);let n=this.options(e,t);n.keysOnly=!1;let r=this.cursor(n);return this.iterateCursor(r,(e,t,n)=>n.delete())}iterate(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.iterateCursor(r,t)}iterateSerial(e){let t=this.cursor({});return new eN((n,r)=>{t.onerror=e=>{r(ez(e.target.error))},t.onsuccess=t=>{let r=t.target.result;if(!r)return void n();e(r.primaryKey,r.value).next(e=>{e?r.continue():n()})}})}iterateCursor(e,t){let n=[];return new eN((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new eF(i),a=t(i.primaryKey,i.value,s);if(a instanceof eN){let e=a.catch(e=>(s.done(),eN.reject(e)));n.push(e)}s.isDone?r():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>eN.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let n=this.store.index(e.index);return e.keysOnly?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}}}function ej(e){return new eN((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(ez(e.target.error))}})}let eq=!1;function ez(e){let t=eM.getIOSVersion((0,h.ZQ)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new M("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eq||(eq=!0,setTimeout(()=>{throw e},0)),e}}return e}let eG="IndexBackfiller",eK=15e3,e$=6e4,eH=50;class eW{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(eK)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){_(eG,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();_(eG,`Documents written: ${e}`)}catch(e){eU(e)?_(eG,"Ignoring IndexedDB error during index backfill: ",e):await eD(e)}await this.schedule(e$)})}}class eQ{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=eH){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let n=new Set,r=t,i=!0;return eN.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||n.has(t)))return _(eG,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}writeEntriesForCollectionGroup(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(r,n)).next(n=>(_(eG,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}getNewOffset(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=eI(t);eA(r,n)>0&&(n=r)}),new e_(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eY{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}eY.INVALID=-1;let eJ="\x01",eX="\x01",eZ="\x10",e0="\x11";function e1(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=e3(t)),t=e2(e.get(n),t);return e3(t)}function e2(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+=eJ+eZ;break;case eJ:n+=eJ+e0;break;default:n+=r}}return n}function e3(e){return e+eJ+eX}function e6(e){let t=e.length;if(N(t>=2),2===t)return N(e.charAt(0)===eJ&&e.charAt(1)===eX),eu.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf(eJ,s);switch((t<0||t>n)&&D(),e.charAt(t+1)){case eX:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case eZ:i+=e.substring(s,t),i+="\0";break;case e0:i+=e.substring(s,t+1);break;default:D()}s=t+2}return new eu(r)}let e5="remoteDocuments",e4="owner",e8="owner",e7="mutationQueues",e9="userId",te="mutations",tt="batchId",tn="userMutationsIndex",tr=["userId","batchId"];function ti(e){return[e]}function ts(e,t){return[e,e1(t)]}function ta(e,t,n){return[e,e1(t),n]}let to={},tl="documentMutations",tu="remoteDocumentsV14",tc=["prefixPath","collectionGroup","readTime","documentId"],th="documentKeyIndex",td=["prefixPath","collectionGroup","documentId"],tf="collectionGroupIndex",tp=["collectionGroup","readTime","prefixPath","documentId"],tm="remoteDocumentGlobal",tg="remoteDocumentGlobalKey",ty="targets",tv="targetId",tb="queryTargetsIndex",tT=["canonicalId","targetId"],tS="targetDocuments",tw=["targetId","path"],tE="documentTargetsIndex",tC=["path","targetId"],tI="targetGlobalKey",t_="targetGlobal",tA="collectionParents",tk=["collectionId","parent"],tR="clientMetadata",tD="clientId",tN="bundles",tO="bundleId",tx="namedQueries",tP="name",tM="indexConfiguration",tL="indexId",tF="collectionGroupIndex",tB="collectionGroup",tU="indexState",tV=["indexId","uid"],tj="sequenceNumberIndex",tq=["uid","sequenceNumber"],tz="indexEntries",tG=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tK="documentKeyIndex",t$=["indexId","uid","orderedDocumentKey"],tH="documentOverlays",tW=["userId","collectionPath","documentId"],tQ="collectionPathOverlayIndex",tY=["userId","collectionPath","largestBatchId"],tJ="collectionGroupOverlayIndex",tX=["userId","collectionGroup","largestBatchId"],tZ="globals",t0="name",t1=[e7,te,tl,e5,ty,e4,t_,tS,tR,tm,tA,tN,tx],t2=[...t1,tH],t3=[e7,te,tl,tu,ty,e4,t_,tS,tR,tm,tA,tN,tx,tH],t6=t3,t5=[...t6,tM,tU,tz],t4=t5,t8=[...t5,tZ];function t7(e){return 17===e?t8:16===e?t4:15===e?t5:14===e?t6:13===e?t3:12===e?t2:11===e?t1:void D()}class t9 extends eR{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function ne(e,t){let n=x(e);return eM.getStore(n.simpleDbTransaction,t)}function nt(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function nn(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nr(e,t){let n=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(t(e[r],r,e));return n}function ni(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ns{constructor(e,t){this.comparator=e,this.root=t||no.EMPTY}insert(e,t){return new ns(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,no.BLACK,null,null))}remove(e){return new ns(this.comparator,this.root.remove(e,this.comparator).copy(null,null,no.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new na(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new na(this.root,e,this.comparator,!1)}getReverseIterator(){return new na(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new na(this.root,e,this.comparator,!0)}}class na{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class no{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:no.RED,this.left=null!=r?r:no.EMPTY,this.right=null!=i?i:no.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new no(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return no.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key))if(r.right.isEmpty())return no.EMPTY;else n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin());r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,no.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,no.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw D()}}no.EMPTY=null,no.RED=!0,no.BLACK=!1;class nl{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(e,t,n,r,i){return this}insert(e,t,n){return new no(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}no.EMPTY=new nl;class nu{constructor(e){this.comparator=e,this.data=new ns(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nc(this.data.getIterator())}getIteratorFrom(e){return new nc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nu)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nu(this.comparator);return t.data=e,t}}class nc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function nh(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=nd(s),l=nd(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=nd(a)):t?(i(o),o=nd(s)):(o=nd(s),l=nd(a))}}function nd(e){return e.hasNext()?e.getNext():void 0}class nf{constructor(e){this.fields=e,e.sort(eh.comparator)}static empty(){return new nf([])}unionWith(e){let t=new nu(eh.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new nf(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return et(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function np(e){return Buffer.from(e,"base64").toString("binary")}function nm(e){return Buffer.from(e,"binary").toString("base64")}function ng(){return!0}class ny{constructor(e){this.binaryString=e}static fromBase64String(e){return new ny(np(e))}static fromUint8Array(e){return new ny(nv(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return nm(this.binaryString)}toUint8Array(){return nb(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function nv(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}function nb(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}ny.EMPTY_BYTE_STRING=new ny("");let nT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nS(e){if(N(!!e),"string"==typeof e){let t=0,n=nT.exec(e);if(N(!!n),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nw(e.seconds),nanos:nw(e.nanos)}}function nw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nE(e){return"string"==typeof e?ny.fromBase64String(e):ny.fromUint8Array(e)}let nC="server_timestamp",nI="__type__",n_="__previous_value__",nA="__local_write_time__";function nk(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nI])?void 0:n.stringValue)===nC}function nR(e,t){let n={fields:{[nI]:{stringValue:nC},[nA]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&nk(t)&&(t=nD(t)),t&&(n.fields[n_]=t),{mapValue:n}}function nD(e){let t=e.mapValue.fields[n_];return nk(t)?nD(t):t}function nN(e){let t=nS(e.mapValue.fields[nA].timestampValue);return new es(t.seconds,t.nanos)}class nO{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let nx="(default)";class nP{constructor(e,t){this.projectId=e,this.database=t||nx}static empty(){return new nP("","")}get isDefaultDatabase(){return this.database===nx}isEqual(e){return e instanceof nP&&e.projectId===this.projectId&&e.database===this.database}}function nM(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new M(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nP(e.options.projectId,t)}let nL=-1;function nF(e){return null==e}function nB(e){return 0===e&&1/e==-1/0}function nU(e){return"number"==typeof e&&Number.isInteger(e)&&!nB(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let nV="__type__",nj="__max__",nq={mapValue:{fields:{__type__:{stringValue:nj}}}},nz="__vector__",nG="value",nK={nullValue:"NULL_VALUE"};function n$(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nk(e)?4:rT(e)?0x1fffffffffffff:rv(e)?10:11:D()}function nH(e,t){if(e===t)return!0;let n=n$(e);if(n!==n$(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nN(e).isEqual(nN(t));case 3:return nW(e,t);case 5:return e.stringValue===t.stringValue;case 6:return nY(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return nQ(e,t);case 2:return nJ(e,t);case 9:return et(e.arrayValue.values||[],t.arrayValue.values||[],nH);case 10:case 11:return nX(e,t);default:return D()}}function nW(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=nS(e.timestampValue),r=nS(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}function nQ(e,t){return nw(e.geoPointValue.latitude)===nw(t.geoPointValue.latitude)&&nw(e.geoPointValue.longitude)===nw(t.geoPointValue.longitude)}function nY(e,t){return nE(e.bytesValue).isEqual(nE(t.bytesValue))}function nJ(e,t){if("integerValue"in e&&"integerValue"in t)return nw(e.integerValue)===nw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=nw(e.doubleValue),r=nw(t.doubleValue);return n===r?nB(n)===nB(r):isNaN(n)&&isNaN(r)}return!1}function nX(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(nt(n)!==nt(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!nH(n[e],r[e])))return!1;return!0}function nZ(e,t){return void 0!==(e.values||[]).find(e=>nH(e,t))}function n0(e,t){if(e===t)return 0;let n=n$(e),r=n$(t);if(n!==r)return J(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return J(e.booleanValue,t.booleanValue);case 2:return n1(e,t);case 3:return n2(e.timestampValue,t.timestampValue);case 4:return n2(nN(e),nN(t));case 5:return X(e.stringValue,t.stringValue);case 6:return n5(e.bytesValue,t.bytesValue);case 7:return n3(e.referenceValue,t.referenceValue);case 8:return n6(e.geoPointValue,t.geoPointValue);case 9:return n4(e.arrayValue,t.arrayValue);case 10:return n8(e.mapValue,t.mapValue);case 11:return n7(e.mapValue,t.mapValue);default:throw D()}}function n1(e,t){let n=nw(e.integerValue||e.doubleValue),r=nw(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}function n2(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return J(e,t);let n=nS(e),r=nS(t),i=J(n.seconds,r.seconds);return 0!==i?i:J(n.nanos,r.nanos)}function n3(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=J(n[e],r[e]);if(0!==t)return t}return J(n.length,r.length)}function n6(e,t){let n=J(nw(e.latitude),nw(t.latitude));return 0!==n?n:J(nw(e.longitude),nw(t.longitude))}function n5(e,t){let n=nE(e),r=nE(t);return n.compareTo(r)}function n4(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=n0(n[e],r[e]);if(t)return t}return J(n.length,r.length)}function n8(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null==(n=a[nG])?void 0:n.arrayValue,u=null==(r=o[nG])?void 0:r.arrayValue,c=J((null==(i=null==l?void 0:l.values)?void 0:i.length)||0,(null==(s=null==u?void 0:u.values)?void 0:s.length)||0);return 0!==c?c:n4(l,u)}function n7(e,t){if(e===nq.mapValue&&t===nq.mapValue)return 0;if(e===nq.mapValue)return 1;if(t===nq.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=X(r[e],s[e]);if(0!==t)return t;let a=n0(n[r[e]],i[s[e]]);if(0!==a)return a}return J(r.length,s.length)}function n9(e){return re(e)}function re(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return rn(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return rt(e.bytesValue);else if("referenceValue"in e)return ri(e.referenceValue);else if("geoPointValue"in e)return rr(e.geoPointValue);else if("arrayValue"in e)return ra(e.arrayValue);else if("mapValue"in e)return rs(e.mapValue);else return D()}function rt(e){return nE(e).toBase64()}function rn(e){let t=nS(e);return`time(${t.seconds},${t.nanos})`}function rr(e){return`geo(${e.latitude},${e.longitude})`}function ri(e){return ed.fromName(e).toString()}function rs(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${re(e.fields[i])}`;return n+"}"}function ra(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=re(r);return t+"]"}function ro(e){switch(n$(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=nD(e);return t?16+ro(t):16;case 5:return 2*e.stringValue.length;case 6:return nE(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return ru(e.arrayValue);case 10:case 11:return rl(e.mapValue);default:throw D()}}function rl(e){let t=0;return nn(e.fields,(e,n)=>{t+=e.length+ro(n)}),t}function ru(e){return(e.values||[]).reduce((e,t)=>e+ro(t),0)}function rc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rh(e){return!!e&&"integerValue"in e}function rd(e){return!!e&&"doubleValue"in e}function rf(e){return rh(e)||rd(e)}function rp(e){return!!e&&"arrayValue"in e}function rm(e){return!!e&&"nullValue"in e}function rg(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ry(e){return!!e&&"mapValue"in e}function rv(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nV])?void 0:n.stringValue)===nz}function rb(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return nn(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=rb(n)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=rb(e.arrayValue.values[n]);return t}}function rT(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nj}let rS={mapValue:{fields:{[nV]:{stringValue:nz},[nG]:{arrayValue:{}}}}};function rw(e){if("nullValue"in e)return nK;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return rc(nP.empty(),ed.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return D();else return rv(e)?rS:{mapValue:{}}}function rE(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return rc(nP.empty(),ed.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return rS;else if(!("mapValue"in e))return D();else return rv(e)?{mapValue:{}}:nq}function rC(e,t){let n=n0(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function rI(e,t){let n=n0(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class r_{constructor(e){this.value=e}static empty(){return new r_({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!ry(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rb(t)}setAll(e){let t=eh.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=rb(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());ry(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nH(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ry(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(nn(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new r_(rb(this.value))}}function rA(e){let t=[];return nn(e.fields,(e,n)=>{let r=new eh([e]);if(ry(n)){let e=rA(n.mapValue).fields;if(0===e.length)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)}),new nf(t)}class rk{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rk(e,0,ea.min(),ea.min(),ea.min(),r_.empty(),0)}static newFoundDocument(e,t,n,r){return new rk(e,1,t,ea.min(),n,r,0)}static newNoDocument(e,t){return new rk(e,2,t,ea.min(),ea.min(),r_.empty(),0)}static newUnknownDocument(e,t){return new rk(e,3,t,ea.min(),ea.min(),r_.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ea.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=r_.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=r_.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ea.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rk&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rk(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function rR(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?n0(r,i):D()}class rD{constructor(e,t){this.position=e,this.inclusive=t}}function rN(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ed.comparator(ed.fromName(a.referenceValue),n.key):n0(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function rO(e,t,n){let r=rN(e,t,n);return e.inclusive?r>=0:r>0}function rx(e,t,n){let r=rN(e,t,n);return e.inclusive?r<=0:r<0}function rP(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nH(e.position[n],t.position[n]))return!1;return!0}class rM{constructor(e,t="asc"){this.field=e,this.dir=t}}function rL(e){return e.field.canonicalString()+e.dir}function rF(e){return`${e.field.canonicalString()} (${e.dir})`}function rB(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class rU{}class rV extends rU{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,n);else return new r0(e,t,n);if("array-contains"===t)return new r6(e,n);if("in"===t)return new r5(e,n);if("not-in"===t)return new r4(e,n);if("array-contains-any"===t)return new r8(e,n);else return new rV(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new r1(e,n):new r2(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(n0(t,this.value)):null!==t&&n$(this.value)===n$(t)&&this.matchesComparison(n0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rj extends rU{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new rj(e,t)}matches(e){return rq(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function rq(e){return"and"===e.op}function rz(e){return"or"===e.op}function rG(e){return rK(e)&&rq(e)}function rK(e){for(let t of e.filters)if(t instanceof rj)return!1;return!0}function r$(e){if(e instanceof rV)return e.field.canonicalString()+e.op.toString()+n9(e.value);{if(rG(e))return e.filters.map(e=>r$(e)).join(",");let t=e.filters.map(e=>r$(e)).join(",");return`${e.op}(${t})`}}function rH(e,t){return e instanceof rV?rW(e,t):e instanceof rj?rQ(e,t):void D()}function rW(e,t){return t instanceof rV&&e.op===t.op&&e.field.isEqual(t.field)&&nH(e.value,t.value)}function rQ(e,t){return t instanceof rj&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&rH(n,t.filters[r]),!0)}function rY(e,t){let n=e.filters.concat(t);return rj.create(n,e.op)}function rJ(e){return e instanceof rV?rZ(e):e instanceof rj?rX(e):"Filter"}function rX(e){return e.op.toString()+" {"+e.getFilters().map(rJ).join(" ,")+"}"}function rZ(e){return`${e.field.canonicalString()} ${e.op} ${n9(e.value)}`}class r0 extends rV{constructor(e,t,n){super(e,t,n),this.key=ed.fromName(n.referenceValue)}matches(e){let t=ed.comparator(e.key,this.key);return this.matchesComparison(t)}}class r1 extends rV{constructor(e,t){super(e,"in",t),this.keys=r3("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class r2 extends rV{constructor(e,t){super(e,"not-in",t),this.keys=r3("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function r3(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>ed.fromName(e.referenceValue))}class r6 extends rV{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rp(t)&&nZ(t.arrayValue,this.value)}}class r5 extends rV{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nZ(this.value.arrayValue,t)}}class r4 extends rV{constructor(e,t){super(e,"not-in",t)}matches(e){if(nZ(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!nZ(this.value.arrayValue,t)}}class r8 extends rV{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!rp(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>nZ(this.value.arrayValue,e))}}class r7{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function r9(e,t=null,n=[],r=[],i=null,s=null,a=null){return new r7(e,t,n,r,i,s,a)}function ie(e){let t=x(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>r$(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>rL(e)).join(","),nF(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>n9(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>n9(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function it(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>rJ(e)).join(", ")}]`),nF(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>rF(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>n9(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>n9(e)).join(",")),`Target(${t})`}function ir(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!rB(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!rH(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rP(e.startAt,t.startAt)&&rP(e.endAt,t.endAt)}function ii(e){return ed.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function is(e,t){return e.filters.filter(e=>e instanceof rV&&e.field.isEqual(t))}function ia(e,t){let n=eg(t);if(void 0===n)return null;for(let t of is(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function io(e,t){let n=new Map;for(let r of ey(t))for(let t of is(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}function il(e,t){let n=[],r=!0;for(let i of ey(t)){let t=0===i.kind?ic(e,i.fieldPath,e.startAt):ih(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new rD(n,r)}function iu(e,t){let n=[],r=!0;for(let i of ey(t)){let t=0===i.kind?ih(e,i.fieldPath,e.endAt):ic(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new rD(n,r)}function ic(e,t,n){let r=nK,i=!0;for(let n of is(e,t)){let e=nK,t=!0;switch(n.op){case"<":case"<=":e=rw(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=nK}0>rC({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>rC({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function ih(e,t,n){let r=nq,i=!0;for(let n of is(e,t)){let e=nq,t=!0;switch(n.op){case">=":case">":e=rE(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=nq}rI({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];rI({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function id(e){let t=new nu(eh.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}function ip(e){return null!==e.limit}class im{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function ig(e,t,n,r,i,s,a,o){return new im(e,t,n,r,i,s,a,o)}function iy(e){return new im(e)}function iv(e,t){return new im(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function ib(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function iT(e){let t=new nu(eh.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function iS(e){return new im(eu.emptyPath(),e)}function iw(e){return ed.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iE(e){return null!==e.collectionGroup}function iC(e){let t=x(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let n of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";iT(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.memoizedNormalizedOrderBy.push(new rM(r,n))}),e.has(eh.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new rM(eh.keyField(),n))}return t.memoizedNormalizedOrderBy}function iI(e){let t=x(e);return t.memoizedTarget||(t.memoizedTarget=iA(t,iC(e))),t.memoizedTarget}function i_(e){let t=x(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=iA(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function iA(e,t){if("F"===e.limitType)return r9(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rM(e.field,t)});let n=e.endAt?new rD(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new rD(e.startAt.position,e.startAt.inclusive):null;return r9(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ik(e,t){let n=e.filters.concat([t]);return new im(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function iR(e,t){let n=e.explicitOrderBy.concat([t]);return new im(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function iD(e,t,n){return new im(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function iN(e,t){return new im(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function iO(e,t){return new im(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function ix(e,t){return ir(iI(e),iI(t))&&e.limitType===t.limitType}function iP(e){return`${ie(iI(e))}|lt:${e.limitType}`}function iM(e){return`Query(target=${it(iI(e))}; limitType=${e.limitType})`}function iL(e,t){return t.isFoundDocument()&&iF(e,t)&&iB(e,t)&&iU(e,t)&&iV(e,t)}function iF(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ed.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}function iB(e,t){for(let n of iC(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}function iU(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}function iV(e,t){return(!e.startAt||!!rx(e.startAt,iC(e),t))&&(!e.endAt||!!rO(e.endAt,iC(e),t))}function ij(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function iq(e){return(t,n)=>{let r=!1;for(let i of iC(e)){let e=iz(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function iz(e,t,n){let r=e.field.isKeyField()?ed.comparator(t.key,n.key):rR(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return D()}}class iG{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r){this.inner[n]=[[e,t]],this.innerSize++;return}for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e)){r[n]=[e,t];return}r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){nn(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return ni(this.inner)}size(){return this.innerSize}}let iK=new ns(ed.comparator);function i$(){return iK}let iH=new ns(ed.comparator);function iW(...e){let t=iH;for(let n of e)t=t.insert(n.key,n);return t}function iQ(){return iZ()}function iY(e){let t=iH;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function iJ(){return iZ()}function iX(){return iZ()}function iZ(){return new iG(e=>e.toString(),(e,t)=>e.isEqual(t))}let i0=new ns(ed.comparator);function i1(){return i0}let i2=new nu(ed.comparator);function i3(...e){let t=i2;for(let n of e)t=t.add(n);return t}let i6=new nu(J);function i5(){return i6}function i4(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nB(t)?"-0":t}}function i8(e){return{integerValue:""+e}}function i7(e,t){return nU(t)?i8(t):i4(e,t)}class i9{constructor(){this._=void 0}}function se(e,t,n){return e instanceof si?nR(n,t):e instanceof ss?sa(e,t):e instanceof so?sl(e,t):sc(e,t)}function st(e,t,n){return e instanceof ss?sa(e,t):e instanceof so?sl(e,t):n}function sn(e,t){return e instanceof su?rf(t)?t:{integerValue:0}:null}function sr(e,t){return e instanceof ss&&t instanceof ss||e instanceof so&&t instanceof so?et(e.elements,t.elements,nH):e instanceof su&&t instanceof su?nH(e.operand,t.operand):e instanceof si&&t instanceof si}class si extends i9{}class ss extends i9{constructor(e){super(),this.elements=e}}function sa(e,t){let n=sd(t);for(let t of e.elements)n.some(e=>nH(e,t))||n.push(t);return{arrayValue:{values:n}}}class so extends i9{constructor(e){super(),this.elements=e}}function sl(e,t){let n=sd(t);for(let t of e.elements)n=n.filter(e=>!nH(e,t));return{arrayValue:{values:n}}}class su extends i9{constructor(e,t){super(),this.serializer=e,this.operand=t}}function sc(e,t){let n=sn(e,t),r=sh(n)+sh(e.operand);return rh(n)&&rh(e.operand)?i8(r):i4(e.serializer,r)}function sh(e){return nw(e.integerValue||e.doubleValue)}function sd(e){return rp(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sf{constructor(e,t){this.field=e,this.transform=t}}function sp(e,t){return e.field.isEqual(t.field)&&sr(e.transform,t.transform)}function sm(e,t){return void 0===e&&void 0===t||!!e&&!!t&&et(e,t,(e,t)=>sp(e,t))}class sg{constructor(e,t){this.version=e,this.transformResults=t}}class sy{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sy}static exists(e){return new sy(void 0,e)}static updateTime(e){return new sy(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sv(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sb{}function sT(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new sP(e.key,sy.none());else return new sI(e.key,e.data,sy.none());{let n=e.data,r=r_.empty(),i=new nu(eh.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new sk(e.key,r,new nf(i.toArray()),sy.none())}}function sS(e,t,n){e instanceof sI?s_(e,t,n):e instanceof sk?sR(e,t,n):sM(e,t,n)}function sw(e,t,n,r){return e instanceof sI?sA(e,t,n,r):e instanceof sk?sD(e,t,n,r):sL(e,t,n)}function sE(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sn(r.transform,e||null);null!=i&&(null===n&&(n=r_.empty()),n.set(r.field,i))}return n||null}function sC(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!sm(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sI extends sb{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}function s_(e,t,n){let r=e.value.clone(),i=sO(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}function sA(e,t,n,r){if(!sv(e.precondition,t))return n;let i=e.value.clone(),s=sx(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class sk extends sb{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sR(e,t,n){if(!sv(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=sO(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(sN(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}function sD(e,t,n,r){if(!sv(e.precondition,t))return n;let i=sx(e.fieldTransforms,r,t),s=t.data;return(s.setAll(sN(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function sN(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function sO(e,t,n){let r=new Map;N(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,st(a,o,n[i]))}return r}function sx(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,se(e,s,t))}return r}class sP extends sb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function sM(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}function sL(e,t,n){return sv(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}class sF extends sb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sB{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&sS(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=sw(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=sw(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=iX();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sT(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(ea.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),i3())}isEqual(e){return this.batchId===e.batchId&&et(this.mutations,e.mutations,(e,t)=>sC(e,t))&&et(this.baseMutations,e.baseMutations,(e,t)=>sC(e,t))}}class sU{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){N(e.mutations.length===n.length);let r=i1(),i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new sU(e,t,n,r)}}class sV{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class sj{constructor(e,t){this.count=e,this.unchangedNames=t}}function sq(e){switch(e){case P.OK:return D();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return D()}}function sz(e){return sq(e)&&e!==P.ABORTED}function sG(e){if(void 0===e)return A("GRPC error has no .code"),P.UNKNOWN;switch(e){case s.OK:return P.OK;case s.CANCELLED:return P.CANCELLED;case s.UNKNOWN:return P.UNKNOWN;case s.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case s.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case s.INTERNAL:return P.INTERNAL;case s.UNAVAILABLE:return P.UNAVAILABLE;case s.UNAUTHENTICATED:return P.UNAUTHENTICATED;case s.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case s.NOT_FOUND:return P.NOT_FOUND;case s.ALREADY_EXISTS:return P.ALREADY_EXISTS;case s.PERMISSION_DENIED:return P.PERMISSION_DENIED;case s.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case s.ABORTED:return P.ABORTED;case s.OUT_OF_RANGE:return P.OUT_OF_RANGE;case s.UNIMPLEMENTED:return P.UNIMPLEMENTED;case s.DATA_LOSS:return P.DATA_LOSS;default:return D()}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(s||(s={}));class sK extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let s$=null;function sH(e){if(s$)throw Error("a TestingHooksSpi instance is already set");s$=e}let sW=new r([0xffffffff,0xffffffff],0);function sQ(e){let t=W().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function sY(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new r([n,i],0),new r([s,a],0)]}class sJ{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new sX(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new sX(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new sX(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=r.fromNumber(this.bitCount)}getBitIndex(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(sW)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,n]=sY(sQ(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);if(!this.isBitSet(r))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,i=new sJ(new Uint8Array(Math.ceil(e/8)),r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,n]=sY(sQ(e));for(let e=0;e<this.hashCount;e++){let r=this.getBitIndex(t,n,e);this.setBit(r)}}setBit(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class sX extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sZ{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,s0.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sZ(ea.min(),r,new ns(J),i$(),i3())}}class s0{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new s0(n,t,i3(),i3(),i3())}}class s1{constructor(e,t,n,r){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=n,this.newDoc=r}}class s2{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class s3{constructor(e,t,n=ny.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class s6{constructor(){this.pendingResponses=0,this.documentChanges=s7(),this._resumeToken=ny.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=i3(),t=i3(),n=i3();return this.documentChanges.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:D()}}),new s0(this._resumeToken,this._current,e,t,n)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=s7()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,N(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let s5="WatchChangeAggregator";class s4{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=i$(),this.pendingDocumentUpdatesByTarget=s8(),this.pendingDocumentTargetMapping=s8(),this.pendingTargetResets=new ns(J)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let n=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&n.updateResumeToken(e.resumeToken);break;case 1:n.recordTargetResponse(),n.isPending||n.clearPendingChanges(),n.updateResumeToken(e.resumeToken);break;case 2:n.recordTargetResponse(),n.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(n.markCurrent(),n.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),n.updateResumeToken(e.resumeToken));break;default:D()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,n)=>{this.isActiveTarget(n)&&t(n)})}handleExistenceFilter(e){let t=e.targetId,n=e.existenceFilter.count,r=this.targetDataForActiveTarget(t);if(r){let i=r.target;if(ii(i))if(0===n){let e=new ed(i.path);this.removeDocumentFromTarget(t,e,rk.newNoDocument(e,ea.min()))}else N(1===n);else{let r=this.getCurrentDocumentCountForTarget(t);if(r!==n){let n=this.parseBloomFilter(e),i=n?this.applyBloomFilter(n,e,r):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}null==s$||s$.notifyOnExistenceFilterMismatch(s9(r,e.existenceFilter,this.metadataProvider.getDatabaseId(),n,i))}}}}parseBloomFilter(e){let t,n,r=e.existenceFilter.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=nE(i).toUint8Array()}catch(e){if(e instanceof sK)return k("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new sJ(t,s,a)}catch(e){return e instanceof sX?k("BloomFilter error: ",e):k("Applying bloom filter failed: ",e),null}return 0===n.bitCount?null:n}applyBloomFilter(e,t,n){return 2*(t.existenceFilter.count!==n-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let n=this.metadataProvider.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,n,null),r++)}),r}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((n,r)=>{let i=this.targetDataForActiveTarget(r);if(i){if(n.current&&ii(i.target)){let t=new ed(i.target.path);this.ensureDocumentUpdateByTarget(t).has(r)||this.targetContainsDocument(r,t)||this.removeDocumentFromTarget(r,t,rk.newNoDocument(t,e))}n.hasPendingChanges&&(t.set(r,n.toTargetChange()),n.clearPendingChanges())}});let n=i3();this.pendingDocumentTargetMapping.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.pendingDocumentUpdates.forEach((t,n)=>n.setReadTime(e));let r=new sZ(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,n);return this.pendingDocumentUpdates=i$(),this.pendingDocumentUpdatesByTarget=s8(),this.pendingDocumentTargetMapping=s8(),this.pendingTargetResets=new ns(J),r}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let n=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,n){if(!this.isActiveTarget(e))return;let r=this.ensureTargetState(e);this.targetContainsDocument(e,t)?r.addDocumentChange(t,1):r.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,n))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new s6,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new nu(J),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new nu(J),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||_(s5,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new s6),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function s8(){return new ns(ed.comparator)}function s7(){return new ns(ed.comparator)}function s9(e,t,n,r,i){var s,a,o,l,u,c;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!=(s=null==d?void 0:d.hashCount)?s:0,bitmapLength:null!=(l=null==(o=null==(a=null==d?void 0:d.bits)?void 0:a.bitmap)?void 0:o.length)?l:0,padding:null!=(c=null==(u=null==d?void 0:d.bits)?void 0:u.padding)?c:0,mightContain:e=>{var t;return null!=(t=null==r?void 0:r.mightContain(e))&&t}}),h}let ae=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),at=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),an=(()=>{let e={};return e.and="AND",e.or="OR",e})();class ar{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ai(e){return new M(void 0===e.code?P.UNKNOWN:sG(e.code),e.message||"")}function as(e,t){return e.useProto3Json||nF(t)?t:{value:t}}function aa(e){let t;return nF(t="object"==typeof e?e.value:e)?null:t}function ao(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),n=("000000000"+t.nanoseconds).slice(-9);return`${e}.${n}Z`}}function al(e){let t=nS(e);return new es(t.seconds,t.nanos)}function au(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ac(e,t){return e.useProto3Json?(N(void 0===t||"string"==typeof t),ny.fromBase64String(t||"")):(N(void 0===t||t instanceof Buffer||t instanceof Uint8Array),ny.fromUint8Array(t||new Uint8Array))}function ah(e,t){return ao(e,t.toTimestamp())}function ad(e){return N(!!e),ea.fromTimestamp(al(e))}function af(e,t){return ap(e,t).canonicalString()}function ap(e,t){let n=aS(e).child("documents");return void 0===t?n:n.child(t)}function am(e){let t=eu.fromString(e);return N(od(t)),t}function ag(e,t){return af(e.databaseId,t.path)}function ay(e,t){let n=am(t);if(n.get(1)!==e.databaseId.projectId)throw new M(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new M(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ed(aw(n))}function av(e,t){return af(e.databaseId,t)}function ab(e){let t=am(e);return 4===t.length?eu.emptyPath():aw(t)}function aT(e){return new eu(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aS(e){return new eu(["projects",e.projectId,"databases",e.database])}function aw(e){return N(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function aE(e,t,n){return{name:ag(e,t),fields:n.value.mapValue.fields}}function aC(e,t){return{name:ag(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ao(e,t.version.toTimestamp()),createTime:ao(e,t.createTime.toTimestamp())}}function aI(e,t,n){let r=ay(e,t.name),i=ad(t.updateTime),s=t.createTime?ad(t.createTime):ea.min(),a=new r_({mapValue:{fields:t.fields}}),o=rk.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function a_(e,t){N(!!t.found),t.found.name,t.found.updateTime;let n=ay(e,t.found.name),r=ad(t.found.updateTime),i=t.found.createTime?ad(t.found.createTime):ea.min(),s=new r_({mapValue:{fields:t.found.fields}});return rk.newFoundDocument(n,r,i,s)}function aA(e,t){N(!!t.missing),N(!!t.readTime);let n=ay(e,t.missing),r=ad(t.readTime);return rk.newNoDocument(n,r)}function ak(e,t){return"found"in t?a_(e,t):"missing"in t?aA(e,t):D()}function aR(e,t){let n;if("targetChange"in t){t.targetChange;let r=aD(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=ac(e,t.targetChange.resumeToken),a=t.targetChange.cause;n=new s3(r,i,s,a&&ai(a)||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=ay(e,r.document.name),s=ad(r.document.updateTime),a=r.document.createTime?ad(r.document.createTime):ea.min(),o=new r_({mapValue:{fields:r.document.fields}}),l=rk.newFoundDocument(i,s,a,o);n=new s1(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=ay(e,r.document),s=r.readTime?ad(r.readTime):ea.min(),a=rk.newNoDocument(i,s);n=new s1([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=ay(e,r.document);n=new s1([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return D();t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new sj(r,i);n=new s2(e.targetId,s)}return n}function aD(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return D()}function aN(e){if(!("targetChange"in e))return ea.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?ea.min():ad(t.readTime)}function aO(e,t){let n;if(t instanceof sI)n={update:aE(e,t.key,t.value)};else if(t instanceof sP)n={delete:ag(e,t.key)};else if(t instanceof sk)n={update:aE(e,t.key,t.data),updateMask:oc(t.fieldMask)};else{if(!(t instanceof sF))return D();n={verify:ag(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(t=>aB(e,t))),t.precondition.isNone||(n.currentDocument=aP(e,t.precondition)),n}function ax(e,t){let n=t.currentDocument?aM(t.currentDocument):sy.none(),r=t.updateTransforms?t.updateTransforms.map(t=>aU(e,t)):[];if(t.update){t.update.name;let i=ay(e,t.update.name),s=new r_({mapValue:{fields:t.update.fields}});return t.updateMask?new sk(i,s,oh(t.updateMask),n,r):new sI(i,s,n,r)}return t.delete?new sP(ay(e,t.delete),n):t.verify?new sF(ay(e,t.verify),n):D()}function aP(e,t){return void 0!==t.updateTime?{updateTime:ah(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:D()}function aM(e){return void 0!==e.updateTime?sy.updateTime(ad(e.updateTime)):void 0!==e.exists?sy.exists(e.exists):sy.none()}function aL(e,t){let n=e.updateTime?ad(e.updateTime):ad(t);return n.isEqual(ea.min())&&(n=ad(t)),new sg(n,e.transformResults||[])}function aF(e,t){return e&&e.length>0?(N(void 0!==t),e.map(e=>aL(e,t))):[]}function aB(e,t){let n=t.transform;if(n instanceof si)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ss)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof so)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof su)return{fieldPath:t.field.canonicalString(),increment:n.operand};throw D()}function aU(e,t){let n=null;return"setToServerValue"in t?(N("REQUEST_TIME"===t.setToServerValue),n=new si):"appendMissingElements"in t?n=new ss(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new so(t.removeAllFromArray.values||[]):"increment"in t?n=new su(e,t.increment):D(),new sf(eh.fromServerFormat(t.fieldPath),n)}function aV(e,t){return{documents:[av(e,t.path)]}}function aj(e){return N(1===e.documents.length),iI(iy(ab(e.documents[0])))}function aq(e,t){let n,r={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n=i,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=i.popLast(),r.structuredQuery.from=[{collectionId:i.lastSegment()}]),r.parent=av(e,n);let s=aQ(t.filters);s&&(r.structuredQuery.where=s);let a=aX(t.orderBy);a&&(r.structuredQuery.orderBy=a);let o=as(e,t.limit);return null!==o&&(r.structuredQuery.limit=o),t.startAt&&(r.structuredQuery.startAt=a0(t.startAt)),t.endAt&&(r.structuredQuery.endAt=a1(t.endAt)),{queryTarget:r,parent:n}}function az(e,t,n,r){let{queryTarget:i,parent:s}=aq(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:oe(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:oe(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function aG(e){let t=ab(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){N(1===r);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=aY(n.where));let a=[];n.orderBy&&(a=aZ(n.orderBy));let o=null;n.limit&&(o=aa(n.limit));let l=null;n.startAt&&(l=a2(n.startAt));let u=null;return n.endAt&&(u=a3(n.endAt)),ig(t,i,a,s,o,"F",l,u)}function aK(e){return iI(aG(e))}function a$(e,t){let n=aH(t.purpose);return null==n?null:{"goog-listen-tags":n}}function aH(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D()}}function aW(e,t){let n,r=t.target;if((n=ii(r)?{documents:aV(e,r)}:{query:aq(e,r).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=au(e,t.resumeToken);let r=as(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ea.min())>0){n.readTime=ao(e,t.snapshotVersion.toTimestamp());let r=as(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}function aQ(e){if(0!==e.length)return oi(rj.create(e,"and"))}function aY(e){let t=aJ(e);return t instanceof rj&&rG(t)?t.getFilters():[t]}function aJ(e){return void 0!==e.unaryFilter?oo(e):void 0!==e.fieldFilter?ol(e):void 0!==e.compositeFilter?ou(e):D()}function aX(e){if(0!==e.length)return e.map(e=>on(e))}function aZ(e){return e.map(e=>or(e))}function a0(e){return{before:e.inclusive,values:e.position}}function a1(e){return{before:!e.inclusive,values:e.position}}function a2(e){let t=!!e.before;return new rD(e.values||[],t)}function a3(e){let t=!e.before;return new rD(e.values||[],t)}function a6(e){return ae[e]}function a5(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function a4(e){return at[e]}function a8(e){return an[e]}function a7(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}function a9(e){switch(e){case"AND":return"and";case"OR":return"or";default:return D()}}function oe(e){return{fieldPath:e.canonicalString()}}function ot(e){return eh.fromServerFormat(e.fieldPath)}function on(e){return{field:oe(e.field),direction:a6(e.dir)}}function or(e){return new rM(ot(e.field),a5(e.direction))}function oi(e){return e instanceof rV?oa(e):e instanceof rj?os(e):D()}function os(e){let t=e.getFilters().map(e=>oi(e));return 1===t.length?t[0]:{compositeFilter:{op:a8(e.op),filters:t}}}function oa(e){if("=="===e.op){if(rg(e.value))return{unaryFilter:{field:oe(e.field),op:"IS_NAN"}};else if(rm(e.value))return{unaryFilter:{field:oe(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rg(e.value))return{unaryFilter:{field:oe(e.field),op:"IS_NOT_NAN"}};else if(rm(e.value))return{unaryFilter:{field:oe(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oe(e.field),op:a4(e.op),value:e.value}}}function oo(e){switch(e.unaryFilter.op){case"IS_NAN":let t=ot(e.unaryFilter.field);return rV.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=ot(e.unaryFilter.field);return rV.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ot(e.unaryFilter.field);return rV.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ot(e.unaryFilter.field);return rV.create(i,"!=",{nullValue:"NULL_VALUE"});default:return D()}}function ol(e){return rV.create(ot(e.fieldFilter.field),a7(e.fieldFilter.op),e.fieldFilter.value)}function ou(e){return rj.create(e.compositeFilter.filters.map(e=>aJ(e)),a9(e.compositeFilter.op))}function oc(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function oh(e){return new nf((e.fieldPaths||[]).map(e=>eh.fromServerFormat(e)))}function od(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class of{constructor(e,t,n,r,i=ea.min(),s=ea.min(),a=ny.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new of(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new of(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new of(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new of(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class op{constructor(e){this.remoteSerializer=e}}function om(e,t){let n;if(t.document)n=aI(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ed.fromSegments(t.noDocument.path),r=oT(t.noDocument.readTime);n=rk.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return D();let e=ed.fromSegments(t.unknownDocument.path),r=oT(t.unknownDocument.version);n=rk.newUnknownDocument(e,r)}return t.readTime&&n.setReadTime(ov(t.readTime)),n}function og(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:oy(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=aC(e.remoteSerializer,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ob(t.version)};else{if(!t.isUnknownDocument())return D();r.unknownDocument={path:n.path.toArray(),version:ob(t.version)}}return r}function oy(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ov(e){let t=new es(e[0],e[1]);return ea.fromTimestamp(t)}function ob(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function oT(e){let t=new es(e.seconds,e.nanoseconds);return ea.fromTimestamp(t)}function oS(e,t,n){let r=n.baseMutations.map(t=>aO(e.remoteSerializer,t)),i=n.mutations.map(t=>aO(e.remoteSerializer,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function ow(e,t){let n=(t.baseMutations||[]).map(t=>ax(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>ax(e.remoteSerializer,t)),i=es.fromMillis(t.localWriteTimeMs);return new sB(t.batchId,i,n,r)}function oE(e){let t,n=oT(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?oT(e.lastLimboFreeSnapshotVersion):ea.min();return new of(t=oI(e.query)?aj(e.query):aK(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,ny.fromBase64String(e.resumeToken))}function oC(e,t){let n,r=ob(t.snapshotVersion),i=ob(t.lastLimboFreeSnapshotVersion);n=ii(t.target)?aV(e.remoteSerializer,t.target):aq(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ie(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function oI(e){return void 0!==e.documents}function o_(e){return{id:e.bundleId,createTime:oT(e.createTime),version:e.version}}function oA(e){return{bundleId:e.id,createTime:ob(ad(e.createTime)),version:e.version}}function ok(e){return{name:e.name,query:oD(e.bundledQuery),readTime:oT(e.readTime)}}function oR(e){return{name:e.name,readTime:ob(ad(e.readTime)),bundledQuery:e.bundledQuery}}function oD(e){let t=aG({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iD(t,t.limit,"L"):t}function oN(e){return{name:e.name,query:oD(e.bundledQuery),readTime:ad(e.readTime)}}function oO(e){return{id:e.id,version:e.version,createTime:ad(e.createTime)}}function ox(e,t){return new sV(t.largestBatchId,ax(e.remoteSerializer,t.overlayMutation))}function oP(e,t,n){let[r,i,s]=oM(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:aO(e.remoteSerializer,n.mutation)}}function oM(e,t){let n=t.path.lastSegment();return[e,e1(t.path.popLast()),n]}function oL(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function oF(e,t){let n=t?new eE(t.sequenceNumber,new e_(oT(t.readTime),new ed(e6(t.documentKey)),t.largestBatchId)):eE.empty(),r=e.fields.map(([e,t])=>new eS(eh.fromServerFormat(e),t));return new em(e.indexId,e.collectionGroup,r,n)}function oB(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:ob(r.readTime),documentKey:e1(r.documentKey.path),largestBatchId:r.largestBatchId}}class oU{getBundleMetadata(e,t){return oV(e).get(t).next(e=>{if(e)return o_(e)})}saveBundleMetadata(e,t){return oV(e).put(oA(t))}getNamedQuery(e,t){return oj(e).get(t).next(e=>{if(e)return ok(e)})}saveNamedQuery(e,t){return oj(e).put(oR(t))}}function oV(e){return ne(e,tN)}function oj(e){return ne(e,tx)}class oq{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new oq(e,t.uid||"")}getOverlay(e,t){return oz(e).get(oM(this.userId,t)).next(e=>e?ox(this.serializer,e):null)}getOverlays(e,t){let n=iJ();return eN.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new sV(t,i);r.push(this.saveOverlay(e,s))}),eN.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(e1(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(oz(e).deleteAll(tQ,r))}),eN.waitFor(i)}getOverlaysForCollection(e,t,n){let r=iJ(),i=e1(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return oz(e).loadAll(tQ,s).next(e=>{for(let t of e){let e=ox(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=iJ(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return oz(e).iterate({index:tJ,range:a},(e,t,n)=>{let a=ox(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}saveOverlay(e,t){return oz(e).put(oP(this.serializer,this.userId,t))}}function oz(e){return ne(e,tH)}class oG{globalsStore(e){return ne(e,tZ)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?ny.fromUint8Array(t):ny.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let oK=5,o$=10,oH=13,oW=15,oQ=20,oY=25,oJ=30,oX=37,oZ=45,o0=50,o1=53,o2=55,o3=60,o6=2;class o5{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,oK);else if("booleanValue"in e)this.writeValueTypeLabel(t,o$),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,oW),t.writeNumber(nw(e.integerValue));else if("doubleValue"in e){let n=nw(e.doubleValue);isNaN(n)?this.writeValueTypeLabel(t,oH):(this.writeValueTypeLabel(t,oW),nB(n)?t.writeNumber(0):t.writeNumber(n))}else if("timestampValue"in e){let n=e.timestampValue;this.writeValueTypeLabel(t,oQ),"string"==typeof n&&(n=nS(n)),t.writeString(`${n.seconds||""}`),t.writeNumber(n.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,oJ),t.writeBytes(nE(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.writeValueTypeLabel(t,oZ),t.writeNumber(n.latitude||0),t.writeNumber(n.longitude||0)}else"mapValue"in e?rT(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):rv(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):D()}writeIndexString(e,t){this.writeValueTypeLabel(t,oY),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let n=e.fields||{};for(let e of(this.writeValueTypeLabel(t,o2),Object.keys(n)))this.writeIndexString(e,t),this.writeIndexValueAux(n[e],t)}writeIndexVector(e,t){var n,r;let i=e.fields||{};this.writeValueTypeLabel(t,o1);let s=nG,a=(null==(r=null==(n=i[s].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.writeValueTypeLabel(t,oW),t.writeNumber(nw(a)),this.writeIndexString(s,t),this.writeIndexValueAux(i[s],t)}writeIndexArray(e,t){let n=e.values||[];for(let e of(this.writeValueTypeLabel(t,o0),n))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,oX),ed.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,o3),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(o6)}}o5.INSTANCE=new o5;let o4="\uD800",o8="\uDBFF",o7=0,o9=255,le=1,lt=255,ln=255,lr=0,li=64,ls=8,la=1024;function lo(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function ll(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function lu(e){let t=0;for(let n=0;n<8;++n){let r=ll(255&e[n]);if(t+=r,8!==r)break}return t}function lc(e){return Math.ceil((li-lu(e))/ls)}class lh{constructor(){this.buffer=new Uint8Array(la),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteAscending(n.value),n=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.writeByteDescending(n.value),n=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<o4||o8<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<o4||o8<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),n=lc(t);this.ensureAvailable(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),n=lc(t);this.ensureAvailable(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(lt),this.writeEscapedByteAscending(ln)}writeInfinityDescending(){this.writeEscapedByteDescending(lt),this.writeEscapedByteDescending(ln)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=lo(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!n;return t}writeByteAscending(e){let t=255&e;t===o7?(this.writeEscapedByteAscending(o7),this.writeEscapedByteAscending(o9)):t===lt?(this.writeEscapedByteAscending(lt),this.writeEscapedByteAscending(lr)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===o7?(this.writeEscapedByteDescending(o7),this.writeEscapedByteDescending(o9)):t===lt?(this.writeEscapedByteDescending(lt),this.writeEscapedByteDescending(lr)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(o7),this.writeEscapedByteAscending(le)}writeSeparatorDescending(){this.writeEscapedByteDescending(o7),this.writeEscapedByteDescending(le)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ld{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class lf{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class lp{constructor(){this.orderedCode=new lh,this.ascending=new ld(this.orderedCode),this.descending=new lf(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class lm{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}successor(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new lm(this.indexId,this.documentKey,this.arrayValue,n)}}function lg(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=ly(e.arrayValue,t.arrayValue))||0!==(n=ly(e.directionalValue,t.directionalValue))?n:ed.comparator(e.documentKey,t.documentKey)}function ly(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class lv{constructor(e){for(let t of(this.inequalityFilters=new nu((e,t)=>eh.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(N(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=eg(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let n=ey(e),r=new Set,i=0,s=0;for(;i<n.length;++i)if(this.hasMatchingEqualityFilter(n[i]))r=r.add(n[i].fieldPath.canonicalString());else break;if(i===n.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new nu(eh.comparator),t=[];for(let n of this.equalityFilters)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new eS(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new eS(n.field,0))}for(let n of this.orderBys)!n.field.isKeyField()&&(e.has(n.field)||(e=e.add(n.field),t.push(new eS(n.field,+("asc"!==n.dir)))));return new em(em.UNKNOWN_ID,this.collectionId,t,eE.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lb(e){var t,n;if(N(e instanceof rV||e instanceof rj),e instanceof rV)if(!(e instanceof r5))return e;else{let r=(null==(n=null==(t=e.value.arrayValue)?void 0:t.values)?void 0:n.map(t=>rV.create(e.field,"==",t)))||[];return rj.create(r,"or")}let r=e.filters.map(e=>lb(e));return rj.create(r,e.op)}function lT(e){if(0===e.getFilters().length)return[];let t=lI(lb(e));return(N(lE(t)),lS(t)||lw(t))?[t]:t.getFilters()}function lS(e){return e instanceof rV}function lw(e){return e instanceof rj&&rG(e)}function lE(e){return lS(e)||lw(e)||lC(e)}function lC(e){if(e instanceof rj&&rz(e)){for(let t of e.getFilters())if(!lS(t)&&!lw(t))return!1;return!0}return!1}function lI(e){if(N(e instanceof rV||e instanceof rj),e instanceof rV)return e;if(1===e.filters.length)return lI(e.filters[0]);let t=e.filters.map(e=>lI(e)),n=rj.create(t,e.op);return lE(n=lD(n))?n:(N(n instanceof rj),N(rq(n)),N(n.filters.length>1),n.filters.reduce((e,t)=>l_(e,t)))}function l_(e,t){let n;return N(e instanceof rV||e instanceof rj),N(t instanceof rV||t instanceof rj),lD(n=e instanceof rV?t instanceof rV?lA(e,t):lR(e,t):t instanceof rV?lR(t,e):lk(e,t))}function lA(e,t){return rj.create([e,t],"and")}function lk(e,t){if(N(e.filters.length>0&&t.filters.length>0),rq(e)&&rq(t))return rY(e,t.getFilters());let n=rz(e)?e:t,r=rz(e)?t:e,i=n.filters.map(e=>l_(e,r));return rj.create(i,"or")}function lR(e,t){if(rq(t))return rY(t,e.getFilters());{let n=t.filters.map(t=>l_(e,t));return rj.create(n,"or")}}function lD(e){if(N(e instanceof rV||e instanceof rj),e instanceof rV)return e;let t=e.getFilters();if(1===t.length)return lD(t[0]);if(rK(e))return e;let n=t.map(e=>lD(e)),r=[];return(n.forEach(t=>{t instanceof rV?r.push(t):t instanceof rj&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length)?r[0]:rj.create(r,e.op)}class lN{constructor(){this.collectionParentIndex=new lO}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),eN.resolve()}getCollectionParents(e,t){return eN.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return eN.resolve()}deleteFieldIndex(e,t){return eN.resolve()}deleteAllFieldIndexes(e){return eN.resolve()}createTargetIndexes(e,t){return eN.resolve()}getDocumentsMatchingTarget(e,t){return eN.resolve(null)}getIndexType(e,t){return eN.resolve(0)}getFieldIndexes(e,t){return eN.resolve([])}getNextCollectionGroupToUpdate(e){return eN.resolve(null)}getMinOffset(e,t){return eN.resolve(e_.min())}getMinOffsetFromCollectionGroup(e,t){return eN.resolve(e_.min())}updateCollectionGroup(e,t,n){return eN.resolve()}updateIndexEntries(e,t){return eN.resolve()}}class lO{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new nu(eu.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new nu(eu.comparator)).toArray()}}let lx="IndexedDbIndexManager",lP=new Uint8Array(0);class lM{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new lO,this.targetToDnfSubTargets=new iG(e=>ie(e),(e,t)=>ir(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:n,parent:e1(r)};return lL(e).put(i)}return eN.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[en(t),""],!1,!0);return lL(e).loadAll(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(e6(r.parent))}return n})}addFieldIndex(e,t){let n=lB(e),r=oL(t);delete r.indexId;let i=n.add(r);if(!t.indexState)return i.next();{let n=lU(e);return i.next(e=>{n.put(oB(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let n=lB(e),r=lU(e),i=lF(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=lB(e),n=lF(e),r=lU(e);return t.deleteAll().next(()=>n.deleteAll()).next(()=>r.deleteAll())}createTargetIndexes(e,t){return eN.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new lv(t).buildTargetIndex();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=lF(e),r=!0,i=new Map;return eN.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(!r)return eN.resolve(null);{let e=i3(),r=[];return eN.forEach(i,(i,s)=>{_(lx,`Using index ${eT(i)} to execute ${ie(t)}`);let a=ia(s,i),o=io(s,i),l=il(s,i),u=iu(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),f=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return eN.forEach(f,i=>n.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let n=ed.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:lT(rj.create(e.filters,"and")).map(t=>r9(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):lP,h=this.generateLowerBound(e,o,n[c%l],r),d=this.generateUpperBound(e,o,i[c%l],s),f=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,f))}return u}generateLowerBound(e,t,n,r){let i=new lm(e,ed.empty(),t,n);return r?i:i.successor()}generateUpperBound(e,t,n,r){let i=new lm(e,ed.empty(),t,n);return r?i.successor():i}getFieldIndex(e,t){let n=new lv(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.servedByIndex(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.getSubTargets(t);return eN.forEach(r,t=>this.getFieldIndex(e,t).next(e=>{e?0!==n&&e.fields.length<id(t)&&(n=1):n=0})).next(()=>ip(t)&&r.length>1&&2===n?1:n)}encodeDirectionalElements(e,t){let n=new lp;for(let r of ey(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.forKind(r.kind);o5.INSTANCE.writeIndexValue(e,i)}return n.encodedBytes()}encodeSingleElement(e){let t=new lp;return o5.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let n=new lp;return o5.INSTANCE.writeIndexValue(rc(this.databaseId,t),n.forKind(ev(e))),n.encodedBytes()}encodeValues(e,t,n){if(null===n)return[];let r=[];r.push(new lp);let i=0;for(let s of ey(e)){let e=n[i++];for(let n of r)if(this.isInFilter(t,s.fieldPath)&&rp(e))r=this.expandIndexValues(r,s,e);else{let t=n.forKind(s.kind);o5.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(r)}encodeBound(e,t,n){return this.encodeValues(e,t,n.position)}getEncodedBytes(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].encodedBytes();return t}expandIndexValues(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new lp;r.seed(n.encodedBytes()),o5.INSTANCE.writeIndexValue(e,r.forKind(t.kind)),i.push(r)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof rV&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=lB(e),r=lU(e);return(t?n.loadAll(tF,IDBKeyRange.bound(t,t)):n.loadAll()).next(e=>{let t=[];return eN.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(oF(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:J(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=lB(e),i=lU(e);return this.getNextSequenceNumber(e).next(e=>r.loadAll(tF,IDBKeyRange.bound(t,t)).next(t=>eN.forEach(t,t=>i.put(oB(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return eN.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?eN.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),eN.forEach(i,n=>this.getExistingIndexEntries(e,t,n).next(t=>{let i=this.computeIndexEntries(r,n);return t.isEqual(i)?eN.resolve():this.updateEntries(e,r,n,t,i)}))))})}addIndexEntry(e,t,n,r){return lF(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(n,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,n,r){return lF(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.encodeDirectionalKey(n,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,n){let r=lF(e),i=new nu(lg);return r.iterate({index:tK,range:IDBKeyRange.only([n.indexId,this.uid,this.encodeDirectionalKey(n,t)])},(e,r)=>{i=i.add(new lm(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}computeIndexEntries(e,t){let n=new nu(lg),r=this.encodeDirectionalElements(t,e);if(null==r)return n;let i=eg(t);if(null!=i){let s=e.data.field(i.fieldPath);if(rp(s))for(let i of s.arrayValue.values||[])n=n.add(new lm(t.indexId,e.key,this.encodeSingleElement(i),r))}else n=n.add(new lm(t.indexId,e.key,lP,r));return n}updateEntries(e,t,n,r,i){_(lx,"Updating index entries for document '%s'",t.key);let s=[];return nh(r,i,lg,r=>{s.push(this.addIndexEntry(e,t,n,r))},r=>{s.push(this.deleteIndexEntry(e,t,n,r))}),eN.waitFor(s)}getNextSequenceNumber(e){let t=1;return lU(e).iterate({index:tj,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>lg(e,t)).filter((e,t,n)=>!t||0!==lg(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=lg(i,e),s=lg(i,t);if(0===n)r[0]=e.successor();else if(n>0&&s<0)r.push(i),r.push(i.successor());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.isRangeMatchable(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,lP,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,lP,[]];i.push(IDBKeyRange.bound(t,n))}return i}isRangeMatchable(e,t){return lg(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lV)}getMinOffset(e,t){return eN.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||D())).next(lV)}}function lL(e){return ne(e,tA)}function lF(e){return ne(e,tz)}function lB(e){return ne(e,tM)}function lU(e){return ne(e,tU)}function lV(e){N(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>eA(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new e_(t.readTime,t.documentKey,n)}function lj(e,t,n){let r=e.store(te),i=e.store(tl),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.iterate({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{N(1===o)}));let u=[];for(let e of n.mutations){let r=ta(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return eN.waitFor(s).next(()=>u)}function lq(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw D();return JSON.stringify(t).length}class lz{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}static forUser(e,t,n,r){return N(""!==e.uid),new lz(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return l$(e).iterate({index:tn,range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=lH(e),s=l$(e);return s.add({}).next(a=>{N("number"==typeof a);let o=new sB(a,t,n,r),l=oS(this.serializer,this.userId,o),u=[],c=new nu((e,t)=>J(e.canonicalString(),t.canonicalString()));for(let e of r){let t=ta(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,to))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),eN.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return l$(e).get(t).next(e=>e?(N(e.userId===this.userId),ow(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?eN.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let n=e.keys();return this.documentKeysByBatchId[t]=n,n}})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return l$(e).iterate({index:tn,range:r},(e,t,r)=>{t.userId===this.userId&&(N(t.batchId>=n),i=ow(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=nL;return l$(e).iterate({index:tn,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,nL],[this.userId,Number.POSITIVE_INFINITY]);return l$(e).loadAll(tn,t).next(e=>e.map(e=>ow(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=ts(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return lH(e).iterate({range:r},(n,r,s)=>{let[a,o,l]=n,u=e6(o);return a===this.userId&&t.path.isEqual(u)?l$(e).get(l).next(e=>{if(!e)throw D();N(e.userId===this.userId),i.push(ow(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nu(J),r=[];return t.forEach(t=>{let i=ts(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=lH(e).iterate({range:s},(e,r,i)=>{let[s,a,o]=e,l=e6(a);if(s!==this.userId||!t.path.isEqual(l))return void i.done();n=n.add(o)});r.push(a)}),eN.waitFor(r).next(()=>this.lookupMutationBatches(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=ts(this.userId,n),s=IDBKeyRange.lowerBound(i),a=new nu(J);return lH(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=e6(o);if(s!==this.userId||!n.isPrefixOf(u))return void i.done();u.length===r&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let n=[],r=[];return t.forEach(t=>{r.push(l$(e).get(t).next(e=>{if(null===e)throw D();N(e.userId===this.userId),n.push(ow(this.serializer,e))}))}),eN.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return lj(e.simpleDbTransaction,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),eN.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eN.resolve();let n=IDBKeyRange.lowerBound(ti(this.userId)),r=[];return lH(e).iterate({range:n},(e,t,n)=>{if(e[0]!==this.userId)return void n.done();{let t=e6(e[1]);r.push(t)}}).next(()=>{N(0===r.length)})})}containsKey(e,t){return lG(e,this.userId,t)}getMutationQueueMetadata(e){return lW(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:nL,lastStreamToken:""})}}function lG(e,t,n){let r=ts(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return lH(e).iterate({range:s,keysOnly:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function lK(e,t){let n=!1;return lW(e).iterateSerial(r=>lG(e,r,t).next(e=>(e&&(n=!0),eN.resolve(!e)))).next(()=>n)}function l$(e){return ne(e,te)}function lH(e){return ne(e,tl)}function lW(e){return ne(e,e7)}let lQ=2;class lY{constructor(e){this.lastId=e}next(){return this.lastId+=lQ,this.lastId}static forTargetCache(){return new lY(2-lQ)}static forSyncEngine(){return new lY(1-lQ)}}class lJ{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let n=new lY(t.highestTargetId);return t.highestTargetId=n.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>ea.fromTimestamp(new es(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.retrieveMetadata(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.saveMetadata(e,r)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(n=>(n.targetCount+=1,this.updateMetadataFromTargetData(t,n),this.saveMetadata(e,n))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lX(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(N(t.targetCount>0),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,n){let r=0,i=[];return lX(e).iterate((s,a)=>{let o=oE(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>eN.waitFor(i)).next(()=>r)}forEachTarget(e,t){return lX(e).iterate((e,n)=>{t(oE(n))})}retrieveMetadata(e){return lZ(e).get(tI).next(e=>(N(null!==e),e))}saveMetadata(e,t){return lZ(e).put(tI,t)}saveTargetData(e,t){return lX(e).put(oC(this.serializer,t))}updateMetadataFromTargetData(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let n=ie(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return lX(e).iterate({range:r,index:tb},(e,n,r)=>{let s=oE(n);ir(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=l0(e);return t.forEach(t=>{let s=e1(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),eN.waitFor(r)}removeMatchingKeys(e,t,n){let r=l0(e);return eN.forEach(t,t=>{let i=e1(t.path);return eN.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=l0(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=l0(e),i=i3();return r.iterate({range:n,keysOnly:!0},(e,t,n)=>{let r=new ed(e6(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=e1(t.path),r=IDBKeyRange.bound([n],[en(n)],!1,!0),i=0;return l0(e).iterate({index:tE,keysOnly:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return lX(e).get(t).next(e=>e?oE(e):null)}}function lX(e){return ne(e,ty)}function lZ(e){return ne(e,t_)}function l0(e){return ne(e,tS)}let l1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},l2=-1,l3=0x2800000;class l6{static withCacheSize(e){return new l6(e,l6.DEFAULT_COLLECTION_PERCENTILE,l6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}l6.DEFAULT_COLLECTION_PERCENTILE=10,l6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,l6.DEFAULT=new l6(l3,l6.DEFAULT_COLLECTION_PERCENTILE,l6.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),l6.DISABLED=new l6(l2,0,0);let l5="LruGarbageCollector",l4=1048576,l8=6e4,l7=3e5;function l9([e,t],[n,r]){let i=J(e,n);return 0===i?J(t,r):i}class ue{constructor(e){this.maxElements=e,this.buffer=new nu(l9),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>l9(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ut{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==l2&&this.scheduleGC(l8)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){_(l5,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eU(e)?_(l5,"Ignoring IndexedDB error during garbage collection: ",e):await eD(e)}await this.scheduleGC(l7)})}}class un{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eN.resolve(eY.INVALID);let n=new ue(t);return this.delegate.forEachTarget(e,e=>n.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>n.addElement(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.delegate.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===l2?(_("LruGarbageCollector","Garbage collection skipped; disabled"),eN.resolve(l1)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),l1):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let n,r,i,s,a,o,l,c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),C()<=u.$b.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-c}ms
	Determined least recently used ${r} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-c}ms`),eN.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function ur(e,t){return new un(e,t)}class ui{constructor(e,t){this.db=e,this.garbageCollector=ur(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,n)=>t(n))}addReference(e,t,n){return uo(e,n)}removeReference(e,t,n){return uo(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return uo(e,t)}isPinned(e,t){return lK(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ea.min()),l0(e).delete(us(s))))});r.push(t)}}).next(()=>eN.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return uo(e,t)}forEachOrphanedDocument(e,t){let n,r=l0(e),i=eY.INVALID;return r.iterate({index:tE},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==eY.INVALID&&t(new ed(e6(n)),i),i=a,n=s):i=eY.INVALID}).next(()=>{i!==eY.INVALID&&t(new ed(e6(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function us(e){return[0,e1(e.path)]}function ua(e,t){return{targetId:0,path:e1(e.path),sequenceNumber:t}}function uo(e,t){return l0(e).put(ua(t,e.currentSequenceNumber))}class ul{constructor(){this.changes=new iG(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rk.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?eN.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uu{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return uf(e).put(n)}removeEntry(e,t,n){return uf(e).delete(um(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.setMetadata(e,n)))}getEntry(e,t){let n=rk.newInvalidDocument(t);return uf(e).iterate({index:th,range:IDBKeyRange.only(up(t))},(e,r)=>{n=this.maybeDecodeDocument(t,r)}).next(()=>n)}getSizedEntry(e,t){let n={size:0,document:rk.newInvalidDocument(t)};return uf(e).iterate({index:th,range:IDBKeyRange.only(up(t))},(e,r)=>{n={document:this.maybeDecodeDocument(t,r),size:lq(r)}}).next(()=>n)}getEntries(e,t){let n=i$();return this.forEachDbEntry(e,t,(e,t)=>{let r=this.maybeDecodeDocument(e,t);n=n.insert(e,r)}).next(()=>n)}getSizedEntries(e,t){let n=i$(),r=new ns(ed.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);n=n.insert(e,i),r=r.insert(e,lq(t))}).next(()=>({documents:n,sizeMap:r}))}forEachDbEntry(e,t,n){if(t.isEmpty())return eN.resolve();let r=new nu(uy);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(up(r.first()),up(r.last())),s=r.getIterator(),a=s.getNext();return uf(e).iterate({index:th,range:i},(e,t,r)=>{let i=ed.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>uy(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.skip(up(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oy(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return uf(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=i$();for(let i of e){let e=this.maybeDecodeDocument(ed.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(iL(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=i$(),s=ug(t,n),a=ug(t,e_.max());return uf(e).iterate({index:tf,range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.maybeDecodeDocument(ed.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new uh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return ud(e).get(tg).next(e=>(N(!!e),e))}setMetadata(e,t){return ud(e).put(tg,t)}maybeDecodeDocument(e,t){if(t){let e=om(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ea.min())))return e}return rk.newInvalidDocument(e)}}function uc(e){return new uu(e)}class uh extends ul{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new iG(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new nu((e,t)=>J(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=og(this.documentCache.serializer,s);r=r.add(i.path.popLast());let l=lq(o);n+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=og(this.documentCache.serializer,s.convertToNoDocument(ea.min()));t.push(this.documentCache.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.documentCache.updateMetadata(e,n)),eN.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,n)=>{this.documentStates.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function ud(e){return ne(e,tm)}function uf(e){return ne(e,tu)}function up(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function um(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],oy(t),n[n.length-1]]}function ug(e,t){let n=t.documentKey.path.toArray();return[e,oy(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function uy(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=J(n[e],r[e]))return i;return(i=J(n.length,r.length))||(i=J(n[n.length-2],r[r.length-2]))?i:J(n[n.length-1],r[r.length-1])}let uv=17;class ub{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class uT{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&sw(n.mutation,e,nf.empty(),es.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,i3()).next(()=>t))}getLocalViewOfDocuments(e,t,n=i3()){let r=iJ();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=iW();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=iJ();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,i3()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=i$(),s=iZ(),a=iQ();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof sk)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sw(a.mutation,t,a.mutation.getFieldMask(),es.now())):s.set(t.key,nf.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new ub(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=iZ(),r=new ns((e,t)=>e-t),i=i3();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||nf.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||i3()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=iX();l.forEach(e=>{if(!i.has(e)){let r=sT(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eN.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return iw(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):eN.resolve(iJ()),a=ef,o=i;return s.next(t=>eN.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t))?eN.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,i3())).next(e=>({batchId:a,changes:iY(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ed(t)).next(e=>{let t=iW();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=iW();return this.indexManager.getCollectionParents(e,i).next(a=>eN.forEach(a,a=>{let o=iv(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,rk.newInvalidDocument(r)))});let n=iW();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&sw(s.mutation,r,nf.empty(),es.now()),iL(t,r)&&(n=n.insert(e,r))}),n})}}class uS{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return eN.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,oO(t)),eN.resolve()}getNamedQuery(e,t){return eN.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,oN(t)),eN.resolve()}}class uw{constructor(){this.overlays=new ns(ed.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return eN.resolve(this.overlays.get(t))}getOverlays(e,t){let n=iJ();return eN.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.saveOverlay(e,t,r)}),eN.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.overlayByBatchId.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(n)),eN.resolve()}getOverlaysForCollection(e,t,n){let r=iJ(),i=t.length+1,s=new ed(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return eN.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ns((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=iJ(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=iJ(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return eN.resolve(a)}saveOverlay(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.overlayByBatchId.get(r.largestBatchId).delete(n.key);this.overlayByBatchId.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new sV(t,n));let i=this.overlayByBatchId.get(t);void 0===i&&(i=i3(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(n.key))}}class uE{constructor(){this.sessionToken=ny.EMPTY_BYTE_STRING}getSessionToken(e){return eN.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eN.resolve()}}class uC{constructor(){this.refsByKey=new nu(uI.compareByKey),this.refsByTarget=new nu(uI.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let n=new uI(e,t);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new uI(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new ed(new eu([])),n=new uI(t,e),r=new uI(t,e+1),i=[];return this.refsByTarget.forEachInRange([n,r],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new ed(new eu([])),n=new uI(t,e),r=new uI(t,e+1),i=i3();return this.refsByTarget.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new uI(e,0),n=this.refsByKey.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class uI{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return ed.comparator(e.key,t.key)||J(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return J(e.targetOrBatchId,t.targetOrBatchId)||ed.comparator(e.key,t.key)}}class u_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new nu(uI.compareByKey)}checkEmpty(e){return eN.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sB(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new uI(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eN.resolve(s)}lookupMutationBatch(e,t){return eN.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.indexOfBatchId(n),i=r<0?0:r;return eN.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return eN.resolve(0===this.mutationQueue.length?nL:this.nextBatchId-1)}getAllMutationBatches(e){return eN.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new uI(t,0),r=new uI(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([n,r],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),eN.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nu(J);return t.forEach(e=>{let t=new uI(e,0),r=new uI(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,r],e=>{n=n.add(e.targetOrBatchId)})}),eN.resolve(this.findMutationBatches(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;ed.isDocumentKey(i)||(i=i.child(""));let s=new uI(new ed(i),0),a=new nu(J);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.targetOrBatchId)),!0)},s),eN.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let n=this.findMutationBatch(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){N(0===this.indexOfExistingBatchId(t.batchId,"removed")),this.mutationQueue.shift();let n=this.batchesByDocumentKey;return eN.forEach(t.mutations,r=>{let i=new uI(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.batchesByDocumentKey=n})}removeCachedMutationKeys(e){}containsKey(e,t){let n=new uI(t,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return eN.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,eN.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let uA="-9223372036854775808";function uk(){return new ns(ed.comparator)}class uR{constructor(e){this.sizer=e,this.docs=uk(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.sizer(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return eN.resolve(n?n.document.mutableCopy():rk.newInvalidDocument(t))}getEntries(e,t){let n=i$();return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():rk.newInvalidDocument(e))}),eN.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=i$(),s=t.path,a=new ed(s.child("__id"+uA+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=eA(eI(a),n))&&(r.has(a.key)||iL(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eN.resolve(i)}getAllFromCollectionGroup(e,t,n,r){D()}forEachDocumentKey(e,t){return eN.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new uN(this)}getSize(e){return eN.resolve(this.size)}}function uD(e){return new uR(e)}class uN extends ul{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.documentCache.addEntry(e,r)):this.documentCache.removeEntry(n)}),eN.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class uO{constructor(e){this.persistence=e,this.targets=new iG(e=>ie(e),ir),this.lastRemoteSnapshotVersion=ea.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new uC,this.targetCount=0,this.targetIdGenerator=lY.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,n)=>t(n)),eN.resolve()}getLastRemoteSnapshotVersion(e){return eN.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eN.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),eN.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),eN.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new lY(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,eN.resolve()}updateTargetData(e,t){return this.saveTargetData(t),eN.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,eN.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),eN.waitFor(i).next(()=>r)}getTargetCount(e){return eN.resolve(this.targetCount)}getTargetData(e,t){let n=this.targets.get(t)||null;return eN.resolve(n)}addMatchingKeys(e,t,n){return this.references.addReferences(t,n),eN.resolve()}removeMatchingKeys(e,t,n){this.references.removeReferences(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),eN.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),eN.resolve()}getMatchingKeysForTargetId(e,t){let n=this.references.referencesForId(t);return eN.resolve(n)}containsKey(e,t){return eN.resolve(this.references.containsKey(t))}}let ux="MemoryPersistence";class uP{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new eY(0),this._started=!1,this._started=!0,this.globalsCache=new uE,this.referenceDelegate=e(this),this.targetCache=new uO(this);let n=e=>this.referenceDelegate.documentSize(e);this.indexManager=new lN,this.remoteDocumentCache=uD(n),this.serializer=new op(t),this.bundleCache=new uS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.mutationQueues[e.toKey()];return n||(n=new u_(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=n),n}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){_(ux,"Starting transaction:",e);let r=new uM(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(r).next(e=>this.referenceDelegate.onTransactionCommitted(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return eN.or(Object.values(this.mutationQueues).map(n=>()=>n.containsKey(e,t)))}}class uM extends eR{constructor(e){super(),this.currentSequenceNumber=e}}class uL{constructor(e){this.persistence=e,this.localViewReferences=new uC,this._orphanedDocuments=null}static factory(e){return new uL(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw D()}addReference(e,t,n){return this.localViewReferences.addReference(n,t),this.orphanedDocuments.delete(n.toString()),eN.resolve()}removeReference(e,t,n){return this.localViewReferences.removeReference(n,t),this.orphanedDocuments.add(n.toString()),eN.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),eN.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eN.forEach(this.orphanedDocuments,n=>{let r=ed.fromPath(n);return this.isReferenced(e,r).next(e=>{e||t.removeEntry(r,ea.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return eN.or([()=>eN.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class uF{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new iG(e=>e1(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=ur(this,t)}static factory(e,t){return new uF(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return eN.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return eN.forEach(this.orphanedSequenceNumbers,(n,r)=>this.isPinned(e,n,r).next(e=>e?eN.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.forEachDocumentKey(e,r=>this.isPinned(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ea.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eN.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),eN.resolve()}removeReference(e,t,n){return this.orphanedSequenceNumbers.set(n,e.currentSequenceNumber),eN.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eN.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ro(e.data.value)),t}isPinned(e,t,n){return eN.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return eN.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uB{constructor(e){this.serializer=e}createOrUpgrade(e,t,n,r){let i=new eP("createOrUpgrade",t);n<1&&r>=1&&(uV(e),uj(e),u$(e),uz(e));let s=eN.resolve();return n<3&&r>=3&&(0!==n&&(uH(e),u$(e)),s=s.next(()=>uQ(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>uq(e,i))),s=s.next(()=>{uY(e)})),n<5&&r>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),n<6&&r>=6&&(s=s.next(()=>(uK(e),this.addDocumentGlobal(i)))),n<7&&r>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),n<8&&r>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),n<9&&r>=9&&(s=s.next(()=>{uW(e)})),n<10&&r>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),n<11&&r>=11&&(s=s.next(()=>{uJ(e),uX(e)})),n<12&&r>=12&&(s=s.next(()=>{u0(e)})),n<13&&r>=13&&(s=s.next(()=>uG(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(e5))),n<14&&r>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),n<15&&r>=15&&(s=s.next(()=>uZ(e))),n<16&&r>=16&&(s=s.next(()=>{t.objectStore(tU).clear()}).next(()=>{t.objectStore(tz).clear()})),n<17&&r>=17&&(s=s.next(()=>{u1(e)})),s}addDocumentGlobal(e){let t=0;return e.store(e5).iterate((e,n)=>{t+=lq(n)}).next(()=>{let n={byteSize:t};return e.store(tm).put(tg,n)})}removeAcknowledgedMutations(e){let t=e.store(e7),n=e.store(te);return t.loadAll().next(t=>eN.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,nL],[t.userId,t.lastAcknowledgedBatchId]);return n.loadAll(tn,r).next(n=>eN.forEach(n,n=>{N(n.userId===t.userId);let r=ow(this.serializer,n);return lj(e,t.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(tS),n=e.store(e5);return e.store(t_).get(tI).next(e=>{let r=n=>t.put({targetId:0,path:e1(n),sequenceNumber:e.highestListenSequenceNumber}),i=[];return n.iterate((e,n)=>{let s=new eu(e),a=uU(s);i.push(t.get(a).next(e=>e?eN.resolve():r(s)))}).next(()=>eN.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(tA,{keyPath:tk});let n=t.store(tA),r=new lO,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:e1(r)})}};return t.store(e5).iterate({keysOnly:!0},(e,t)=>i(new eu(e).popLast())).next(()=>t.store(tl).iterate({keysOnly:!0},([e,t,n],r)=>i(e6(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(ty);return t.iterate((e,n)=>{let r=oE(n),i=oC(this.serializer,r);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let n=t.store(e5),r=[];return n.iterate((e,n)=>{let i=t.store(tu),s=u2(n).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>eN.waitFor(r))}runOverlayMigration(e,t){let n=t.store(te),r=uc(this.serializer),i=new uP(uL.factory,this.serializer.remoteSerializer);return n.loadAll().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:i3();ow(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),eN.forEach(n,(e,n)=>{let s=new b(n),a=oq.forUser(this.serializer,s),o=i.getIndexManager(s);return new uT(r,lz.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new t9(t,eY.INVALID),e).next()})})}}function uU(e){return[0,e1(e)]}function uV(e){e.createObjectStore(e4)}function uj(e){e.createObjectStore(e7,{keyPath:e9}),e.createObjectStore(te,{keyPath:tt,autoIncrement:!0}).createIndex(tn,tr,{unique:!0}),e.createObjectStore(tl)}function uq(e,t){return t.store(te).loadAll().next(n=>{e.deleteObjectStore(te),e.createObjectStore(te,{keyPath:tt,autoIncrement:!0}).createIndex(tn,tr,{unique:!0});let r=t.store(te),i=n.map(e=>r.put(e));return eN.waitFor(i)})}function uz(e){e.createObjectStore(e5)}function uG(e){let t=e.createObjectStore(tu,{keyPath:tc});t.createIndex(th,td),t.createIndex(tf,tp)}function uK(e){e.createObjectStore(tm)}function u$(e){e.createObjectStore(tS,{keyPath:tw}).createIndex(tE,tC,{unique:!0}),e.createObjectStore(ty,{keyPath:tv}).createIndex(tb,tT,{unique:!0}),e.createObjectStore(t_)}function uH(e){e.deleteObjectStore(tS),e.deleteObjectStore(ty),e.deleteObjectStore(t_)}function uW(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function uQ(e){let t=e.store(t_),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ea.min().toTimestamp(),targetCount:0};return t.put(tI,n)}function uY(e){e.createObjectStore(tR,{keyPath:tD})}function uJ(e){e.createObjectStore(tN,{keyPath:tO})}function uX(e){e.createObjectStore(tx,{keyPath:tP})}function uZ(e){e.createObjectStore(tM,{keyPath:tL,autoIncrement:!0}).createIndex(tF,tB,{unique:!1}),e.createObjectStore(tU,{keyPath:tV}).createIndex(tj,tq,{unique:!1}),e.createObjectStore(tz,{keyPath:tG}).createIndex(tK,t$,{unique:!1})}function u0(e){let t=e.createObjectStore(tH,{keyPath:tW});t.createIndex(tQ,tY,{unique:!1}),t.createIndex(tJ,tX,{unique:!1})}function u1(e){e.createObjectStore(tZ,{keyPath:t0})}function u2(e){return e.document?new ed(eu.fromString(e.document.name).popFirst(5)):e.noDocument?ed.fromSegments(e.noDocument.path):e.unknownDocument?ed.fromSegments(e.unknownDocument.path):D()}let u3="IndexedDbPersistence",u6=18e5,u5=5e3,u4=4e3,u8="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",u7="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",u9="firestore_zombie",ce="main";class ct{constructor(e,t,n,r,i,s,a,o,l,u,c=uv){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!ct.isAvailable())throw new M(P.UNIMPLEMENTED,u7);this.referenceDelegate=new ui(this,r),this.dbName=t+ce,this.serializer=new op(o),this.simpleDb=new eM(this.dbName,this.schemaVersion,new uB(this.serializer)),this.globalsCache=new oG,this.targetCache=new lJ(this.referenceDelegate,this.serializer),this.remoteDocumentCache=uc(this.serializer),this.bundleCache=new oU,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&A(u3,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new M(P.FAILED_PRECONDITION,u8);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new eY(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>cr(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(eU(e))return _(u3,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _(u3,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return cn(e).get(e8).next(e=>eN.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return cr(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,u6)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ne(e,tR);return t.loadAll().next(e=>{let n=this.filterActiveClients(e,u6),r=e.filter(e=>-1===n.indexOf(e));return eN.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",u4,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?eN.resolve(!0):cn(e).get(e8).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,u5)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new M(P.FAILED_PRECONDITION,u8);return!1}}return!!this.networkEnabled&&!!this.inForeground||cr(e).loadAll().next(e=>void 0===this.filterActiveClients(e,u5).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&_(u3,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[e4,tR],e=>{let t=new t9(e,eY.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>cr(e).loadAll().next(e=>this.filterActiveClients(e,u6).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return lz.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lM(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return oq.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,n){let r;_(u3,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=t7(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(r=new t9(i,this.listenSequence?this.listenSequence.next():eY.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(r).next(e=>!!e||this.canActAsPrimary(r)).next(t=>{if(!t)throw A(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new M(P.FAILED_PRECONDITION,ek);return n(r)}).next(e=>this.acquireOrExtendPrimaryLease(r).next(()=>e)):this.verifyAllowTabSynchronization(r).next(()=>n(r))).then(e=>(r.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return cn(e).get(e8).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,u5)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new M(P.FAILED_PRECONDITION,u8)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return cn(e).put(e8,t)}static isAvailable(){return eM.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=cn(e);return t.get(e8).next(e=>this.isLocalClient(e)?(_(u3,"Releasing primary lease."),t.delete(e8)):eN.resolve())}isWithinAge(e,t){let n=Date.now(),r=n-t,i=n;return!(e<r)&&(!(e>i)||(A(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;(0,h.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let n=(null==(t=this.webStorage)?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return _(u3,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return A(u3,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){A("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${u9}_${this.persistenceKey}_${e}`}}function cn(e){return ne(e,e4)}function cr(e){return ne(e,tR)}function ci(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}async function cs(e){if(!eM.isAvailable())return Promise.resolve();let t=e+ce;await eM.delete(t)}function ca(e,t,n,r,i){t=[...t],(e=[...e]).sort(n),t.sort(n);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=n(e[l],t[o]);s<0?i(e[l++]):s>0?r(t[o++]):(o++,l++)}for(;o<a;)r(t[o++]);for(;l<s;)i(e[l++])}function co(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}let cl="LocalStore",cu=3e8;class cc{constructor(e,t,n,r){this.persistence=e,this.queryEngine=t,this.serializer=r,this.targetDataByTarget=new ns(J),this.targetIdByTarget=new iG(e=>ie(e),ir),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(n)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uT(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function ch(e,t,n,r){return new cc(e,t,n,r)}async function cd(e,t){let n=x(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.initializeUserComponents(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=i3();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return n.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function cf(e,t){let n,r,i=x(e),s=es.now(),a=t.reduce((e,t)=>e.add(t.key),i3());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=i$(),l=i3();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(r=>{n=r;let a=[];for(let e of t){let t=sE(e,n.get(e.key).overlayedDocument);null!=t&&a.push(new sk(e.key,t,rA(t.value.mapValue),sy.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(n,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:iY(n)}))}function cp(e,t){let n=x(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});return cR(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,cm(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function cm(e){let t=i3();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}function cg(e,t){let n=x(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(N(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}function cy(e){let t=x(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function cv(e){let t=x(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function cb(e,t){let n=x(e),r=t.snapshotVersion,i=n.targetDataByTarget;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(n.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(ny.EMPTY_BYTE_STRING,ea.min()).withLastLimboFreeSnapshotVersion(ea.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(o,u),cS(l,u,s)&&a.push(n.targetCache.updateTargetData(e,u))});let o=i$(),l=i3();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(cT(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!r.isEqual(ea.min())){let t=n.targetCache.getLastRemoteSnapshotVersion(e).next(t=>n.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return eN.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.targetDataByTarget=i,e))}function cT(e,t,n){let r=i3(),i=i3();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=i$();return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ea.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):_(cl,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:r,existenceChangedKeys:i}})}function cS(e,t,n){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=cu)||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}async function cw(e,t){let n=x(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>eN.forEach(t,t=>eN.forEach(t.addedKeys,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>eN.forEach(t.removedKeys,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(eU(e))_(cl,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.targetDataByTarget.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.targetDataByTarget=n.targetDataByTarget.insert(t,i)}}}function cE(e,t){let n=x(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=nL),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function cC(e,t){let n=x(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}function cI(e,t){let n=x(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.targetCache.getTargetData(e,t).next(i=>i?(r=i,eN.resolve(r)):n.targetCache.allocateTargetId(e).next(i=>(r=new of(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.targetCache.addTargetData(e,r).next(()=>r))))}).then(e=>{let r=n.targetDataByTarget.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.targetDataByTarget=n.targetDataByTarget.insert(e.targetId,e),n.targetIdByTarget.set(t,e.targetId)),e})}function c_(e,t,n){let r=x(e),i=r.targetIdByTarget.get(n);return void 0!==i?eN.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(t,n)}async function cA(e,t,n){let r=x(e),i=r.targetDataByTarget.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(eU(e))_(cl,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}r.targetDataByTarget=r.targetDataByTarget.remove(t),r.targetIdByTarget.delete(i.target)}function ck(e,t,n){let r=x(e),i=ea.min(),s=i3();return r.persistence.runTransaction("Execute query","readwrite",e=>c_(r,e,iI(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:ea.min(),n?s:i3())).next(e=>(cM(r,ij(t),e),{documents:e,remoteKeys:s})))}function cR(e,t,n,r){let i=n.batch,s=i.keys(),a=eN.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);N(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function cD(e,t){let n=x(e),r=x(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.lookupMutationKeys(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):eN.resolve(null)))}function cN(e,t){x(x(e,cc).mutationQueue).removeCachedMutationKeys(t)}function cO(e){return x(x(e,cc).persistence).getActiveClients()}function cx(e,t){let n=x(e),r=x(n.targetCache),i=n.targetDataByTarget.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function cP(e,t){let n=x(e),r=n.collectionGroupReadTime.get(t)||ea.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.remoteDocuments.getAllFromCollectionGroup(e,t,eC(r,ef),Number.MAX_SAFE_INTEGER)).then(e=>(cM(n,t,e),e))}function cM(e,t,n){let r=e.collectionGroupReadTime.get(t)||ea.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.collectionGroupReadTime.set(t,r)}function cL(e){return iI(iy(eu.fromString(`__bundle__/docs/${e}`)))}async function cF(e,t,n,r){let i=x(e),s=i3(),a=i$();for(let e of n){let n=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(n));let r=t.toMutableDocument(e);r.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(n,r)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await cI(i,cL(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>cT(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function cB(e,t){let n=x(e),r=ad(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}function cU(e,t){let n=x(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.bundleCache.saveBundleMetadata(e,t))}function cV(e,t){let n=x(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.bundleCache.getNamedQuery(e,t))}async function cj(e,t,n=i3()){let r=await cI(e,iI(oD(t.bundledQuery))),i=x(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=ad(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=r.withResumeToken(ny.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.targetCache.addMatchingKeys(e,n,r.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function cq(e,t){let n=x(e),r=n.indexManager,i=[];return n.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(n=>ca(n,t,eb,t=>{i.push(r.addFieldIndex(e,t))},t=>{i.push(r.deleteFieldIndex(e,t))})).next(()=>eN.waitFor(i)))}function cz(e,t){x(e).queryEngine.indexAutoCreationEnabled=t}function cG(e){let t=x(e),n=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>n.deleteAllFieldIndexes(e))}class cK{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let c$=100;function cH(){return(0,h.nr)()?8:eL((0,h.ZQ)())>0?6:4}class cW{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=c$,this.relativeIndexReadCostPerDocument=cH()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new cK;return this.executeFullCollectionScan(e,t,n).next(r=>{if(i.result=r,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,n,r.size)})}).next(()=>i.result)}createCacheIndexes(e,t,n,r){return n.documentReadCount<this.indexAutoCreationMinCollectionSize?(C()<=u.$b.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",iM(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),eN.resolve()):(C()<=u.$b.DEBUG&&_("QueryEngine","Query:",iM(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.relativeIndexReadCostPerDocument*r)?(C()<=u.$b.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",iM(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,iI(t))):eN.resolve()}performQueryUsingIndex(e,t){if(ib(t))return eN.resolve(null);let n=iI(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=iI(t=iD(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=i3(...r);return this.localDocumentsView.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.applyQuery(t,r);return this.needsRefill(t,s,i,n.readTime)?this.performQueryUsingIndex(e,iD(t,null,"F")):this.appendRemainingResults(e,s,t,n)}))})))}performQueryUsingRemoteKeys(e,t,n,r){return ib(t)||r.isEqual(ea.min())?eN.resolve(null):this.localDocumentsView.getDocuments(e,n).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,n,r)?eN.resolve(null):(C()<=u.$b.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),iM(t)),this.appendRemainingResults(e,s,t,eC(r,ef)).next(e=>e))})}applyQuery(e,t){let n=new nu(iq(e));return t.forEach((t,r)=>{iL(e,r)&&(n=n.add(r))}),n}needsRefill(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}executeFullCollectionScan(e,t,n){return C()<=u.$b.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",iM(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,e_.min(),n)}appendRemainingResults(e,t,n,r){return this.localDocumentsView.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let cQ="firestore_clients";function cY(e,t){return`${cQ}_${e}_${t}`}let cJ="firestore_mutations";function cX(e,t,n){let r=`${cJ}_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}let cZ="firestore_targets";function c0(e,t){return`${cZ}_${e}_${t}`}let c1="firestore_online_state";function c2(e){return`${c1}_${e}`}let c3="firestore_bundle_loaded_v2";function c6(e){return`${c3}_${e}`}let c5="firestore_sequence_number";function c4(e){return`${c5}_${e}`}let c8="SharedClientState";class c7{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static fromWebStorageEntry(e,t,n){let r,i=JSON.parse(n),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new M(i.error.code,i.error.message)),s)?new c7(e,t,i.state,r):(A(c8,`Failed to parse mutation state for ID '${t}': ${n}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class c9{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static fromWebStorageEntry(e,t){let n,r=JSON.parse(t),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return(i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new M(r.error.code,r.error.message)),i)?new c9(e,r.state,n):(A(c8,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class he{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=i5();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=nU(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new he(e,i):(A(c8,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ht{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ht(t.clientId,t.onlineState):(A(c8,`Failed to parse online state: ${e}`),null)}}class hn{constructor(){this.activeTargetIds=i5()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hr{constructor(e,t,n,r,i){this.window=e,this.queue=t,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new ns(J),this.started=!1,this.earlyEvents=[];let s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=cY(this.persistenceKey,this.localClientId),this.sequenceNumberKey=c4(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new hn),this.clientStateKeyRe=RegExp(`^${cQ}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${cJ}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${cZ}_${s}_(\\d+)$`),this.onlineStateKey=c2(this.persistenceKey),this.bundleLoadedKey=c6(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(cY(this.persistenceKey,e));if(t){let n=he.fromWebStorageEntry(e,t);n&&(this.activeClients=this.activeClients.insert(n.clientId,n))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,n){this.persistMutationState(e,t,n),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(c0(this.persistenceKey,e));if(t){let r=c9.fromWebStorageEntry(e,t);r&&(n=r.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),n}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(c0(this.persistenceKey,e))}updateQueryState(e,t,n){this.persistQueryTargetState(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return _(c8,"READ",e,t),t}setItem(e,t){_(c8,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){_(c8,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(_(c8,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void A("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=hi(t.newValue);e!==eY.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,n){let r=new c7(this.currentUser,e,t,n),i=cX(this.persistenceKey,this.currentUser,e);this.setItem(i,r.toWebStorageJSON())}removeMutationState(e){let t=cX(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,n){let r=c0(this.persistenceKey,e),i=new c9(e,t,n);this.setItem(r,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let n=this.fromWebStorageClientStateKey(e);return he.fromWebStorageEntry(n,t)}fromWebStorageMutationMetadata(e,t){let n=this.mutationBatchKeyRe.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return c7.fromWebStorageEntry(new b(i),r,t)}fromWebStorageQueryTargetMetadata(e,t){let n=Number(this.queryTargetKeyRe.exec(e)[1]);return c9.fromWebStorageEntry(n,t)}fromWebStorageOnlineState(e){return ht.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void _(c8,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let n=t?this.activeClients.insert(e,t):this.activeClients.remove(e),r=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=n})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=i5();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}function hi(e){let t=eY.INVALID;if(null!=e)try{let n=JSON.parse(e);N("number"==typeof n),t=n}catch(e){A(c8,"Failed to read sequence number from WebStorage",e)}return t}class hs{constructor(){this.localState=new hn,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,n){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new hn,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ha{addCallback(e){}shutdown(){}}class ho{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let hl=null;function hu(){return 0x10000000+Math.round(0x80000000*Math.random())}function hc(){return null===hl?hl=hu():hl++,"0x"+hl.toString(16)}function hh(e){return new Promise((t,n)=>{e((e,r)=>{e?n(e):t(r)})})}let hd="1.9.15",hf="GrpcConnection",hp=`gl-node/${process.versions.node} fire/${T} grpc/${hd}`;function hm(e,t,n,r){N(null===t||"OAuth"===t.type);let i=new m.OS;return t&&t.headers.forEach((e,t)=>i.set(t,e)),n&&n.headers.forEach((e,t)=>i.set(t,e)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",hp),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class hg{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){_(hf,"Creating Firestore stub.");let e=this.databaseInfo.ssl?m.z3.createSsl():m.z3.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,n,r,i){let s=hc(),a=this.ensureActiveStub(),o=hm(this.databasePath,r,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},n);return hh(t=>(_(hf,`RPC '${e}' ${s} invoked with request:`,n),a[e](l,o,(n,r)=>{n?(_(hf,`RPC '${e}' ${s} failed with error:`,n),t(new M(sG(n.code),n.message))):(_(hf,`RPC '${e}' ${s} completed with response:`,r),t(void 0,r))})))}invokeStreamingRPC(e,t,n,r,i,s){let a=hc(),o=[],l=new L;_(hf,`RPC '${e}' ${a} invoked (streaming) with request:`,n);let u=this.ensureActiveStub(),c=hm(this.databasePath,r,i,this.databaseInfo.appId),h=Object.assign(Object.assign({},n),{database:this.databasePath}),d=u[e](h,c),f=!1;return d.on("data",t=>{_(hf,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(f=!0,l.resolve(o))}),d.on("end",()=>{_(hf,`RPC '${e}' ${a} completed.`),f||(f=!0,l.resolve(o))}),d.on("error",t=>{_(hf,`RPC '${e}' ${a} failed with error:`,t);let n=sG(t.code);l.reject(new M(n,t.message))}),l.promise}openStream(e,t,n){let r=hc(),i=this.ensureActiveStub(),s=hm(this.databasePath,t,n,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new ho({sendFn:t=>{if(o)_(hf,`RPC '${e}' stream ${r} not sending because gRPC stream is closed:`,t);else{_(hf,`RPC '${e}' stream ${r} sending:`,t);try{a.write(t)}catch(e){throw A("Failure sending:",t),A("Error:",e),e}}},closeFn:()=>{_(hf,`RPC '${e}' stream ${r} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(_(hf,`RPC '${e}' stream ${r} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{_(hf,`RPC '${e}' stream ${r} ended.`),l()}),a.on("error",t=>{o||(k(hf,`RPC '${e}' stream ${r} error. Code:`,t.code,"Message:",t.message),l(new M(sG(t.code),t.message)))}),_(hf,`Opening RPC '${e}' stream ${r} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let hy={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var hv={nested:hy},hb=Object.freeze({__proto__:null,nested:hy,default:hv});let hT={longs:String,enums:String,defaults:!0,oneofs:!1};function hS(){let e=g.rS(hb,hT);return m.ex(e)}function hw(e){return new hg(hS(),e)}function hE(){return new ha}function hC(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function hI(){return null}function h_(e){return new ar(e,!1)}let hA="ExponentialBackoff",hk=1e3,hR=1.5,hD=6e4;class hN{constructor(e,t,n=hk,r=hR,i=hD){this.queue=e,this.timerId=t,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),n=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-n);r>0&&_(hA,`Backing off for ${r} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,r,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let hO="PersistentStream",hx=6e4,hP=1e4;class hM{constructor(e,t,n,r,i,s,a,o){this.queue=e,this.idleTimerId=n,this.healthTimerId=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new hN(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state)return void this.performBackoff();this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,hx,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(A(t.toString()),A("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===P.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.closeCount===t&&this.startStream(e,n)},t=>{e(()=>{let e=new M(P.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{n(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{n(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,hP,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{n(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{n(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return _(hO,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(_(hO,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hL extends hM{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=aR(this.serializer,e),n=aN(e);return this.listener.onWatchChange(t,n)}watch(e){let t={};t.database=aT(this.serializer),t.addTarget=aW(this.serializer,e);let n=a$(this.serializer,e);n&&(t.labels=n),this.sendRequest(t)}unwatch(e){let t={};t.database=aT(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class hF extends hM{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return N(!!e.streamToken),this.lastStreamToken=e.streamToken,N(!e.writeResults||0===e.writeResults.length),this.listener.onHandshakeComplete()}onNext(e){N(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=aF(e.writeResults,e.commitTime),n=ad(e.commitTime);return this.listener.onMutationResult(n,t)}writeHandshake(){let e={};e.database=aT(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>aO(this.serializer,e))};this.sendRequest(t)}}class hB{}class hU extends hB{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new M(P.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,n,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,ap(t,n),r,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new M(P.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,n,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,ap(t,n),r,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new M(P.UNKNOWN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function hV(e,t,n,r){return new hU(e,t,n,r)}async function hj(e,t){let n=x(e),r={writes:t.map(e=>aO(n.serializer,e))};await n.invokeRPC("Commit",n.serializer.databaseId,eu.emptyPath(),r)}async function hq(e,t){let n=x(e),r={documents:t.map(e=>ag(n.serializer,e))},i=await n.invokeStreamingRPC("BatchGetDocuments",n.serializer.databaseId,eu.emptyPath(),r,t.length),s=new Map;i.forEach(e=>{let t=ak(n.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());N(!!t),a.push(t)}),a}async function hz(e,t,n){var r;let i=x(e),{request:s,aliasMap:a,parent:o}=az(i.serializer,i_(t),n);i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",i.serializer.databaseId,o,s,1)).filter(e=>!!e.result);N(1===l.length);let u=null==(r=l[0].result)?void 0:r.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[a[t]]=u[t],e),{})}function hG(e,t,n){let r=x(e);return r.verifyInitialized(),new hF(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}function hK(e,t,n){let r=x(e);return r.verifyInitialized(),new hL(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}let h$="OnlineStateTracker",hH=1,hW=1e4;class hQ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",hW,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${hW/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=hH&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${hH} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(A(t),this.shouldWarnClientIsOffline=!1):_(h$,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let hY="RemoteStore",hJ=10;class hX{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{n.enqueueAndForget(async()=>{dt(this)&&(_(hY,"Restarting streams for network reachability change."),await dw(this))})}),this.onlineStateTracker=new hQ(n,r)}}function hZ(e,t,n,r,i){return new hX(e,t,n,r,i)}function h0(e){let t=x(e);return t.offlineCauses.delete(0),h1(t)}async function h1(e){if(dt(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function h2(e){let t=x(e);t.offlineCauses.add(0),await h3(t),t.onlineStateTracker.set("Offline")}async function h3(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function h6(e){let t=x(e);_(hY,"RemoteStore shutting down."),t.offlineCauses.add(5),await h3(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function h5(e,t){let n=x(e);!n.listenTargets.has(t.targetId)&&(n.listenTargets.set(t.targetId,t),de(n)?h9(n):dI(n).isOpen()&&h8(n,t))}function h4(e,t){let n=x(e),r=dI(n);n.listenTargets.delete(t),r.isOpen()&&h7(n,t),0===n.listenTargets.size&&(r.isOpen()?r.markIdle():dt(n)&&n.onlineStateTracker.set("Unknown"))}function h8(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ea.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}dI(e).watch(t)}function h7(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),dI(e).unwatch(t)}function h9(e){e.watchChangeAggregator=new s4({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),dI(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function de(e){return dt(e)&&!dI(e).isStarted()&&e.listenTargets.size>0}function dt(e){return 0===x(e).offlineCauses.size}function dn(e){e.watchChangeAggregator=void 0}async function dr(e){e.onlineStateTracker.set("Online")}async function di(e){e.listenTargets.forEach((t,n)=>{h8(e,t)})}async function ds(e,t){dn(e),de(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),h9(e)):e.onlineStateTracker.set("Unknown")}async function da(e,t,n){if(e.onlineStateTracker.set("Online"),t instanceof s3&&2===t.state&&t.cause){try{await dh(e,t)}catch(n){_(hY,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await dl(e,n)}return}if(t instanceof s1?e.watchChangeAggregator.handleDocumentChange(t):t instanceof s2?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!n.isEqual(ea.min()))try{let t=await cv(e.localStore);n.compareTo(t)>=0&&await dc(e,n)}catch(t){_(hY,"Failed to raise snapshot:",t),await dl(e,t)}}async function dl(e,t,n){if(eU(t))e.offlineCauses.add(1),await h3(e),e.onlineStateTracker.set("Offline"),n||(n=()=>cv(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{_(hY,"Retrying IndexedDB access"),await n(),e.offlineCauses.delete(1),await h1(e)});else throw t}function du(e,t){return t().catch(n=>dl(e,n,t))}function dc(e,t){let n=e.watchChangeAggregator.createRemoteEvent(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(r);i&&e.listenTargets.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.listenTargets.get(t);r&&(e.listenTargets.set(t,r.withResumeToken(ny.EMPTY_BYTE_STRING,r.snapshotVersion)),h7(e,t),h8(e,new of(r.target,t,n,r.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(n)}async function dh(e,t){let n=t.cause;for(let r of t.targetIds)e.listenTargets.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.listenTargets.delete(r),e.watchChangeAggregator.removeTarget(r))}async function dd(e){let t=x(e),n=d_(t),r=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:nL;for(;df(t);)try{let e=await cE(t.localStore,r);if(null===e){0===t.writePipeline.length&&n.markIdle();break}r=e.batchId,dp(t,e)}catch(e){await dl(t,e)}dm(t)&&dg(t)}function df(e){return dt(e)&&e.writePipeline.length<hJ}function dp(e,t){e.writePipeline.push(t);let n=d_(e);n.isOpen()&&n.handshakeComplete&&n.writeMutations(t.mutations)}function dm(e){return dt(e)&&!d_(e).isStarted()&&e.writePipeline.length>0}function dg(e){d_(e).start()}async function dy(e){d_(e).writeHandshake()}async function dv(e){let t=d_(e);for(let n of e.writePipeline)t.writeMutations(n.mutations)}async function db(e,t,n){let r=e.writePipeline.shift(),i=sU.from(r,t,n);await du(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await dd(e)}async function dT(e,t){t&&d_(e).handshakeComplete&&await dS(e,t),dm(e)&&dg(e)}async function dS(e,t){if(sz(t.code)){let n=e.writePipeline.shift();d_(e).inhibitBackoff(),await du(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await dd(e)}}async function dw(e){let t=x(e);t.offlineCauses.add(4),await h3(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await h1(t)}async function dE(e,t){let n=x(e);n.asyncQueue.verifyOperationInProgress(),_(hY,"RemoteStore received new credentials");let r=dt(n);n.offlineCauses.add(3),await h3(n),r&&n.onlineStateTracker.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.offlineCauses.delete(3),await h1(n)}async function dC(e,t){let n=x(e);t?(n.offlineCauses.delete(2),await h1(n)):t||(n.offlineCauses.add(2),await h3(n),n.onlineStateTracker.set("Unknown"))}function dI(e){return e.watchStream||(e.watchStream=hK(e.datastore,e.asyncQueue,{onConnected:dr.bind(null,e),onOpen:di.bind(null,e),onClose:ds.bind(null,e),onWatchChange:da.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),de(e)?h9(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),dn(e))})),e.watchStream}function d_(e){return e.writeStream||(e.writeStream=hG(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:dy.bind(null,e),onClose:dT.bind(null,e),onHandshakeComplete:dv.bind(null,e),onMutationResult:db.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await dd(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(_(hY,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let dA="AsyncQueue";class dk{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new L,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new dk(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new M(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function dR(e,t){if(A(dA,`${t}: ${e}`),eU(e))return new M(P.UNAVAILABLE,`${t}: ${e}`);throw e}class dD{static emptySet(e){return new dD(e.comparator)}constructor(e){e?this.comparator=(t,n)=>e(t,n)||ed.comparator(t.key,n.key):this.comparator=(e,t)=>ed.comparator(e.key,t.key),this.keyedMap=iW(),this.sortedSet=new ns(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dD)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new dD;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class dN{constructor(){this.changeMap=new ns(ed.comparator)}track(e){let t=e.doc.key,n=this.changeMap.get(t);if(!n){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===n.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==n.type?this.changeMap=this.changeMap.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===n.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):D()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,n)=>{e.push(n)}),e}}class dO{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new dO(e,t,dD.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!ix(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class dx{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function dP(){return new dM}class dM{constructor(){this.queries=dL(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){dG(this,new M(P.ABORTED,"Firestore shutting down"))}}function dL(){return new iG(e=>iP(e),ix)}async function dF(e,t){let n=x(e),r=3,i=t.query,s=n.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(r=2):(s=new dx,r=+!t.listensToRemoteStore());try{switch(r){case 0:s.viewSnap=await n.onListen(i,!0);break;case 1:s.viewSnap=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(n){let e=dR(n,`Initialization of query '${iM(t.query)}' failed`);t.onError(e);return}n.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(n.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&dK(n)}async function dB(e,t){let n=x(e),r=t.query,i=3,s=n.queries.get(r);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function dU(e,t){let n=x(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(r=!0);i.viewSnap=e}}r&&dK(n)}function dV(e,t,n){let r=x(e),i=r.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);r.queries.delete(t)}function dj(e,t){let n=x(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(let e of n.listeners)e.applyOnlineStateChange(t)&&(r=!0)}),r&&dK(n)}function dq(e,t){x(e).snapshotsInSyncListeners.add(t),t.next()}function dz(e,t){x(e).snapshotsInSyncListeners.delete(t)}function dG(e,t){let n=x(e),r=n.queries;n.queries=dL(),r.forEach((e,n)=>{for(let e of n.listeners)e.onError(t)})}function dK(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(a||(a={}));class d${constructor(e,t,n){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=n||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new dO(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let n="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=dO.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==a.Cache}}class dH{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.addedKeys=n,this.removedKeys=r}static fromSnapshot(e,t){let n=i3(),r=i3();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new dH(e,t.fromCache,n,r)}}class dW{constructor(e){this.serializer=e}toDocumentKey(e){return ay(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?aI(this.serializer,e.document,!1):rk.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ad(e)}}class dQ{constructor(e,t,n){this.bundleMetadata=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=dY(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let n=eu.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,n=new dW(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.toDocumentKey(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||i3()).add(e);t.set(n,r)}}return t}async complete(){let e=await cF(this.localStore,new dW(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let e of this.queries)await cj(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}}}function dY(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function dJ(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class dX{constructor(e){this.key=e}}class dZ{constructor(e){this.key=e}}class d0{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=i3(),this.mutatedKeys=i3(),this.docComparator=iq(e),this.documentSet=new dD(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let n=t?t.changeSet:new dN,r=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=iL(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),f=!0):!this.shouldWaitForSyncedDocument(u,c)&&(n.track({type:2,doc:c}),f=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),f=!0):u&&!c&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{documentSet:s,changeSet:n,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>d1(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(n),r=null!=r&&r;let a=t&&!r?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!r),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new dO(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new dN,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=i3(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new dZ(e))}),this.limboDocuments.forEach(n=>{e.has(n)||t.push(new dX(n))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=i3();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return dO.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function d1(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return n(e)-n(t)}let d2="SyncEngine";class d3{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class d6{constructor(e){this.key=e,this.receivedDocument=!1}}class d5{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new iG(e=>iP(e),ix),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new ns(ed.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new uC,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=lY.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function d4(e,t,n,r,i,s,a){let o=new d5(e,t,n,r,i,s);return a&&(o._isPrimaryClient=!0),o}async function d8(e,t,n=!0){let r,i=fx(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.computeInitialSnapshot()):r=await d9(i,t,n,!0),r}async function d7(e,t){let n=fx(e);await d9(n,t,!0,!1)}async function d9(e,t,n,r){let i,s=await cI(e.localStore,iI(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await fe(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&h5(e.remoteStore,s),i}async function fe(e,t,n,r,i){e.applyDocChanges=(t,n,r)=>fT(e,t,n,r);let s=await ck(e.localStore,t,!0),a=new d0(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=s0.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);fg(e,n,u.limboChanges);let c=new d3(t,n,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(n)?e.queriesByTarget.get(n).push(t):e.queriesByTarget.set(n,[t]),u.snapshot}async function ft(e,t,n){let r=x(e),i=r.queryViewsByQuery.get(t),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(e=>!ix(e,t))),r.queryViewsByQuery.delete(t);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await cA(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&h4(r.remoteStore,i.targetId),fp(r,i.targetId)}).catch(eD)):(fp(r,i.targetId),await cA(r.localStore,i.targetId,!0))}async function fn(e,t){let n=x(e),r=n.queryViewsByQuery.get(t),i=n.queriesByTarget.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),h4(n.remoteStore,r.targetId))}async function fr(e,t,n){let r=fP(e);try{let e=await cf(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),fd(r,e.batchId,n),await fb(r,e.changes),await dd(r.remoteStore)}catch(t){let e=dR(t,"Failed to persist write");n.reject(e)}}async function fi(e,t){let n=x(e);try{let e=await cb(n.localStore,t);t.targetChanges.forEach((e,t)=>{let r=n.activeLimboResolutionsByTarget.get(t);r&&(N(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?N(r.receivedDocument):e.removedDocuments.size>0&&(N(r.receivedDocument),r.receivedDocument=!1))}),await fb(n,e,t)}catch(e){await eD(e)}}function fs(e,t,n){let r=x(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){let e=[];r.queryViewsByQuery.forEach((n,r)=>{let i=r.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),dj(r.eventManager,t),e.length&&r.syncEngineListener.onWatchChange(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function fa(e,t,n){let r=x(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new ns(ed.comparator);e=e.insert(s,rk.newNoDocument(s,ea.min()));let n=i3().add(s),i=new sZ(ea.min(),new Map,new ns(J),e,n);await fi(r,i),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(t),fv(r)}else await cA(r.localStore,t,!1).then(()=>fp(r,t,n)).catch(eD)}async function fo(e,t){let n=x(e),r=t.batch.batchId;try{let e=await cp(n.localStore,t);ff(n,r,null),fc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await fb(n,e)}catch(e){await eD(e)}}async function fl(e,t,n){let r=x(e);try{let e=await cg(r.localStore,t);ff(r,t,n),fc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await fb(r,e)}catch(e){await eD(e)}}async function fu(e,t){let n=x(e);dt(n.remoteStore)||_(d2,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await cy(n.localStore);if(e===nL)return void t.resolve();let r=n.pendingWritesCallbacks.get(e)||[];r.push(t),n.pendingWritesCallbacks.set(e,r)}catch(n){let e=dR(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function fc(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function fh(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new M(P.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function fd(e,t,n){let r=e.mutationUserCallbacks[e.currentUser.toKey()];r||(r=new ns(J)),r=r.insert(t,n),e.mutationUserCallbacks[e.currentUser.toKey()]=r}function ff(e,t,n){let r=x(e),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function fp(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(r),n&&e.syncEngineListener.onWatchError(r,n);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||fm(e,t)})}function fm(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let n=e.activeLimboTargetsByKey.get(t);null!==n&&(h4(e.remoteStore,n),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(n),fv(e))}function fg(e,t,n){for(let r of n)r instanceof dX?(e.limboDocumentRefs.addReference(r.key,t),fy(e,r)):r instanceof dZ?(_(d2,"Document no longer in limbo: "+r.key),e.limboDocumentRefs.removeReference(r.key,t),e.limboDocumentRefs.containsKey(r.key)||fm(e,r.key)):D()}function fy(e,t){let n=t.key,r=n.path.canonicalString();e.activeLimboTargetsByKey.get(n)||e.enqueuedLimboResolutions.has(r)||(_(d2,"New document in limbo: "+n),e.enqueuedLimboResolutions.add(r),fv(e))}function fv(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let n=new ed(eu.fromString(t)),r=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(r,new d6(n)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(n,r),h5(e.remoteStore,new of(iI(iy(n.path)),r,"TargetPurposeLimboResolution",eY.INVALID))}}async function fb(e,t,n){let r=x(e),i=[],s=[],a=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((e,o)=>{a.push(r.applyDocChanges(o,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){let i=e?!e.fromCache:null==(t=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);let t=dH.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.syncEngineListener.onWatchChange(i),await cw(r.localStore,s))}async function fT(e,t,n,r){let i=t.view.computeDocChanges(n);i.needsRefill&&(i=await ck(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return fg(e,t.targetId,o.limboChanges),o.snapshot}async function fS(e,t){let n=x(e);if(!n.currentUser.isEqual(t)){_(d2,"User change. New user:",t.toKey());let e=await cd(n.localStore,t);n.currentUser=t,fh(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await fb(n,e.affectedDocuments)}}function fw(e,t){let n=x(e),r=n.activeLimboResolutionsByTarget.get(t);if(r&&r.receivedDocument)return i3().add(r.key);{let e=i3(),r=n.queriesByTarget.get(t);if(!r)return e;for(let t of r){let r=n.queryViewsByQuery.get(t);e=e.unionWith(r.view.syncedDocuments)}return e}}async function fE(e,t){let n=x(e),r=await ck(n.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(r);return n.isPrimaryClient&&fg(n,t.targetId,i.limboChanges),i}async function fC(e,t){let n=x(e);return cP(n.localStore,t).then(e=>fb(n,e))}async function fI(e,t,n,r){let i=x(e),s=await cD(i.localStore,t);if(null===s)return void _(d2,"Cannot apply mutation batch with id: "+t);"pending"===n?await dd(i.remoteStore):"acknowledged"===n||"rejected"===n?(ff(i,t,r||null),fc(i,t),cN(i.localStore,t)):D(),await fb(i,s)}async function f_(e,t){let n=x(e);if(fx(n),fP(n),!0===t&&!0!==n._isPrimaryClient){let e=n.sharedClientState.getAllActiveQueryTargets(),t=await fk(n,e.toArray());for(let e of(n._isPrimaryClient=!0,await dC(n.remoteStore,!0),t))h5(n.remoteStore,e)}else if(!1===t&&!1!==n._isPrimaryClient){let e=[],t=Promise.resolve();n.queriesByTarget.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(fp(n,i),cA(n.localStore,i,!0))),h4(n.remoteStore,i)}),await t,await fk(n,e),fA(n),n._isPrimaryClient=!1,await dC(n.remoteStore,!1)}}function fA(e){let t=x(e);t.activeLimboResolutionsByTarget.forEach((e,n)=>{h4(t.remoteStore,n)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new ns(ed.comparator)}async function fk(e,t,n){let r=x(e),i=[],s=[];for(let e of t){let t,n=r.queriesByTarget.get(e);if(n&&0!==n.length)for(let e of(t=await cI(r.localStore,iI(n[0])),n)){let t=r.queryViewsByQuery.get(e),n=await fE(r,t);n.snapshot&&s.push(n.snapshot)}else{let n=await cx(r.localStore,e);t=await cI(r.localStore,n),await fe(r,fR(n),e,!1,t.resumeToken)}i.push(t)}return r.syncEngineListener.onWatchChange(s),i}function fR(e){return ig(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function fD(e){return cO(x(e).localStore)}async function fN(e,t,n,r){let i=x(e);if(i._isPrimaryClient)return void _(d2,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{let e=await cP(i.localStore,ij(s[0])),r=sZ.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,ny.EMPTY_BYTE_STRING);await fb(i,e,r);break}case"rejected":await cA(i.localStore,t,!0),fp(i,t,r);break;default:D()}}async function fO(e,t,n){let r=fx(e);if(r._isPrimaryClient){for(let e of t){if(r.queriesByTarget.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){_(d2,"Adding an already active target "+e);continue}let t=await cx(r.localStore,e),n=await cI(r.localStore,t);await fe(r,fR(t),n.targetId,!1,n.resumeToken),h5(r.remoteStore,n)}for(let e of n)r.queriesByTarget.has(e)&&await cA(r.localStore,e,!1).then(()=>{h4(r.remoteStore,e),fp(r,e)}).catch(eD)}}function fx(e){let t=x(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=fi.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=fw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=fa.bind(null,t),t.syncEngineListener.onWatchChange=dU.bind(null,t.eventManager),t.syncEngineListener.onWatchError=dV.bind(null,t.eventManager),t}function fP(e){let t=x(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=fo.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=fl.bind(null,t),t}function fM(e,t,n){let r=x(e);fL(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}async function fL(e,t,n){try{let r=await t.getMetadata();if(await cB(e.localStore,r))return await t.close(),n._completeWith(dJ(r)),Promise.resolve(new Set);n._updateProgress(dY(r));let i=new dQ(r,e.localStore,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&n._updateProgress(e),s=await t.nextElement()}let a=await i.complete();return await fb(e,a.changedDocs,void 0),await cU(e.localStore,r),n._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return k(d2,`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}}class fF{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=h_(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ch(this.persistence,new cW,e.initialUser,this.serializer)}createPersistence(e){return new uP(uL.factory,this.serializer)}createSharedClientState(e){return new hs}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fF.provider={build:()=>new fF};class fB extends fF{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return N(this.persistence.referenceDelegate instanceof uF),new ut(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?l6.withCacheSize(this.cacheSizeBytes):l6.DEFAULT;return new uP(e=>uF.factory(e,t),this.serializer)}}class fU extends fF{constructor(e,t,n){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await fP(this.onlineComponentProvider.syncEngine),await dd(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return ch(this.persistence,new cW,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new ut(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new eQ(t,this.persistence);return new eW(e.asyncQueue,n)}createPersistence(e){let t=ci(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?l6.withCacheSize(this.cacheSizeBytes):l6.DEFAULT;return new ct(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,hC(),hI(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new hs}}class fV extends fU{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof hr&&(this.sharedClientState.syncEngine={applyBatchState:fI.bind(null,t),applyTargetState:fN.bind(null,t),applyActiveTargetsChange:fO.bind(null,t),getActiveClients:fD.bind(null,t),synchronizeWithChangedDocuments:fC.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await f_(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=hC();if(!hr.isAvailable(t))throw new M(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ci(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new hr(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class fj{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>fs(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=fS.bind(null,this.syncEngine),await dC(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return dP()}createDatastore(e){let t=h_(e.databaseInfo.databaseId),n=hw(e.databaseInfo);return hV(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return hZ(this.localStore,this.datastore,e.asyncQueue,e=>fs(this.syncEngine,e,0),hE())}createSyncEngine(e,t){return d4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await h6(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}fj.provider={build:()=>new fj};let fq=10240;function fz(e,t=fq){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function fG(e,t,n){if(!n)throw new M(P.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function fK(e,t,n,r){if(!0===t&&!0===r)throw new M(P.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function f$(e){if(!ed.isDocumentKey(e))throw new M(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function fH(e){if(ed.isDocumentKey(e))throw new M(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function fW(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function fQ(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=fY(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return D()}function fY(e){return e.constructor?e.constructor.name:null}function fJ(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new M(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let n=fQ(e);throw new M(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}return e}function fX(e,t){if(t<=0)throw new M(P.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function fZ(e,t){if(!(e instanceof Uint8Array))throw new M(P.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${fQ(e)}`);return fz(e,t)}class f0{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):A("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class f1{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class f2{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new L,this.buffer=new Uint8Array,this.textDecoder=Q(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),n=Number(t);return isNaN(n)&&this.raiseError(`length string (${t}) is not valid number`),new f1(JSON.parse(await this.readJsonString(n)),e.length+n)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function f3(e,t){return new f2(e,t)}class f6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new M(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await hq(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sP(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=ed.fromPath(t);this.mutations.push(new sF(n,this.precondition(n)))}),await hj(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=ea.min();else throw D();let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new M(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?sy.none():t.isEqual(ea.min())?sy.exists(!1):sy.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return sy.exists(!0);if(t.isEqual(ea.min()))throw new M(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sy.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class f5{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.attemptsRemaining=n.maxAttempts,this.backoff=new hN(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new f6(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(nF(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sq(t)}return!1}}let f4="FirestoreClient",f8=100,f7=11,f9=20,pe=22;class pt{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=b.UNAUTHENTICATED,this.clientId=Y.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{_(f4,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(_(f4,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:f8}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new L;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=dR(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function pn(e,t){e.asyncQueue.verifyOperationInProgress(),_(f4,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await cd(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function pr(e,t){e.asyncQueue.verifyOperationInProgress();let n=await ps(e);_(f4,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>dE(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>dE(t.remoteStore,n)),e._onlineComponents=t}function pi(e){return"FirebaseError"===e.name?e.code===P.FAILED_PRECONDITION||e.code===P.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===pe||e.code===f9||e.code===f7}async function ps(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){_(f4,"Using user provided OfflineComponentProvider");try{await pn(e,e._uninitializedComponentsProvider._offline)}catch(n){let t=n;if(!pi(t))throw t;k("Error using user provided cache. Falling back to memory cache: "+t),await pn(e,new fF)}}else _(f4,"Using default OfflineComponentProvider"),await pn(e,new fB(void 0));return e._offlineComponents}async function pa(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(_(f4,"Using user provided OnlineComponentProvider"),await pr(e,e._uninitializedComponentsProvider._online)):(_(f4,"Using default OnlineComponentProvider"),await pr(e,new fj))),e._onlineComponents}function po(e){return ps(e).then(e=>e.persistence)}function pl(e){return ps(e).then(e=>e.localStore)}function pu(e){return pa(e).then(e=>e.remoteStore)}function pc(e){return pa(e).then(e=>e.syncEngine)}function ph(e){return pa(e).then(e=>e.datastore)}async function pd(e){let t=await pa(e),n=t.eventManager;return n.onListen=d8.bind(null,t.syncEngine),n.onUnlisten=ft.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=d7.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fn.bind(null,t.syncEngine),n}function pf(e){return e.asyncQueue.enqueue(async()=>{let t=await po(e),n=await pu(e);return t.setNetworkEnabled(!0),h0(n)})}function pp(e){return e.asyncQueue.enqueue(async()=>{let t=await po(e),n=await pu(e);return t.setNetworkEnabled(!1),h2(n)})}function pm(e){let t=new L;return e.asyncQueue.enqueueAndForget(async()=>fu(await pc(e),t)),t.promise}function pg(e,t,n,r){let i=new f0(r),s=new d$(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>dF(await pd(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>dB(await pd(e),s))}}function py(e,t){let n=new L;return e.asyncQueue.enqueueAndForget(async()=>pI(await pl(e),t,n)),n.promise}function pv(e,t,n={}){let r=new L;return e.asyncQueue.enqueueAndForget(async()=>p_(await pd(e),e.asyncQueue,t,n,r)),r.promise}function pb(e,t){let n=new L;return e.asyncQueue.enqueueAndForget(async()=>pA(await pl(e),t,n)),n.promise}function pT(e,t,n={}){let r=new L;return e.asyncQueue.enqueueAndForget(async()=>pk(await pd(e),e.asyncQueue,t,n,r)),r.promise}function pS(e,t,n){let r=new L;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await ph(e);r.resolve(hz(i,t,n))}catch(e){r.reject(e)}}),r.promise}function pw(e,t){let n=new L;return e.asyncQueue.enqueueAndForget(async()=>fr(await pc(e),t,n)),n.promise}function pE(e,t){let n=new f0(t);return e.asyncQueue.enqueueAndForget(async()=>dq(await pd(e),n)),()=>{n.mute(),e.asyncQueue.enqueueAndForget(async()=>dz(await pd(e),n))}}function pC(e,t,n){let r=new L;return e.asyncQueue.enqueueAndForget(async()=>{let i=await ph(e);new f5(e.asyncQueue,i,n,t,r).run()}),r.promise}async function pI(e,t,n){try{let r=await cC(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new M(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=dR(r,`Failed to get document '${t} from cache`);n.reject(e)}}function p_(e,t,n,r,i){let s=new f0({next:o=>{s.mute(),t.enqueueAndForget(()=>dB(e,a));let l=o.docs.has(n);!l&&o.fromCache?i.reject(new M(P.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new M(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new d$(iy(n.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dF(e,a)}async function pA(e,t,n){try{let r=await ck(e,t,!0),i=new d0(t,r.remoteKeys),s=i.computeDocChanges(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=dR(r,`Failed to execute query '${t} against cache`);n.reject(e)}}function pk(e,t,n,r,i){let s=new f0({next:n=>{s.mute(),t.enqueueAndForget(()=>dB(e,a)),n.fromCache&&"server"===r.source?i.reject(new M(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new d$(n,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dF(e,a)}function pR(e,t,n,r){let i=pN(n,h_(t));e.asyncQueue.enqueueAndForget(async()=>{fM(await pc(e),i,r)})}function pD(e,t){return e.asyncQueue.enqueue(async()=>cV(await pl(e),t))}function pN(e,t){let n;return f3(fZ(n="string"==typeof e?W().encode(e):e),t)}function pO(e,t){return e.asyncQueue.enqueue(async()=>cq(await pl(e),t))}function px(e,t){return e.asyncQueue.enqueue(async()=>cz(await pl(e),t))}function pP(e){return e.asyncQueue.enqueue(async()=>cG(await pl(e)))}function pM(e,t){return e.timeoutSeconds===t.timeoutSeconds}function pL(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let pF="ComponentProvider",pB=new Map;function pU(e){let t=pB.get(e);t&&(_(pF,"Removing Datastore"),pB.delete(e),t.terminate())}function pV(e,t,n,r){return new nO(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,pL(r.experimentalLongPollingOptions),r.useFetchStreams)}let pj="firestore.googleapis.com",pq=!0,pz=5,pG=30,pK=!0;class p${constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new M(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pj,this.ssl=pq}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:pq;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=l3;else if(e.cacheSizeBytes!==l2&&e.cacheSizeBytes<l4)throw new M(P.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${l4}`);else this.cacheSizeBytes=e.cacheSizeBytes;fK("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=pK:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pL(null!=(n=e.experimentalLongPollingOptions)?n:{}),pH(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&pM(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function pH(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<pz)throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${pz})`);if(e.timeoutSeconds>pG)throw new M(P.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${pG})`)}}class pW{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new p$({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new M(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new p$(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=$(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return pU(this),Promise.resolve()}}function pQ(e,t,n,r={}){var i;let s=(e=fJ(e,pW))._getSettings(),a=Object.assign(Object.assign({},s),{emulatorOptions:e._getEmulatorOptions()}),o=`${t}:${n}`;s.host!==pj&&s.host!==o&&k("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=Object.assign(Object.assign({},s),{host:o,ssl:!1,emulatorOptions:r});if(!(0,h.bD)(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=b.MOCK_USER;else{t=(0,h.Fy)(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new M(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new b(s)}e._authCredentials=new U(new F(t,n))}}class pY{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pY(this.firestore,e,this._query)}}class pJ{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pX(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pJ(this.firestore,e,this._key)}}class pX extends pY{constructor(e,t,n){super(e,t,iy(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new pJ(this.firestore,null,new ed(e))}withConverter(e){return new pX(this.firestore,e,this._path)}}function pZ(e,t,...n){if(e=(0,h.Ku)(e),fG("collection","path",t),e instanceof pW){let r=eu.fromString(t,...n);return fH(r),new pX(e,null,r)}{if(!(e instanceof pJ)&&!(e instanceof pX))throw new M(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eu.fromString(t,...n));return fH(r),new pX(e.firestore,null,r)}}function p0(e,t){if(e=fJ(e,pW),fG("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new M(P.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pY(e,null,iS(t))}function p1(e,t,...n){if(e=(0,h.Ku)(e),1==arguments.length&&(t=Y.newId()),fG("doc","path",t),e instanceof pW){let r=eu.fromString(t,...n);return f$(r),new pJ(e,null,new ed(r))}{if(!(e instanceof pJ)&&!(e instanceof pX))throw new M(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(eu.fromString(t,...n));return f$(r),new pJ(e.firestore,e instanceof pX?e.converter:null,new ed(r))}}function p2(e,t){return e=(0,h.Ku)(e),t=(0,h.Ku)(t),(e instanceof pJ||e instanceof pX)&&(t instanceof pJ||t instanceof pX)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function p3(e,t){return e=(0,h.Ku)(e),t=(0,h.Ku)(t),e instanceof pY&&t instanceof pY&&e.firestore===t.firestore&&ix(e._query,t._query)&&e.converter===t.converter}let p6="AsyncQueue";class p5{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new hN(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new L;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(eU(e))_(p6,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,A("INTERNAL UNHANDLED ERROR: ",p4(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,n){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let r=dk.createAndSchedule(this,e,t,n,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(r),r}verifyNotFailed(){this.failure&&D()}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function p4(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class p8{constructor(){this._progressObserver={},this._taskCompletionResolver=new L,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let p7=l2;class p9 extends pW{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new p5,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new p5(e),this._firestoreClient=void 0,await e}}}function me(e,t,n){n||(n=nx);let r=(0,o.j6)(e,"firestore");if(r.isInitialized(n)){let e=r.getImmediate({identifier:n}),i=r.getOptions(n);if((0,h.bD)(i,t))return e;throw new M(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new M(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&t.cacheSizeBytes!==p7&&t.cacheSizeBytes<l4)throw new M(P.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${l4}`);return r.initialize({options:t,instanceIdentifier:n})}function mt(e,t){let n="object"==typeof e?e:(0,o.Sx)(),r="string"==typeof e?e:t||nx,i=(0,o.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(0,h.yU)("firestore");e&&pQ(i,...e)}return i}function mn(e){if(e._terminated)throw new M(P.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||mr(e),e._firestoreClient}function mr(e){var t,n,r;let i=e._freezeSettings(),s=pV(e._databaseId,(null==(t=e._app)?void 0:t.options.appId)||"",e._persistenceKey,i);!e._componentsProvider&&(null==(n=i.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=i.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new pt(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&mi(e._componentsProvider))}function mi(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}function ms(e,t){k("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings();return mo(e,fj.provider,{build:e=>new fU(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function ma(e){k("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();mo(e,fj.provider,{build:e=>new fV(e,t.cacheSizeBytes)})}function mo(e,t,n){if((e=fJ(e,p9))._firestoreClient||e._terminated)throw new M(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new M(P.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},mr(e)}function ml(e){if(e._initialized&&!e._terminated)throw new M(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new L;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await cs(ci(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function mu(e){return pm(mn(e=fJ(e,p9)))}function mc(e){return pf(mn(e=fJ(e,p9)))}function mh(e){return pp(mn(e=fJ(e,p9)))}function md(e){return(0,o.Us)(e.app,"firestore",e._databaseId.database),e._delete()}function mf(e,t){let n=mn(e=fJ(e,p9)),r=new p8;return pR(n,e._databaseId,t,r),r}function mp(e,t){return pD(mn(e=fJ(e,p9)),t).then(t=>t?new pY(e,null,t.query):null)}function mm(e,t=!0){S(o.MF),(0,o.om)(new l.uA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new p9(new V(e.getProvider("auth-internal")),new G(i,e.getProvider("app-check-internal")),nM(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,o.KO)(y,v,e),(0,o.KO)(y,v,"esm2017")}class mg{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class my{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class mv{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class mb{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mb(ny.fromBase64String(e))}catch(e){throw new M(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new mb(ny.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class mT{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new M(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eh(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function mS(){return new mT(eo)}class mw{constructor(e){this._methodName=e}}class mE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}}class mC{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return co(this._values,e._values)}}let mI=/^__.*__$/;class m_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new sk(e,this.data,this.fieldMask,t,this.fieldTransforms):new sI(e,this.data,t,this.fieldTransforms)}}class mA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new sk(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function mk(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}class mR{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new mR(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return mZ(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(mk(this.dataSource)&&mI.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class mD{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||h_(e)}createContext(e,t,n,r=!1){return new mR({dataSource:e,methodName:t,targetDoc:n,path:eh.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mN(e){let t=e._freezeSettings(),n=h_(e._databaseId);return new mD(e._databaseId,!!t.ignoreUndefinedProperties,n)}function mO(e,t,n,r,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,n,i);mQ("Data must be an object, but it was:",l,r);let u=mz(r,l);if(s.merge)a=new nf(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=mY(t,r,n);if(!l.contains(i))throw new M(P.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);m0(e,i)||e.push(i)}a=new nf(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new m_(new r_(u),a,o)}class mx extends mw{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof mx}}function mP(e,t,n){return new mR({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class mM extends mw{_toFieldTransform(e){return new sf(e.path,new si)}isEqual(e){return e instanceof mM}}class mL extends mw{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=mP(this,e,!0),n=new ss(this._elements.map(e=>mq(e,t)));return new sf(e.path,n)}isEqual(e){return e instanceof mL&&(0,h.bD)(this._elements,e._elements)}}class mF extends mw{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=mP(this,e,!0),n=new so(this._elements.map(e=>mq(e,t)));return new sf(e.path,n)}isEqual(e){return e instanceof mF&&(0,h.bD)(this._elements,e._elements)}}class mB extends mw{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new su(e.serializer,i7(e.serializer,this._operand));return new sf(e.path,t)}isEqual(e){return e instanceof mB&&this._operand===e._operand}}function mU(e,t,n,r){let i=e.createContext(1,t,n);mQ("Data must be an object, but it was:",i,r);let s=[],a=r_.empty();return nn(r,(e,r)=>{let o=mX(t,e,n);r=(0,h.Ku)(r);let l=i.childContextForFieldPath(o);if(r instanceof mx)s.push(o);else{let e=mq(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new mA(a,new nf(s),i.fieldTransforms)}function mV(e,t,n,r,i,s){let a=e.createContext(1,t,n),o=[mY(t,r,n)],l=[i];if(s.length%2!=0)throw new M(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(mY(t,s[e])),l.push(s[e+1]);let u=[],c=r_.empty();for(let e=o.length-1;e>=0;--e)if(!m0(u,o[e])){let t=o[e],n=l[e];n=(0,h.Ku)(n);let r=a.childContextForFieldPath(t);if(n instanceof mx)u.push(t);else{let e=mq(n,r);null!=e&&(u.push(t),c.set(t,e))}}return new mA(c,new nf(u),a.fieldTransforms)}function mj(e,t,n,r=!1){return mq(n,e.createContext(r?4:3,t))}function mq(e,t){if(mW(e=(0,h.Ku)(e)))return mQ("Unsupported field value:",t,e),mz(e,t);if(e instanceof mw)return mK(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return m$(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return mG(e,t)}function mz(e,t){let n={};return ni(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nn(e,(e,r)=>{let i=mq(r,t.childContextForField(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function mG(e,t){let n=[],r=0;for(let i of e){let e=mq(i,t.childContextForArray(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}function mK(e,t){if(!mk(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}function m$(e,t){if(null===(e=(0,h.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return i7(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=es.fromDate(e);return{timestampValue:ao(t.serializer,n)}}else if(e instanceof es){let n=new es(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ao(t.serializer,n)}}else if(e instanceof mE)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof mb)return{bytesValue:au(t.serializer,e._byteString)};else if(e instanceof pJ){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:af(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof mC)return mH(e,t);else throw t.createError(`Unsupported field value: ${fQ(e)}`)}function mH(e,t){return{mapValue:{fields:{[nV]:{stringValue:nz},[nG]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return i4(t.serializer,e)})}}}}}}function mW(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof es)&&!(e instanceof mE)&&!(e instanceof mb)&&!(e instanceof pJ)&&!(e instanceof mw)&&!(e instanceof mC)}function mQ(e,t,n){if(!mW(n)||!fW(n)){let r=fQ(n);if("an object"===r)throw t.createError(e+" a custom object");throw t.createError(e+" "+r)}}function mY(e,t,n){if((t=(0,h.Ku)(t))instanceof mT)return t._internalPath;if("string"==typeof t)return mX(e,t);throw mZ("Field path arguments must be of type string or ",e,!1,void 0,n)}let mJ=RegExp("[~\\*/\\[\\]]");function mX(e,t,n){if(t.search(mJ)>=0)throw mZ(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new mT(...t.split("."))._internalPath}catch(r){throw mZ(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function mZ(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new M(P.INVALID_ARGUMENT,o+e+l)}function m0(e,t){return e.some(e=>e.isEqual(t))}class m1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pJ(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new m2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(m3("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class m2 extends m1{data(){return super.data()}}function m3(e,t){return"string"==typeof t?mX(e,t):t instanceof mT?t._internalPath:t._delegate._internalPath}function m6(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new M(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class m5{}class m4 extends m5{}function m8(e,t,...n){let r=[];for(let i of(t instanceof m5&&r.push(t),g_(r=r.concat(n)),r))e=i._apply(e);return e}class m7 extends m4{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new m7(e,t,n)}_apply(e){let t=this._parse(e);return gw(e._query,t),new pY(e.firestore,e.converter,ik(e._query,t))}_parse(e){let t=mN(e.firestore);return gm(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function m9(e,t,n){let r=t,i=m3("where",e);return m7._create(i,r,n)}class ge extends m5{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ge(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rj.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(gE(e._query,t),new pY(e.firestore,e.converter,ik(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function gt(...e){return e.forEach(e=>gI("or",e)),ge._create("or",e)}function gn(...e){return e.forEach(e=>gI("and",e)),ge._create("and",e)}class gr extends m4{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new gr(e,t)}_apply(e){let t=gg(e._query,this._field,this._direction);return new pY(e.firestore,e.converter,iR(e._query,t))}}function gi(e,t="asc"){let n=t,r=m3("orderBy",e);return gr._create(r,n)}class gs extends m4{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new gs(e,t,n)}_apply(e){return new pY(e.firestore,e.converter,iD(e._query,this._limit,this._limitType))}}function ga(e){return fX("limit",e),gs._create("limit",e,"F")}function go(e){return fX("limitToLast",e),gs._create("limitToLast",e,"L")}class gl extends m4{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gl(e,t,n)}_apply(e){let t=gp(e,this.type,this._docOrFields,this._inclusive);return new pY(e.firestore,e.converter,iN(e._query,t))}}function gu(...e){return gl._create("startAt",e,!0)}function gc(...e){return gl._create("startAfter",e,!1)}class gh extends m4{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gh(e,t,n)}_apply(e){let t=gp(e,this.type,this._docOrFields,this._inclusive);return new pY(e.firestore,e.converter,iO(e._query,t))}}function gd(...e){return gh._create("endBefore",e,!1)}function gf(...e){return gh._create("endAt",e,!0)}function gp(e,t,n,r){if(n[0]=(0,h.Ku)(n[0]),n[0]instanceof m1)return gy(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=mN(e.firestore);return gv(e._query,e.firestore._databaseId,i,t,n,r)}}function gm(e,t,n,r,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new M(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){gT(a,s);let t=[];for(let n of a)t.push(gb(r,e,n));o={arrayValue:{values:t}}}else o=gb(r,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&gT(a,s),o=mj(n,t,a,"in"===s||"not-in"===s);return rV.create(i,s,o)}function gg(e,t,n){if(null!==e.startAt)throw new M(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new M(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rM(t,n)}function gy(e,t,n,r,i){if(!r)throw new M(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of iC(e))if(n.field.isKeyField())s.push(rc(t,r.key));else{let e=r.data.field(n.field);if(nk(e))throw new M(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=n.field.canonicalString();throw new M(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new rD(s,i)}function gv(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new M(P.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new M(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!iE(e)&&-1!==l.indexOf("/"))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(eu.fromString(l));if(!ed.isDocumentKey(n))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new ed(n);o.push(rc(t,i))}else{let e=mj(n,r,l);o.push(e)}}return new rD(o,s)}function gb(e,t,n){if("string"==typeof(n=(0,h.Ku)(n))){if(""===n)throw new M(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iE(t)&&-1!==n.indexOf("/"))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(eu.fromString(n));if(!ed.isDocumentKey(r))throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rc(e,new ed(r))}if(n instanceof pJ)return rc(e,n._key);throw new M(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fQ(n)}.`)}function gT(e,t){if(!Array.isArray(e)||0===e.length)throw new M(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function gS(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function gw(e,t){let n=gC(e.filters,gS(t.op));if(null!==n)if(n===t.op)throw new M(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new M(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function gE(e,t){let n=e;for(let e of t.getFlattenedFilters())gw(n,e),n=ik(n,e)}function gC(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function gI(e,t){if(!(t instanceof m7)&&!(t instanceof ge))throw new M(P.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function g_(e){let t=e.filter(e=>e instanceof ge).length,n=e.filter(e=>e instanceof m7).length;if(t>1||t>0&&n>0)throw new M(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}class gA{convertValue(e,t="none"){switch(n$(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw D()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return nn(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new mC(null==(r=null==(n=null==(t=e.fields)?void 0:t[nG].arrayValue)?void 0:n.values)?void 0:r.map(e=>nw(e.doubleValue)))}convertGeoPoint(e){return new mE(nw(e.latitude),nw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=nD(e);if(null==n)return null;return this.convertValue(n,t);case"estimate":return this.convertTimestamp(nN(e));default:return null}}convertTimestamp(e){let t=nS(e);return new es(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=eu.fromString(e);N(od(n));let r=new nP(n.get(1),n.get(3)),i=new ed(n.popFirst(5));return r.isEqual(t)||A(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function gk(e,t,n){let r;return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class gR extends gA{constructor(e){super(),this.firestore=e}convertBytes(e){return new mb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pJ(this.firestore,null,t)}}function gD(e){return new my("sum",mY("sum",e))}function gN(e){return new my("avg",mY("average",e))}function gO(){return new my("count")}function gx(e,t){var n,r;return e instanceof my&&t instanceof my&&e.aggregateType===t.aggregateType&&(null==(n=e._internalFieldPath)?void 0:n.canonicalString())===(null==(r=t._internalFieldPath)?void 0:r.canonicalString())}function gP(e,t){return p3(e.query,t.query)&&(0,h.bD)(e.data(),t.data())}function gM(e){return gL(e,["next","error","complete"])}function gL(e,t){if("object"!=typeof e||null===e)return!1;let n=e;for(let e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}class gF{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gB extends m1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new gU(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let n=this._document.data.field(m3("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class gU extends gB{data(e={}){return super.data(e)}}class gV{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new gF(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new gU(this._firestore,this._userDataWriter,n.key,n,new gF(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=gj(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function gj(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new gU(e._firestore,e._userDataWriter,n.doc.key,n.doc,new gF(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new gU(e._firestore,e._userDataWriter,t.doc.key,t.doc,new gF(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:gq(t.type),doc:r,oldIndex:i,newIndex:s}})}}function gq(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function gz(e,t){return e instanceof gB&&t instanceof gB?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof gV&&t instanceof gV&&e._firestore===t._firestore&&p3(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function gG(e){e=fJ(e,pJ);let t=fJ(e.firestore,p9);return pv(mn(t),e._key).then(n=>g6(t,e,n))}class gK extends gA{constructor(e){super(),this.firestore=e}convertBytes(e){return new mb(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new pJ(this.firestore,null,t)}}function g$(e){e=fJ(e,pJ);let t=fJ(e.firestore,p9),n=mn(t),r=new gK(t);return py(n,e._key).then(n=>new gB(t,r,e._key,n,new gF(null!==n&&n.hasLocalMutations,!0),e.converter))}function gH(e){e=fJ(e,pJ);let t=fJ(e.firestore,p9);return pv(mn(t),e._key,{source:"server"}).then(n=>g6(t,e,n))}function gW(e){e=fJ(e,pY);let t=fJ(e.firestore,p9),n=mn(t),r=new gK(t);return m6(e._query),pT(n,e._query).then(n=>new gV(t,r,e,n))}function gQ(e){e=fJ(e,pY);let t=fJ(e.firestore,p9),n=mn(t),r=new gK(t);return pb(n,e._query).then(n=>new gV(t,r,e,n))}function gY(e){e=fJ(e,pY);let t=fJ(e.firestore,p9),n=mn(t),r=new gK(t);return pT(n,e._query,{source:"server"}).then(n=>new gV(t,r,e,n))}function gJ(e,t,n){e=fJ(e,pJ);let r=fJ(e.firestore,p9),i=gk(e.converter,t,n),s=mO(mN(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,sy.none());return g3(r,[s])}function gX(e,t,n,...r){let i;e=fJ(e,pJ);let s=fJ(e.firestore,p9),a=mN(s);return g3(s,[(i="string"==typeof(t=(0,h.Ku)(t))||t instanceof mT?mV(a,"updateDoc",e._key,t,n,r):mU(a,"updateDoc",e._key,t)).toMutation(e._key,sy.exists(!0))])}function gZ(e){return g3(fJ(e.firestore,p9),[new sP(e._key,sy.none())])}function g0(e,t){let n=fJ(e.firestore,p9),r=p1(e),i=gk(e.converter,t);return g3(n,[mO(mN(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,sy.exists(!1))]).then(()=>r)}function g1(e,...t){var n,r,i;let s,a,o;e=(0,h.Ku)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"==typeof t[0]&&!gM(t[u])&&(l=t[u],u++);let c={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(gM(t[u])){let e=t[u];t[u]=null==(n=e.next)?void 0:n.bind(e),t[u+1]=null==(r=e.error)?void 0:r.bind(e),t[u+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof pJ)a=fJ(e.firestore,p9),o=iy(e._key.path),s={next:n=>{t[u]&&t[u](g6(a,e,n))},error:t[u+1],complete:t[u+2]};else{let n=fJ(e,pY);a=fJ(n.firestore,p9),o=n._query;let r=new gK(a);s={next:e=>{t[u]&&t[u](new gV(a,r,n,e))},error:t[u+1],complete:t[u+2]},m6(e._query)}return pg(mn(a),o,c,s)}function g2(e,t){return pE(mn(e=fJ(e,p9)),gM(t)?t:{next:t})}function g3(e,t){return pw(mn(e),t)}function g6(e,t,n){let r=n.docs.get(t._key),i=new gK(e);return new gB(e,i,t._key,r,new gF(n.hasPendingWrites,n.fromCache),t.converter)}function g5(e){return g4(e,{count:gO()})}function g4(e,t){let n=fJ(e.firestore,p9),r=mn(n),i=nr(t,(e,t)=>new mg(t,e.aggregateType,e._internalFieldPath));return pS(r,e._query,i).then(t=>g8(n,e,t))}function g8(e,t,n){return new mv(t,new gK(e),n)}class g7{constructor(e){this.kind="memory",this._onlineComponentProvider=fj.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new fB(void 0)}}toJSON(){return{kind:this.kind}}}class g9{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=yl(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class ye{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fF.provider}toJSON(){return{kind:this.kind}}}class yt{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new fB(e)}}toJSON(){return{kind:this.kind}}}function yn(){return new ye}function yr(e){return new yt(null==e?void 0:e.cacheSizeBytes)}function yi(e){return new g7(e)}function ys(e){return new g9(e)}class ya{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fj.provider,this._offlineComponentProvider={build:t=>new fU(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class yo{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=fj.provider,this._offlineComponentProvider={build:t=>new fV(t,null==e?void 0:e.cacheSizeBytes)}}}function yl(e){return new ya(null==e?void 0:e.forceOwnership)}function yu(){return new yo}let yc={maxAttempts:5};function yh(e){if(e.maxAttempts<1)throw new M(P.INVALID_ARGUMENT,"Max attempts must be at least 1")}class yd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=mN(e)}set(e,t,n){this._verifyNotCommitted();let r=yf(e,this._firestore),i=gk(r.converter,t,n),s=mO(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,sy.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=yf(e,this._firestore);return i="string"==typeof(t=(0,h.Ku)(t))||t instanceof mT?mV(this._dataReader,"WriteBatch.update",s._key,t,n,r):mU(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,sy.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=yf(e,this._firestore);return this._mutations=this._mutations.concat(new sP(t._key,sy.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yf(e,t){if((e=(0,h.Ku)(e)).firestore===t)return e;throw new M(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}class yp{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=mN(e)}get(e){let t=yf(e,this._firestore),n=new gR(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return D();let r=e[0];if(r.isFoundDocument())return new m1(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new m1(this._firestore,n,t._key,null,t.converter);throw D()})}set(e,t,n){let r=yf(e,this._firestore),i=gk(r.converter,t,n),s=mO(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=yf(e,this._firestore);return i="string"==typeof(t=(0,h.Ku)(t))||t instanceof mT?mV(this._dataReader,"Transaction.update",s._key,t,n,r):mU(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=yf(e,this._firestore);return this._transaction.delete(t._key),this}}class ym extends yp{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=yf(e,this._firestore),n=new gK(this._firestore);return super.get(e).then(e=>new gB(this._firestore,n,t._key,e._document,new gF(!1,!1),t.converter))}}function yg(e,t,n){e=fJ(e,p9);let r=Object.assign(Object.assign({},yc),n);return yh(r),pC(mn(e),n=>t(new ym(e,n)),r)}function yy(){return new mx("deleteField")}function yv(){return new mM("serverTimestamp")}function yb(...e){return new mL("arrayUnion",e)}function yT(...e){return new mF("arrayRemove",e)}function yS(e){return new mB("increment",e)}function yw(e){return new mC(e)}function yE(e){return mn(e=fJ(e,p9)),new yd(e,t=>g3(e,t))}function yC(e,t){let n=mn(e=fJ(e,p9));return n._uninitializedComponentsProvider&&"memory"!==n._uninitializedComponentsProvider._offline.kind?pO(n,yI(t)):(k("Cannot enable indexes when persistence is disabled"),Promise.resolve())}function yI(e){let t="string"==typeof e?y_(e):e,n=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=yA(e,"collectionGroup"),r=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=mX("setIndexConfiguration",yA(t,"fieldPath"));"CONTAINS"===t.arrayConfig?r.push(new eS(e,2)):"ASCENDING"===t.order?r.push(new eS(e,0)):"DESCENDING"===t.order&&r.push(new eS(e,1))}n.push(new em(em.UNKNOWN_ID,t,r,eE.empty()))}return n}function y_(e){try{return JSON.parse(e)}catch(e){throw new M(P.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}function yA(e,t){if("string"!=typeof e[t])throw new M(P.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class yk{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function yR(e){var t;e=fJ(e,p9);let n=yP.get(e);if(n)return n;if((null==(t=mn(e)._uninitializedComponentsProvider)?void 0:t._offline.kind)!=="persistent")return null;let r=new yk(e);return yP.set(e,r),r}function yD(e){yx(e,!0)}function yN(e){yx(e,!1)}function yO(e){pP(mn(e._firestore)).then(e=>_("deleting all persistent cache indexes succeeded")).catch(e=>k("deleting all persistent cache indexes failed",e))}function yx(e,t){px(mn(e._firestore),t).then(e=>_(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>k(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let yP=new WeakMap;function yM(e){var t;let n=null==(t=mn(fJ(e.firestore,p9))._onlineComponents)?void 0:t.datastore.serializer;return void 0===n?null:aq(n,iI(e._query)).queryTarget}function yL(e,t){var n;let r=nr(t,(e,t)=>new mg(t,e.aggregateType,e._internalFieldPath)),i=null==(n=mn(fJ(e.firestore,p9))._onlineComponents)?void 0:n.datastore.serializer;return void 0===i?null:az(i,i_(e._query),r,!0).request}class yF{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return yB.instance.onExistenceFilterMismatch(e)}}class yB{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return yU||sH(yU=new yB),yU}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),n=this.existenceFilterMismatchCallbacksById;return n.set(t,e),()=>n.delete(t)}}let yU=null;mm("node")},75677:(e,t,n)=>{"use strict";e.exports=s;var r=n(26996);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(8707);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},77936:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let r=n(63038),i=n(93122),s=n(98605),a=n(81630),o=n(34631),l=n(63038),u=n(98387),c=n(57213),h=n(79551),d=n(42319),f="proxy";function p(e){l.trace(i.LogVerbosity.DEBUG,f,e)}function m(){let e,t="",n="";if(process.env.grpc_proxy)n="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)n="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};n="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,r.log)(i.LogVerbosity.ERROR,`cannot parse value of "${n}" env var`),{}}if("http:"!==e.protocol)return(0,r.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,r.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),p("Proxy server "+l.address+" set by environment variable "+n),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(p("No proxy server list set by environment variable "+t),e.split(",")):[]}t.mapProxyName=function(e,t){var n;let r={target:e,extraOptions:{}};if((null!=(n=t["grpc.enable_http_proxy"])?n:1)===0||"unix"===e.scheme)return r;let i=m();if(!i.address)return r;let s=(0,c.splitHostPort)(e.path);if(!s)return r;let a=s.host;for(let t of g())if(t===a)return p("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),r;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},t.getProxiedConnection=function(e,t,n){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],f=(0,c.parseUri)(h);if(null===f)return Promise.resolve({});let m=(0,c.splitHostPort)(f.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,u.subchannelAddressToString)(e);return p("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,h)=>{var d;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode)if(p("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in n){let r=(0,s.getDefaultAuthority)(f),i=(0,c.splitHostPort)(r),a=null!=(d=null==i?void 0:i.host)?d:r,l=o.connect(Object.assign({host:a,servername:a,socket:u},n),()=>{p("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:f})});l.on("error",e=>{p("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else p("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:f});else(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,r.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}},77968:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,a=n(64824);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=n(73267),l=n(93107),u=n(12630);function c(e,t){if(e&&e.length){for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null}function d(e){return e._nestedArray=null,e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var n=0;n<e.length;++n)if(e[n]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var n,a=Object.keys(e),l=0;l<a.length;++l)n=e[a[l]],t.add((void 0!==n.fields?r.fromJSON:void 0!==n.values?s.fromJSON:void 0!==n.methods?i.fromJSON:void 0!==n.id?o.fromJSON:h.fromJSON)(a[l],n));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof r||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof h&&e instanceof h&&!(t instanceof r||t instanceof i)){for(var n=t.nestedArray,a=0;a<n.length;++a)e.add(n[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};return this.nested[e.name]=e,this instanceof r||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof h))throw Error("path conflicts with non-namespace objects")}else n.add(n=new h(r))}return t&&n.addJSON(t),n},h.prototype.resolveAll=function(){var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this},h.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this},h.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof h&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof h&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},h.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,n){r=e,i=t,s=n}},82281:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},t.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},82566:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},82703:(e,t,n)=>{"use strict";e.exports=h;var r,i,s,a=n(77968);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=n(73267),l=n(32110),u=n(12630),c=n(93107);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2"}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=void 0);var a=this;if(!r)return c.asPromise(e,a,t,n);var o=r===d;function l(e,t){if(r){if(o)throw e;var n=r;r=null,t&&t.resolveAll(),n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in s)return n}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var r,s=i(t,a,n),h=0;if(s.imports)for(;h<s.imports.length;++h)(r=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&f(r);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(r=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&f(r,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||p||l(null,a)}function f(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?h(e,s[e]):(++p,setTimeout(function(){--p,h(e,s[e])})));if(o){var n;try{n=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,n)}else++p,a.fetch(e,function(n,i){if(--p,r){if(n)return void(t?p||l(null,a):l(n));h(e,i)}})}}var p=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&f(m);return a.resolveAll(),o||p||l(null,a),a},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!n.get(r.name)||(r.declaringField=t,t.extensionField=r,n.add(r),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||p(this,e)||this.deferred.push(e);else if(e instanceof l)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)p(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);f.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);f.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,i=t,s=n}},83232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let r=n(36551),i=n(48436);class s{constructor(e,t,n){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof r.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(n&&"object"!=typeof n)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,n)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,n){this.internalChannel.watchConnectivityState(e,t,n)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,n,r,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,n,r,i)}}t.ChannelImplementation=s},83273:e=>{"use strict";e.exports=function e(e,t,n){var r=n||8192,i=r>>>1,s=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(s=e(r),a=0);var o=t.call(s,a,a+=n);return 7&a&&(a=(7|a)+1),o}}},84245:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ActionCodeOperation:()=>d,ActionCodeURL:()=>tb,AuthCredential:()=>e5,AuthErrorCodes:()=>y,EmailAuthCredential:()=>tl,EmailAuthProvider:()=>tS,FacebookAuthProvider:()=>tI,FactorId:()=>l,GithubAuthProvider:()=>tA,GoogleAuthProvider:()=>t_,OAuthCredential:()=>th,OAuthProvider:()=>tC,OperationType:()=>h,PhoneAuthCredential:()=>tg,PhoneAuthProvider:()=>nX,PhoneMultiFactorGenerator:()=>rt,ProviderId:()=>u,RecaptchaVerifier:()=>re,SAMLAuthProvider:()=>tN,SignInMethod:()=>c,TotpMultiFactorGenerator:()=>ri,TotpSecret:()=>ra,TwitterAuthProvider:()=>tO,applyActionCode:()=>t3,beforeAuthStateChanged:()=>nw,browserCookiePersistence:()=>nQ,browserLocalPersistence:()=>nH,browserPopupRedirectResolver:()=>nJ,browserSessionPersistence:()=>nW,checkActionCode:()=>t6,confirmPasswordReset:()=>t2,connectAuthEmulator:()=>e0,createUserWithEmailAndPassword:()=>t4,debugErrorMap:()=>p,deleteUser:()=>nk,fetchSignInMethodsForEmail:()=>nn,getAdditionalUserInfo:()=>ny,getAuth:()=>nz,getIdToken:()=>et,getIdTokenResult:()=>en,getMultiFactorResolver:()=>nN,getRedirectResult:()=>n9,inMemoryPersistence:()=>ew,indexedDBLocalPersistence:()=>nY,initializeAuth:()=>eX,initializeRecaptchaConfig:()=>nb,isSignInWithEmailLink:()=>t9,linkWithCredential:()=>t$,linkWithPhoneNumber:()=>n0,linkWithPopup:()=>n6,linkWithRedirect:()=>n8,multiFactor:()=>nF,onAuthStateChanged:()=>nE,onIdTokenChanged:()=>nS,parseActionCodeURL:()=>tT,prodErrorMap:()=>m,reauthenticateWithCredential:()=>tH,reauthenticateWithPhoneNumber:()=>n1,reauthenticateWithPopup:()=>n5,reauthenticateWithRedirect:()=>n7,reload:()=>eh,revokeAccessToken:()=>nA,sendEmailVerification:()=>nr,sendPasswordResetEmail:()=>t1,sendSignInLinkToEmail:()=>t7,setPersistence:()=>nv,signInAnonymously:()=>tL,signInWithCredential:()=>tK,signInWithCustomToken:()=>tQ,signInWithEmailAndPassword:()=>t8,signInWithEmailLink:()=>ne,signInWithPhoneNumber:()=>nZ,signInWithPopup:()=>n3,signInWithRedirect:()=>n4,signOut:()=>n_,unlink:()=>tV,updateCurrentUser:()=>nI,updateEmail:()=>no,updatePassword:()=>nl,updatePhoneNumber:()=>n2,updateProfile:()=>na,useDeviceLanguage:()=>nC,validatePassword:()=>nT,verifyBeforeUpdateEmail:()=>ni,verifyPasswordResetCode:()=>t5});var r=n(31305),i=n(52122);function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Object.create;Object.create;var a=("function"==typeof SuppressedError&&SuppressedError,n(35545)),o=n(88060);let l={PHONE:"phone",TOTP:"totp"},u={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},c={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},h={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},d={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function f(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let p=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}},m=f,g=new i.FA("auth","Firebase",f()),y={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"},v=new o.Vy("@firebase/auth");function b(e,...t){v.logLevel<=o.$b.WARN&&v.warn(`Auth (${r.MF}): ${e}`,...t)}function T(e,...t){v.logLevel<=o.$b.ERROR&&v.error(`Auth (${r.MF}): ${e}`,...t)}function S(e,...t){throw I(e,...t)}function w(e,...t){return I(e,...t)}function E(e,t,n){let r=Object.assign(Object.assign({},m()),{[t]:n});return new i.FA("auth","Firebase",r).create(t,{appName:e.name})}function C(e){return E(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function I(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return g.create(e,...t)}function _(e,t,...n){if(!e)throw I(t,...n)}function A(e){let t="INTERNAL ASSERTION FAILED: "+e;throw T(t),Error(t)}function k(e,t){e||A(t)}function R(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function D(){return"http:"===N()||"https:"===N()}function N(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}function O(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(D()||(0,i.sr)()||"connection"in navigator))||navigator.onLine}function x(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class P{constructor(e,t){this.shortDelay=e,this.longDelay=t,k(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return O()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function M(e,t){k(e.emulator,"Emulator should always be set here");let{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class L{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void A("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void A("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void A("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let F={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},B=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],U=new P(3e4,6e4);function V(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function j(e,t,n,r,s={}){return q(e,s,async()=>{let s={},a={};r&&("GET"===t?a=r:s={body:JSON.stringify(r)});let o=(0,i.Am)(Object.assign({key:e.config.apiKey},a)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);let u=Object.assign({method:t,headers:l},s);return(0,i.c1)()||(u.referrerPolicy="no-referrer"),L.fetch()(await G(e,e.config.apiHost,n,o),u)})}async function q(e,t,n){e._canInitEmulator=!1;let r=Object.assign(Object.assign({},F),t);try{let t=new $(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw H(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw H(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw H(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw H(e,"user-disabled",s);let a=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw E(e,a,n);S(e,a)}}catch(t){if(t instanceof i.g)throw t;S(e,"network-request-failed",{message:String(t)})}}async function z(e,t,n,r,i={}){let s=await j(e,t,n,r,i);return"mfaPendingCredential"in s&&S(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function G(e,t,n,r){let i=`${t}${n}?${r}`,s=e,a=s.config.emulator?M(e.config,i):`${e.config.apiScheme}://${i}`;return B.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function K(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ${clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(w(this.auth,"network-request-failed")),U.get())})}}function H(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=w(e,t,r);return i.customData._tokenResponse=n,i}function W(e){return void 0!==e&&void 0!==e.enterprise}class Q{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return K(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Y(e,t){return j(e,"GET","/v2/recaptchaConfig",V(e,t))}async function J(e,t){return j(e,"POST","/v1/accounts:delete",t)}async function X(e,t){return j(e,"POST","/v1/accounts:update",t)}async function Z(e,t){return j(e,"POST","/v1/accounts:lookup",t)}function ee(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function et(e,t=!1){return(0,i.Ku)(e).getIdToken(t)}async function en(e,t=!1){let n=(0,i.Ku)(e),r=await n.getIdToken(t),s=ei(r);_(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let a="object"==typeof s.firebase?s.firebase:void 0,o=null==a?void 0:a.sign_in_provider;return{claims:s,token:r,authTime:ee(er(s.auth_time)),issuedAtTime:ee(er(s.iat)),expirationTime:ee(er(s.exp)),signInProvider:o||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}function er(e){return 1e3*Number(e)}function ei(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return T("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,i.u)(n);if(!e)return T("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return T("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function es(e){let t=ei(e);return _(t,"internal-error"),_(void 0!==t.exp,"internal-error"),_(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function ea(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.g&&eo(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function eo({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class el{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class eu{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ee(this.lastLoginAt),this.creationTime=ee(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ec(e){var t;let n=e.auth,r=await e.getIdToken(),i=await ea(e,Z(n,{idToken:r}));_(null==i?void 0:i.users.length,n,"internal-error");let s=i.users[0];e._notifyReloadListener(s);let a=(null==(t=s.providerUserInfo)?void 0:t.length)?ef(s.providerUserInfo):[],o=ed(e.providerData,a),l=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null==o?void 0:o.length),c=!!l&&u;Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new eu(s.createdAt,s.lastLoginAt),isAnonymous:c})}async function eh(e){let t=(0,i.Ku)(e);await ec(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function ed(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function ef(e){return e.map(e=>{var{providerId:t}=e,n=s(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function ep(e,t){let n=await q(e,{},async()=>{let n=(0,i.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,a=await G(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",L.fetch()(a,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function em(e,t){return j(e,"POST","/v2/accounts:revokeToken",V(e,t))}class eg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_(e.idToken,"internal-error"),_(void 0!==e.idToken,"internal-error"),_(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):es(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_(0!==e.length,"internal-error");let t=es(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(_(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await ep(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new eg;return n&&(_("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(_("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(_("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new eg,this.toJSON())}_performRefresh(){return A("not implemented")}}function ey(e,t){_("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ev{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=s(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new el(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new eu(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await ea(this,this.stsTokenManager.getToken(this.auth,e));return _(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return en(this,e)}reload(){return eh(this)}_assign(e){this!==e&&(_(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ev(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){_(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ec(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r.xZ)(this.auth.app))return Promise.reject(C(this.auth));let e=await this.getIdToken();return await ea(this,J(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,u;let c=null!=(n=t.displayName)?n:void 0,h=null!=(r=t.email)?r:void 0,d=null!=(i=t.phoneNumber)?i:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(a=t.tenantId)?a:void 0,m=null!=(o=t._redirectEventId)?o:void 0,g=null!=(l=t.createdAt)?l:void 0,y=null!=(u=t.lastLoginAt)?u:void 0,{uid:v,emailVerified:b,isAnonymous:T,providerData:S,stsTokenManager:w}=t;_(v&&w,e,"internal-error");let E=eg.fromJSON(this.name,w);_("string"==typeof v,e,"internal-error"),ey(c,e.name),ey(h,e.name),_("boolean"==typeof b,e,"internal-error"),_("boolean"==typeof T,e,"internal-error"),ey(d,e.name),ey(f,e.name),ey(p,e.name),ey(m,e.name),ey(g,e.name),ey(y,e.name);let C=new ev({uid:v,auth:e,email:h,emailVerified:b,displayName:c,isAnonymous:T,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return S&&Array.isArray(S)&&(C.providerData=S.map(e=>Object.assign({},e))),m&&(C._redirectEventId=m),C}static async _fromIdTokenResponse(e,t,n=!1){let r=new eg;r.updateFromServerResponse(t);let i=new ev({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ec(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];_(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?ef(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length),a=new eg;a.updateFromIdToken(n);let o=new ev({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new eu(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length)}),o}}let eb=new Map;function eT(e){k(e instanceof Function,"Expected a class definition");let t=eb.get(e);return t?k(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,eb.set(e,t)),t}class eS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}eS.type="NONE";let ew=eS;function eE(e,t,n){return`firebase:${e}:${t}:${n}`}class eC{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:r,name:i}=this.auth;this.fullUserKey=eE(this.userKey,r.apiKey,i),this.fullPersistenceKey=eE("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await Z(this.auth,{idToken:e}).catch(()=>void 0);return t?ev._fromGetAccountInfoResponse(this.auth,t,e):null}return ev._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new eC(eT(ew),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||eT(ew),s=eE(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let r;if("string"==typeof t){let n=await Z(e,{idToken:t}).catch(()=>void 0);if(!n)break;r=await ev._fromGetAccountInfoResponse(e,n,t)}else r=ev._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}let o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new eC(i,e,n)}}function eI(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(eR(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(e_(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eN(t))return"Blackberry";if(eO(t))return"Webos";if(eA(t))return"Safari";if((t.includes("chrome/")||ek(t))&&!t.includes("edge/"))return"Chrome";if(eD(t))return"Android";let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(n);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function e_(e=(0,i.ZQ)()){return/firefox\//i.test(e)}function eA(e=(0,i.ZQ)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ek(e=(0,i.ZQ)()){return/crios\//i.test(e)}function eR(e=(0,i.ZQ)()){return/iemobile/i.test(e)}function eD(e=(0,i.ZQ)()){return/android/i.test(e)}function eN(e=(0,i.ZQ)()){return/blackberry/i.test(e)}function eO(e=(0,i.ZQ)()){return/webos/i.test(e)}function ex(e,t=[]){let n;switch(e){case"Browser":n=eI((0,i.ZQ)());break;case"Worker":n=`${eI((0,i.ZQ)())}-${e}`;break;default:n=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.MF}/${s}`}class eP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function eM(e,t={}){return j(e,"GET","/v2/passwordPolicy",V(e,t))}let eL=6;class eF{constructor(e){var t,n,r,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:eL,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(n=e.allowedNonAlphanumericCharacters)?void 0:n.join(""))?r:"",this.forceUpgradeOnSignin=null!=(i=e.forceUpgradeOnSignin)&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(n=o.meetsMaxPasswordLength)||n),o.isValid&&(o.isValid=null==(r=o.containsLowercaseLetter)||r),o.isValid&&(o.isValid=null==(i=o.containsUppercaseLetter)||i),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class eB{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eV(this),this.idTokenSubscription=new eV(this),this.beforeStateQueue=new eP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=g,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=eT(t)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted){if(this.persistenceManager=await eC.create(this,e),null==(n=this._resolvePersistenceManagerAvailable)||n.call(this),!this._deleted){if(null==(r=this._popupRedirectResolver)?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await Z(this,{idToken:e}),n=await ev._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,r.xZ)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);(!n||n===r)&&(null==a?void 0:a.user)&&(i=a.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(_(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ec(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=x()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r.xZ)(this.app))return Promise.reject(C(this));let t=e?(0,i.Ku)(e):null;return t&&_(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,r.xZ)(this.app)?Promise.reject(C(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r.xZ)(this.app)?Promise.reject(C(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eT(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new eF(await eM(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new i.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await em(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&eT(e)||this._popupRedirectResolver;_(t,this,"argument-error"),this.redirectPersistenceManager=await eC.create(this,[eT(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(_(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ex(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if((0,r.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&b(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function eU(e){return(0,i.Ku)(e)}class eV{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.tD)(e=>this.observer=e)}get next(){return _(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ej={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eq(e){return ej.loadJS(e)}function ez(){return ej.recaptchaEnterpriseScript}class eG{constructor(){this.enterprise=new eK}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eK{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let e$="recaptcha-enterprise",eH="NO_RECAPTCHA";class eW{constructor(e){this.type=e$,this.auth=eU(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Y(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new Q(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;W(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(eH)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eG().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&W(window.grecaptcha))r(n,e,i);else{if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=ez();0!==t.length&&(t+=n),eq(t).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function eQ(e,t,n,r=!1,i=!1){let s,a=new eW(e);if(i)s=eH;else try{s=await a.verify(n)}catch(e){s=await a.verify(n,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function eY(e,t,n,r,i){var s,a;if("EMAIL_PASSWORD_PROVIDER"===i)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await eQ(e,t,n,"getOobCode"===n);return r(e,i)}});else{let i=await eQ(e,t,n,"getOobCode"===n);return r(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await eQ(e,t,n);return r(e,i).catch(async i=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await eQ(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await eQ(e,t,n,!1,!0);return r(e,i)}}async function eJ(e){let t=eU(e),n=new Q(await Y(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new eW(t).verify()}function eX(e,t){let n=(0,r.j6)(e,"auth");if(n.isInitialized()){let e=n.getImmediate(),r=n.getOptions();if((0,i.bD)(r,null!=t?t:{}))return e;S(e,"already-initialized")}return n.initialize({options:t})}function eZ(e,t){let n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(eT);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}function e0(e,t,n){let r=eU(e);_(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let s=!!(null==n?void 0:n.disableWarnings),a=e1(t),{host:o,port:l}=e2(t),u=null===l?"":`:${l}`,c={url:`${a}//${o}${u}/`},h=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){_(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),_((0,i.bD)(c,r.config.emulator)&&(0,i.bD)(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,s||e6()}function e1(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function e2(e){let t=e1(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:e3(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:e3(t)}}}function e3(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function e6(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class e5{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return A("not implemented")}_getIdTokenResponse(e){return A("not implemented")}_linkToIdToken(e,t){return A("not implemented")}_getReauthenticationResolver(e){return A("not implemented")}}async function e4(e,t){return j(e,"POST","/v1/accounts:resetPassword",V(e,t))}async function e8(e,t){return j(e,"POST","/v1/accounts:update",t)}async function e7(e,t){return j(e,"POST","/v1/accounts:signUp",t)}async function e9(e,t){return j(e,"POST","/v1/accounts:update",V(e,t))}async function te(e,t){return z(e,"POST","/v1/accounts:signInWithPassword",V(e,t))}async function tt(e,t){return j(e,"POST","/v1/accounts:sendOobCode",V(e,t))}async function tn(e,t){return tt(e,t)}async function tr(e,t){return tt(e,t)}async function ti(e,t){return tt(e,t)}async function ts(e,t){return tt(e,t)}async function ta(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",V(e,t))}async function to(e,t){return z(e,"POST","/v1/accounts:signInWithEmailLink",V(e,t))}class tl extends e5{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new tl(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new tl(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eY(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",te,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ta(e,{email:this._email,oobCode:this._password});default:S(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eY(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",e7,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return to(e,{idToken:t,email:this._email,oobCode:this._password});default:S(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function tu(e,t){return z(e,"POST","/v1/accounts:signInWithIdp",V(e,t))}let tc="http://localhost";class th extends e5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new th(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):S("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=s(t,["providerId","signInMethod"]);if(!n||!r)return null;let a=new th(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return tu(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,tu(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,tu(e,t)}buildRequest(){let e={requestUri:tc,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.Am)(t)}return e}}async function td(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,t))}async function tf(e,t){let n=await z(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,t));if(n.temporaryProof)throw H(e,"account-exists-with-different-credential",n);return n}let tp={USER_NOT_FOUND:"user-not-found"};async function tm(e,t){return z(e,"POST","/v1/accounts:signInWithPhoneNumber",V(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),tp)}class tg extends e5{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new tg({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new tg({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return td(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tf(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return tm(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new tg({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}function ty(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tv(e){let t=(0,i.I9)((0,i.hp)(e)).link,n=t?(0,i.I9)((0,i.hp)(t)).deep_link_id:null,r=(0,i.I9)((0,i.hp)(e)).deep_link_id;return(r?(0,i.I9)((0,i.hp)(r)).link:null)||r||n||t||e}class tb{constructor(e){var t,n,r,s,a,o;let l=(0,i.I9)((0,i.hp)(e)),u=null!=(t=l.apiKey)?t:null,c=null!=(n=l.oobCode)?n:null,h=ty(null!=(r=l.mode)?r:null);_(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=null!=(s=l.continueUrl)?s:null,this.languageCode=null!=(a=l.languageCode)?a:null,this.tenantId=null!=(o=l.tenantId)?o:null}static parseLink(e){let t=tv(e);try{return new tb(t)}catch(e){return null}}}function tT(e){return tb.parseLink(e)}class tS{constructor(){this.providerId=tS.PROVIDER_ID}static credential(e,t){return tl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=tb.parseLink(t);return _(n,"argument-error"),tl._fromEmailAndCode(e,n.code,n.tenantId)}}tS.PROVIDER_ID="password",tS.EMAIL_PASSWORD_SIGN_IN_METHOD="password",tS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class tw{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class tE extends tw{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tC extends tE{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return _("providerId"in t&&"signInMethod"in t,"argument-error"),th._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return _(e.idToken||e.accessToken,"argument-error"),th._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return tC.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return tC.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!n&&!r&&!t&&!i||!a)return null;try{return new tC(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class tI extends tE{constructor(){super("facebook.com")}static credential(e){return th._fromParams({providerId:tI.PROVIDER_ID,signInMethod:tI.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tI.credentialFromTaggedObject(e)}static credentialFromError(e){return tI.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tI.credential(e.oauthAccessToken)}catch(e){return null}}}tI.FACEBOOK_SIGN_IN_METHOD="facebook.com",tI.PROVIDER_ID="facebook.com";class t_ extends tE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return th._fromParams({providerId:t_.PROVIDER_ID,signInMethod:t_.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return t_.credentialFromTaggedObject(e)}static credentialFromError(e){return t_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return t_.credential(t,n)}catch(e){return null}}}t_.GOOGLE_SIGN_IN_METHOD="google.com",t_.PROVIDER_ID="google.com";class tA extends tE{constructor(){super("github.com")}static credential(e){return th._fromParams({providerId:tA.PROVIDER_ID,signInMethod:tA.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tA.credentialFromTaggedObject(e)}static credentialFromError(e){return tA.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tA.credential(e.oauthAccessToken)}catch(e){return null}}}tA.GITHUB_SIGN_IN_METHOD="github.com",tA.PROVIDER_ID="github.com";let tk="http://localhost";class tR extends e5{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return tu(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,tu(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,tu(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new tR(t,r):null}static _create(e,t){return new tR(e,t)}buildRequest(){return{requestUri:tk,returnSecureToken:!0,pendingToken:this.pendingToken}}}let tD="saml.";class tN extends tw{constructor(e){_(e.startsWith(tD),"argument-error"),super(e)}static credentialFromResult(e){return tN.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return tN.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=tR.fromJSON(e);return _(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return tR._create(n,t)}catch(e){return null}}}class tO extends tE{constructor(){super("twitter.com")}static credential(e,t){return th._fromParams({providerId:tO.PROVIDER_ID,signInMethod:tO.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tO.credentialFromTaggedObject(e)}static credentialFromError(e){return tO.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return tO.credential(t,n)}catch(e){return null}}}async function tx(e,t){return z(e,"POST","/v1/accounts:signUp",V(e,t))}tO.TWITTER_SIGN_IN_METHOD="twitter.com",tO.PROVIDER_ID="twitter.com";class tP{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new tP({user:await ev._fromIdTokenResponse(e,n,r),providerId:tM(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new tP({user:e,providerId:tM(n),_tokenResponse:n,operationType:t})}}function tM(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function tL(e){var t;if((0,r.xZ)(e.app))return Promise.reject(C(e));let n=eU(e);if(await n._initializationPromise,null==(t=n.currentUser)?void 0:t.isAnonymous)return new tP({user:n.currentUser,providerId:null,operationType:"signIn"});let i=await tx(n,{returnSecureToken:!0}),s=await tP._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(s.user),s}class tF extends i.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,tF.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new tF(e,t,n,r)}}function tB(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw tF._fromErrorAndOperation(e,n,t,r);throw n})}function tU(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function tV(e,t){let n=(0,i.Ku)(e);await tq(!0,n,t);let{providerUserInfo:r}=await X(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=tU(r||[]);return n.providerData=n.providerData.filter(e=>s.has(e.providerId)),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function tj(e,t,n=!1){let r=await ea(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return tP._forOperation(e,"link",r)}async function tq(e,t,n){await ec(t);let r=tU(t.providerData),i=!1===e?"provider-already-linked":"no-such-provider";_(r.has(n)===e,t.auth,i)}async function tz(e,t,n=!1){let{auth:i}=e;if((0,r.xZ)(i.app))return Promise.reject(C(i));let s="reauthenticate";try{let r=await ea(e,tB(i,s,t,e),n);_(r.idToken,i,"internal-error");let a=ei(r.idToken);_(a,i,"internal-error");let{sub:o}=a;return _(e.uid===o,i,"user-mismatch"),tP._forOperation(e,s,r)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&S(i,"user-mismatch"),e}}async function tG(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(C(e));let i="signIn",s=await tB(e,i,t),a=await tP._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(a.user),a}async function tK(e,t){return tG(eU(e),t)}async function t$(e,t){let n=(0,i.Ku)(e);return await tq(!1,n,t.providerId),tj(n,t)}async function tH(e,t){return tz((0,i.Ku)(e),t)}async function tW(e,t){return z(e,"POST","/v1/accounts:signInWithCustomToken",V(e,t))}async function tQ(e,t){if((0,r.xZ)(e.app))return Promise.reject(C(e));let n=eU(e),i=await tW(n,{token:t,returnSecureToken:!0}),s=await tP._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(s.user),s}class tY{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?tJ._fromServerResponse(e,t):"totpInfo"in t?tX._fromServerResponse(e,t):S(e,"internal-error")}}class tJ extends tY{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new tJ(t)}}class tX extends tY{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new tX(t)}}function tZ(e,t,n){var r;_((null==(r=n.url)?void 0:r.length)>0,e,"invalid-continue-uri"),_(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),_(void 0===n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(_(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(_(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function t0(e){let t=eU(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function t1(e,t,n){let r=eU(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&tZ(r,i,n),await eY(r,i,"getOobCode",tr,"EMAIL_PASSWORD_PROVIDER")}async function t2(e,t,n){await e4((0,i.Ku)(e),{oobCode:t,newPassword:n}).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&t0(e),t})}async function t3(e,t){await e9((0,i.Ku)(e),{oobCode:t})}async function t6(e,t){let n=(0,i.Ku)(e),r=await e4(n,{oobCode:t}),s=r.requestType;switch(_(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":_(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":_(r.mfaInfo,n,"internal-error");default:_(r.email,n,"internal-error")}let a=null;return r.mfaInfo&&(a=tY._fromServerResponse(eU(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:a},operation:s}}async function t5(e,t){let{data:n}=await t6((0,i.Ku)(e),t);return n.email}async function t4(e,t,n){if((0,r.xZ)(e.app))return Promise.reject(C(e));let i=eU(e),s=eY(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",tx,"EMAIL_PASSWORD_PROVIDER"),a=await s.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&t0(e),t}),o=await tP._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(o.user),o}function t8(e,t,n){return(0,r.xZ)(e.app)?Promise.reject(C(e)):tK((0,i.Ku)(e),tS.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&t0(e),t})}async function t7(e,t,n){let r=eU(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};(function(e,t){_(t.handleCodeInApp,r,"argument-error"),t&&tZ(r,e,t)})(i,n),await eY(r,i,"getOobCode",ti,"EMAIL_PASSWORD_PROVIDER")}function t9(e,t){let n=tb.parseLink(t);return(null==n?void 0:n.operation)==="EMAIL_SIGNIN"}async function ne(e,t,n){if((0,r.xZ)(e.app))return Promise.reject(C(e));let s=(0,i.Ku)(e),a=tS.credentialWithLink(t,n||R());return _(a._tenantId===(s.tenantId||null),s,"tenant-id-mismatch"),tK(s,a)}async function nt(e,t){return j(e,"POST","/v1/accounts:createAuthUri",V(e,t))}async function nn(e,t){let n={identifier:t,continueUri:D()?R():"http://localhost"},{signinMethods:r}=await nt((0,i.Ku)(e),n);return r||[]}async function nr(e,t){let n=(0,i.Ku)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&tZ(n.auth,r,t);let{email:s}=await tn(n.auth,r);s!==e.email&&await e.reload()}async function ni(e,t,n){let r=(0,i.Ku)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&tZ(r.auth,s,n);let{email:a}=await ts(r.auth,s);a!==e.email&&await e.reload()}async function ns(e,t){return j(e,"POST","/v1/accounts:update",t)}async function na(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;let r=(0,i.Ku)(e),s={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},a=await ea(r,ns(r.auth,s));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;let o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function no(e,t){let n=(0,i.Ku)(e);return(0,r.xZ)(n.auth.app)?Promise.reject(C(n.auth)):nu(n,t,null)}function nl(e,t){return nu((0,i.Ku)(e),null,t)}async function nu(e,t,n){let{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);let s=await ea(e,e8(r,i));await e._updateTokensIfNecessary(s,!0)}function nc(e){var t,n;if(!e)return null;let{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){let r=null==(n=null==(t=ei(e.idToken))?void 0:t.firebase)?void 0:n.sign_in_provider;if(r)return new nh(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new nf(s,i);case"github.com":return new np(s,i);case"google.com":return new nm(s,i);case"twitter.com":return new ng(s,i,e.screenName||null);case"custom":case"anonymous":return new nh(s,null);default:return new nh(s,r,i)}}class nh{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class nd extends nh{constructor(e,t,n,r){super(e,t,n),this.username=r}}class nf extends nh{constructor(e,t){super(e,"facebook.com",t)}}class np extends nd{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class nm extends nh{constructor(e,t){super(e,"google.com",t)}}class ng extends nd{constructor(e,t,n){super(e,"twitter.com",t,n)}}function ny(e){let{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:nc(n)}function nv(e,t){return(0,i.Ku)(e).setPersistence(t)}function nb(e){return eJ(e)}async function nT(e,t){return eU(e).validatePassword(t)}function nS(e,t,n,r){return(0,i.Ku)(e).onIdTokenChanged(t,n,r)}function nw(e,t,n){return(0,i.Ku)(e).beforeAuthStateChanged(t,n)}function nE(e,t,n,r){return(0,i.Ku)(e).onAuthStateChanged(t,n,r)}function nC(e){(0,i.Ku)(e).useDeviceLanguage()}function nI(e,t){return(0,i.Ku)(e).updateCurrentUser(t)}function n_(e){return(0,i.Ku)(e).signOut()}function nA(e,t){return eU(e).revokeAccessToken(t)}async function nk(e){return(0,i.Ku)(e).delete()}class nR{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new nR("enroll",e,t)}static _fromMfaPendingCredential(e){return new nR("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return nR._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(n=e.multiFactorSession)?void 0:n.idToken)return nR._fromIdtoken(e.multiFactorSession.idToken)}return null}}class nD{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=eU(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>tY._fromServerResponse(n,e));_(r.mfaPendingCredential,n,"internal-error");let s=nR._fromMfaPendingCredential(r.mfaPendingCredential);return new nD(s,i,async e=>{let i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;let a=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await tP._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(o.user),o;case"reauthenticate":return _(t.user,n,"internal-error"),tP._forOperation(t.user,t.operationType,a);default:S(n,"internal-error")}})}async resolveSignIn(e){let t=e;return this.signInResolver(t)}}function nN(e,t){var n;let r=(0,i.Ku)(e),s=t;return _(t.customData.operationType,r,"argument-error"),_(null==(n=s.customData._serverResponse)?void 0:n.mfaPendingCredential,r,"argument-error"),nD._fromError(r,s)}function nO(e,t){return j(e,"POST","/v2/accounts/mfaEnrollment:start",V(e,t))}function nx(e,t){return j(e,"POST","/v2/accounts/mfaEnrollment:finalize",V(e,t))}function nP(e,t){return j(e,"POST","/v2/accounts/mfaEnrollment:withdraw",V(e,t))}class nM{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>tY._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new nM(e)}async getSession(){return nR._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let n=e,r=await this.getSession(),i=await ea(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{let e=await ea(this.user,nP(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}let nL=new WeakMap;function nF(e){let t=(0,i.Ku)(e);return nL.has(t)||nL.set(t,nM._fromUser(t)),nL.get(t)}var nB="@firebase/auth",nU="1.10.0";class nV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function nj(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function nq(e){(0,r.om)(new a.uA("auth",(t,{options:n})=>{let r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;_(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l=new eB(r,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ex(e)});return eZ(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,r.om)(new a.uA("auth-internal",e=>new nV(eU(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(nB,nU,nj(e)),(0,r.KO)(nB,nU,"esm2017")}function nz(e=(0,r.Sx)()){let t=(0,r.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();let n=eX(e),s=(0,i.Tj)("auth");return s&&e0(n,`http://${s}`),n}L.initialize(fetch,Headers,Response),nq("Node");let nG=w("operation-not-supported-in-this-environment");async function nK(){throw nG}class n${constructor(){throw nG}}let nH=ew,nW=ew,nQ=ew,nY=ew,nJ=nG,nX=n$,nZ=nK,n0=nK,n1=nK,n2=nK,n3=nK,n6=nK,n5=nK,n4=nK,n8=nK,n7=nK,n9=nK,re=n$;class rt{static assertion(){throw nG}}function rn(e,t){return j(e,"POST","/v2/accounts/mfaSignIn:finalize",V(e,t))}eB.prototype.setPersistence=async()=>{};class rr{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return A("unexpected MultiFactorSessionType")}}}class ri{static assertionForEnrollment(e,t){return rs._fromSecret(e,t)}static assertionForSignIn(e,t){return rs._fromEnrollmentId(e,t)}static async generateSecret(e){var t;let n=e;_(void 0!==(null==(t=n.user)?void 0:t.auth),"internal-error");let r=await nO(n.user.auth,{idToken:n.credential,totpEnrollmentInfo:{}});return ra._fromStartTotpMfaEnrollmentResponse(r,n.user.auth)}}ri.FACTOR_ID="totp";class rs extends rr{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new rs(t,void 0,e)}static _fromEnrollmentId(e,t){return new rs(t,e)}async _finalizeEnroll(e,t,n){return _(void 0!==this.secret,e,"argument-error"),nx(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){_(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let n={verificationCode:this.otp};return rn(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n})}}class ra{constructor(e,t,n,r,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=r,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new ra(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let r=!1;return(ro(e)||ro(t))&&(r=!0),r&&(ro(e)&&(e=(null==(n=this.auth.currentUser)?void 0:n.email)||"unknownuser"),ro(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ro(e){return void 0===e||(null==e?void 0:e.length)===0}},84553:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},86243:e=>{"use strict";e.exports={rE:"1.9.15"}},86693:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let n=1e3,r=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=n,this.multiplier=r,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,n;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(n=(t=this.timerId).unref)||n.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},86984:(e,t,n)=>{"use strict";e.exports=i;var r=n(8707);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return r.asPromise(e,o,t,n,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return o.emit("error",e,t),a(e);if(null===n)return void o.end(!0);if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},87988:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class n{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=n;class r{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new r([...this.factories])}createFilter(){return new n(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=r},88060:(e,t,n)=>{"use strict";var r;n.d(t,{$b:()=>r,Vy:()=>u});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},a=r.INFO,o={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=o[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},89374:(e,t,n)=>{"use strict";var r=e.exports=n(95477);function i(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)}function s(e,t){return t||(t=new r.Root),t.loadSync(e)}r.build="light",r.load=i,r.loadSync=s,r.encoder=n(30847),r.decoder=n(62823),r.verifier=n(16973),r.converter=n(97659),r.ReflectionObject=n(64824),r.Namespace=n(77968),r.Root=n(82703),r.Enum=n(32110),r.Type=n(54351),r.Field=n(73267),r.OneOf=n(12630),r.MapField=n(25585),r.Service=n(3076),r.Method=n(71202),r.Message=n(8920),r.wrappers=n(63695),r.types=n(61810),r.util=n(93107),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},89644:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},90441:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let r=n(99978),i=n(42609),s=n(93122),a=n(82281);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;let c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},h={start:(e,t,n)=>{n(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class d{constructor(e,t){var n,r,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(n=t.start)?n:h.start,sendMessage:null!=(r=t.sendMessage)?r:h.sendMessage,halfClose:null!=(i=t.halfClose)?i:h.halfClose,cancel:null!=(s=t.cancel)?s:h.cancel}:this.requester=h}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var n,r,s,a,o,l;let u={onReceiveMetadata:null!=(r=null==(n=null==t?void 0:t.onReceiveMetadata)?void 0:n.bind(t))?r:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var n,r,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(n=t.onReceiveMetadata)?n:c.onReceiveMetadata,onReceiveMessage:null!=(r=t.onReceiveMessage)?r:c.onReceiveMessage,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,n=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,n),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function f(e,t,n){var r,i;let s=null!=(r=n.deadline)?r:1/0,a=n.host,o=null!=(i=n.parent)?i:null,l=n.propagate_flags,u=n.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=d;class p{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let n;try{n=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,n)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let n=null;this.call.start(e,{onReceiveMetadata:e=>{var n;null==(n=null==t?void 0:t.onReceiveMetadata)||n.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){n={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new r.Metadata},this.call.cancelWithStatus(n.code,n.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var r,i;n?null==(r=null==t?void 0:t.onReceiveStatus)||r.call(t,n):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class m extends p{constructor(e,t){super(e,t)}start(e,t){var n,r;let i=!1,s={onReceiveMetadata:null!=(r=null==(n=null==t?void 0:t.onReceiveMetadata)?void 0:n.bind(t))?r:e=>{},onReceiveMessage:e=>{var n;i=!0,null==(n=null==t?void 0:t.onReceiveMessage)||n.call(t,e)},onReceiveStatus:e=>{var n,r;i||null==(n=null==t?void 0:t.onReceiveMessage)||n.call(t,null),null==(r=null==t?void 0:t.onReceiveStatus)||r.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends p{}function y(e,t,n){let r=f(e,n.path,t);return n.responseStream?new g(r,n):new m(r,n)}t.getInterceptingCall=function(e,t,n,r){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},n,{method_definition:t});return i.reduceRight((e,t)=>n=>t(n,e),e=>y(r,e,t))(s)}},93107:(e,t,n)=>{"use strict";var r,i,s=e.exports=n(8707),a=n(46642);s.codegen=n(98344),s.fetch=n(17757),s.path=n(71140),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),n=Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},s.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];void 0!==i&&(t[r]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;r||(r=n(54351));var i=new r(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=n(32110));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,n,r){function i(e,t,n){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,n);else{var a=e[s];if(a&&r)return e;a&&(n=[].concat(a).concat(n)),e[s]=n}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),n)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(n(82703)))}})},93122:(e,t)=>{"use strict";var n,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(n||(t.Status=n={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(r||(t.LogVerbosity=r={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},95477:(e,t,n)=>{"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(96120),r.BufferWriter=n(54369),r.Reader=n(26996),r.BufferReader=n(75677),r.util=n(8707),r.rpc=n(27236),r.roots=n(46642),r.configure=i,i()},96120:(e,t,n)=>{"use strict";e.exports=h;var r,i=n(8707),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(e,t,n){t[n]=255&e}function p(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=p,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(f,1,+!!e)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var n=h.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},96138:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},96202:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let r=n(73496),i=n(34631),s=n(37216),a=n(93122),o=n(77936),l=n(63038),u=n(98605),c=n(98387),h=n(57213),d=n(91645),f=n(97875),p=n(16497),m="transport",g="transport_flowctrl",y=n(86243).rE,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:T,HTTP2_HEADER_PATH:S,HTTP2_HEADER_TE:w,HTTP2_HEADER_USER_AGENT:E}=r.constants,C=2e4,I=Buffer.from("too_many_pings","ascii");class _{constructor(e,t,n,i){this.session=e,this.options=n,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=C,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===n["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[n["grpc.primary_user_agent"],`grpc-node-js/${y}`,n["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in n&&(this.keepaliveTimeMs=n["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in n&&(this.keepaliveTimeoutMs=n["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in n?this.keepaliveWithoutCalls=1===n["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,n)=>{let i=!1;e===r.constants.NGHTTP2_ENHANCE_YOUR_CALM&&n&&n.equals(I)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==n?void 0:n.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,n;let r,i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,n=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();r={cipherSuiteStandardName:null!=(e=n.standardName)?e:null,cipherSuiteOtherName:n.standardName?null:n.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else r=null;return{remoteAddress:s,localAddress:a,security:r,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(n=this.session.state.remoteWindowSize)?n:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,n)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,n,r,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[E]=this.userAgent,l[b]="application/grpc",l[T]="POST",l[S]=n,l[w]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new f.Http2SubchannelCall(s,a,r,this,(0,p.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class A{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,n,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,f,p;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in n?y.maxSessionMemory=n["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),y.servername=e}else{let e=null!=(p=null==(f=(0,h.splitHostPort)(g))?void 0:f.host)?p:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,n)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===n["grpc-node.tls_enable_trace"]});let b=r.connect(v+g,y);this.session=b;let T="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new _(b,e,n,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${T} (${new Date().toISOString()})`)})}),b.once("error",e=>{T=e.message,this.trace("connection failed with error "+T)})})}connect(e,t,n){var r,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],n["grpc.ssl_target_name_override"]){let e=n["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,n)=>(0,i.checkServerIdentity)(e,n),a.servername=e}else if("grpc.http_connect_target"in n){let e=(0,u.getDefaultAuthority)(null!=(r=(0,h.parseUri)(n["grpc.http_connect_target"]))?r:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}n["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,n,a).then(r=>this.createSession(e,t,n,r))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}t.Http2SubchannelConnector=A},97587:(e,t,n)=>{"use strict";var r,i;r={value:!0},r=r=t.rS=t.Yi=r=t.Ib=r=r=void 0;let s=n(47099),a=n(68474),o=n(61614),l=n(27603);r=n(56061),r=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(i=t.Ib||(t.Ib={}));let u={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function h(e){return e instanceof a.Service||e instanceof a.Type||e instanceof a.Enum}function d(e){return e instanceof a.Namespace||e instanceof a.Root}function f(e,t){let n=c(t,e.name);return h(e)?[[n,e]]:d(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>f(e.nested[t],n)).reduce((e,t)=>e.concat(t),[]):[]}function p(e,t){return function(n){return e.toObject(e.decode(n),t)}}function m(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let n=e.fromObject(t);return e.encode(n).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(let[n,r]of Object.entries(t))"uninterpreted_option"===n?e.uninterpreted_option.push(t.uninterpreted_option):e[n]=r;return e},{deprecated:!1,idempotency_level:i.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function y(e,t,n,r){let i=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:m(i),requestDeserialize:p(i,n),responseSerialize:m(a),responseDeserialize:p(a,n),originalName:s(e.name),requestType:b(i,r),responseType:b(a,r),options:g(e.parsedOptions)}}function v(e,t,n,r){let i={};for(let s of e.methodsArray)i[s.name]=y(s,t,n,r);return i}function b(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:n.$type.toObject(n,u),fileDescriptorProtos:t}}function T(e,t){let n=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:n.$type.toObject(n,u),fileDescriptorProtos:t}}function S(e,t,n,r){if(e instanceof a.Service)return v(e,t,n,r);if(e instanceof a.Type)return b(e,r);if(e instanceof a.Enum)return T(e,r);throw Error("Type mismatch in reflection object handling")}function w(e,t){let n={};e.resolveAll();let r=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of f(e,""))n[i]=S(s,i,t,r);return n}function E(e,t){t=t||{};let n=a.Root.fromDescriptor(e);return n.resolveAll(),w(n,t)}r=function(e,t){return(0,l.loadProtosWithOptions)(e,t).then(e=>w(e,t))},t.Yi=function(e,t){return w((0,l.loadProtosWithOptionsSync)(e,t),t)},t.rS=function(e,t){t=t||{};let n=a.Root.fromJSON(e);return n.resolveAll(),w(n,t)},r=function(e,t){return E(o.FileDescriptorSet.decode(e),t)},r=function(e,t){return E(o.FileDescriptorSet.fromObject(e),t)},(0,l.addCommonProtos)()},97659:(e,t,n)=>{"use strict";var r=t,i=n(32110),s=n(93107);function a(e,t,n,r){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",r,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r);else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,u)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function o(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,n,r,r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,s?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var o=t[r].resolve(),l=s.safeProp(o.name);o.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(n,o,r,l+"[ks[i]]")("}")("}")):o.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(n,o,r,l+"[i]")("}")("}")):(o.resolvedType instanceof i||n("if(d%s!=null){",l),a(n,o,r,l),o.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var n=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?a:l).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",s.safeProp(r[u].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),u=0;u<a.length;++u)n("d%s={}",s.safeProp(a[u].name));n("}")}if(l.length){for(n("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,c.typeDefault)}n("}")}var f=!1;for(u=0;u<t.length;++u){var c=t[u],p=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(f||(f=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(n,c,p,h+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(n,c,p,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(n,c,p,h),c.partOf&&n("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}},97875:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let r=n(73496),i=n(21820),s=n(93122),a=n(99978),o=n(25678),l=n(63038),u=n(93122),c="subchannel_call";function h(e){for(let[t,n]of Object.entries(i.constants.errno))if(n===e)return t;return"Unknown system error "+e}class d{constructor(e,t,n,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=n,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let c=null!=(u=i.getOptions()["grpc.max_receive_message_length"])?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+n),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&r.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let n;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case r.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case r.constants.NGHTTP2_REFUSED_STREAM:n=s.Status.UNAVAILABLE,i="Stream refused by server";break;case r.constants.NGHTTP2_CANCEL:n=s.Status.CANCELLED,i="Call cancelled";break;case r.constants.NGHTTP2_ENHANCE_YOUR_CALM:n=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case r.constants.NGHTTP2_INADEQUATE_SECURITY:n=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case r.constants.NGHTTP2_INTERNAL_ERROR:n=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(n=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:n=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:n,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let n="";for(let t of Object.keys(e))n+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+n);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let r=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof r["grpc-status"]){let e=Number(r["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof r["grpc-message"]){try{o=decodeURI(r["grpc-message"])}catch(e){o=r["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?r.constants.NGHTTP2_NO_ERROR:r.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let n=t=>{process.nextTick(()=>{var n;let r=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(r=s.Status.INTERNAL),t&&this.cancelWithStatus(r,`Write error: ${t.message}`),null==(n=e.callback)||n.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,n)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=d},98344:e=>{"use strict";function t(e,n){"string"==typeof e&&(n=e,e=void 0);var r=[];function i(e){if("string"!=typeof e){var n=s();if(t.verbose&&console.log("codegen: "+n),n="return "+n,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=n,Function.apply(null,o).apply(null,l)}return Function(n)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var n=c[h++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return r.push(e),i}function s(t){return"function "+(t||n||"")+"("+(e&&e.join(",")||"")+"){\n  "+r.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},98387:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let r=n(91645);function i(e){return"port"in e}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},t.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;t.stringToSubchannelAddress=function(e,t){return(0,r.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},98605:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let r=n(57213),i={},s=null;t.registerResolver=function(e,t){i[e]=t},t.registerDefaultScheme=function(e){s=e},t.createResolver=function(e,t,n){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,n);throw Error(`No resolver could be created for target ${(0,r.uriToString)(e)}`)},t.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,r.uriToString)(e)}`)},t.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,r.uriToString)(e)};else return null;return e}},99978:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let r=n(63038),i=n(93122),s=n(82281),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function f(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class p{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){f(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){f(e=d(e),t);let n=this.internalRepr.get(e);void 0===n?this.internalRepr.set(e,[t]):n.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,n]of this.internalRepr)if(n.length>0){let r=n[0];e[t]=Buffer.isBuffer(r)?Buffer.from(r):r}return e}clone(){let e=new p(this.options),t=e.internalRepr;for(let[e,n]of this.internalRepr){let r=n.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,r)}return e}merge(e){for(let[t,n]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(n);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,n]of this.internalRepr)e[t]=n.map(m);return e}toJSON(){let e={};for(let[t,n]of this.internalRepr)e[t]=n;return e}static fromHttp2Headers(e){let t=new p;for(let n of Object.keys(e)){if(":"===n.charAt(0))continue;let a=e[n];try{c(n)?Array.isArray(a)?a.forEach(e=>{t.add(n,Buffer.from(e,"base64"))}):void 0!==a&&(h(n)?a.split(",").forEach(e=>{t.add(n,Buffer.from(e.trim(),"base64"))}):t.add(n,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(n,e)}):void 0!==a&&t.add(n,a)}catch(t){let e=`Failed to add metadata entry ${n}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,r.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=p;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e}};