"use strict";exports.id=9123,exports.ids=[9123],exports.modules={49123:(e,t,s)=>{s.d(t,{A:()=>f});var r=s(60687),l=s(43210),o=s(16189),a=s(88645),i=s(79440),n=s(43649),c=s(79522),d=s(45306),u=s(41120),m=s(5062),g=s.n(m);let h=({onInsert:e})=>{let[t,s]=(0,l.useState)(!1),[o,a]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[c,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)("inspirations"),p=async()=>{m(!0);try{let[e,t]=await Promise.all([(0,d.Aq)(),(0,d.Gy)()]);a(e),n(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{m(!1)}},f=t=>{e&&e(t),s(!1)},b=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||`Write about ${e}...`;return t?(0,r.jsx)("div",{className:"fixed bottom-8 right-8 z-40 w-96",children:(0,r.jsxs)("div",{className:`${g()["glass-modal"]} max-h-96 overflow-hidden`,children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("div",{className:g()["glass-content"],children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold text-stone-800 flex items-center gap-2 font-serif",children:[(0,r.jsx)(u.TG,{size:18,color:"#f59e0b"}),"Your Reflection Insights"]}),(0,r.jsx)("button",{onClick:()=>s(!1),className:"text-stone-500 hover:text-stone-700 text-xl font-bold leading-none",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"flex p-4 gap-2",children:[(0,r.jsxs)("button",{className:`${g()["glass-tag"]} flex-1 text-center py-2 text-sm font-semibold transition-all ${"inspirations"===h?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"}`,onClick:()=>x("inspirations"),children:["Recent Thoughts (",o.length,")"]}),(0,r.jsxs)("button",{className:`${g()["glass-tag"]} flex-1 text-center py-2 text-sm font-semibold transition-all ${"themes"===h?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"}`,onClick:()=>x("themes"),children:["Writing Themes (",i.length,")"]})]}),(0,r.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:c?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-stone-600",children:"Loading your insights..."})]}):"inspirations"===h?(0,r.jsx)("div",{children:0===o.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,r.jsx)(u.d3,{size:16,color:"#6b7280"}),(0,r.jsx)("p",{className:"font-semibold",children:"No reflections yet!"})]}),(0,r.jsx)("p",{className:"text-sm text-stone-500",children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Your past reflections that might spark new ideas:"}),(0,r.jsx)("div",{className:"space-y-3",children:o.map((e,t)=>(0,r.jsxs)("div",{className:`${g()["glass-card"]} p-4`,children:[(0,r.jsx)("div",{className:g()["glass-card-highlight"]}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("p",{className:"text-sm text-stone-700 italic mb-2",children:['"',e.response,'"']}),e.articleTitle&&(0,r.jsxs)("p",{className:"text-xs text-stone-500 mb-3",children:["From: ",e.articleTitle]}),(0,r.jsx)("button",{onClick:()=>{let t=e.articleTitle?` (inspired by "${e.articleTitle}")`:"";f(`"${e.response}"${t} - This reminds me of...`)},className:`${g()["glass-button"]} ${g()["glass-button-primary"]} text-xs px-3 py-1 w-full`,children:"Use as starting point"})]})]},t))})]})}):(0,r.jsx)("div",{children:0===i.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,r.jsx)(u.v1,{size:16,color:"#6b7280"}),(0,r.jsx)("p",{className:"font-semibold",children:"No themes identified yet!"})]}),(0,r.jsx)("p",{className:"text-sm text-stone-500",children:"Keep reflecting on articles to discover your writing themes."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Writing prompts based on your reflection patterns:"}),(0,r.jsx)("div",{className:"space-y-3",children:i.map((e,t)=>(0,r.jsxs)("div",{className:`${g()["glass-card"]} p-4`,children:[(0,r.jsx)("div",{className:g()["glass-card-highlight"]}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsx)("div",{className:`${g()["glass-tag"]} inline-block mb-2 text-xs`,children:e}),(0,r.jsx)("p",{className:"text-sm text-stone-700 mb-3",children:b(e)}),(0,r.jsx)("button",{onClick:()=>f(b(e)),className:`${g()["glass-button"]} ${g()["glass-button-primary"]} text-xs px-3 py-1 w-full`,children:"Start writing"})]})]},t))})]})})}),(0,r.jsx)("div",{className:"p-4 border-t border-white/20",children:(0,r.jsx)("button",{onClick:p,className:`${g()["glass-button"]} text-sm px-4 py-2 w-full disabled:opacity-50`,disabled:c,children:"\uD83D\uDD04 Refresh insights"})})]})]})}):(0,r.jsx)("div",{className:"fixed bottom-8 right-8 z-40",children:(0,r.jsxs)("button",{onClick:()=>{t||p(),s(!t)},className:`${g()["glass-button"]} ${g()["glass-button-primary"]} flex items-center gap-2 px-6 py-4 text-sm font-semibold`,title:"Get inspiration from your reflections",children:[(0,r.jsx)(u.Y_,{size:16,color:"currentColor"}),"Inspiration"]})})};var x=s(94497);function p({onImageUpload:e,disabled:t=!1,className:s="",acceptedFormats:o=["image/jpeg","image/png","image/gif","image/webp"],maxFileSize:a=10,useServerUpload:i=!1}){let[n,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(0),[m,g]=(0,l.useState)(null),h=(0,l.useRef)(null),p=e=>o.includes(e.type)?e.size/1048576>a?`File size must be less than ${a}MB`:null:`Please select a valid image file (${o.join(", ")})`,f=async t=>{let s=t.target.files?.[0];if(!s)return;g(null);let r=p(s);if(r)return void g(r);c(!0),u(0);try{let t=setInterval(()=>{u(e=>e>=90?(clearInterval(t),90):e+10)},200),r=i?await (0,x.uploadImageViaAPI)(s):await (0,x.V)(s);clearInterval(t),u(100),setTimeout(()=>{e(r),c(!1),u(0),h.current&&(h.current.value="")},300)}catch(e){console.error("Upload failed:",e),g("Failed to upload image. Please try again."),c(!1),u(0)}};return(0,r.jsxs)("div",{className:`relative ${s}`,children:[(0,r.jsx)("input",{ref:h,type:"file",accept:o.join(","),onChange:f,className:"hidden",disabled:t||n}),(0,r.jsx)("button",{type:"button",onClick:()=>{t||n||h.current?.click()},disabled:t||n,className:`
          relative overflow-hidden border-2 border-dashed border-gray-300 
          rounded-lg p-6 text-center hover:border-gray-400 
          transition-colors duration-200 w-full
          ${t||n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
          ${m?"border-red-300 bg-red-50":"bg-gray-50 hover:bg-gray-100"}
        `,children:n?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-blue-600",children:(0,r.jsxs)("svg",{className:"animate-spin h-8 w-8 mx-auto",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Uploading... ",d,"%"]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${d}%`}})})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-gray-400",children:(0,r.jsx)("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-medium text-blue-600",children:"Click to upload"})," or drag and drop"]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[o.map(e=>e.split("/")[1]).join(", ").toUpperCase()," up to ",a,"MB"]})]})}),m&&(0,r.jsx)("div",{className:"mt-2 text-sm text-red-600 bg-red-50 border border-red-200 rounded p-2",children:m})]})}let f=({articleId:e,onUpdateComplete:t,backToArticleAction:s,editingTitle:d})=>{let u=(0,o.useRouter)(),[m,x]=(0,l.useState)(""),[f,b]=(0,l.useState)(""),[y,w]=(0,l.useState)([]),[v,j]=(0,l.useState)(""),[N,k]=(0,l.useState)(!1),[$,C]=(0,l.useState)(!1),[E,A]=(0,l.useState)(!1),[I,D]=(0,l.useState)(""),[S,T]=(0,l.useState)(!!e),[U,z]=(0,l.useState)(null),[L,R]=(0,l.useState)(""),B=(0,l.useRef)(null),Y=(0,l.useRef)(null),W=(0,l.useRef)(null),F=(0,l.useCallback)(()=>{B.current&&(B.current.style.height="auto",B.current.style.height=`${B.current.scrollHeight}px`,!m&&B.current&&B.current.focus())},[m]);(0,l.useEffect)(()=>{let e=n.j2.onAuthStateChanged(e=>{z(e),e||u.push("/login?redirect=compose")});return()=>e()},[u]),(0,l.useEffect)(()=>{console.log("ArticleComposer useEffect - articleId:",e,"user:",U?.uid),e&&U?(async()=>{try{console.log("Fetching article for editing, ID:",e),T(!0);let t=await (0,i.getArticleById)(e);if(console.log("Fetched article:",t?.title,"Body length:",t?.body?.length),!t){console.log("Article not found"),D("Article not found"),u.push("/");return}if(t.authorId!==U.uid){console.log("User not authorized to edit this article"),D("You can only edit your own articles"),u.push("/");return}console.log("Setting title:",t.title),x(t.title);let s=t.body.replace(/data-[\w-]+="[^"]*"/g,"");console.log("Setting content, length:",s.length,"Preview:",s.substring(0,100)+"..."),b(s),w(t.tags||[]),j(t.coverImage||""),console.log("Article data loaded successfully for editing")}catch(e){console.error("Error loading article:",e),D("Failed to load article")}finally{T(!1)}})():e?console.log("User not logged in, waiting..."):(console.log("No articleId, starting with empty content"),T(!1))},[e,U,u]),(0,l.useEffect)(()=>{F()},[m,F]),(0,l.useEffect)(()=>{let e;return U&&m.trim()&&f.trim()&&!$&&!N&&(e=setTimeout(()=>{G("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[U,m,f,$,N]);let P=(0,l.useCallback)((e,t)=>{b(t=>e!==t?(E&&A(!1),e):t)},[E]),q=()=>{let e=L.trim().toLowerCase();e&&!y.includes(e)&&y.length<5&&(w([...y,e]),R(""))},M=e=>{w(y.filter(t=>t!==e))},H=e=>{j(e.target.value)},G=async(s="drafts")=>{if(!U)return void D("You must be logged in to save articles");if(!m.trim())return void D("Title is required");try{D(""),C(!0);let r=m.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),l={title:m.trim(),body:f,tags:y,coverImage:v,status:s,authorId:U.uid,authorName:U.displayName||U.email||"Anonymous",slug:r};if(e)try{console.log("Updating article with ID:",e);let s=await (0,i.iZ)(e,l);console.log("Article updated successfully"),A(!0),t?(console.log("Calling onUpdateComplete callback instead of navigating"),t(s)):(console.log("No callback provided, navigating to article page"),setTimeout(()=>{u.push(`/articles/?slug=${r}`)},1e3))}catch(e){console.error("Error updating article:",e),D("Failed to update article. Please try again."),A(!1)}else await (0,i.N6)(l),"published"===s?u.push(`/articles/?slug=${r}`):u.push("/dashboard")}catch(e){console.error("Error saving article:",e),D("Failed to save article. Please try again.")}finally{C(!1),k(!1)}},V=async()=>{if(!f.trim())return void D("Content is required");k(!0),await G("published")},K=async()=>{await G("drafts")};return S?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed"},children:(0,r.jsxs)("div",{className:g()["glass-loading"],children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-stone-600 text-lg",children:"Loading your article..."})]})}):(0,r.jsxs)("div",{className:`${g()["glass-container"]} min-h-screen w-full`,style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed",position:"relative",borderRadius:"0px",border:"none"},children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("header",{className:`${g()["glass-container"]} fixed top-6 left-6 right-6 z-50 max-w-6xl mx-auto`,style:{backdropFilter:"blur(20px) saturate(180%)"},children:[(0,r.jsx)("div",{className:g()["glass-highlight"]}),(0,r.jsxs)("div",{className:`${g()["glass-content"]} flex items-center justify-between p-4`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[s?(0,r.jsxs)("button",{onClick:s,className:`${g()["glass-button"]} flex items-center gap-2 px-3 py-2 text-sm font-medium text-stone-700 hover:text-stone-900 transition-colors`,children:[(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"})}),"Back to Article"]}):(0,r.jsx)("div",{className:"text-xl font-bold text-stone-800 font-serif",children:"Journalite"}),(0,r.jsx)("div",{className:"text-stone-500 text-sm",children:e?d?`Editing: ${d}`:"Editing":"Writing"}),E&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{className:`${g()["glass-button"]} px-4 py-2 text-sm font-semibold disabled:opacity-50`,onClick:K,disabled:$||N,children:$?"Saving...":"Save Draft"}),(0,r.jsx)("button",{className:`${g()["glass-button"]} ${g()["glass-button-primary"]} px-4 py-2 text-sm font-semibold disabled:opacity-50`,onClick:V,disabled:$||N||!m.trim()||!f.trim(),children:N?"Publishing...":e?"Update":"Publish"})]})]})]}),(0,r.jsxs)("div",{className:`${g()["glass-content"]} pt-32 pb-16 min-h-screen w-full max-w-4xl mx-auto`,style:{paddingLeft:"64px",paddingRight:"64px"},children:[(0,r.jsx)("textarea",{ref:B,value:m,onChange:e=>{x(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1,className:"w-full bg-transparent border-none outline-none resize-none overflow-hidden text-5xl font-bold text-stone-800 placeholder-stone-400 font-serif leading-tight mb-8 focus:outline-none",style:{minHeight:"60px"}}),(v||m.length>10)&&(0,r.jsxs)("div",{className:"mb-8",children:[!v&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("input",{type:"text",value:v,onChange:H,placeholder:"Add a cover image URL...",className:"w-full bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 py-2 border-b border-stone-200 focus:border-stone-400 transition-colors"}),(0,r.jsx)("div",{className:"text-center text-stone-400 text-sm",children:"or"}),(0,r.jsx)(p,{onImageUpload:e=>{j(e)},className:"max-w-md mx-auto"})]}),v&&(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("img",{src:v,alt:"Cover",className:"w-full h-64 object-cover rounded-2xl mb-4"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("input",{type:"text",value:v,onChange:H,placeholder:"Cover image URL...",className:"flex-1 bg-white/80 backdrop-blur border border-stone-200 outline-none text-stone-600 placeholder-stone-400 py-2 px-4 rounded-lg focus:border-stone-400 transition-colors"}),(0,r.jsx)("button",{onClick:()=>j(""),className:"px-4 py-2 bg-red-100/80 backdrop-blur border border-red-200 text-red-700 rounded-lg hover:bg-red-200/80 transition-colors",children:"Remove"})]})]})]}),(y.length>0||m.length>5)&&(0,r.jsxs)("div",{className:"mb-8 flex flex-wrap gap-2 items-center",children:[y.map(e=>(0,r.jsxs)("div",{className:"px-3 py-1 bg-blue-100/60 backdrop-blur text-blue-700 rounded-full text-sm font-medium flex items-center gap-2",children:[e,(0,r.jsx)("button",{className:"text-blue-600 hover:text-blue-800 font-bold text-base leading-none",onClick:()=>M(e),"aria-label":`Remove ${e} tag`,children:"\xd7"})]},e)),y.length<5&&(0,r.jsx)("input",{ref:Y,type:"text",value:L,onChange:e=>{R(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),q())},onBlur:q,placeholder:0===y.length?"Add tags...":"Add tag...",className:"bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 min-w-24 py-1"})]}),I&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50/80 border border-red-200 rounded-xl text-red-700 text-sm",children:I}),(0,r.jsx)("div",{className:"min-h-[500px] w-full relative",style:{background:"transparent"},children:(0,r.jsx)(c.A,{ref:W,articleId:e||(0,a.A)(),initialContent:f,onChange:P,placeholder:"Write your story...",className:"seamless-editor medium-style-content",onImageInsert:(e,t="")=>{if(W.current){let s=`<p><img src="${e}" alt="${t}" /></p>`;W.current.insertText(s)}},onVideoInsert:e=>{if(W.current){let t=`

[üìπ Video: Click to view](${e})

`;W.current.insertText(t)}}})})]}),(0,r.jsx)(h,{onInsert:e=>{W.current&&W.current.insertText?W.current.insertText("\n\n"+e+"\n\n"):b(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{W.current&&W.current.focus&&W.current.focus()},100)}})]})}},79440:(e,t,s)=>{s.d(t,{BC:()=>m,GE:()=>a,N6:()=>c,Oe:()=>g,Tu:()=>x,a:()=>p,fz:()=>u,getArticleById:()=>i,iZ:()=>d,l6:()=>n,tT:()=>h,zE:()=>f});var r=s(75535),l=s(43649),o=s(28163);async function a(e={}){let{limit:t,includeDrafts:s=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,r.collection)(l.db,"articles"),o=[];s||o.push((0,r.where)("status","==","published")),o.push((0,r.orderBy)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),o.push((0,r.limit)(t)));let a=(0,r.query)(e,...o),i=await (0,r.getDocs)(a);console.log("Query returned document count:",i.size);let n=[];return i.forEach(e=>{let t=e.data();n.push({id:e.id,...t})}),n}catch(e){throw console.error("Error getting articles:",e),e}}async function i(e){try{let t=Date.now();console.log(`üîÑ DIRECT FETCH: Getting article with ID: ${e} (time: ${t})`);let s=(0,r.doc)(l.db,"articles",e),o=await (0,r.getDoc)(s);if(!o.exists())return console.log("‚ùå Article not found for ID:",e),null;{let e={id:o.id,...o.data()};return console.log("‚úÖ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",e.body?.length||0),console.log("\uD83C\uDFF7Ô∏è Tags:",e.tags?.join(", ")||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function n(e){try{console.log(`Getting article by slug: ${e}, timestamp: ${Date.now()}`);let t=0;for(;t<2;){t++,console.log(`Attempt ${t} to get article by slug`),t>1&&await new Promise(e=>setTimeout(e,500));let s=(0,r.collection)(l.db,"articles"),o=(0,r.query)(s,(0,r.where)("slug","==",e),(0,r.where)("status","==","published")),a=await (0,r.getDocs)(o);if(a.empty){if(t>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{let e=a.docs[0],t={id:e.id,...e.data()};return console.log("Article found by slug:",t.title,"Content length:",t.body?.length||0),t}console.log(`Article not found by slug on attempt ${t}, will retry...`)}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{let t=l.j2.currentUser;if(!t)throw Error("You must be logged in to create an article");let s={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:r.Timestamp.now(),authorId:t.uid,authorName:t.displayName||t.email?.split("@")[0]||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,r.addDoc)((0,r.collection)(l.db,"articles"),s)).id,...s}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let s=l.j2.currentUser;if(!s)throw Error("You must be logged in to edit an article");let o=(0,r.doc)(l.db,"articles",e),a=await (0,r.getDoc)(o);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==s.uid)throw Error("You can only edit your own articles");let i={...t};t.title&&(i.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",i.slug)),i.updatedAt=r.Timestamp.now(),await (0,r.updateDoc)(o,i);let n=await (0,r.getDoc)(o);return{id:n.id,...n.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,r.collection)(l.db,"articles",e,"comments"),s=(0,r.query)(t,(0,r.orderBy)("createdAt","desc")),o=await (0,r.getDocs)(s),a=[];return o.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function m(e,t){try{let s=l.j2.currentUser;if(!s)throw Error("You must be logged in to comment");let a={userId:s.uid,userName:s.displayName||s.email?.split("@")[0]||"Anonymous",content:t,createdAt:r.Timestamp.now(),likes:[],replies:[]},n=await (0,r.addDoc)((0,r.collection)(l.db,"articles",e,"comments"),a),c=await i(e);return c&&c.authorId!==s.uid&&await (0,o.fZ)(c.authorId,e,c.slug||"",c.title||"Article",n.id,t),{id:n.id,commentId:n.id,...a}}catch(e){throw console.error("Error adding comment:",e),e}}async function g(e,t,s){try{let o=l.j2.currentUser;if(!o)throw Error("You must be logged in to reply");let a=(0,r.doc)(l.db,"articles",e,"comments",t),n=await (0,r.getDoc)(a);if(!n.exists())throw Error("Comment not found");let c={replyId:Math.random().toString(36).substring(2,15),userId:o.uid,userName:o.displayName||o.email?.split("@")[0]||"Anonymous",content:s,createdAt:r.Timestamp.now(),likes:[]};await (0,r.updateDoc)(a,{replies:(0,r.arrayUnion)(c)});let d=n.data();if(d.userId!==o.uid){let s=await i(e);console.log(`User ${o.uid} replied to comment ${t} by ${d.userId} on article ${s?.title}`)}return c}catch(e){throw console.error("Error adding reply:",e),e}}async function h(e,t){try{let s=l.j2.currentUser;if(!s)throw Error("You must be logged in to like a comment");let o=(0,r.doc)(l.db,"articles",e,"comments",t),a=await (0,r.getDoc)(o);if(!a.exists())throw Error("Comment not found");let i=a.data(),n=s.uid,c=(i.likes||[]).includes(n);await (0,r.updateDoc)(o,{likes:c?(0,r.arrayRemove)(n):(0,r.arrayUnion)(n)});let d=(await (0,r.getDoc)(o)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function x(e,t){try{let s=l.j2.currentUser;if(!s)throw Error("You must be logged in to delete a comment");let o=(0,r.doc)(l.db,"articles",e,"comments",t),a=await (0,r.getDoc)(o);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==s.uid)throw Error("You can only delete your own comments");return await (0,r.deleteDoc)(o),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function p(e){try{let t=l.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let s=(0,r.doc)(l.db,"articles",e),o=await (0,r.getDoc)(s);if(!o.exists())throw Error("Article not found");if(o.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,r.deleteDoc)(s),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function f(e,t={}){let{limit:s}=t;try{let t=(0,r.collection)(l.db,"articles"),o=[(0,r.where)("tags","array-contains",e),(0,r.where)("status","==","published"),(0,r.orderBy)("createdAt","desc")];s&&s>0&&o.push((0,r.limit)(s));let a=(0,r.query)(t,...o),i=await (0,r.getDocs)(a),n=[];return i.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){throw console.error("Error getting articles by tag:",e),e}}}};