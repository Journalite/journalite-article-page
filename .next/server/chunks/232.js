"use strict";exports.id=232,exports.ids=[232],exports.modules={6621:(e,t,r)=>{r.d(t,{A:()=>i});class a{initialize(e,t){this.containerElement=e,this.currentModel=t,this.rebuildParagraphMap()}fullRender(e){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");this.currentModel=e,this.containerElement.innerHTML="",this.paragraphMap.clear(),this.sectionMap.clear();let t=document.createElement("h1");t.classList.add("article-title"),t.textContent=e.title,this.containerElement.appendChild(t),e.sections.forEach(e=>{let t=this.createSectionElement(e);this.containerElement.appendChild(t),this.sectionMap.set(e.id,t),e.paragraphs.forEach(e=>{let r=this.createParagraphElement(e);t.appendChild(r),this.paragraphMap.set(e.id,r)})})}applyOperation(e,t){if(!this.containerElement)return void console.error("DOMPatcher not initialized with a container element");switch(this.currentModel=e,t.type){case"INSERT_PARAGRAPH":this.insertParagraphDOM(t.sectionId,t.index,t.paragraph);break;case"REMOVE_PARAGRAPH":this.removeParagraphDOM(t.sectionId,t.paragraphId);break;case"UPDATE_PARAGRAPH":this.updateParagraphDOM(t.sectionId,t.paragraphId,t.updates);break;case"INSERT_SECTION":this.insertSectionDOM(t.index,t.section);break;case"REMOVE_SECTION":this.removeSectionDOM(t.sectionId);break;case"UPDATE_SECTION":this.updateSectionDOM(t.sectionId,t.updates);break;default:console.warn("Unknown operation type:",t.type),this.fullRender(e)}}applyOperations(e,t){t.forEach(t=>{this.applyOperation(e,t)})}createParagraphElement(e){let t;switch(e.type){case"heading":t=document.createElement(`h${e.level||2}`);break;case"image":return t=document.createElement("img"),e.src&&(t.setAttribute("src",e.src),t.setAttribute("alt",e.text||"Image")),t;case"blockquote":t=document.createElement("blockquote");break;case"bulletList":t=document.createElement("ul");break;case"orderedList":t=document.createElement("ol");break;case"listItem":t=document.createElement("li");break;default:t=document.createElement("p")}return(t.dataset.paragraphId=e.id,e.marks&&0!==e.marks.length)?this.renderFormattedText(t,e.text,e.marks):t.textContent=e.text,t}createSectionElement(e){let t=document.createElement("section");return t.dataset.sectionId=e.id,t}renderFormattedText(e,t,r){let a=[...r].sort((e,t)=>e.from-t.from);if(0===a.length){e.textContent=t;return}e.innerHTML="";let i=0;if(a.forEach(r=>{let a;if(r.from>i){let a=t.substring(i,r.from);e.appendChild(document.createTextNode(a))}let n=t.substring(r.from,r.to);switch(r.type){case"bold":a=document.createElement("strong");break;case"italic":a=document.createElement("em");break;case"code":a=document.createElement("code");break;case"link":a=document.createElement("a"),r.attrs?.href&&a.setAttribute("href",r.attrs.href);break;default:a=document.createElement("span")}a.textContent=n,e.appendChild(a),i=r.to}),i<t.length){let r=t.substring(i);e.appendChild(document.createTextNode(r))}}insertParagraphDOM(e,t,r){let a=this.sectionMap.get(e);if(!a)return void console.warn(`Section element with ID ${e} not found`);let i=this.createParagraphElement(r);t>=a.children.length?a.appendChild(i):a.insertBefore(i,a.children[t]),this.paragraphMap.set(r.id,i)}removeParagraphDOM(e,t){let r=this.paragraphMap.get(t);if(!r)return void console.warn(`Paragraph element with ID ${t} not found`);r.remove(),this.paragraphMap.delete(t)}updateParagraphDOM(e,t,r){let a=this.paragraphMap.get(t);if(!a)return void console.warn(`Paragraph element with ID ${t} not found`);let i=this.currentModel?.sections.find(t=>t.id===e);if(!i)return;let n=i.paragraphs.find(e=>e.id===t);if(n){if(r.type&&r.type!==n.type){let e=this.createParagraphElement({...n,...r});a.replaceWith(e),this.paragraphMap.set(t,e);return}if(void 0!==r.text||void 0!==r.marks){let e={...n,text:void 0!==r.text?r.text:n.text,marks:void 0!==r.marks?r.marks:n.marks};"image"===e.type?"IMG"===a.tagName&&e.src&&(a.src=e.src,a.alt=e.text||"Image"):(a.innerHTML="",this.renderFormattedText(a,e.text,e.marks))}if(void 0!==r.level&&"heading"===n.type){let e=document.createElement(`h${r.level}`);for(;a.attributes.length>0;){let t=a.attributes[0];e.setAttribute(t.name,t.value),a.removeAttributeNode(t)}e.innerHTML=a.innerHTML,a.replaceWith(e),this.paragraphMap.set(t,e)}}}insertSectionDOM(e,t){if(!this.containerElement)return;let r=this.createSectionElement(t);t.paragraphs.forEach(e=>{let t=this.createParagraphElement(e);r.appendChild(t),this.paragraphMap.set(e.id,t)});let a=Array.from(this.containerElement.querySelectorAll("section"));e>=a.length?this.containerElement.appendChild(r):this.containerElement.insertBefore(r,a[e]),this.sectionMap.set(t.id,r)}removeSectionDOM(e){let t=this.sectionMap.get(e);if(!t)return void console.warn(`Section element with ID ${e} not found`);t.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.delete(t)}),t.remove(),this.sectionMap.delete(e)}updateSectionDOM(e,t){if(!this.sectionMap.get(e))return void console.warn(`Section element with ID ${e} not found`)}rebuildParagraphMap(){this.containerElement&&(this.paragraphMap.clear(),this.sectionMap.clear(),this.containerElement.querySelectorAll("section[data-section-id]").forEach(e=>{let t=e.getAttribute("data-section-id");t&&this.sectionMap.set(t,e)}),this.containerElement.querySelectorAll("[data-paragraph-id]").forEach(e=>{let t=e.getAttribute("data-paragraph-id");t&&this.paragraphMap.set(t,e)}))}constructor(){this.containerElement=null,this.paragraphMap=new Map,this.sectionMap=new Map,this.currentModel=null}}let i=new a},16189:(e,t,r)=>{var a=r(65773);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},79440:(e,t,r)=>{r.d(t,{BC:()=>h,GE:()=>o,N6:()=>c,Oe:()=>p,S1:()=>E,Tu:()=>g,a:()=>f,fz:()=>u,iZ:()=>d,l6:()=>l,tT:()=>m,zE:()=>s});var a=r(75535),i=r(43649),n=r(28163);async function o(e={}){let{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,a.rJ)(i.db,"articles"),n=[];r||n.push((0,a._M)("status","==","published")),n.push((0,a.My)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),n.push((0,a.AB)(t)));let o=(0,a.P)(e,...n),s=await (0,a.GG)(o);console.log("Query returned document count:",s.size);let l=[];return s.forEach(e=>{let t=e.data();l.push({id:e.id,...t})}),l}catch(e){throw console.error("Error getting articles:",e),e}}async function s(e){try{let t=(0,a.H9)(i.db,"articles",e),r=await (0,a.x7)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){throw console.error("Error getting article:",e),e}}async function l(e){try{let t=(0,a.rJ)(i.db,"articles"),r=(0,a.P)(t,(0,a._M)("slug","==",e),(0,a._M)("status","==","published")),n=await (0,a.GG)(r);if(n.empty)return null;let o=n.docs[0];return{id:o.id,...o.data()}}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{let t=i.j2.currentUser;if(!t)throw Error("You must be logged in to create an article");let r={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:a.Dc.now(),authorId:t.uid,authorName:t.displayName||t.email?.split("@")[0]||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,a.gS)((0,a.rJ)(i.db,"articles"),r)).id,...r}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let n=(0,a.H9)(i.db,"articles",e),o=await (0,a.x7)(n);if(!o.exists())throw Error("Article not found");if(o.data().authorId!==r.uid)throw Error("You can only edit your own articles");let s={...t};t.title&&!t.slug&&(s.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),s.updatedAt=a.Dc.now(),await (0,a.mZ)(n,s);let l=await (0,a.x7)(n);return{id:l.id,...l.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,a.rJ)(i.db,"articles",e,"comments"),r=(0,a.P)(t,(0,a.My)("createdAt","desc")),n=await (0,a.GG)(r),o=[];return n.forEach(e=>{let t=e.data();o.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),o}catch(e){throw console.error("Error getting comments:",e),e}}async function h(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to comment");let o={userId:r.uid,userName:r.displayName||r.email?.split("@")[0]||"Anonymous",content:t,createdAt:a.Dc.now(),likes:[],replies:[]},l=await (0,a.gS)((0,a.rJ)(i.db,"articles",e,"comments"),o),c=await s(e);return c&&c.authorId!==r.uid&&await (0,n.fZ)(c.authorId,e,c.slug||"",c.title||"Article",l.id,t),{id:l.id,commentId:l.id,...o}}catch(e){throw console.error("Error adding comment:",e),e}}async function p(e,t,r){try{let n=i.j2.currentUser;if(!n)throw Error("You must be logged in to reply");let o=(0,a.H9)(i.db,"articles",e,"comments",t),l=await (0,a.x7)(o);if(!l.exists())throw Error("Comment not found");let c={replyId:Math.random().toString(36).substring(2,15),userId:n.uid,userName:n.displayName||n.email?.split("@")[0]||"Anonymous",content:r,createdAt:a.Dc.now(),likes:[]};await (0,a.mZ)(o,{replies:(0,a.hq)(c)});let d=l.data();if(d.userId!==n.uid){let r=await s(e);console.log(`User ${n.uid} replied to comment ${t} by ${d.userId} on article ${r?.title}`)}return c}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let n=(0,a.H9)(i.db,"articles",e,"comments",t),o=await (0,a.x7)(n);if(!o.exists())throw Error("Comment not found");let s=o.data(),l=r.uid,c=(s.likes||[]).includes(l);await (0,a.mZ)(n,{likes:c?(0,a.C3)(l):(0,a.hq)(l)});let d=(await (0,a.x7)(n)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function g(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let n=(0,a.H9)(i.db,"articles",e,"comments",t),o=await (0,a.x7)(n);if(!o.exists())throw Error("Comment not found");if(o.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,a.kd)(n),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=i.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,a.H9)(i.db,"articles",e),n=await (0,a.x7)(r);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,a.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function E(e,t={}){let{limit:r}=t;try{let t=(0,a.rJ)(i.db,"articles"),n=[(0,a._M)("tags","array-contains",e),(0,a._M)("status","==","published"),(0,a.My)("createdAt","desc")];r&&r>0&&n.push((0,a.AB)(r));let o=(0,a.P)(t,...n),s=await (0,a.GG)(o),l=[];return s.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error getting articles by tag:",e),e}}}};