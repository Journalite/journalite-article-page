exports.id=3255,exports.ids=[3255],exports.modules={26734:(t,e,i)=>{"use strict";i.d(e,{A:()=>u});var o=i(60687),r=i(98673),a=i(85814),n=i.n(a),c=i(28163),s=i(41120),l=i(55801),d=i.n(l);let u=()=>{let[t,e]=(0,r.useState)(0),[i,a]=(0,r.useState)([]),[l,u]=(0,r.useState)(!1),f=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=async()=>{e(await (0,c.Hs)())};t();let i=setInterval(t,6e4);return()=>clearInterval(i)},[]),(0,r.useEffect)(()=>{let t=t=>{f.current&&!f.current.contains(t.target)&&u(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),(0,r.useEffect)(()=>{l&&h()},[l]);let h=async()=>{try{let t=await (0,c.Ss)(!1);a(t)}catch(t){console.error("Error fetching notifications:",t)}},m=async t=>{try{!t.read&&t.id&&(await (0,c.bA)(t.id),e(t=>Math.max(t-1,0)),a(e=>e.map(e=>e.id===t.id?{...e,read:!0}:e)))}catch(t){console.error("Error marking notification as read:",t)}},g=t=>{if(!t)return"";let e=t.toDate?t.toDate():new Date(t),i=Math.floor((new Date().getTime()-e.getTime())/6e4);if(i<1)return"Just now";if(i<60)return`${i}m ago`;let o=Math.floor(i/60);if(o<24)return`${o}h ago`;let r=Math.floor(o/24);return r<7?`${r}d ago`:e.toLocaleDateString()},w=t=>"follow"===t.type?t.fromUser?.username?`/user/${t.fromUser.username}`:"/notifications":t.articleSlug?`/articles?slug=${t.articleSlug}`:"/notifications";return(0,o.jsxs)("div",{className:d().notificationContainer,ref:f,children:[(0,o.jsxs)("button",{className:d().bellButton,onClick:()=>{u(!l)},children:[(0,o.jsx)("span",{className:d().bellIcon,children:(0,o.jsx)(s.He,{size:20,color:"#6b7280"})}),t>0&&(0,o.jsx)("span",{className:d().unreadBadge,children:t})]}),l&&(0,o.jsxs)("div",{className:d().notificationDropdown,children:[(0,o.jsxs)("div",{className:d().notificationHeader,children:[(0,o.jsx)("h3",{children:"Notifications"}),i.length>0&&(0,o.jsx)(n(),{href:"/notifications",className:d().viewAllLink,children:"View All"})]}),(0,o.jsx)("div",{className:d().notificationList,children:0===i.length?(0,o.jsx)("div",{className:d().emptyState,children:"No notifications yet"}):i.slice(0,5).map(t=>(0,o.jsxs)(n(),{href:w(t),className:`${d().notificationItem} ${!t.read?d().unread:""}`,onClick:()=>m(t),children:[(0,o.jsxs)("div",{className:d().notificationContent,children:[(0,o.jsx)("p",{className:d().notificationMessage,children:t.message}),(0,o.jsx)("span",{className:d().notificationTime,children:g(t.createdAt)})]}),!t.read&&(0,o.jsx)("div",{className:d().unreadDot})]},t.id))}),i.length>5&&(0,o.jsx)("div",{className:d().notificationFooter,children:(0,o.jsx)(n(),{href:"/notifications",className:d().seeMoreLink,children:"See more notifications"})})]})]})}},55801:t=>{t.exports={notificationContainer:"NotificationBell_notificationContainer__TFGqP",bellButton:"NotificationBell_bellButton__PKB6r",bellIcon:"NotificationBell_bellIcon__ALAAB",unreadBadge:"NotificationBell_unreadBadge__cOn_b",notificationDropdown:"NotificationBell_notificationDropdown__p8Mv4",notificationHeader:"NotificationBell_notificationHeader__cPSyI",viewAllLink:"NotificationBell_viewAllLink__une1x",notificationList:"NotificationBell_notificationList__SBbvK",notificationItem:"NotificationBell_notificationItem__MW9MC",unread:"NotificationBell_unread__9c4op",notificationContent:"NotificationBell_notificationContent__2upmA",notificationMessage:"NotificationBell_notificationMessage__aqMDB",notificationTime:"NotificationBell_notificationTime__JQ2O9",unreadDot:"NotificationBell_unreadDot__qaEb7",notificationFooter:"NotificationBell_notificationFooter__l28sD",seeMoreLink:"NotificationBell_seeMoreLink__eh2qR",emptyState:"NotificationBell_emptyState___y1V2"}},79440:(t,e,i)=>{"use strict";i.d(e,{GE:()=>a,N6:()=>s,a:()=>d,getArticleById:()=>n,iZ:()=>l,l6:()=>c,zE:()=>u});var o=i(75535),r=i(43649);async function a(t={}){let{limit:e,includeDrafts:i=!1}=t;try{let t=(0,o.collection)(r.db,"articles"),a=[];i||a.push((0,o.where)("status","==","published")),a.push((0,o.orderBy)("createdAt","desc")),e&&e>0&&a.push((0,o.limit)(e));let n=(0,o.query)(t,...a),c=await (0,o.getDocs)(n),s=[];return c.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function n(t){Date.now();try{let e=(0,o.doc)(r.db,"articles",t),i=await (0,o.getDoc)(e);if(!i.exists())return null;return{id:i.id,...i.data()}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function c(t){let e=0;for(;e<3;){e++;try{let i=(0,o.collection)(r.db,"articles"),a=(0,o.query)(i,(0,o.where)("slug","==",t),(0,o.where)("status","==","published"),(0,o.limit)(1)),n=await (0,o.getDocs)(a);if(n.empty)if(3===e)break;else await new Promise(t=>setTimeout(t,1e3));else{let t=n.docs[0];return{id:t.id,...t.data()}}}catch(t){if(console.error("Error getting article by slug:",t),3===e)throw t}}return null}async function s(t){try{let e=r.j2.currentUser;if(!e)throw Error("You must be logged in to create an article");let i={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:e.uid,authorName:e.displayName||e.email?.split("@")[0]||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[],hasReflectionRoom:t.hasReflectionRoom||!1};return{id:(await (0,o.addDoc)((0,o.collection)(r.db,"articles"),i)).id,...i}}catch(t){throw console.error("Error creating article:",t),t}}async function l(t,e){try{let i=r.j2.currentUser;if(!i)throw Error("You must be logged in to edit an article");let a=(0,o.doc)(r.db,"articles",t),n=await (0,o.getDoc)(a);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==i.uid)throw Error("You can only edit your own articles");let c={...e};e.title&&(c.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),c.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(a,c);let s=await (0,o.getDoc)(a);if(!s.exists())return{id:t,...c,createdAt:o.Timestamp.now(),updatedAt:o.Timestamp.now()};{let t=s.data();return{id:s.id,...t}}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=r.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let i=(0,o.doc)(r.db,"articles",t),a=await (0,o.getDoc)(i);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(i),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function u(t,e={}){let{limit:i}=e;try{let e=(0,o.collection)(r.db,"articles"),a=[(0,o.where)("tags","array-contains",t),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];i&&i>0&&a.push((0,o.limit)(i));let n=(0,o.query)(e,...a),c=await (0,o.getDocs)(n),s=[];return c.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}i(28163)},98673:(t,e,i)=>{"use strict";var o=i(43210);i.o(o,"useEffect")&&i.d(e,{useEffect:function(){return o.useEffect}}),i.o(o,"useRef")&&i.d(e,{useRef:function(){return o.useRef}}),i.o(o,"useState")&&i.d(e,{useState:function(){return o.useState}})}};