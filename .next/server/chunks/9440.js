"use strict";exports.id=9440,exports.ids=[9440],exports.modules={28163:(t,e,r)=>{r.d(e,{Hs:()=>d,N9:()=>a,Ss:()=>c,bA:()=>n,fP:()=>l,he:()=>s});var o=r(75535),i=r(43649);async function a(t,e,r,a){try{if(t===r)return null;let c={userId:t,type:"follow",read:!1,sourceId:r,sourceType:"user",message:`${e} (@${a}) started following you`,fromUser:{id:r,name:e,username:a},createdAt:o.Timestamp.now()};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"notifications"),c)).id,...c}}catch(t){return console.error("Error creating follow notification:",t),null}}async function c(t=!1){try{let e,r=i.j2.currentUser;if(!r)throw Error("User not authenticated");let a=(0,o.collection)(i.db,"notifications");e=t?(0,o.query)(a,(0,o.where)("userId","==",r.uid),(0,o.where)("read","==",!1),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100)):(0,o.query)(a,(0,o.where)("userId","==",r.uid),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100));let c=await (0,o.getDocs)(e),n=[];return c.forEach(t=>{n.push({id:t.id,...t.data()})}),n}catch(t){throw console.error("Error fetching notifications:",t),t}}async function n(t){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",t),a=await (0,o.getDoc)(r);if(!a.exists())throw Error("Notification not found");if(a.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(t){throw console.error("Error marking notification as read:",t),t}}async function s(){try{let t=i.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(e,(0,o.where)("userId","==",t.uid),(0,o.where)("read","==",!1)),a=await (0,o.getDocs)(r),c=a.docs.map(t=>(0,o.updateDoc)(t.ref,{read:!0}));return await Promise.all(c),{success:!0,count:a.size}}catch(t){throw console.error("Error marking all notifications as read:",t),t}}async function l(t){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",t),a=await (0,o.getDoc)(r);if(!a.exists())throw Error("Notification not found");if(a.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.deleteDoc)(r),{success:!0}}catch(t){throw console.error("Error deleting notification:",t),t}}async function d(){try{let t=i.j2.currentUser;if(!t)return 0;let e=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(e,(0,o.where)("userId","==",t.uid),(0,o.where)("read","==",!1));return(await (0,o.getDocs)(r)).size}catch(t){return console.error("Error counting unread notifications:",t),0}}},79440:(t,e,r)=>{r.d(e,{GE:()=>a,N6:()=>s,a:()=>d,getArticleById:()=>c,iZ:()=>l,l6:()=>n,zE:()=>u});var o=r(75535),i=r(43649);async function a(t={}){let{limit:e,includeDrafts:r=!1}=t;try{let t=(0,o.collection)(i.db,"articles"),a=[];r||a.push((0,o.where)("status","==","published")),a.push((0,o.orderBy)("createdAt","desc")),e&&e>0&&a.push((0,o.limit)(e));let c=(0,o.query)(t,...a),n=await (0,o.getDocs)(c),s=[];return n.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function c(t){Date.now();try{let e=(0,o.doc)(i.db,"articles",t),r=await (0,o.getDoc)(e);if(!r.exists())return null;return{id:r.id,...r.data()}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function n(t){let e=0;for(;e<3;){e++;try{let r=(0,o.collection)(i.db,"articles"),a=(0,o.query)(r,(0,o.where)("slug","==",t),(0,o.where)("status","==","published"),(0,o.limit)(1)),c=await (0,o.getDocs)(a);if(c.empty)if(3===e)break;else await new Promise(t=>setTimeout(t,1e3));else{let t=c.docs[0];return{id:t.id,...t.data()}}}catch(t){if(console.error("Error getting article by slug:",t),3===e)throw t}}return null}async function s(t){try{let e=i.j2.currentUser;if(!e)throw Error("You must be logged in to create an article");let r={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:e.uid,authorName:e.displayName||e.email?.split("@")[0]||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[],hasReflectionRoom:t.hasReflectionRoom||!1};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"articles"),r)).id,...r}}catch(t){throw console.error("Error creating article:",t),t}}async function l(t,e){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let a=(0,o.doc)(i.db,"articles",t),c=await (0,o.getDoc)(a);if(!c.exists())throw Error("Article not found");if(c.data().authorId!==r.uid)throw Error("You can only edit your own articles");let n={...e};e.title&&(n.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),n.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(a,n);let s=await (0,o.getDoc)(a);if(!s.exists())return{id:t,...n,createdAt:o.Timestamp.now(),updatedAt:o.Timestamp.now()};{let t=s.data();return{id:s.id,...t}}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=i.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(i.db,"articles",t),a=await (0,o.getDoc)(r);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function u(t,e={}){let{limit:r}=e;try{let e=(0,o.collection)(i.db,"articles"),a=[(0,o.where)("tags","array-contains",t),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];r&&r>0&&a.push((0,o.limit)(r));let c=(0,o.query)(e,...a),n=await (0,o.getDocs)(c),s=[];return n.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}r(28163)}};