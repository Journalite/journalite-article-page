exports.id=278,exports.ids=[278],exports.modules={31237:t=>{t.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},79440:(t,e,r)=>{"use strict";r.d(e,{BC:()=>g,GE:()=>i,N6:()=>c,Oe:()=>m,S1:()=>f,Tu:()=>p,a:()=>b,fz:()=>d,iZ:()=>u,l6:()=>s,tT:()=>h,zE:()=>n});var o=r(75535),l=r(43649),a=r(28163);async function i(t={}){let{limit:e,includeDrafts:r=!1}=t;console.log("getArticles called with limit:",e);try{let t=(0,o.rJ)(l.db,"articles"),a=[];r||a.push((0,o._M)("status","==","published")),a.push((0,o.My)("createdAt","desc")),e&&e>0&&(console.log("Adding limit constraint:",e),a.push((0,o.AB)(e)));let i=(0,o.P)(t,...a),n=await (0,o.GG)(i);console.log("Query returned document count:",n.size);let s=[];return n.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function n(t){try{let e=Date.now();console.log(`üîÑ DIRECT FETCH: Getting article with ID: ${t} (time: ${e})`);let r=(0,o.H9)(l.db,"articles",t),a=await (0,o.x7)(r);if(!a.exists())return console.log("‚ùå Article not found for ID:",t),null;{let t={id:a.id,...a.data()};return console.log("‚úÖ Article found:",t.title),console.log("\uD83D\uDCC4 Content length:",t.body?.length||0),console.log("\uD83C\uDFF7Ô∏è Tags:",t.tags?.join(", ")||"none"),t}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function s(t){try{console.log(`Getting article by slug: ${t}, timestamp: ${Date.now()}`);let e=0;for(;e<2;){e++,console.log(`Attempt ${e} to get article by slug`),e>1&&await new Promise(t=>setTimeout(t,500));let r=(0,o.rJ)(l.db,"articles"),a=(0,o.P)(r,(0,o._M)("slug","==",t),(0,o._M)("status","==","published")),i=await (0,o.GG)(a);if(i.empty){if(e>=2){console.log("Article not found for slug after multiple attempts:",t);break}}else{let t=i.docs[0],e={id:t.id,...t.data()};return console.log("Article found by slug:",e.title,"Content length:",e.body?.length||0),e}console.log(`Article not found by slug on attempt ${e}, will retry...`)}return null}catch(t){throw console.error("Error getting article by slug:",t),t}}async function c(t){try{let e=l.j2.currentUser;if(!e)throw Error("You must be logged in to create an article");let r={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Dc.now(),authorId:e.uid,authorName:e.displayName||e.email?.split("@")[0]||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.gS)((0,o.rJ)(l.db,"articles"),r)).id,...r}}catch(t){throw console.error("Error creating article:",t),t}}async function u(t,e){try{let r=l.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let a=(0,o.H9)(l.db,"articles",t),i=await (0,o.x7)(a);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==r.uid)throw Error("You can only edit your own articles");let n={...e};e.title&&(n.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",n.slug)),n.updatedAt=o.Dc.now(),await (0,o.mZ)(a,n);let s=await (0,o.x7)(a);return{id:s.id,...s.data()}}catch(t){throw console.error("Error updating article:",t),t}}async function d(t){try{let e=(0,o.rJ)(l.db,"articles",t,"comments"),r=(0,o.P)(e,(0,o.My)("createdAt","desc")),a=await (0,o.GG)(r),i=[];return a.forEach(t=>{let e=t.data();i.push({id:t.id,commentId:t.id,...e,replies:e.replies||[]})}),i}catch(t){throw console.error("Error getting comments:",t),t}}async function g(t,e){try{let r=l.j2.currentUser;if(!r)throw Error("You must be logged in to comment");let i={userId:r.uid,userName:r.displayName||r.email?.split("@")[0]||"Anonymous",content:e,createdAt:o.Dc.now(),likes:[],replies:[]},s=await (0,o.gS)((0,o.rJ)(l.db,"articles",t,"comments"),i),c=await n(t);return c&&c.authorId!==r.uid&&await (0,a.fZ)(c.authorId,t,c.slug||"",c.title||"Article",s.id,e),{id:s.id,commentId:s.id,...i}}catch(t){throw console.error("Error adding comment:",t),t}}async function m(t,e,r){try{let a=l.j2.currentUser;if(!a)throw Error("You must be logged in to reply");let i=(0,o.H9)(l.db,"articles",t,"comments",e),s=await (0,o.x7)(i);if(!s.exists())throw Error("Comment not found");let c={replyId:Math.random().toString(36).substring(2,15),userId:a.uid,userName:a.displayName||a.email?.split("@")[0]||"Anonymous",content:r,createdAt:o.Dc.now(),likes:[]};await (0,o.mZ)(i,{replies:(0,o.hq)(c)});let u=s.data();if(u.userId!==a.uid){let r=await n(t);console.log(`User ${a.uid} replied to comment ${e} by ${u.userId} on article ${r?.title}`)}return c}catch(t){throw console.error("Error adding reply:",t),t}}async function h(t,e){try{let r=l.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let a=(0,o.H9)(l.db,"articles",t,"comments",e),i=await (0,o.x7)(a);if(!i.exists())throw Error("Comment not found");let n=i.data(),s=r.uid,c=(n.likes||[]).includes(s);await (0,o.mZ)(a,{likes:c?(0,o.C3)(s):(0,o.hq)(s)});let u=(await (0,o.x7)(a)).data();return{success:!0,action:c?"unliked":"liked",likes:u.likes,count:u.likes.length}}catch(t){throw console.error("Error liking comment:",t),t}}async function p(t,e){try{let r=l.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let a=(0,o.H9)(l.db,"articles",t,"comments",e),i=await (0,o.x7)(a);if(!i.exists())throw Error("Comment not found");if(i.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.kd)(a),{success:!0,message:"Comment deleted successfully"}}catch(t){throw console.error("Error deleting comment:",t),t}}async function b(t){try{let e=l.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let r=(0,o.H9)(l.db,"articles",t),a=await (0,o.x7)(r);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function f(t,e={}){let{limit:r}=e;try{let e=(0,o.rJ)(l.db,"articles"),a=[(0,o._M)("tags","array-contains",t),(0,o._M)("status","==","published"),(0,o.My)("createdAt","desc")];r&&r>0&&a.push((0,o.AB)(r));let i=(0,o.P)(e,...a),n=await (0,o.GG)(i),s=[];return n.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}},85540:t=>{t.exports={editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",toolbar:"Editor_toolbar__aaOo7",toolbarGroup:"Editor_toolbarGroup__dOvRT",toolbarButton:"Editor_toolbarButton__hmThZ",active:"Editor_active__UGSnI",keyboardHint:"Editor_keyboardHint__u082F",editorContent:"Editor_editorContent__Hto0I",ProseMirror:"Editor_ProseMirror__DHY3Q",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},97278:(t,e,r)=>{"use strict";r.d(e,{A:()=>j});var o=r(60687),l=r(43210),a=r(16189),i=r(88645),n=r(79440),s=r(43649);r(53764);var c=r(35857);r(98031);var u=r(19954),d=r(67800),g=r(51040);let m=new(r(81553)).Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:t=>[`h${t.attrs.level}`,0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt"),width:t.getAttribute("width"),height:t.getAttribute("height")})}],toDOM(t){let{src:e,alt:r,title:o,width:l,height:a}=t.attrs,i={src:e};return null!=r&&(i.alt=r),null!=o&&(i.title=o),null!=l&&(i.width=l),null!=a&&(i.height=a),["img",i]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1==t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!=t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title"),target:t.getAttribute("target")})}],toDOM(t){let{href:e,title:r,target:o}=t.attrs,l={href:e};return null!=r&&(l.title=r),null!=o&&(l.target=o),["a",l,0]}}}});r(31224),r(52073),r(90021),r(23684);let h=(t,e)=>(r,o,l)=>{let a=!1;(0,d.T2)(e)(r,o,l)&&(r=l.state,a=!0);let i=t(r,o,l);return a||i},{heading:p,paragraph:b,list_item:f,blockquote:_}=m.nodes,y=t=>h((0,u.y_)(p,{level:t}),f),w=()=>h((0,u.y_)(b),f),C=(t,e,r)=>{let{from:o,to:l}=t.selection,a=!1;return(t.doc.nodesBetween(o,l,t=>t.type!==_||(a=!0,!1)),a)?!!(0,d.T2)(f)(t,e)||(0,u.yY)(t,e):((0,d.T2)(f)(t,e)&&(t=r.state),(0,u.Im)(_)(t,e,r))};new c.k_({key:new c.hs("exitHeading"),props:{handleKeyDown(t,e){if("Enter"!==e.key||e.shiftKey)return!1;let{state:r,dispatch:o}=t,{$from:l,empty:a}=r.selection,{heading:i,paragraph:n}=m.nodes;return!!a&&l.parent.type===i&&l.parentOffset===l.parent.content.size&&(e.preventDefault(),(0,u.y_)(n)(r,o,t))}}});var v=r(85540),k=r.n(v);let x=({articleId:t,initialContent:e="",onChange:r,placeholder:a="Tell your story...",className:i=""})=>{let n=(0,l.useRef)(null),s=(0,l.useRef)(null),[c,h]=(0,l.useState)(!1),[,p]=(0,l.useState)(0);(0,l.useEffect)(()=>{console.log("Editor: Running on server, skipping initialization")},[]);let b=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,u.wh)(m.marks.strong)(t,e,s.current),s.current.focus()},[]),f=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,u.wh)(m.marks.em)(t,e,s.current),s.current.focus()},[]),_=(0,l.useCallback)(t=>{if(!s.current)return;let{state:e,dispatch:r}=s.current;y(t)(e,r,s.current),s.current.focus()},[]),v=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;w()(t,e,s.current),s.current.focus()},[]),x=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;C(t,e,s.current),s.current.focus()},[p]),A=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,u.y_)(m.nodes.code_block)(t,e,s.current),s.current.focus()},[]),I=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,d.Sd)(m.nodes.bullet_list)(t,e,s.current),s.current.focus()},[]),j=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,d.Sd)(m.nodes.ordered_list)(t,e,s.current),s.current.focus()},[]),E=(0,l.useCallback)(()=>{let t=prompt("Enter image URL:");if(t&&s.current){let{state:e,dispatch:r}=s.current,o=m.nodes.image.create({src:t,alt:""});r(e.tr.replaceSelectionWith(o)),s.current.focus()}},[]),N=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,g.tN)(t,e),s.current.focus()},[]),D=(0,l.useCallback)(()=>{if(!s.current)return;let{state:t,dispatch:e}=s.current;(0,g.ZS)(t,e),s.current.focus()},[]),M=(0,l.useCallback)(t=>{if(!s.current)return!1;let{from:e,$from:r,to:o,empty:l}=s.current.state.selection;return l?t.isInSet(s.current.state.storedMarks||r.marks()):s.current.state.doc.rangeHasMark(e,o,t)},[p]),B=(0,l.useCallback)((t,e={})=>{if(!s.current)return!1;let{from:r,to:o}=s.current.state.selection,l=!0;return s.current.state.doc.nodesBetween(r,o,r=>!r.isTextblock||!!r.hasMarkup(t,e)||(l=!1,!1)),l},[p]),$=(0,l.useCallback)(()=>{if(!s.current)return!1;let{from:t,to:e}=s.current.state.selection,r=!1;return s.current.state.doc.nodesBetween(t,e,t=>t.type!==m.nodes.blockquote||(r=!0,!1)),r},[p]);return(0,o.jsxs)("div",{className:`${k().editor} ${i}`,children:[c?(0,o.jsxs)("div",{className:k().toolbar,children:[(0,o.jsxs)("div",{className:k().toolbarGroup,children:[(0,o.jsx)("button",{className:`${k().toolbarButton} ${M(m.marks.strong)?k().active:""}`,onClick:b,title:"Bold (‚åò/Ctrl+B)",children:(0,o.jsx)("strong",{children:"B"})}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${M(m.marks.em)?k().active:""}`,onClick:f,title:"Italic (‚åò/Ctrl+I)",children:(0,o.jsx)("em",{children:"I"})})]}),(0,o.jsxs)("div",{className:k().toolbarGroup,children:[(0,o.jsx)("button",{className:`${k().toolbarButton} ${B(m.nodes.paragraph)?k().active:""}`,onClick:v,title:"Paragraph (‚åò/Ctrl+0)",children:"P"}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${B(m.nodes.heading,{level:1})?k().active:""}`,onClick:()=>_(1),title:"Heading 1 (‚åò/Ctrl+Shift+1)",children:"H1"}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${B(m.nodes.heading,{level:2})?k().active:""}`,onClick:()=>_(2),title:"Heading 2 (‚åò/Ctrl+Shift+2)",children:"H2"}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${B(m.nodes.heading,{level:3})?k().active:""}`,onClick:()=>_(3),title:"Heading 3 (‚åò/Ctrl+Shift+3)",children:"H3"})]}),(0,o.jsxs)("div",{className:k().toolbarGroup,children:[(0,o.jsx)("button",{className:k().toolbarButton,onClick:I,title:"Bullet List",children:"‚Ä¢ List"}),(0,o.jsx)("button",{className:k().toolbarButton,onClick:j,title:"Ordered List",children:"1. List"}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${$()?k().active:""}`,onClick:x,title:"Blockquote (‚åò/Ctrl+>)",children:'" Quote'}),(0,o.jsx)("button",{className:`${k().toolbarButton} ${B(m.nodes.code_block)?k().active:""}`,onClick:A,title:"Code Block",children:"</>"})]}),(0,o.jsx)("div",{className:k().toolbarGroup,children:(0,o.jsx)("button",{className:k().toolbarButton,onClick:E,title:"Insert Image",children:"\uD83D\uDDBCÔ∏è Image"})}),(0,o.jsxs)("div",{className:k().toolbarGroup,children:[(0,o.jsx)("button",{className:k().toolbarButton,onClick:N,title:"Undo (‚åò/Ctrl+Z)",children:"‚Ü∂ Undo"}),(0,o.jsx)("button",{className:k().toolbarButton,onClick:D,title:"Redo (‚åò/Ctrl+Y)",children:"‚Ü∑ Redo"})]}),(0,o.jsxs)("div",{className:k().keyboardHint,children:[(0,o.jsx)("kbd",{children:"‚åòB"})," Bold \xa0 ",(0,o.jsx)("kbd",{children:"‚åòI"})," Italic \xa0 ",(0,o.jsx)("kbd",{children:"‚åò‚áß1-3"})," Headings"]})]}):(0,o.jsx)("div",{className:k().loading,children:"Loading editor..."}),(0,o.jsx)("div",{ref:n,className:`ProseMirror ${k().editorContent}`,"aria-label":"Rich text editor",style:{minHeight:"300px",opacity:c?1:.5}})]})};var A=r(31237),I=r.n(A);let j=({articleId:t,onUpdateComplete:e})=>{let r=(0,a.useRouter)(),[c,u]=(0,l.useState)(""),[d,g]=(0,l.useState)(""),[m,h]=(0,l.useState)([]),[p,b]=(0,l.useState)(""),[f,_]=(0,l.useState)(!1),[y,w]=(0,l.useState)(!1),[C,v]=(0,l.useState)(!1),[k,A]=(0,l.useState)(""),[j,E]=(0,l.useState)(!!t),[N,D]=(0,l.useState)(null),[M,B]=(0,l.useState)(""),$=(0,l.useRef)(null),S=(0,l.useRef)(null),O=(0,l.useCallback)(()=>{$.current&&($.current.style.height="auto",$.current.style.height=`${$.current.scrollHeight}px`,!c&&$.current&&$.current.focus())},[c]);(0,l.useEffect)(()=>{let t=s.j2.onAuthStateChanged(t=>{D(t),t||r.push("/login?redirect=compose")});return()=>t()},[r]),(0,l.useEffect)(()=>{t&&N?(async()=>{try{E(!0);let e=await (0,n.zE)(t);if(!e){A("Article not found"),r.push("/");return}if(e.authorId!==N.uid){A("You can only edit your own articles"),r.push("/");return}u(e.title);let o=e.body.replace(/data-[\w-]+="[^"]*"/g,"");g(o),h(e.tags||[]),b(e.coverImage||"")}catch(t){console.error("Error loading article:",t),A("Failed to load article")}finally{E(!1)}})():t||E(!1)},[t,N,r]),(0,l.useEffect)(()=>{O()},[c,O]),(0,l.useEffect)(()=>{let t;return N&&c.trim()&&d.trim()&&!y&&!f&&(t=setTimeout(()=>{P("drafts")},3e4)),()=>{t&&clearTimeout(t)}},[N,c,d,y,f]);let H=(0,l.useCallback)((t,e)=>{t!==d&&(g(t),C&&v(!1))},[d,C]),T=()=>{let t=M.trim().toLowerCase();t&&!m.includes(t)&&m.length<5&&(h([...m,t]),B(""))},G=t=>{h(m.filter(e=>e!==t))},P=async(o="drafts")=>{if(!N)return void A("You must be logged in to save an article");if(!c.trim())return void A("Title is required");if(!d.trim())return void A("Content is required");try{w(!0),A("");let l=d.replace(/data-[\w-]+="[^"]*"/g,""),a={title:c.trim(),body:l,tags:m,coverImage:p.trim(),status:o};if(console.log("Saving article data:",a),t)try{let r=await (0,n.iZ)(t,a);console.log("Article updated successfully:",r?.title),v(!0),await new Promise(t=>setTimeout(t,500));let o=await (0,n.zE)(t);console.log("Fetched updated article data:",o?.title),e&&e(o),setTimeout(()=>{console.log("Applying changes immediately and redirecting to article ID page"),window.location.href=`/articles/${t}/view?updated=true&time=${Date.now()}`,setTimeout(()=>{window.location.pathname.includes("/edit")&&(console.log("Fallback navigation to ID-based article page"),window.location.href=`/articles/${t}?updated=true&time=${Date.now()}`)},2e3)},1e3)}catch(t){console.error("Error updating article:",t),A("Failed to update article. Please try again."),v(!1)}else{let t=await (0,n.N6)(a);"published"===o?r.push(`/articles/${t.id}`):r.push("/dashboard")}}catch(t){console.error("Error saving article:",t),A("Failed to save article. Please try again.")}finally{w(!1),_(!1)}},U=async()=>{if(!d.trim())return void A("Content is required");_(!0),await P("published")},L=async()=>{await P("drafts")};return j?(0,o.jsxs)("div",{className:I().composerLoading,children:[(0,o.jsx)("div",{className:I().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):(0,o.jsxs)("div",{className:I().articleComposer,children:[(0,o.jsxs)("header",{className:I().composerHeader,children:[(0,o.jsx)("div",{className:I().logoContainer,children:(0,o.jsx)("div",{className:I().logo,children:"Journalite"})}),(0,o.jsxs)("div",{className:I().actionButtons,children:[C&&(0,o.jsxs)("span",{className:I().savedIndicator,children:[(0,o.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,o.jsx)("button",{className:I().actionButton,onClick:L,disabled:y||f,children:"Save draft"}),(0,o.jsx)("button",{className:I().publishButton,onClick:U,disabled:y||f||!c.trim()||!d.trim(),children:t?"Update":"Publish"})]})]}),(0,o.jsxs)("main",{className:I().composerContent,children:[(0,o.jsx)("textarea",{ref:$,className:I().titleInput,value:c,onChange:t=>{u(t.target.value)},onKeyDown:t=>{"Enter"===t.key&&t.preventDefault()},placeholder:"Title",rows:1}),(0,o.jsxs)("div",{className:I().coverImageInput,children:[(0,o.jsx)("input",{type:"text",value:p,onChange:t=>{b(t.target.value)},placeholder:"Add a cover image (enter image URL)",className:I().imageUrlInput}),p&&(0,o.jsx)("div",{className:I().coverImagePreview,children:(0,o.jsx)("img",{src:p,alt:"Cover preview"})})]}),(0,o.jsxs)("div",{className:I().tagContainer,children:[m.map(t=>(0,o.jsxs)("div",{className:I().tag,children:[t,(0,o.jsx)("button",{className:I().removeTagButton,onClick:()=>G(t),"aria-label":`Remove ${t} tag`,children:"\xd7"})]},t)),m.length<5&&(0,o.jsx)("input",{ref:S,type:"text",value:M,onChange:t=>{B(t.target.value)},onKeyDown:t=>{("Enter"===t.key||","===t.key)&&(t.preventDefault(),T())},onBlur:T,placeholder:0===m.length?"Add up to 5 tags...":"Add another tag...",className:I().tagInput})]}),k&&(0,o.jsx)("div",{className:I().errorMessage,children:k}),(0,o.jsx)("div",{className:I().editorContainer,children:(0,o.jsx)(x,{articleId:t||(0,i.A)(),initialContent:d,onChange:H,placeholder:"Tell your story..."})})]})]})}}};