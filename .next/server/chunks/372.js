exports.id=372,exports.ids=[372,440],exports.modules={28163:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>a,Ss:()=>l,bA:()=>s,fP:()=>d,fZ:()=>n,he:()=>c});var o=r(75535),i=r(43649);async function n(e,t,r,n,a,l){try{let t=i.j2.currentUser;if(!t||t.uid===e)return null;let s={userId:e,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:`${t.displayName||"Someone"} commented on your article: "${l.substring(0,50)}${l.length>50?"...":""}"`,fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:o.Timestamp.now(),articleSlug:r,articleTitle:n};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"notifications"),s)).id,...s}}catch(e){return console.error("Error creating notification:",e),null}}async function a(e,t,r,n){try{if(e===r)return null;let a={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:`${t} (@${n}) started following you`,fromUser:{id:r,name:t,username:n},createdAt:o.Timestamp.now()};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"notifications"),a)).id,...a}}catch(e){return console.error("Error creating follow notification:",e),null}}async function l(e=!1){try{let t,r=i.j2.currentUser;if(!r)throw Error("User not authenticated");let n=(0,o.collection)(i.db,"notifications");t=e?(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.where)("read","==",!1),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100)):(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100));let a=await (0,o.getDocs)(t),l=[];return a.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error fetching notifications:",e),e}}async function s(e){try{let t=i.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",e),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1)),n=await (0,o.getDocs)(r),a=n.docs.map(e=>(0,o.updateDoc)(e.ref,{read:!0}));return await Promise.all(a),{success:!0,count:n.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=i.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",e),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,o.deleteDoc)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=i.j2.currentUser;if(!e)return 0;let t=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(t,(0,o.where)("userId","==",e.uid),(0,o.where)("read","==",!1));return(await (0,o.getDocs)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}},31237:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},46899:e=>{e.exports={inspirationButton:"InspirationWidget_inspirationButton__RMfVc",inspirationWidget:"InspirationWidget_inspirationWidget__q1gMO",header:"InspirationWidget_header__wZRt7",closeButton:"InspirationWidget_closeButton__qCHBN",tabs:"InspirationWidget_tabs__hfv7d",tab:"InspirationWidget_tab__7hEDY",active:"InspirationWidget_active__CK3jp",content:"InspirationWidget_content__X6qiV",loading:"InspirationWidget_loading__2pTEa",spinner:"InspirationWidget_spinner__Z8Ppp",spin:"InspirationWidget_spin__syiZE",empty:"InspirationWidget_empty__S_QN1",subtitle:"InspirationWidget_subtitle__c_Jph",inspirationItem:"InspirationWidget_inspirationItem__295J_",themeItem:"InspirationWidget_themeItem__oQ_6E",themeTag:"InspirationWidget_themeTag__66K0g",themePrompt:"InspirationWidget_themePrompt__m0Ebn",useButton:"InspirationWidget_useButton__aSW_t",footer:"InspirationWidget_footer__7guyU",refreshButton:"InspirationWidget_refreshButton__yTge0"}},79440:(e,t,r)=>{"use strict";r.d(t,{BC:()=>g,GE:()=>a,N6:()=>c,Oe:()=>h,Tu:()=>p,a:()=>f,fz:()=>u,getArticleById:()=>l,iZ:()=>d,l6:()=>s,tT:()=>m,zE:()=>_});var o=r(75535),i=r(43649),n=r(28163);async function a(e={}){let{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,o.collection)(i.db,"articles"),n=[];r||n.push((0,o.where)("status","==","published")),n.push((0,o.orderBy)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),n.push((0,o.limit)(t)));let a=(0,o.query)(e,...n),l=await (0,o.getDocs)(a);console.log("Query returned document count:",l.size);let s=[];return l.forEach(e=>{let t=e.data();s.push({id:e.id,...t})}),s}catch(e){throw console.error("Error getting articles:",e),e}}async function l(e){try{let t=Date.now();console.log(`üîÑ DIRECT FETCH: Getting article with ID: ${e} (time: ${t})`);let r=(0,o.doc)(i.db,"articles",e),n=await (0,o.getDoc)(r);if(!n.exists())return console.log("‚ùå Article not found for ID:",e),null;{let e={id:n.id,...n.data()};return console.log("‚úÖ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",e.body?.length||0),console.log("\uD83C\uDFF7Ô∏è Tags:",e.tags?.join(", ")||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function s(e){try{console.log(`Getting article by slug: ${e}, timestamp: ${Date.now()}`);let t=0;for(;t<2;){t++,console.log(`Attempt ${t} to get article by slug`),t>1&&await new Promise(e=>setTimeout(e,500));let r=(0,o.collection)(i.db,"articles"),n=(0,o.query)(r,(0,o.where)("slug","==",e),(0,o.where)("status","==","published")),a=await (0,o.getDocs)(n);if(a.empty){if(t>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{let e=a.docs[0],t={id:e.id,...e.data()};return console.log("Article found by slug:",t.title,"Content length:",t.body?.length||0),t}console.log(`Article not found by slug on attempt ${t}, will retry...`)}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{let t=i.j2.currentUser;if(!t)throw Error("You must be logged in to create an article");let r={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:t.uid,authorName:t.displayName||t.email?.split("@")[0]||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"articles"),r)).id,...r}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let n=(0,o.doc)(i.db,"articles",e),a=await (0,o.getDoc)(n);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let l={...t};t.title&&(l.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",l.slug)),l.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(n,l);let s=await (0,o.getDoc)(n);return{id:s.id,...s.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,o.collection)(i.db,"articles",e,"comments"),r=(0,o.query)(t,(0,o.orderBy)("createdAt","desc")),n=await (0,o.getDocs)(r),a=[];return n.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function g(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to comment");let a={userId:r.uid,userName:r.displayName||r.email?.split("@")[0]||"Anonymous",content:t,createdAt:o.Timestamp.now(),likes:[],replies:[]},s=await (0,o.addDoc)((0,o.collection)(i.db,"articles",e,"comments"),a),c=await l(e);return c&&c.authorId!==r.uid&&await (0,n.fZ)(c.authorId,e,c.slug||"",c.title||"Article",s.id,t),{id:s.id,commentId:s.id,...a}}catch(e){throw console.error("Error adding comment:",e),e}}async function h(e,t,r){try{let n=i.j2.currentUser;if(!n)throw Error("You must be logged in to reply");let a=(0,o.doc)(i.db,"articles",e,"comments",t),s=await (0,o.getDoc)(a);if(!s.exists())throw Error("Comment not found");let c={replyId:Math.random().toString(36).substring(2,15),userId:n.uid,userName:n.displayName||n.email?.split("@")[0]||"Anonymous",content:r,createdAt:o.Timestamp.now(),likes:[]};await (0,o.updateDoc)(a,{replies:(0,o.arrayUnion)(c)});let d=s.data();if(d.userId!==n.uid){let r=await l(e);console.log(`User ${n.uid} replied to comment ${t} by ${d.userId} on article ${r?.title}`)}return c}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let n=(0,o.doc)(i.db,"articles",e,"comments",t),a=await (0,o.getDoc)(n);if(!a.exists())throw Error("Comment not found");let l=a.data(),s=r.uid,c=(l.likes||[]).includes(s);await (0,o.updateDoc)(n,{likes:c?(0,o.arrayRemove)(s):(0,o.arrayUnion)(s)});let d=(await (0,o.getDoc)(n)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function p(e,t){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let n=(0,o.doc)(i.db,"articles",e,"comments",t),a=await (0,o.getDoc)(n);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.deleteDoc)(n),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=i.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(i.db,"articles",e),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function _(e,t={}){let{limit:r}=t;try{let t=(0,o.collection)(i.db,"articles"),n=[(0,o.where)("tags","array-contains",e),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];r&&r>0&&n.push((0,o.limit)(r));let a=(0,o.query)(t,...n),l=await (0,o.getDocs)(a),s=[];return l.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error getting articles by tag:",e),e}}},85372:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var o=r(60687),i=r(43210),n=r.n(i),a=r(16189),l=r(88645),s=r(79440),c=r(43649);r(53764);var d=r(35857);r(98031);var u=r(19954),g=r(67800),h=r(51040);r(31224),r(90021),r(23684);var m=r(81553);let p=new m.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>[`h${e.attrs.level}`,0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:o,width:i,height:n}=e.attrs,a={src:t};return null!=r&&(a.alt=r),null!=o&&(a.title=o),null!=i&&(a.width=i),null!=n&&(a.height=n),["img",a]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:"javascript"}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs(e){let t=e.getAttribute("data-language");if(t)return{language:t};let r=e.querySelector("code");if(r){let e=(r.className||"").match(/language-(\w+)/);if(e)return{language:e[1]}}return{language:"javascript"}},getContent(e,t){let r=e.querySelector("code");if(r){let e=r.textContent||r.innerText||"";return e?[t.text(e)]:[]}return[]}}],toDOM:e=>["pre",{"data-language":e.attrs.language},["code",{class:`language-${e.attrs.language}`},0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:o}=e.attrs,i={href:t};return null!=r&&(i.title=r),null!=o&&(i.target=o),["a",i,0]}}}}),f=(e,t)=>(r,o,i)=>{let n=!1;(0,g.T2)(t)(r,o,i)&&(r=i.state,n=!0);let a=e(r,o,i);return n||a},{heading:_,paragraph:v,list_item:b,blockquote:y}=p.nodes,w=e=>f((0,u.y_)(_,{level:e}),b),x=()=>f((0,u.y_)(v),b),j=(e,t,r)=>{let{from:o,to:i}=e.selection,n=!1;return(e.doc.nodesBetween(o,i,e=>e.type!==y||(n=!0,!1)),n)?!!(0,g.T2)(b)(e,t)||(0,u.yY)(e,t):((0,g.T2)(b)(e,t)&&(e=r.state),(0,u.Im)(y)(e,t,r))};new d.k_({key:new d.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:o}=e,{$from:i,empty:n}=r.selection,{heading:a,paragraph:l}=p.nodes;return!!n&&i.parent.type===a&&i.parentOffset===i.parent.content.size&&(t.preventDefault(),(0,u.y_)(l)(r,o,e))}}}),r(46997),r(57894),r(8990),r(68960),r(36014),r(71454),r(25865),r(92623),r(25119),r(29173),r(65848),r(88224),r(35630),r(14321),r(48541),r(83075),r(29731),r(34425),r(61707),r(11566),r(86908);var C=r(85540),I=r.n(C);let N=n().forwardRef(({articleId:e,initialContent:t="",onChange:r,placeholder:a="Tell your story...",className:l=""},s)=>{let c=(0,i.useRef)(null),d=(0,i.useRef)(null),f=(0,i.useRef)(r),[_,v]=(0,i.useState)(!1);f.current=r;let b=(0,i.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current,{selection:o}=t,i=p.text(e);r(t.tr.replaceSelectionWith(i)),d.current.focus()},[]);n().useImperativeHandle(s,()=>({insertText:b,focus:()=>d.current?.focus()}),[b]),(0,i.useEffect)(()=>{},[]),(0,i.useEffect)(()=>{if(d.current&&_&&t){console.log("Editor: Updating content without reinitializing, length:",t.length);try{let e=function(e){if(!e||""===e.trim())return p.node("doc",null,[p.node("paragraph")]);let t=document.createElement("div");return t.innerHTML=e,m.S4.fromSchema(p).parse(t)}(t),r=function(e){let t=document.createElement("div");return t.appendChild(m.ZF.fromSchema(p).serializeFragment(e.content)),t.innerHTML}(d.current.state.doc);if(t!==r){let t=d.current.state.tr.replaceWith(0,d.current.state.doc.content.size,e.content);d.current.dispatch(t),console.log("Editor: Content updated successfully")}}catch(e){console.error("Editor: Failed to update content:",e)}}},[t,_]);let y=(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,u.wh)(p.marks.strong)(e,t)&&d.current.focus()},[]),C=(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,u.wh)(p.marks.em)(e,t)&&d.current.focus()},[]),N=(0,i.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current;w(e)(t,r,d.current)&&d.current.focus()},[]);(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;x()(e,t,d.current)&&d.current.focus()},[]);let k=(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;j(e,t,d.current)&&d.current.focus()},[]),E=(0,i.useCallback)(()=>{if(!d.current)return;let e=prompt("Enter programming language (e.g., javascript, python, css):","javascript");if(!e)return;let{state:t,dispatch:r}=d.current,{from:o,to:i}=t.selection,n=p.nodes.code_block.create({language:e.toLowerCase()}),a=t.tr.replaceRangeWith(o,i,n);r&&(r(a),d.current.focus())},[]),A=(0,i.useCallback)(()=>{if(!d.current)return;console.log("Bullet list button clicked");let{state:e,dispatch:t}=d.current,{$from:r,$to:o}=e.selection;try{let i=p.nodes.list_item.create(null,p.nodes.paragraph.create(null,r.parent.content)),n=p.nodes.bullet_list.create(null,i),a=e.tr.replaceWith(r.start(),o.end(),n);t(a),console.log("Manual bullet list creation: success"),d.current.focus()}catch(o){console.log("Manual bullet list creation failed:",o);let r=(0,g.Sd)(p.nodes.bullet_list)(e,t);console.log("wrapInList fallback result:",r),r&&d.current.focus()}},[]),D=(0,i.useCallback)(()=>{if(!d.current)return;console.log("Ordered list button clicked");let{state:e,dispatch:t}=d.current,{$from:r,$to:o}=e.selection;try{let i=p.nodes.list_item.create(null,p.nodes.paragraph.create(null,r.parent.content)),n=p.nodes.ordered_list.create(null,i),a=e.tr.replaceWith(r.start(),o.end(),n);t(a),console.log("Manual ordered list creation: success"),d.current.focus()}catch(o){console.log("Manual ordered list creation failed:",o);let r=(0,g.Sd)(p.nodes.ordered_list)(e,t);console.log("wrapInList fallback result:",r),r&&d.current.focus()}},[]),B=(0,i.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&d.current){let{state:t,dispatch:r}=d.current,o=p.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(o)),d.current.focus()}},[]),M=(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,h.tN)(e,t),d.current.focus()},[]),T=(0,i.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,h.ZS)(e,t),d.current.focus()},[]),S=(0,i.useCallback)(e=>{if(!d.current)return!1;let{from:t,$from:r,to:o,empty:i}=d.current.state.selection;return i?e.isInSet(d.current.state.storedMarks||r.marks()):d.current.state.doc.rangeHasMark(t,o,e)},[]),H=(0,i.useCallback)((e,t={})=>{if(!d.current)return!1;let{from:r,to:o}=d.current.state.selection,i=!0;return d.current.state.doc.nodesBetween(r,o,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(i=!1,!1)),i},[]),z=(0,i.useCallback)(()=>{if(!d.current)return!1;let{from:e,to:t}=d.current.state.selection,r=!1;return d.current.state.doc.nodesBetween(e,t,e=>e.type!==p.nodes.blockquote||(r=!0,!1)),r},[]);return(0,o.jsxs)("div",{className:I().editor,style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[_&&(0,o.jsx)("div",{className:I().modernToolbar,style:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,o.jsxs)("div",{className:I().toolbarContainer,children:[(0,o.jsxs)("div",{className:I().formatGroup,children:[(0,o.jsx)("button",{className:`${I().toolBtn} ${S(p.marks.strong)?I().active:""}`,onClick:y,title:"Bold (‚åòB)","aria-label":"Bold",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,o.jsx)("button",{className:`${I().toolBtn} ${S(p.marks.em)?I().active:""}`,onClick:C,title:"Italic (‚åòI)","aria-label":"Italic",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,o.jsx)("div",{className:I().divider}),(0,o.jsxs)("div",{className:I().formatGroup,children:[(0,o.jsx)("button",{className:`${I().toolBtn} ${H(p.nodes.heading,{level:1})?I().active:""}`,onClick:()=>N(1),title:"Large Heading (‚åò‚áß1)","aria-label":"Heading 1",children:(0,o.jsx)("span",{className:I().headingIcon,children:"H1"})}),(0,o.jsx)("button",{className:`${I().toolBtn} ${H(p.nodes.heading,{level:2})?I().active:""}`,onClick:()=>N(2),title:"Medium Heading (‚åò‚áß2)","aria-label":"Heading 2",children:(0,o.jsx)("span",{className:I().headingIcon,children:"H2"})}),(0,o.jsx)("button",{className:`${I().toolBtn} ${H(p.nodes.heading,{level:3})?I().active:""}`,onClick:()=>N(3),title:"Small Heading (‚åò‚áß3)","aria-label":"Heading 3",children:(0,o.jsx)("span",{className:I().headingIcon,children:"H3"})})]}),(0,o.jsx)("div",{className:I().divider}),(0,o.jsxs)("div",{className:I().formatGroup,children:[(0,o.jsx)("button",{className:I().toolBtn,onClick:A,title:"Bullet List","aria-label":"Bullet list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,o.jsx)("button",{className:I().toolBtn,onClick:D,title:"Numbered List","aria-label":"Numbered list",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,o.jsx)("button",{className:`${I().toolBtn} ${z()?I().active:""}`,onClick:k,title:"Quote (‚åò>)","aria-label":"Quote",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,o.jsx)("div",{className:I().divider}),(0,o.jsxs)("div",{className:I().formatGroup,children:[(0,o.jsx)("button",{className:I().toolBtn,onClick:B,title:"Add Image","aria-label":"Insert image",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,o.jsx)("button",{className:`${I().toolBtn} ${H(p.nodes.code_block)?I().active:""}`,onClick:E,title:"Code Block","aria-label":"Code block",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,o.jsx)("div",{className:I().divider}),(0,o.jsxs)("div",{className:I().formatGroup,children:[(0,o.jsx)("button",{className:I().toolBtn,onClick:M,title:"Undo (‚åòZ)","aria-label":"Undo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,o.jsx)("button",{className:I().toolBtn,onClick:T,title:"Redo (‚åòY)","aria-label":"Redo",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!_&&(0,o.jsxs)("div",{className:I().loading,children:[(0,o.jsx)("div",{className:I().loadingSpinner}),(0,o.jsx)("span",{children:"Loading editor..."})]}),(0,o.jsx)("div",{ref:c,className:I().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"400px",opacity:_?1:.3}})]})});N.displayName="Editor";var k=r(45306),E=r(41120),A=r(46899),D=r.n(A);let B=({onInsert:e})=>{let[t,r]=(0,i.useState)(!1),[n,a]=(0,i.useState)([]),[l,s]=(0,i.useState)([]),[c,d]=(0,i.useState)(!1),[u,g]=(0,i.useState)("inspirations"),h=async()=>{d(!0);try{let[e,t]=await Promise.all([(0,k.Aq)(),(0,k.Gy)()]);a(e),s(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{d(!1)}},m=t=>{e&&e(t),r(!1)},p=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||`Write about ${e}...`;return t?(0,o.jsxs)("div",{className:D().inspirationWidget,children:[(0,o.jsxs)("div",{className:D().header,children:[(0,o.jsxs)("h3",{children:[(0,o.jsx)(E.TG,{size:18,color:"#f59e0b"}),"Your Reflection Insights"]}),(0,o.jsx)("button",{onClick:()=>r(!1),className:D().closeButton,children:"\xd7"})]}),(0,o.jsxs)("div",{className:D().tabs,children:[(0,o.jsxs)("button",{className:`${D().tab} ${"inspirations"===u?D().active:""}`,onClick:()=>g("inspirations"),children:["Recent Thoughts (",n.length,")"]}),(0,o.jsxs)("button",{className:`${D().tab} ${"themes"===u?D().active:""}`,onClick:()=>g("themes"),children:["Writing Themes (",l.length,")"]})]}),(0,o.jsx)("div",{className:D().content,children:c?(0,o.jsxs)("div",{className:D().loading,children:[(0,o.jsx)("div",{className:D().spinner}),(0,o.jsx)("p",{children:"Loading your insights..."})]}):"inspirations"===u?(0,o.jsx)("div",{className:D().inspirationsList,children:0===n.length?(0,o.jsxs)("div",{className:D().empty,children:[(0,o.jsxs)("p",{children:[(0,o.jsx)(E.d3,{size:16,color:"#6b7280"}),"No reflections yet!"]}),(0,o.jsx)("p",{children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:D().subtitle,children:"Your past reflections that might spark new ideas:"}),n.map((e,t)=>(0,o.jsxs)("div",{className:D().inspirationItem,children:[(0,o.jsxs)("p",{children:['"',e.response,'"']}),e.articleTitle&&(0,o.jsxs)("p",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["From: ",e.articleTitle]}),(0,o.jsx)("button",{onClick:()=>{let t=e.articleTitle?` (inspired by "${e.articleTitle}")`:"";m(`"${e.response}"${t} - This reminds me of...`)},className:D().useButton,children:"Use as starting point"})]},t))]})}):(0,o.jsx)("div",{className:D().themesList,children:0===l.length?(0,o.jsxs)("div",{className:D().empty,children:[(0,o.jsxs)("p",{children:[(0,o.jsx)(E.v1,{size:16,color:"#6b7280"}),"No themes identified yet!"]}),(0,o.jsx)("p",{children:"Keep reflecting on articles to discover your writing themes."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:D().subtitle,children:"Writing prompts based on your reflection patterns:"}),l.map((e,t)=>(0,o.jsxs)("div",{className:D().themeItem,children:[(0,o.jsx)("div",{className:D().themeTag,children:e}),(0,o.jsx)("p",{className:D().themePrompt,children:p(e)}),(0,o.jsx)("button",{onClick:()=>m(p(e)),className:D().useButton,children:"Start writing"})]},t))]})})}),(0,o.jsx)("div",{className:D().footer,children:(0,o.jsx)("button",{onClick:h,className:D().refreshButton,disabled:c,children:"\uD83D\uDD04 Refresh insights"})})]}):(0,o.jsxs)("button",{onClick:()=>{t||h(),r(!t)},className:D().inspirationButton,title:"Get inspiration from your reflections",children:[(0,o.jsx)(E.Y_,{size:16,color:"currentColor"}),"Inspiration"]})};var M=r(31237),T=r.n(M);let S=({articleId:e,onUpdateComplete:t})=>{let r=(0,a.useRouter)(),[n,d]=(0,i.useState)(""),[u,g]=(0,i.useState)(""),[h,m]=(0,i.useState)([]),[p,f]=(0,i.useState)(""),[_,v]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),[w,x]=(0,i.useState)(!1),[j,C]=(0,i.useState)(""),[I,k]=(0,i.useState)(!!e),[E,A]=(0,i.useState)(null),[D,M]=(0,i.useState)(""),S=(0,i.useRef)(null),H=(0,i.useRef)(null),z=(0,i.useRef)(null),$=(0,i.useCallback)(()=>{S.current&&(S.current.style.height="auto",S.current.style.height=`${S.current.scrollHeight}px`,!n&&S.current&&S.current.focus())},[n]);(0,i.useEffect)(()=>{let e=c.j2.onAuthStateChanged(e=>{A(e),e||r.push("/login?redirect=compose")});return()=>e()},[r]),(0,i.useEffect)(()=>{console.log("ArticleComposer useEffect - articleId:",e,"user:",E?.uid),e&&E?(async()=>{try{console.log("Fetching article for editing, ID:",e),k(!0);let t=await (0,s.getArticleById)(e);if(console.log("Fetched article:",t?.title,"Body length:",t?.body?.length),!t){console.log("Article not found"),C("Article not found"),r.push("/");return}if(t.authorId!==E.uid){console.log("User not authorized to edit this article"),C("You can only edit your own articles"),r.push("/");return}console.log("Setting title:",t.title),d(t.title);let o=t.body.replace(/data-[\w-]+="[^"]*"/g,"");console.log("Setting content, length:",o.length,"Preview:",o.substring(0,100)+"..."),g(o),m(t.tags||[]),f(t.coverImage||""),console.log("Article data loaded successfully for editing")}catch(e){console.error("Error loading article:",e),C("Failed to load article")}finally{k(!1)}})():e?console.log("User not logged in, waiting..."):(console.log("No articleId, starting with empty content"),k(!1))},[e,E,r]),(0,i.useEffect)(()=>{$()},[n,$]),(0,i.useEffect)(()=>{let e;return E&&n.trim()&&u.trim()&&!b&&!_&&(e=setTimeout(()=>{O("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[E,n,u,b,_]);let W=(0,i.useCallback)((e,t)=>{g(t=>e!==t?(w&&x(!1),e):t)},[w]),U=()=>{let e=D.trim().toLowerCase();e&&!h.includes(e)&&h.length<5&&(m([...h,e]),M(""))},L=e=>{m(h.filter(t=>t!==e))},O=async(o="drafts")=>{if(!E)return void C("You must be logged in to save an article");if(!n.trim())return void C("Title is required");if(!u.trim())return void C("Content is required");try{y(!0),C("");let i=u.replace(/data-[\w-]+="[^"]*"/g,""),a={title:n.trim(),body:i,tags:h,coverImage:p.trim(),status:o};if(console.log("Saving article data:",a),e)try{let r=await (0,s.iZ)(e,a);console.log("Article updated successfully:",r?.title),x(!0),await new Promise(e=>setTimeout(e,500));let o=await (0,s.getArticleById)(e);console.log("Fetched updated article data:",o?.title),t?(console.log("Calling onUpdateComplete callback instead of navigating"),t(o)):(console.log("No callback provided, navigating to article page"),setTimeout(()=>{window.location.href=`/articles/${e}/view?updated=true&time=${Date.now()}`},1e3))}catch(e){console.error("Error updating article:",e),C("Failed to update article. Please try again."),x(!1)}else{let e=await (0,s.N6)(a);"published"===o?r.push(`/articles/${e.id}`):r.push("/dashboard")}}catch(e){console.error("Error saving article:",e),C("Failed to save article. Please try again.")}finally{y(!1),v(!1)}},q=async()=>{if(!u.trim())return void C("Content is required");v(!0),await O("published")},R=async()=>{await O("drafts")};return I?(0,o.jsxs)("div",{className:T().composerLoading,children:[(0,o.jsx)("div",{className:T().loadingIndicator}),(0,o.jsx)("p",{children:"Loading article..."})]}):(0,o.jsxs)("div",{className:T().articleComposer,children:[(0,o.jsxs)("header",{className:T().composerHeader,children:[(0,o.jsx)("div",{className:T().logoContainer,children:(0,o.jsx)("div",{className:T().logo,children:"Journalite"})}),(0,o.jsxs)("div",{className:T().actionButtons,children:[w&&(0,o.jsxs)("span",{className:T().savedIndicator,children:[(0,o.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,o.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,o.jsx)("button",{className:T().actionButton,onClick:R,disabled:b||_,children:"Save draft"}),(0,o.jsx)("button",{className:T().publishButton,onClick:q,disabled:b||_||!n.trim()||!u.trim(),children:e?"Update":"Publish"})]})]}),(0,o.jsxs)("main",{className:T().composerContent,children:[(0,o.jsx)("textarea",{ref:S,className:T().titleInput,value:n,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1}),(0,o.jsxs)("div",{className:T().coverImageInput,children:[(0,o.jsx)("input",{type:"text",value:p,onChange:e=>{f(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:T().imageUrlInput}),p&&(0,o.jsx)("div",{className:T().coverImagePreview,children:(0,o.jsx)("img",{src:p,alt:"Cover preview"})})]}),(0,o.jsxs)("div",{className:T().tagContainer,children:[h.map(e=>(0,o.jsxs)("div",{className:T().tag,children:[e,(0,o.jsx)("button",{className:T().removeTagButton,onClick:()=>L(e),"aria-label":`Remove ${e} tag`,children:"\xd7"})]},e)),h.length<5&&(0,o.jsx)("input",{ref:H,type:"text",value:D,onChange:e=>{M(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),U())},onBlur:U,placeholder:0===h.length?"Add up to 5 tags...":"Add another tag...",className:T().tagInput})]}),j&&(0,o.jsx)("div",{className:T().errorMessage,children:j}),(0,o.jsx)("div",{className:T().editorContainer,children:(0,o.jsx)(N,{ref:z,articleId:e||(0,l.A)(),initialContent:u,onChange:W,placeholder:"Tell your story..."})})]}),(0,o.jsx)(B,{onInsert:e=>{z.current&&z.current.insertText?z.current.insertText("\n\n"+e+"\n\n"):g(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{z.current&&z.current.focus&&z.current.focus()},100)}})]})}},85540:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",modernToolbar:"Editor_modernToolbar__VDG5b",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}}};