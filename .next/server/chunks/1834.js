exports.id=1834,exports.ids=[1834],exports.modules={79440:(e,t,r)=>{"use strict";r.d(t,{GE:()=>l,N6:()=>o,a:()=>d,getArticleById:()=>i,iZ:()=>c,l6:()=>n,zE:()=>u});var s=r(75535),a=r(43649);async function l(e={}){let{limit:t,includeDrafts:r=!1}=e;try{let e=(0,s.collection)(a.db,"articles"),l=[];r||l.push((0,s.where)("status","==","published")),l.push((0,s.orderBy)("createdAt","desc")),t&&t>0&&l.push((0,s.limit)(t));let i=(0,s.query)(e,...l),n=await (0,s.getDocs)(i),o=[];return n.forEach(e=>{let t=e.data();o.push({id:e.id,...t})}),o}catch(e){throw console.error("Error getting articles:",e),e}}async function i(e){Date.now();try{let t=(0,s.doc)(a.db,"articles",e),r=await (0,s.getDoc)(t);if(!r.exists())return null;return{id:r.id,...r.data()}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function n(e){let t=0;for(;t<3;){t++;try{let r=(0,s.collection)(a.db,"articles"),l=(0,s.query)(r,(0,s.where)("slug","==",e),(0,s.where)("status","==","published"),(0,s.limit)(1)),i=await (0,s.getDocs)(l);if(i.empty)if(3===t)break;else await new Promise(e=>setTimeout(e,1e3));else{let e=i.docs[0];return{id:e.id,...e.data()}}}catch(e){if(console.error("Error getting article by slug:",e),3===t)throw e}}return null}async function o(e){try{let t=a.j2.currentUser;if(!t)throw Error("You must be logged in to create an article");let r={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:s.Timestamp.now(),authorId:t.uid,authorName:t.displayName||t.email?.split("@")[0]||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[],hasReflectionRoom:e.hasReflectionRoom||!1};return{id:(await (0,s.addDoc)((0,s.collection)(a.db,"articles"),r)).id,...r}}catch(e){throw console.error("Error creating article:",e),e}}async function c(e,t){try{let r=a.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let l=(0,s.doc)(a.db,"articles",e),i=await (0,s.getDoc)(l);if(!i.exists())throw Error("Article not found");if(i.data().authorId!==r.uid)throw Error("You can only edit your own articles");let n={...t};t.title&&(n.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,"")),n.updatedAt=s.Timestamp.now(),await (0,s.updateDoc)(l,n);let o=await (0,s.getDoc)(l);if(!o.exists())return{id:e,...n,createdAt:s.Timestamp.now(),updatedAt:s.Timestamp.now()};{let e=o.data();return{id:o.id,...e}}}catch(e){throw console.error("Error updating article:",e),e}}async function d(e){try{let t=a.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,s.doc)(a.db,"articles",e),l=await (0,s.getDoc)(r);if(!l.exists())throw Error("Article not found");if(l.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,s.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function u(e,t={}){let{limit:r}=t;try{let t=(0,s.collection)(a.db,"articles"),l=[(0,s.where)("tags","array-contains",e),(0,s.where)("status","==","published"),(0,s.orderBy)("createdAt","desc")];r&&r>0&&l.push((0,s.limit)(r));let i=(0,s.query)(t,...l),n=await (0,s.getDocs)(i),o=[];return n.forEach(e=>{o.push({id:e.id,...e.data()})}),o}catch(e){throw console.error("Error getting articles by tag:",e),e}}r(28163)},85540:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",seamlessEditor:"Editor_seamlessEditor__2leHe",modernToolbar:"Editor_modernToolbar__VDG5b",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}},91834:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var s=r(60687),a=r(43210),l=r.n(a),i=r(16189),n=r(88645),o=r(79440),c=r(43649),d=r(75535);async function u(e,t){let r=c.j2.currentUser;if(!r)throw Error("Authentication required");try{let s=(0,d.doc)(c.db,"articles",e);await (0,d.updateDoc)(s,{hasReflectionRoom:!0,updatedAt:(0,d.serverTimestamp)()});let a=(0,d.doc)(c.db,"reflections",e,"metadata","main");await (0,d.setDoc)(a,{topic:t,createdAt:(0,d.serverTimestamp)(),authorId:r.uid})}catch(e){throw console.error("Error enabling reflection room:",e),e}}async function h(e,t){if(!c.j2.currentUser)throw Error("Authentication required");try{let r=(0,d.collection)(c.db,"reflections",e,"messages"),s=(await (0,d.getDocs)(r)).docs.map(e=>(0,d.deleteDoc)(e.ref));await Promise.all(s);let a=(0,d.doc)(c.db,"reflections",e,"metadata","main");await (0,d.updateDoc)(a,{topic:t,updatedAt:(0,d.serverTimestamp)()})}catch(e){throw console.error("Error updating reflection topic:",e),e}}r(53764);var m=r(35857);r(98031);var g=r(19954),p=r(67800),x=r(51040);r(31224),r(90021),r(23684);var f=r(81553);let b=new f.Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>[`h${e.attrs.level}`,0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:s,width:a,height:l}=e.attrs,i={src:t};return null!=r&&(i.alt=r),null!=s&&(i.title=s),null!=a&&(i.width=a),null!=l&&(i.height=l),["img",i]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,attrs:{language:{default:"javascript"}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs(e){let t=e.getAttribute("data-language");if(t)return{language:t};let r=e.querySelector("code");if(r){let e=(r.className||"").match(/language-(\w+)/);if(e)return{language:e[1]}}return{language:"javascript"}},getContent(e,t){let r=e.querySelector("code");if(r){let e=r.textContent||r.innerText||"";return e?[t.text(e)]:[]}return[]}}],toDOM:e=>["pre",{"data-language":e.attrs.language},["code",{class:`language-${e.attrs.language}`},0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:s}=e.attrs,a={href:t};return null!=r&&(a.title=r),null!=s&&(a.target=s),["a",a,0]}}}}),v=(e,t)=>(r,s,a)=>{let l=!1;(0,p.T2)(t)(r,s,a)&&(r=a.state,l=!0);let i=e(r,s,a);return l||i},{heading:y,paragraph:j,list_item:w,blockquote:N}=b.nodes,k=e=>v((0,g.y_)(y,{level:e}),w),C=()=>v((0,g.y_)(j),w),E=(e,t,r)=>{let{from:s,to:a}=e.selection,l=!1;return(e.doc.nodesBetween(s,a,e=>e.type!==N||(l=!0,!1)),l)?!!(0,p.T2)(w)(e,t)||(0,g.yY)(e,t):((0,p.T2)(w)(e,t)&&(e=r.state),(0,g.Im)(N)(e,t,r))};new m.k_({key:new m.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:s}=e,{$from:a,empty:l}=r.selection,{heading:i,paragraph:n}=b.nodes;return!!l&&a.parent.type===i&&a.parentOffset===a.parent.content.size&&(t.preventDefault(),(0,g.y_)(n)(r,s,e))}}}),r(46997),r(57894),r(8990),r(68960),r(36014),r(71454),r(25865),r(92623),r(25119),r(29173),r(65848),r(88224),r(35630),r(14321),r(48541),r(83075),r(29731),r(34425),r(61707),r(11566),r(86908);var _=r(85540),D=r.n(_);let $=l().forwardRef(({articleId:e,initialContent:t="",onChange:r,placeholder:i="Tell your story...",className:n=""},o)=>{let c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useRef)(r),[h,m]=(0,a.useState)(!1);u.current=r;let v=(0,a.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current,{selection:s}=t,a=b.text(e);r(t.tr.replaceSelectionWith(a)),d.current.focus()},[]);l().useImperativeHandle(o,()=>({insertText:v,focus:()=>d.current?.focus()}),[v]),(0,a.useEffect)(()=>{},[]),(0,a.useEffect)(()=>{if(d.current&&h&&t)try{let e=function(e){if(!e||""===e.trim())return b.node("doc",null,[b.node("paragraph")]);let t=document.createElement("div");return t.innerHTML=e,f.S4.fromSchema(b).parse(t)}(t),r=function(e){let t=document.createElement("div");return t.appendChild(f.ZF.fromSchema(b).serializeFragment(e.content)),t.innerHTML}(d.current.state.doc);if(t!==r){let t=d.current.state.tr.replaceWith(0,d.current.state.doc.content.size,e.content);d.current.dispatch(t)}}catch(e){console.error("Editor: Failed to update content:",e)}},[t,h]);let y=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.wh)(b.marks.strong)(e,t)&&d.current.focus()},[]),j=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.wh)(b.marks.em)(e,t)&&d.current.focus()},[]),w=(0,a.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current;k(e)(t,r,d.current)&&d.current.focus()},[]);(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;C()(e,t,d.current)&&d.current.focus()},[]);let N=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;E(e,t,d.current)&&d.current.focus()},[]),_=(0,a.useCallback)(()=>{if(!d.current)return;let e=prompt("Enter programming language (e.g., javascript, python, css):","javascript");if(!e)return;let{state:t,dispatch:r}=d.current,{from:s,to:a}=t.selection,l=b.nodes.code_block.create({language:e.toLowerCase()}),i=t.tr.replaceRangeWith(s,a,l);r&&(r(i),d.current.focus())},[]),$=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current,{$from:r,$to:s}=e.selection;try{let a=b.nodes.list_item.create(null,b.nodes.paragraph.create(null,r.parent.content)),l=b.nodes.bullet_list.create(null,a),i=e.tr.replaceWith(r.start(),s.end(),l);t(i),d.current.focus()}catch(r){(0,p.Sd)(b.nodes.bullet_list)(e,t)&&d.current.focus()}},[]),M=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current,{$from:r,$to:s}=e.selection;try{let a=b.nodes.list_item.create(null,b.nodes.paragraph.create(null,r.parent.content)),l=b.nodes.ordered_list.create(null,a),i=e.tr.replaceWith(r.start(),s.end(),l);t(i),d.current.focus()}catch(r){(0,p.Sd)(b.nodes.ordered_list)(e,t)&&d.current.focus()}},[]),A=(0,a.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&d.current){let{state:t,dispatch:r}=d.current,s=b.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(s)),d.current.focus()}},[]),S=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,x.tN)(e,t),d.current.focus()},[]),H=(0,a.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,x.ZS)(e,t),d.current.focus()},[]),z=(0,a.useCallback)(e=>{if(!d.current)return!1;let{from:t,$from:r,to:s,empty:a}=d.current.state.selection;return a?e.isInSet(d.current.state.storedMarks||r.marks()):d.current.state.doc.rangeHasMark(t,s,e)},[]),T=(0,a.useCallback)((e,t={})=>{if(!d.current)return!1;let{from:r,to:s}=d.current.state.selection,a=!0;return d.current.state.doc.nodesBetween(r,s,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(a=!1,!1)),a},[]),B=(0,a.useCallback)(()=>{if(!d.current)return!1;let{from:e,to:t}=d.current.state.selection,r=!1;return d.current.state.doc.nodesBetween(e,t,e=>e.type!==b.nodes.blockquote||(r=!0,!1)),r},[]);return(0,s.jsxs)("div",{className:`${D().editor} ${"seamless-editor"===n?D().seamlessEditor:""}`,style:"seamless-editor"===n?{}:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[h&&(0,s.jsx)("div",{className:D().modernToolbar,style:"seamless-editor"===n?{}:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,s.jsxs)("div",{className:D().toolbarContainer,children:[(0,s.jsxs)("div",{className:D().formatGroup,children:[(0,s.jsx)("button",{className:`${D().toolBtn} ${z(b.marks.strong)?D().active:""}`,onClick:y,title:"Bold (⌘B)","aria-label":"Bold",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,s.jsx)("button",{className:`${D().toolBtn} ${z(b.marks.em)?D().active:""}`,onClick:j,title:"Italic (⌘I)","aria-label":"Italic",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,s.jsx)("div",{className:D().divider}),(0,s.jsxs)("div",{className:D().formatGroup,children:[(0,s.jsx)("button",{className:`${D().toolBtn} ${T(b.nodes.heading,{level:1})?D().active:""}`,onClick:()=>w(1),title:"Large Heading (⌘⇧1)","aria-label":"Heading 1",children:(0,s.jsx)("span",{className:D().headingIcon,children:"H1"})}),(0,s.jsx)("button",{className:`${D().toolBtn} ${T(b.nodes.heading,{level:2})?D().active:""}`,onClick:()=>w(2),title:"Medium Heading (⌘⇧2)","aria-label":"Heading 2",children:(0,s.jsx)("span",{className:D().headingIcon,children:"H2"})}),(0,s.jsx)("button",{className:`${D().toolBtn} ${T(b.nodes.heading,{level:3})?D().active:""}`,onClick:()=>w(3),title:"Small Heading (⌘⇧3)","aria-label":"Heading 3",children:(0,s.jsx)("span",{className:D().headingIcon,children:"H3"})})]}),(0,s.jsx)("div",{className:D().divider}),(0,s.jsxs)("div",{className:D().formatGroup,children:[(0,s.jsx)("button",{className:D().toolBtn,onClick:$,title:"Bullet List","aria-label":"Bullet list",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,s.jsx)("button",{className:D().toolBtn,onClick:M,title:"Numbered List","aria-label":"Numbered list",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,s.jsx)("button",{className:`${D().toolBtn} ${B()?D().active:""}`,onClick:N,title:"Quote (⌘>)","aria-label":"Quote",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,s.jsx)("div",{className:D().divider}),(0,s.jsxs)("div",{className:D().formatGroup,children:[(0,s.jsx)("button",{className:D().toolBtn,onClick:A,title:"Add Image","aria-label":"Insert image",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,s.jsx)("button",{className:`${D().toolBtn} ${T(b.nodes.code_block)?D().active:""}`,onClick:_,title:"Code Block","aria-label":"Code block",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,s.jsx)("div",{className:D().divider}),(0,s.jsxs)("div",{className:D().formatGroup,children:[(0,s.jsx)("button",{className:D().toolBtn,onClick:S,title:"Undo (⌘Z)","aria-label":"Undo",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,s.jsx)("button",{className:D().toolBtn,onClick:H,title:"Redo (⌘Y)","aria-label":"Redo",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!h&&(0,s.jsxs)("div",{className:D().loading,children:[(0,s.jsx)("div",{className:D().loadingSpinner}),(0,s.jsx)("span",{children:"Loading editor..."})]}),(0,s.jsx)("div",{ref:c,className:D().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"seamless-editor"===n?"500px":"400px",opacity:h?1:.3,..."seamless-editor"===n?{background:"transparent",border:"none",boxShadow:"none",padding:0,margin:0,fontSize:"18px",lineHeight:"1.6",color:"#1f2937"}:{}}})]})});$.displayName="Editor";var M=r(45306),A=r(41120),S=r(5062),H=r.n(S);let z=({onInsert:e})=>{let[t,r]=(0,a.useState)(!1),[l,i]=(0,a.useState)([]),[n,o]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)("inspirations"),m=async()=>{d(!0);try{let[e,t]=await Promise.all([(0,M.Aq)(),(0,M.Gy)()]);i(e),o(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{d(!1)}},g=t=>{e&&e(t),r(!1)},p=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||`Write about ${e}...`;return t?(0,s.jsx)("div",{className:"fixed bottom-8 right-8 z-40 w-96",children:(0,s.jsxs)("div",{className:`${H()["glass-modal"]} max-h-96 overflow-hidden`,children:[(0,s.jsx)("div",{className:H()["glass-highlight"]}),(0,s.jsxs)("div",{className:H()["glass-content"],children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/20",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold text-stone-800 flex items-center gap-2 font-serif",children:[(0,s.jsx)(A.TG,{size:18,color:"#f59e0b"}),"Your Reflection Insights"]}),(0,s.jsx)("button",{onClick:()=>r(!1),className:"text-stone-500 hover:text-stone-700 text-xl font-bold leading-none",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex p-4 gap-2",children:[(0,s.jsxs)("button",{className:`${H()["glass-tag"]} flex-1 text-center py-2 text-sm font-semibold transition-all ${"inspirations"===u?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"}`,onClick:()=>h("inspirations"),children:["Recent Thoughts (",l.length,")"]}),(0,s.jsxs)("button",{className:`${H()["glass-tag"]} flex-1 text-center py-2 text-sm font-semibold transition-all ${"themes"===u?"bg-blue-500/20 text-blue-700 border-blue-300/30":"hover:bg-white/20"}`,onClick:()=>h("themes"),children:["Writing Themes (",n.length,")"]})]}),(0,s.jsx)("div",{className:"p-4 max-h-64 overflow-y-auto",children:c?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-stone-600",children:"Loading your insights..."})]}):"inspirations"===u?(0,s.jsx)("div",{children:0===l.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,s.jsx)(A.d3,{size:16,color:"#6b7280"}),(0,s.jsx)("p",{className:"font-semibold",children:"No reflections yet!"})]}),(0,s.jsx)("p",{className:"text-sm text-stone-500",children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Your past reflections that might spark new ideas:"}),(0,s.jsx)("div",{className:"space-y-3",children:l.map((e,t)=>(0,s.jsxs)("div",{className:`${H()["glass-card"]} p-4`,children:[(0,s.jsx)("div",{className:H()["glass-card-highlight"]}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("p",{className:"text-sm text-stone-700 italic mb-2",children:['"',e.response,'"']}),e.articleTitle&&(0,s.jsxs)("p",{className:"text-xs text-stone-500 mb-3",children:["From: ",e.articleTitle]}),(0,s.jsx)("button",{onClick:()=>{let t=e.articleTitle?` (inspired by "${e.articleTitle}")`:"";g(`"${e.response}"${t} - This reminds me of...`)},className:`${H()["glass-button"]} ${H()["glass-button-primary"]} text-xs px-3 py-1 w-full`,children:"Use as starting point"})]})]},t))})]})}):(0,s.jsx)("div",{children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-stone-500 mb-2",children:[(0,s.jsx)(A.v1,{size:16,color:"#6b7280"}),(0,s.jsx)("p",{className:"font-semibold",children:"No themes identified yet!"})]}),(0,s.jsx)("p",{className:"text-sm text-stone-500",children:"Keep reflecting on articles to discover your writing themes."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-stone-600 mb-4 font-semibold",children:"Writing prompts based on your reflection patterns:"}),(0,s.jsx)("div",{className:"space-y-3",children:n.map((e,t)=>(0,s.jsxs)("div",{className:`${H()["glass-card"]} p-4`,children:[(0,s.jsx)("div",{className:H()["glass-card-highlight"]}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsx)("div",{className:`${H()["glass-tag"]} inline-block mb-2 text-xs`,children:e}),(0,s.jsx)("p",{className:"text-sm text-stone-700 mb-3",children:p(e)}),(0,s.jsx)("button",{onClick:()=>g(p(e)),className:`${H()["glass-button"]} ${H()["glass-button-primary"]} text-xs px-3 py-1 w-full`,children:"Start writing"})]})]},t))})]})})}),(0,s.jsx)("div",{className:"p-4 border-t border-white/20",children:(0,s.jsx)("button",{onClick:m,className:`${H()["glass-button"]} text-sm px-4 py-2 w-full disabled:opacity-50`,disabled:c,children:"\uD83D\uDD04 Refresh insights"})})]})]})}):(0,s.jsx)("div",{className:"fixed bottom-8 right-8 z-40",children:(0,s.jsxs)("button",{onClick:()=>{t||m(),r(!t)},className:`${H()["glass-button"]} ${H()["glass-button-primary"]} flex items-center gap-2 px-6 py-4 text-sm font-semibold`,title:"Get inspiration from your reflections",children:[(0,s.jsx)(A.Y_,{size:16,color:"currentColor"}),"Inspiration"]})})},T=({articleId:e,onUpdateComplete:t,backToArticleAction:r,editingTitle:l})=>{let m=(0,i.useRouter)(),[g,p]=(0,a.useState)(""),[x,f]=(0,a.useState)(""),[b,v]=(0,a.useState)([]),[y,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(!1),[k,C]=(0,a.useState)(!1),[E,_]=(0,a.useState)(!1),[D,M]=(0,a.useState)(""),[A,S]=(0,a.useState)(!!e),[T,B]=(0,a.useState)(null),[R,L]=(0,a.useState)(""),[I,O]=(0,a.useState)(!1),[W,q]=(0,a.useState)(""),[U,F]=(0,a.useState)(""),G=(0,a.useRef)(null),Y=(0,a.useRef)(null),V=(0,a.useRef)(null),P=(0,a.useCallback)(()=>{G.current&&(G.current.style.height="auto",G.current.style.height=`${G.current.scrollHeight}px`,!g&&G.current&&G.current.focus())},[g]);(0,a.useEffect)(()=>{let e=c.j2.onAuthStateChanged(e=>{B(e),e||m.push("/login?redirect=compose")});return()=>e()},[m]),(0,a.useEffect)(()=>{let t=setTimeout(async()=>{if(e&&I&&T&&W.trim()&&U&&W.trim()!==U.trim())try{await h(e,W.trim()),F(W.trim())}catch(e){console.error("Error updating reflection topic:",e),q(U)}},1e3);return()=>clearTimeout(t)},[W,e,I,T,U]),(0,a.useEffect)(()=>{e&&T?(async()=>{try{S(!0);let t=await (0,d.getDoc)((0,d.doc)(c.db,"articles",e));if(!t.exists())return void M("Article not found");let r={id:t.id,...t.data()};if(r.authorId!==T.uid)return void M("You can only edit your own articles");if(p(r.title),f(r.body||""),v(r.tags||[]),j(r.coverImage||""),O(r.hasReflectionRoom||!1),r.hasReflectionRoom)try{let t=(0,d.doc)(c.db,"reflections",e,"metadata","main"),r=await (0,d.getDoc)(t);if(r.exists()){let e=r.data().topic||"";q(e),F(e)}}catch(e){console.error("Error loading reflection room topic:",e)}}catch(e){console.error("Error loading article:",e),M("Failed to load article")}finally{S(!1)}})():e||S(!1)},[e,T,m]),(0,a.useEffect)(()=>{P()},[g,P]),(0,a.useEffect)(()=>{let e;return T&&g.trim()&&x.trim()&&!k&&!w&&(e=setTimeout(()=>{X("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[T,g,x,k,w]);let K=(0,a.useCallback)((e,t)=>{f(t=>e!==t?(E&&_(!1),e):t)},[E]),Z=()=>{let e=R.trim().toLowerCase();e&&!b.includes(e)&&b.length<5&&(v([...b,e]),L(""))},Q=e=>{v(b.filter(t=>t!==e))},J=e=>{j(e.target.value)},X=async(r="drafts")=>{if(!T)return void M("You must be logged in to save articles");if(!g.trim())return void M("Title is required");try{M(""),C(!0);let s=g.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),a={title:g.trim(),body:x,tags:b,coverImage:y,status:r,authorId:T.uid,authorName:T.displayName||T.email||"Anonymous",slug:s,hasReflectionRoom:I};if(e)try{let r=await (0,o.iZ)(e,a);if(I&&W.trim())try{await u(e,W.trim())}catch(e){console.error("Error setting up reflection room:",e)}_(!0),t?t(r):setTimeout(()=>{m.push(`/articles/?slug=${s}`)},1e3)}catch(e){console.error("Error updating article:",e),M("Failed to update article. Please try again."),_(!1)}else{let e=await (0,o.N6)(a);if(I&&W.trim()&&e?.id)try{await u(e.id,W.trim())}catch(e){console.error("Error setting up reflection room for new article:",e)}"published"===r?m.push(`/articles/?slug=${s}`):m.push("/dashboard")}}catch(e){console.error("Error saving article:",e),M("Failed to save article. Please try again.")}finally{C(!1),N(!1)}},ee=async()=>{if(!x.trim())return void M("Content is required");N(!0),await X("published")},et=async()=>{await X("drafts")};return A?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed"},children:(0,s.jsxs)("div",{className:H()["glass-loading"],children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-stone-600 text-lg",children:"Loading your article..."})]})}):(0,s.jsxs)("div",{className:`${H()["glass-container"]} min-h-screen w-full`,style:{background:"linear-gradient(135deg, #f0f9ff 0%, #f7fafc 20%, #fef7ff 40%, #f0fdfa 60%, #fff7ed 80%, #f3f4f6 100%)",backgroundAttachment:"fixed",position:"relative",borderRadius:"0px",border:"none"},children:[(0,s.jsx)("div",{className:H()["glass-highlight"]}),(0,s.jsxs)("header",{className:`${H()["glass-container"]} fixed top-6 left-6 right-6 z-50 max-w-6xl mx-auto`,style:{backdropFilter:"blur(20px) saturate(180%)"},children:[(0,s.jsx)("div",{className:H()["glass-highlight"]}),(0,s.jsxs)("div",{className:`${H()["glass-content"]} flex items-center justify-between p-4`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[r?(0,s.jsxs)("button",{onClick:r,className:`${H()["glass-button"]} flex items-center gap-2 px-3 py-2 text-sm font-medium text-stone-700 hover:text-stone-900 transition-colors`,children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"})}),"Back to Article"]}):(0,s.jsx)("div",{className:"text-xl font-bold text-stone-800 font-serif",children:"Journalite"}),(0,s.jsx)("div",{className:"text-stone-500 text-sm",children:e?l?`Editing: ${l}`:"Editing":"Writing"}),E&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:(0,s.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:`${H()["glass-button"]} px-4 py-2 text-sm font-semibold disabled:opacity-50`,onClick:et,disabled:k||w,children:k?"Saving...":"Save Draft"}),(0,s.jsx)("button",{className:`${H()["glass-button"]} ${H()["glass-button-primary"]} px-4 py-2 text-sm font-semibold disabled:opacity-50`,onClick:ee,disabled:k||w||!g.trim()||!x.trim(),children:w?"Publishing...":e?"Update":"Publish"})]})]})]}),(0,s.jsxs)("div",{className:`${H()["glass-content"]} pt-32 pb-16 min-h-screen w-full max-w-4xl mx-auto`,style:{paddingLeft:"64px",paddingRight:"64px"},children:[(0,s.jsx)("textarea",{ref:G,value:g,onChange:e=>{p(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1,className:"w-full bg-transparent border-none outline-none resize-none overflow-hidden text-5xl font-bold text-stone-800 placeholder-stone-400 font-serif leading-tight mb-8 focus:outline-none",style:{minHeight:"60px"}}),(y||g.length>10)&&(0,s.jsxs)("div",{className:"mb-8",children:[!y&&(0,s.jsx)("input",{type:"text",value:y,onChange:J,placeholder:"Add a cover image URL...",className:"w-full bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 py-2 border-b border-stone-200 focus:border-stone-400 transition-colors"}),y&&(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("img",{src:y,alt:"Cover",className:"w-full h-64 object-cover rounded-2xl mb-4"}),(0,s.jsx)("input",{type:"text",value:y,onChange:J,placeholder:"Cover image URL...",className:"w-full bg-white/70 backdrop-blur border border-stone-200 outline-none text-stone-600 placeholder-stone-400 py-1.5 px-3 rounded-md focus:border-stone-400 transition-colors"})]})]}),(b.length>0||g.length>5)&&(0,s.jsxs)("div",{className:"mb-8 flex flex-wrap gap-2 items-center",children:[b.map(e=>(0,s.jsxs)("div",{className:"px-2.5 py-0.5 bg-blue-100/50 backdrop-blur text-blue-700 rounded-full text-sm font-medium flex items-center gap-1.5",children:[e,(0,s.jsx)("button",{className:"text-blue-600 hover:text-blue-800 font-bold text-base leading-none",onClick:()=>Q(e),"aria-label":`Remove ${e} tag`,children:"\xd7"})]},e)),b.length<5&&(0,s.jsx)("input",{ref:Y,type:"text",value:R,onChange:e=>{L(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),Z())},onBlur:Z,placeholder:0===b.length?"Add tags...":"Add tag...",className:"bg-transparent border-none outline-none text-stone-600 placeholder-stone-400 min-w-24 py-1"})]}),g.length>5&&(0,s.jsxs)("div",{className:"mb-8 p-4 bg-white/50 backdrop-blur border border-stone-200/50 rounded-xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"hasReflectionRoom",checked:I,onChange:e=>{O(e.target.checked),e.target.checked||q("")},className:"w-4 h-4 text-blue-600 bg-white border-stone-300 rounded focus:ring-blue-500 focus:ring-2"}),(0,s.jsx)("label",{htmlFor:"hasReflectionRoom",className:"text-sm font-medium text-stone-700 cursor-pointer",children:"Enable Reflection Room"})]}),(0,s.jsx)("span",{className:"text-xs text-stone-500 bg-stone-100 px-2 py-1 rounded-full",children:"\uD83D\uDCAD Let readers discuss"})]}),I&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("label",{className:"block text-xs font-medium text-stone-600 mb-2",children:["Discussion Topic",e&&U&&(0,s.jsx)("span",{className:"ml-2 text-orange-600 font-normal",children:"(⚠️ Changing this will clear all chat messages)"})]}),(0,s.jsx)("input",{type:"text",value:W,onChange:e=>q(e.target.value),placeholder:"What should readers discuss? (e.g., 'Share your thoughts on the main theme')",maxLength:200,className:"w-full bg-white/70 backdrop-blur border border-stone-200 outline-none text-stone-700 placeholder-stone-400 py-2 px-3 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-100 transition-all text-sm"}),(0,s.jsxs)("div",{className:"text-xs text-stone-500 mt-1",children:[W.length,"/200 characters"]})]}),(0,s.jsx)("p",{className:"text-xs text-stone-500 mt-2",children:"Reflection rooms create a real-time chat sidebar where authenticated readers can discuss your article."})]}),D&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50/80 border border-red-200 rounded-xl text-red-700 text-sm",children:D}),(0,s.jsx)("div",{className:"min-h-[500px] w-full",style:{background:"transparent"},children:(0,s.jsx)($,{ref:V,...{articleId:e||(0,n.A)(),initialContent:x,onChange:K,placeholder:"Write your story...",className:"seamless-editor"}})})]}),(0,s.jsx)(z,{onInsert:e=>{V.current&&V.current.insertText?V.current.insertText("\n\n"+e+"\n\n"):f(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{V.current&&V.current.focus&&V.current.focus()},100)}})]})}}};