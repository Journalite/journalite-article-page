"use strict";exports.id=440,exports.ids=[440],exports.modules={28163:(t,e,r)=>{r.d(e,{Hs:()=>u,N9:()=>c,Ss:()=>a,bA:()=>s,fP:()=>d,fZ:()=>n,he:()=>l});var o=r(75535),i=r(43649);async function n(t,e,r,n,c,a){try{let e=i.j2.currentUser;if(!e||e.uid===t)return null;let s={userId:t,type:"comment",read:!1,sourceId:c,sourceType:"comment",message:`${e.displayName||"Someone"} commented on your article: "${a.substring(0,50)}${a.length>50?"...":""}"`,fromUser:{id:e.uid,name:e.displayName||"Anonymous"},createdAt:o.Timestamp.now(),articleSlug:r,articleTitle:n};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"notifications"),s)).id,...s}}catch(t){return console.error("Error creating notification:",t),null}}async function c(t,e,r,n){try{if(t===r)return null;let c={userId:t,type:"follow",read:!1,sourceId:r,sourceType:"user",message:`${e} (@${n}) started following you`,fromUser:{id:r,name:e,username:n},createdAt:o.Timestamp.now()};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"notifications"),c)).id,...c}}catch(t){return console.error("Error creating follow notification:",t),null}}async function a(t=!1){try{let e,r=i.j2.currentUser;if(!r)throw Error("User not authenticated");let n=(0,o.collection)(i.db,"notifications");e=t?(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.where)("read","==",!1),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100)):(0,o.query)(n,(0,o.where)("userId","==",r.uid),(0,o.orderBy)("createdAt","desc"),(0,o.limit)(100));let c=await (0,o.getDocs)(e),a=[];return c.forEach(t=>{a.push({id:t.id,...t.data()})}),a}catch(t){throw console.error("Error fetching notifications:",t),t}}async function s(t){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",t),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.updateDoc)(r,{read:!0}),{success:!0}}catch(t){throw console.error("Error marking notification as read:",t),t}}async function l(){try{let t=i.j2.currentUser;if(!t)throw Error("User not authenticated");let e=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(e,(0,o.where)("userId","==",t.uid),(0,o.where)("read","==",!1)),n=await (0,o.getDocs)(r),c=n.docs.map(t=>(0,o.updateDoc)(t.ref,{read:!0}));return await Promise.all(c),{success:!0,count:n.size}}catch(t){throw console.error("Error marking all notifications as read:",t),t}}async function d(t){try{let e=i.j2.currentUser;if(!e)throw Error("User not authenticated");let r=(0,o.doc)(i.db,"notifications",t),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==e.uid)throw Error("Unauthorized access to notification");return await (0,o.deleteDoc)(r),{success:!0}}catch(t){throw console.error("Error deleting notification:",t),t}}async function u(){try{let t=i.j2.currentUser;if(!t)return 0;let e=(0,o.collection)(i.db,"notifications"),r=(0,o.query)(e,(0,o.where)("userId","==",t.uid),(0,o.where)("read","==",!1));return(await (0,o.getDocs)(r)).size}catch(t){return console.error("Error counting unread notifications:",t),0}}},79440:(t,e,r)=>{r.d(e,{BC:()=>m,GE:()=>c,N6:()=>l,Oe:()=>g,Tu:()=>w,a:()=>f,fz:()=>u,getArticleById:()=>a,iZ:()=>d,l6:()=>s,tT:()=>h,zE:()=>y});var o=r(75535),i=r(43649),n=r(28163);async function c(t={}){let{limit:e,includeDrafts:r=!1}=t;console.log("getArticles called with limit:",e);try{let t=(0,o.collection)(i.db,"articles"),n=[];r||n.push((0,o.where)("status","==","published")),n.push((0,o.orderBy)("createdAt","desc")),e&&e>0&&(console.log("Adding limit constraint:",e),n.push((0,o.limit)(e)));let c=(0,o.query)(t,...n),a=await (0,o.getDocs)(c);console.log("Query returned document count:",a.size);let s=[];return a.forEach(t=>{let e=t.data();s.push({id:t.id,...e})}),s}catch(t){throw console.error("Error getting articles:",t),t}}async function a(t){try{let e=Date.now();console.log(`üîÑ DIRECT FETCH: Getting article with ID: ${t} (time: ${e})`);let r=(0,o.doc)(i.db,"articles",t),n=await (0,o.getDoc)(r);if(!n.exists())return console.log("‚ùå Article not found for ID:",t),null;{let t={id:n.id,...n.data()};return console.log("‚úÖ Article found:",t.title),console.log("\uD83D\uDCC4 Content length:",t.body?.length||0),console.log("\uD83C\uDFF7Ô∏è Tags:",t.tags?.join(", ")||"none"),t}}catch(t){throw console.error("\uD83D\uDED1 Error getting article:",t),t}}async function s(t){try{console.log(`Getting article by slug: ${t}, timestamp: ${Date.now()}`);let e=0;for(;e<2;){e++,console.log(`Attempt ${e} to get article by slug`),e>1&&await new Promise(t=>setTimeout(t,500));let r=(0,o.collection)(i.db,"articles"),n=(0,o.query)(r,(0,o.where)("slug","==",t),(0,o.where)("status","==","published")),c=await (0,o.getDocs)(n);if(c.empty){if(e>=2){console.log("Article not found for slug after multiple attempts:",t);break}}else{let t=c.docs[0],e={id:t.id,...t.data()};return console.log("Article found by slug:",e.title,"Content length:",e.body?.length||0),e}console.log(`Article not found by slug on attempt ${e}, will retry...`)}return null}catch(t){throw console.error("Error getting article by slug:",t),t}}async function l(t){try{let e=i.j2.currentUser;if(!e)throw Error("You must be logged in to create an article");let r={title:t.title,body:t.body,slug:t.slug||t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:o.Timestamp.now(),authorId:e.uid,authorName:e.displayName||e.email?.split("@")[0]||"Anonymous",tags:t.tags||[],status:t.status||"published",coverImage:t.coverImage||null,likes:[],excerpt:t.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,o.addDoc)((0,o.collection)(i.db,"articles"),r)).id,...r}}catch(t){throw console.error("Error creating article:",t),t}}async function d(t,e){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let n=(0,o.doc)(i.db,"articles",t),c=await (0,o.getDoc)(n);if(!c.exists())throw Error("Article not found");if(c.data().authorId!==r.uid)throw Error("You can only edit your own articles");let a={...e};e.title&&(a.slug=e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",a.slug)),a.updatedAt=o.Timestamp.now(),await (0,o.updateDoc)(n,a);let s=await (0,o.getDoc)(n);return{id:s.id,...s.data()}}catch(t){throw console.error("Error updating article:",t),t}}async function u(t){try{let e=(0,o.collection)(i.db,"articles",t,"comments"),r=(0,o.query)(e,(0,o.orderBy)("createdAt","desc")),n=await (0,o.getDocs)(r),c=[];return n.forEach(t=>{let e=t.data();c.push({id:t.id,commentId:t.id,...e,replies:e.replies||[]})}),c}catch(t){throw console.error("Error getting comments:",t),t}}async function m(t,e){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to comment");let c={userId:r.uid,userName:r.displayName||r.email?.split("@")[0]||"Anonymous",content:e,createdAt:o.Timestamp.now(),likes:[],replies:[]},s=await (0,o.addDoc)((0,o.collection)(i.db,"articles",t,"comments"),c),l=await a(t);return l&&l.authorId!==r.uid&&await (0,n.fZ)(l.authorId,t,l.slug||"",l.title||"Article",s.id,e),{id:s.id,commentId:s.id,...c}}catch(t){throw console.error("Error adding comment:",t),t}}async function g(t,e,r){try{let n=i.j2.currentUser;if(!n)throw Error("You must be logged in to reply");let c=(0,o.doc)(i.db,"articles",t,"comments",e),s=await (0,o.getDoc)(c);if(!s.exists())throw Error("Comment not found");let l={replyId:Math.random().toString(36).substring(2,15),userId:n.uid,userName:n.displayName||n.email?.split("@")[0]||"Anonymous",content:r,createdAt:o.Timestamp.now(),likes:[]};await (0,o.updateDoc)(c,{replies:(0,o.arrayUnion)(l)});let d=s.data();if(d.userId!==n.uid){let r=await a(t);console.log(`User ${n.uid} replied to comment ${e} by ${d.userId} on article ${r?.title}`)}return l}catch(t){throw console.error("Error adding reply:",t),t}}async function h(t,e){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let n=(0,o.doc)(i.db,"articles",t,"comments",e),c=await (0,o.getDoc)(n);if(!c.exists())throw Error("Comment not found");let a=c.data(),s=r.uid,l=(a.likes||[]).includes(s);await (0,o.updateDoc)(n,{likes:l?(0,o.arrayRemove)(s):(0,o.arrayUnion)(s)});let d=(await (0,o.getDoc)(n)).data();return{success:!0,action:l?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(t){throw console.error("Error liking comment:",t),t}}async function w(t,e){try{let r=i.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let n=(0,o.doc)(i.db,"articles",t,"comments",e),c=await (0,o.getDoc)(n);if(!c.exists())throw Error("Comment not found");if(c.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,o.deleteDoc)(n),{success:!0,message:"Comment deleted successfully"}}catch(t){throw console.error("Error deleting comment:",t),t}}async function f(t){try{let e=i.j2.currentUser;if(!e)throw Error("You must be logged in to delete an article");let r=(0,o.doc)(i.db,"articles",t),n=await (0,o.getDoc)(r);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==e.uid)throw Error("You can only delete your own articles");return await (0,o.deleteDoc)(r),{success:!0,message:"Article deleted successfully"}}catch(t){throw console.error("Error deleting article:",t),t}}async function y(t,e={}){let{limit:r}=e;try{let e=(0,o.collection)(i.db,"articles"),n=[(0,o.where)("tags","array-contains",t),(0,o.where)("status","==","published"),(0,o.orderBy)("createdAt","desc")];r&&r>0&&n.push((0,o.limit)(r));let c=(0,o.query)(e,...n),a=await (0,o.getDocs)(c),s=[];return a.forEach(t=>{s.push({id:t.id,...t.data()})}),s}catch(t){throw console.error("Error getting articles by tag:",t),t}}}};