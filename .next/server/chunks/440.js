exports.id=440,exports.ids=[59,440],exports.modules={28163:(e,t,r)=>{"use strict";r.d(t,{Hs:()=>u,N9:()=>a,Ss:()=>s,bA:()=>l,fP:()=>d,fZ:()=>n,he:()=>c});var i=r(75535),o=r(43649);async function n(e,t,r,n,a,s){try{let t=o.j2.currentUser;if(!t||t.uid===e)return null;let l={userId:e,type:"comment",read:!1,sourceId:a,sourceType:"comment",message:`${t.displayName||"Someone"} commented on your article: "${s.substring(0,50)}${s.length>50?"...":""}"`,fromUser:{id:t.uid,name:t.displayName||"Anonymous"},createdAt:i.Dc.now(),articleSlug:r,articleTitle:n};return{id:(await (0,i.gS)((0,i.rJ)(o.db,"notifications"),l)).id,...l}}catch(e){return console.error("Error creating notification:",e),null}}async function a(e,t,r,n){try{if(e===r)return null;let a={userId:e,type:"follow",read:!1,sourceId:r,sourceType:"user",message:`${t} (@${n}) started following you`,fromUser:{id:r,name:t,username:n},createdAt:i.Dc.now()};return{id:(await (0,i.gS)((0,i.rJ)(o.db,"notifications"),a)).id,...a}}catch(e){return console.error("Error creating follow notification:",e),null}}async function s(e=!1){try{let t,r=o.j2.currentUser;if(!r)throw Error("User not authenticated");let n=(0,i.rJ)(o.db,"notifications");t=e?(0,i.P)(n,(0,i._M)("userId","==",r.uid),(0,i._M)("read","==",!1),(0,i.My)("createdAt","desc"),(0,i.AB)(100)):(0,i.P)(n,(0,i._M)("userId","==",r.uid),(0,i.My)("createdAt","desc"),(0,i.AB)(100));let a=await (0,i.GG)(t),s=[];return a.forEach(e=>{s.push({id:e.id,...e.data()})}),s}catch(e){throw console.error("Error fetching notifications:",e),e}}async function l(e){try{let t=o.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,i.doc)(o.db,"notifications",e),n=await (0,i.x7)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,i.updateDoc)(r,{read:!0}),{success:!0}}catch(e){throw console.error("Error marking notification as read:",e),e}}async function c(){try{let e=o.j2.currentUser;if(!e)throw Error("User not authenticated");let t=(0,i.rJ)(o.db,"notifications"),r=(0,i.P)(t,(0,i._M)("userId","==",e.uid),(0,i._M)("read","==",!1)),n=await (0,i.GG)(r),a=n.docs.map(e=>(0,i.updateDoc)(e.ref,{read:!0}));return await Promise.all(a),{success:!0,count:n.size}}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async function d(e){try{let t=o.j2.currentUser;if(!t)throw Error("User not authenticated");let r=(0,i.doc)(o.db,"notifications",e),n=await (0,i.x7)(r);if(!n.exists())throw Error("Notification not found");if(n.data().userId!==t.uid)throw Error("Unauthorized access to notification");return await (0,i.kd)(r),{success:!0}}catch(e){throw console.error("Error deleting notification:",e),e}}async function u(){try{let e=o.j2.currentUser;if(!e)return 0;let t=(0,i.rJ)(o.db,"notifications"),r=(0,i.P)(t,(0,i._M)("userId","==",e.uid),(0,i._M)("read","==",!1));return(await (0,i.GG)(r)).size}catch(e){return console.error("Error counting unread notifications:",e),0}}},31237:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}},46899:e=>{e.exports={inspirationButton:"InspirationWidget_inspirationButton__RMfVc",inspirationWidget:"InspirationWidget_inspirationWidget__q1gMO",header:"InspirationWidget_header__wZRt7",closeButton:"InspirationWidget_closeButton__qCHBN",tabs:"InspirationWidget_tabs__hfv7d",tab:"InspirationWidget_tab__7hEDY",active:"InspirationWidget_active__CK3jp",content:"InspirationWidget_content__X6qiV",loading:"InspirationWidget_loading__2pTEa",spinner:"InspirationWidget_spinner__Z8Ppp",spin:"InspirationWidget_spin__syiZE",empty:"InspirationWidget_empty__S_QN1",subtitle:"InspirationWidget_subtitle__c_Jph",inspirationItem:"InspirationWidget_inspirationItem__295J_",themeItem:"InspirationWidget_themeItem__oQ_6E",themeTag:"InspirationWidget_themeTag__66K0g",themePrompt:"InspirationWidget_themePrompt__m0Ebn",useButton:"InspirationWidget_useButton__aSW_t",footer:"InspirationWidget_footer__7guyU",refreshButton:"InspirationWidget_refreshButton__yTge0"}},55440:(e,t,r)=>{"use strict";r.d(t,{A:()=>D});var i=r(60687),o=r(43210),n=r.n(o),a=r(16189),s=r(88645),l=r(79440),c=r(43649);r(53764);var d=r(35857);r(98031);var u=r(19954),h=r(67800),g=r(51040);r(31224),r(90021),r(23684);let m=new(r(81553)).Sj({nodes:{doc:{content:"block+"},text:{group:"inline"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:e=>[`h${e.attrs.level}`,0]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),height:e.getAttribute("height")})}],toDOM(e){let{src:t,alt:r,title:i,width:o,height:n}=e.attrs,a={src:t};return null!=r&&(a.alt=r),null!=i&&(a.title=i),null!=o&&(a.width=o),null!=n&&(a.height=n),["img",a]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:e=>({order:e.hasAttribute("start")?+e.getAttribute("start"):1})}],toDOM:e=>1==e.attrs.order?["ol",0]:["ol",{start:e.attrs.order},0]},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:()=>["li",0],defining:!0}},marks:{strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!=e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code",0]},link:{attrs:{href:{},title:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href"),title:e.getAttribute("title"),target:e.getAttribute("target")})}],toDOM(e){let{href:t,title:r,target:i}=e.attrs,o={href:t};return null!=r&&(o.title=r),null!=i&&(o.target=i),["a",o,0]}}}}),p=(e,t)=>(r,i,o)=>{let n=!1;(0,h.T2)(t)(r,i,o)&&(r=o.state,n=!0);let a=e(r,i,o);return n||a},{heading:f,paragraph:_,list_item:b,blockquote:v}=m.nodes,y=e=>p((0,u.y_)(f,{level:e}),b),w=()=>p((0,u.y_)(_),b),x=(e,t,r)=>{let{from:i,to:o}=e.selection,n=!1;return(e.doc.nodesBetween(i,o,e=>e.type!==v||(n=!0,!1)),n)?!!(0,h.T2)(b)(e,t)||(0,u.yY)(e,t):((0,h.T2)(b)(e,t)&&(e=r.state),(0,u.Im)(v)(e,t,r))};new d.k_({key:new d.hs("exitHeading"),props:{handleKeyDown(e,t){if("Enter"!==t.key||t.shiftKey)return!1;let{state:r,dispatch:i}=e,{$from:o,empty:n}=r.selection,{heading:a,paragraph:s}=m.nodes;return!!n&&o.parent.type===a&&o.parentOffset===o.parent.content.size&&(t.preventDefault(),(0,u.y_)(s)(r,i,e))}}});var j=r(85540),C=r.n(j);let I=n().forwardRef(({articleId:e,initialContent:t="",onChange:r,placeholder:a="Tell your story...",className:s=""},l)=>{let c=(0,o.useRef)(null),d=(0,o.useRef)(null),p=(0,o.useRef)(r),[f,_]=(0,o.useState)(!1);p.current=r;let b=(0,o.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current,{selection:i}=t,o=m.text(e);r(t.tr.replaceSelectionWith(o)),d.current.focus()},[]);n().useImperativeHandle(l,()=>({insertText:b,focus:()=>d.current?.focus()}),[b]),(0,o.useEffect)(()=>{},[]);let v=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,u.wh)(m.marks.strong)(e,t)&&d.current.focus()},[]),j=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,u.wh)(m.marks.em)(e,t)&&d.current.focus()},[]),I=(0,o.useCallback)(e=>{if(!d.current)return;let{state:t,dispatch:r}=d.current;y(e)(t,r,d.current)&&d.current.focus()},[]);(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;w()(e,t,d.current)&&d.current.focus()},[]);let k=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;x(e,t,d.current)&&d.current.focus()},[]),N=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,u.y_)(m.nodes.code_block)(e,t)&&d.current.focus()},[]),A=(0,o.useCallback)(()=>{if(!d.current)return;console.log("Bullet list button clicked");let{state:e,dispatch:t}=d.current,{$from:r,$to:i}=e.selection;try{let o=m.nodes.list_item.create(null,m.nodes.paragraph.create(null,r.parent.content)),n=m.nodes.bullet_list.create(null,o),a=e.tr.replaceWith(r.start(),i.end(),n);t(a),console.log("Manual bullet list creation: success"),d.current.focus()}catch(i){console.log("Manual bullet list creation failed:",i);let r=(0,h.Sd)(m.nodes.bullet_list)(e,t);console.log("wrapInList fallback result:",r),r&&d.current.focus()}},[]),E=(0,o.useCallback)(()=>{if(!d.current)return;console.log("Ordered list button clicked");let{state:e,dispatch:t}=d.current,{$from:r,$to:i}=e.selection;try{let o=m.nodes.list_item.create(null,m.nodes.paragraph.create(null,r.parent.content)),n=m.nodes.ordered_list.create(null,o),a=e.tr.replaceWith(r.start(),i.end(),n);t(a),console.log("Manual ordered list creation: success"),d.current.focus()}catch(i){console.log("Manual ordered list creation failed:",i);let r=(0,h.Sd)(m.nodes.ordered_list)(e,t);console.log("wrapInList fallback result:",r),r&&d.current.focus()}},[]),M=(0,o.useCallback)(()=>{let e=prompt("Enter image URL:");if(e&&d.current){let{state:t,dispatch:r}=d.current,i=m.nodes.image.create({src:e,alt:""});r(t.tr.replaceSelectionWith(i)),d.current.focus()}},[]),B=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.tN)(e,t),d.current.focus()},[]),D=(0,o.useCallback)(()=>{if(!d.current)return;let{state:e,dispatch:t}=d.current;(0,g.ZS)(e,t),d.current.focus()},[]),S=(0,o.useCallback)(e=>{if(!d.current)return!1;let{from:t,$from:r,to:i,empty:o}=d.current.state.selection;return o?e.isInSet(d.current.state.storedMarks||r.marks()):d.current.state.doc.rangeHasMark(t,i,e)},[]),T=(0,o.useCallback)((e,t={})=>{if(!d.current)return!1;let{from:r,to:i}=d.current.state.selection,o=!0;return d.current.state.doc.nodesBetween(r,i,r=>!r.isTextblock||!!r.hasMarkup(e,t)||(o=!1,!1)),o},[]),$=(0,o.useCallback)(()=>{if(!d.current)return!1;let{from:e,to:t}=d.current.state.selection,r=!1;return d.current.state.doc.nodesBetween(e,t,e=>e.type!==m.nodes.blockquote||(r=!0,!1)),r},[]);return(0,i.jsxs)("div",{className:C().editor,style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[f&&(0,i.jsx)("div",{className:C().modernToolbar,style:{opacity:1,visibility:"visible",position:"relative",top:"auto",left:"auto",transform:"none",marginBottom:"20px"},children:(0,i.jsxs)("div",{className:C().toolbarContainer,children:[(0,i.jsxs)("div",{className:C().formatGroup,children:[(0,i.jsx)("button",{className:`${C().toolBtn} ${S(m.marks.strong)?C().active:""}`,onClick:v,title:"Bold (‚åòB)","aria-label":"Bold",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M13.5 15.5H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM10 6.5h3c.55 0 1 .45 1 1s-.45 1-1 1h-3v-2zm5.6 4.5c.75-.9 1.2-2.05 1.2-3.3 0-2.76-2.24-5-5-5H6.5C5.67 2.7 5 3.37 5 4.2v15.6c0 .83.67 1.5 1.5 1.5h8.5c3.31 0 6-2.69 6-6 0-2.5-1.49-4.65-3.4-5.3z"})})}),(0,i.jsx)("button",{className:`${C().toolBtn} ${S(m.marks.em)?C().active:""}`,onClick:j,title:"Italic (‚åòI)","aria-label":"Italic",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"})})})]}),(0,i.jsx)("div",{className:C().divider}),(0,i.jsxs)("div",{className:C().formatGroup,children:[(0,i.jsx)("button",{className:`${C().toolBtn} ${T(m.nodes.heading,{level:1})?C().active:""}`,onClick:()=>I(1),title:"Large Heading (‚åò‚áß1)","aria-label":"Heading 1",children:(0,i.jsx)("span",{className:C().headingIcon,children:"H1"})}),(0,i.jsx)("button",{className:`${C().toolBtn} ${T(m.nodes.heading,{level:2})?C().active:""}`,onClick:()=>I(2),title:"Medium Heading (‚åò‚áß2)","aria-label":"Heading 2",children:(0,i.jsx)("span",{className:C().headingIcon,children:"H2"})}),(0,i.jsx)("button",{className:`${C().toolBtn} ${T(m.nodes.heading,{level:3})?C().active:""}`,onClick:()=>I(3),title:"Small Heading (‚åò‚áß3)","aria-label":"Heading 3",children:(0,i.jsx)("span",{className:C().headingIcon,children:"H3"})})]}),(0,i.jsx)("div",{className:C().divider}),(0,i.jsxs)("div",{className:C().formatGroup,children:[(0,i.jsx)("button",{className:C().toolBtn,onClick:A,title:"Bullet List","aria-label":"Bullet list",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"})})}),(0,i.jsx)("button",{className:C().toolBtn,onClick:E,title:"Numbered List","aria-label":"Numbered list",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"})})}),(0,i.jsx)("button",{className:`${C().toolBtn} ${$()?C().active:""}`,onClick:k,title:"Quote (‚åò>)","aria-label":"Quote",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"})})})]}),(0,i.jsx)("div",{className:C().divider}),(0,i.jsxs)("div",{className:C().formatGroup,children:[(0,i.jsx)("button",{className:C().toolBtn,onClick:M,title:"Add Image","aria-label":"Insert image",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),(0,i.jsx)("button",{className:`${C().toolBtn} ${T(m.nodes.code_block)?C().active:""}`,onClick:N,title:"Code Block","aria-label":"Code block",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})})]}),(0,i.jsx)("div",{className:C().divider}),(0,i.jsxs)("div",{className:C().formatGroup,children:[(0,i.jsx)("button",{className:C().toolBtn,onClick:B,title:"Undo (‚åòZ)","aria-label":"Undo",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})})}),(0,i.jsx)("button",{className:C().toolBtn,onClick:D,title:"Redo (‚åòY)","aria-label":"Redo",children:(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})})})]})]})}),!f&&(0,i.jsxs)("div",{className:C().loading,children:[(0,i.jsx)("div",{className:C().loadingSpinner}),(0,i.jsx)("span",{children:"Loading editor..."})]}),(0,i.jsx)("div",{ref:c,className:C().prosemirrorEditor,"aria-label":"Rich text editor",style:{minHeight:"400px",opacity:f?1:.3}})]})});I.displayName="Editor";var k=r(45306),N=r(46899),A=r.n(N);let E=({onInsert:e})=>{let[t,r]=(0,o.useState)(!1),[n,a]=(0,o.useState)([]),[s,l]=(0,o.useState)([]),[c,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)("inspirations"),g=async()=>{d(!0);try{let[e,t]=await Promise.all([(0,k.Aq)(),(0,k.Gy)()]);a(e),l(t)}catch(e){console.error("Error loading inspiration data:",e)}finally{d(!1)}},m=t=>{e&&e(t),r(!1)},p=e=>({emotions:"Explore a moment when your emotions surprised you...","decision-making":"Write about a decision that changed your perspective...","personal experience":"Reflect on an experience that shaped who you are today...",questioning:"What questions have been on your mind lately?","unexpected insights":"Share something that recently surprised you...",perspectives:"How has your viewpoint on something important changed?","dialogue with authors":"What would you say to an author whose work moved you?",connections:"Write about connections you've discovered between different ideas..."})[e]||`Write about ${e}...`;return t?(0,i.jsxs)("div",{className:A().inspirationWidget,children:[(0,i.jsxs)("div",{className:A().header,children:[(0,i.jsx)("h3",{children:"\uD83D\uDCA1 Your Reflection Insights"}),(0,i.jsx)("button",{onClick:()=>r(!1),className:A().closeButton,children:"\xd7"})]}),(0,i.jsxs)("div",{className:A().tabs,children:[(0,i.jsxs)("button",{className:`${A().tab} ${"inspirations"===u?A().active:""}`,onClick:()=>h("inspirations"),children:["Recent Thoughts (",n.length,")"]}),(0,i.jsxs)("button",{className:`${A().tab} ${"themes"===u?A().active:""}`,onClick:()=>h("themes"),children:["Writing Themes (",s.length,")"]})]}),(0,i.jsx)("div",{className:A().content,children:c?(0,i.jsxs)("div",{className:A().loading,children:[(0,i.jsx)("div",{className:A().spinner}),(0,i.jsx)("p",{children:"Loading your insights..."})]}):"inspirations"===u?(0,i.jsx)("div",{className:A().inspirationsList,children:0===n.length?(0,i.jsxs)("div",{className:A().empty,children:[(0,i.jsx)("p",{children:"\uD83D\uDCAD No reflections yet!"}),(0,i.jsx)("p",{children:"Start reading articles and reflecting to build your inspiration library."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:A().subtitle,children:"Your past reflections that might spark new ideas:"}),n.map((e,t)=>(0,i.jsxs)("div",{className:A().inspirationItem,children:[(0,i.jsxs)("p",{children:['"',e.response,'"']}),e.articleTitle&&(0,i.jsxs)("p",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px"},children:["From: ",e.articleTitle]}),(0,i.jsx)("button",{onClick:()=>{let t=e.articleTitle?` (inspired by "${e.articleTitle}")`:"";m(`"${e.response}"${t} - This reminds me of...`)},className:A().useButton,children:"Use as starting point"})]},t))]})}):(0,i.jsx)("div",{className:A().themesList,children:0===s.length?(0,i.jsxs)("div",{className:A().empty,children:[(0,i.jsx)("p",{children:"\uD83C\uDFA8 No themes identified yet!"}),(0,i.jsx)("p",{children:"Keep reflecting on articles to discover your writing themes."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:A().subtitle,children:"Writing prompts based on your reflection patterns:"}),s.map((e,t)=>(0,i.jsxs)("div",{className:A().themeItem,children:[(0,i.jsx)("div",{className:A().themeTag,children:e}),(0,i.jsx)("p",{className:A().themePrompt,children:p(e)}),(0,i.jsx)("button",{onClick:()=>m(p(e)),className:A().useButton,children:"Start writing"})]},t))]})})}),(0,i.jsx)("div",{className:A().footer,children:(0,i.jsx)("button",{onClick:g,className:A().refreshButton,disabled:c,children:"\uD83D\uDD04 Refresh insights"})})]}):(0,i.jsx)("button",{onClick:()=>{t||g(),r(!t)},className:A().inspirationButton,title:"Get inspiration from your reflections",children:"‚ú® Inspiration"})};var M=r(31237),B=r.n(M);let D=({articleId:e,onUpdateComplete:t})=>{let r=(0,a.useRouter)(),[n,d]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),[g,m]=(0,o.useState)([]),[p,f]=(0,o.useState)(""),[_,b]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),[w,x]=(0,o.useState)(!1),[j,C]=(0,o.useState)(""),[k,N]=(0,o.useState)(!!e),[A,M]=(0,o.useState)(null),[D,S]=(0,o.useState)(""),T=(0,o.useRef)(null),$=(0,o.useRef)(null),H=(0,o.useRef)(null),W=(0,o.useCallback)(()=>{T.current&&(T.current.style.height="auto",T.current.style.height=`${T.current.scrollHeight}px`,!n&&T.current&&T.current.focus())},[n]);(0,o.useEffect)(()=>{let e=c.j2.onAuthStateChanged(e=>{M(e),e||r.push("/login?redirect=compose")});return()=>e()},[r]),(0,o.useEffect)(()=>{e&&A?(async()=>{try{N(!0);let t=await (0,l.getArticleById)(e);if(!t){C("Article not found"),r.push("/");return}if(t.authorId!==A.uid){C("You can only edit your own articles"),r.push("/");return}d(t.title);let i=t.body.replace(/data-[\w-]+="[^"]*"/g,"");h(i),m(t.tags||[]),f(t.coverImage||"")}catch(e){console.error("Error loading article:",e),C("Failed to load article")}finally{N(!1)}})():e||N(!1)},[e,A,r]),(0,o.useEffect)(()=>{W()},[n,W]),(0,o.useEffect)(()=>{let e;return A&&n.trim()&&u.trim()&&!v&&!_&&(e=setTimeout(()=>{O("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[A,n,u,v,_]);let z=(0,o.useCallback)((e,t)=>{e!==u&&(h(e),w&&x(!1))},[u,w]),U=()=>{let e=D.trim().toLowerCase();e&&!g.includes(e)&&g.length<5&&(m([...g,e]),S(""))},L=e=>{m(g.filter(t=>t!==e))},O=async(i="drafts")=>{if(!A)return void C("You must be logged in to save an article");if(!n.trim())return void C("Title is required");if(!u.trim())return void C("Content is required");try{y(!0),C("");let o=u.replace(/data-[\w-]+="[^"]*"/g,""),a={title:n.trim(),body:o,tags:g,coverImage:p.trim(),status:i};if(console.log("Saving article data:",a),e)try{let r=await (0,l.iZ)(e,a);console.log("Article updated successfully:",r?.title),x(!0),await new Promise(e=>setTimeout(e,500));let i=await (0,l.getArticleById)(e);console.log("Fetched updated article data:",i?.title),t&&t(i),setTimeout(()=>{console.log("Applying changes immediately and redirecting to article ID page"),window.location.href=`/articles/${e}/view?updated=true&time=${Date.now()}`,setTimeout(()=>{window.location.pathname.includes("/edit")&&(console.log("Fallback navigation to ID-based article page"),window.location.href=`/articles/${e}?updated=true&time=${Date.now()}`)},2e3)},1e3)}catch(e){console.error("Error updating article:",e),C("Failed to update article. Please try again."),x(!1)}else{let e=await (0,l.N6)(a);"published"===i?r.push(`/articles/${e.id}`):r.push("/dashboard")}}catch(e){console.error("Error saving article:",e),C("Failed to save article. Please try again.")}finally{y(!1),b(!1)}},G=async()=>{if(!u.trim())return void C("Content is required");b(!0),await O("published")},P=async()=>{await O("drafts")};return k?(0,i.jsxs)("div",{className:B().composerLoading,children:[(0,i.jsx)("div",{className:B().loadingIndicator}),(0,i.jsx)("p",{children:"Loading article..."})]}):(0,i.jsxs)("div",{className:B().articleComposer,children:[(0,i.jsxs)("header",{className:B().composerHeader,children:[(0,i.jsx)("div",{className:B().logoContainer,children:(0,i.jsx)("div",{className:B().logo,children:"Journalite"})}),(0,i.jsxs)("div",{className:B().actionButtons,children:[w&&(0,i.jsxs)("span",{className:B().savedIndicator,children:[(0,i.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,i.jsx)("button",{className:B().actionButton,onClick:P,disabled:v||_,children:"Save draft"}),(0,i.jsx)("button",{className:B().publishButton,onClick:G,disabled:v||_||!n.trim()||!u.trim(),children:e?"Update":"Publish"})]})]}),(0,i.jsxs)("main",{className:B().composerContent,children:[(0,i.jsx)("textarea",{ref:T,className:B().titleInput,value:n,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},placeholder:"Title",rows:1}),(0,i.jsxs)("div",{className:B().coverImageInput,children:[(0,i.jsx)("input",{type:"text",value:p,onChange:e=>{f(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:B().imageUrlInput}),p&&(0,i.jsx)("div",{className:B().coverImagePreview,children:(0,i.jsx)("img",{src:p,alt:"Cover preview"})})]}),(0,i.jsxs)("div",{className:B().tagContainer,children:[g.map(e=>(0,i.jsxs)("div",{className:B().tag,children:[e,(0,i.jsx)("button",{className:B().removeTagButton,onClick:()=>L(e),"aria-label":`Remove ${e} tag`,children:"\xd7"})]},e)),g.length<5&&(0,i.jsx)("input",{ref:$,type:"text",value:D,onChange:e=>{S(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),U())},onBlur:U,placeholder:0===g.length?"Add up to 5 tags...":"Add another tag...",className:B().tagInput})]}),j&&(0,i.jsx)("div",{className:B().errorMessage,children:j}),(0,i.jsx)("div",{className:B().editorContainer,children:(0,i.jsx)(I,{ref:H,articleId:e||(0,s.A)(),initialContent:u,onChange:z,placeholder:"Tell your story..."})})]}),(0,i.jsx)(E,{onInsert:e=>{H.current&&H.current.insertText?H.current.insertText("\n\n"+e+"\n\n"):h(t=>t.trim()?t+"\n\n<p>"+e+"</p>":"<p>"+e+"</p>"),setTimeout(()=>{H.current&&H.current.focus&&H.current.focus()},100)}})]})}},79440:(e,t,r)=>{"use strict";r.d(t,{BC:()=>h,GE:()=>a,N6:()=>c,Oe:()=>g,Tu:()=>p,a:()=>f,fz:()=>u,getArticleById:()=>s,iZ:()=>d,l6:()=>l,tT:()=>m,zE:()=>_});var i=r(75535),o=r(43649),n=r(28163);async function a(e={}){let{limit:t,includeDrafts:r=!1}=e;console.log("getArticles called with limit:",t);try{let e=(0,i.rJ)(o.db,"articles"),n=[];r||n.push((0,i._M)("status","==","published")),n.push((0,i.My)("createdAt","desc")),t&&t>0&&(console.log("Adding limit constraint:",t),n.push((0,i.AB)(t)));let a=(0,i.P)(e,...n),s=await (0,i.GG)(a);console.log("Query returned document count:",s.size);let l=[];return s.forEach(e=>{let t=e.data();l.push({id:e.id,...t})}),l}catch(e){throw console.error("Error getting articles:",e),e}}async function s(e){try{let t=Date.now();console.log(`üîÑ DIRECT FETCH: Getting article with ID: ${e} (time: ${t})`);let r=(0,i.doc)(o.db,"articles",e),n=await (0,i.x7)(r);if(!n.exists())return console.log("‚ùå Article not found for ID:",e),null;{let e={id:n.id,...n.data()};return console.log("‚úÖ Article found:",e.title),console.log("\uD83D\uDCC4 Content length:",e.body?.length||0),console.log("\uD83C\uDFF7Ô∏è Tags:",e.tags?.join(", ")||"none"),e}}catch(e){throw console.error("\uD83D\uDED1 Error getting article:",e),e}}async function l(e){try{console.log(`Getting article by slug: ${e}, timestamp: ${Date.now()}`);let t=0;for(;t<2;){t++,console.log(`Attempt ${t} to get article by slug`),t>1&&await new Promise(e=>setTimeout(e,500));let r=(0,i.rJ)(o.db,"articles"),n=(0,i.P)(r,(0,i._M)("slug","==",e),(0,i._M)("status","==","published")),a=await (0,i.GG)(n);if(a.empty){if(t>=2){console.log("Article not found for slug after multiple attempts:",e);break}}else{let e=a.docs[0],t={id:e.id,...e.data()};return console.log("Article found by slug:",t.title,"Content length:",t.body?.length||0),t}console.log(`Article not found by slug on attempt ${t}, will retry...`)}return null}catch(e){throw console.error("Error getting article by slug:",e),e}}async function c(e){try{let t=o.j2.currentUser;if(!t)throw Error("You must be logged in to create an article");let r={title:e.title,body:e.body,slug:e.slug||e.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),createdAt:i.Dc.now(),authorId:t.uid,authorName:t.displayName||t.email?.split("@")[0]||"Anonymous",tags:e.tags||[],status:e.status||"published",coverImage:e.coverImage||null,likes:[],excerpt:e.excerpt||"",viewCount:0,reposts:[],comments:[]};return{id:(await (0,i.gS)((0,i.rJ)(o.db,"articles"),r)).id,...r}}catch(e){throw console.error("Error creating article:",e),e}}async function d(e,t){try{let r=o.j2.currentUser;if(!r)throw Error("You must be logged in to edit an article");let n=(0,i.doc)(o.db,"articles",e),a=await (0,i.x7)(n);if(!a.exists())throw Error("Article not found");if(a.data().authorId!==r.uid)throw Error("You can only edit your own articles");let s={...t};t.title&&(s.slug=t.title.toLowerCase().replace(/[\s\W-]+/g,"-").replace(/^-+|-+$/g,""),console.log("Updated slug to:",s.slug)),s.updatedAt=i.Dc.now(),await (0,i.updateDoc)(n,s);let l=await (0,i.x7)(n);return{id:l.id,...l.data()}}catch(e){throw console.error("Error updating article:",e),e}}async function u(e){try{let t=(0,i.rJ)(o.db,"articles",e,"comments"),r=(0,i.P)(t,(0,i.My)("createdAt","desc")),n=await (0,i.GG)(r),a=[];return n.forEach(e=>{let t=e.data();a.push({id:e.id,commentId:e.id,...t,replies:t.replies||[]})}),a}catch(e){throw console.error("Error getting comments:",e),e}}async function h(e,t){try{let r=o.j2.currentUser;if(!r)throw Error("You must be logged in to comment");let a={userId:r.uid,userName:r.displayName||r.email?.split("@")[0]||"Anonymous",content:t,createdAt:i.Dc.now(),likes:[],replies:[]},l=await (0,i.gS)((0,i.rJ)(o.db,"articles",e,"comments"),a),c=await s(e);return c&&c.authorId!==r.uid&&await (0,n.fZ)(c.authorId,e,c.slug||"",c.title||"Article",l.id,t),{id:l.id,commentId:l.id,...a}}catch(e){throw console.error("Error adding comment:",e),e}}async function g(e,t,r){try{let n=o.j2.currentUser;if(!n)throw Error("You must be logged in to reply");let a=(0,i.doc)(o.db,"articles",e,"comments",t),l=await (0,i.x7)(a);if(!l.exists())throw Error("Comment not found");let c={replyId:Math.random().toString(36).substring(2,15),userId:n.uid,userName:n.displayName||n.email?.split("@")[0]||"Anonymous",content:r,createdAt:i.Dc.now(),likes:[]};await (0,i.updateDoc)(a,{replies:(0,i.arrayUnion)(c)});let d=l.data();if(d.userId!==n.uid){let r=await s(e);console.log(`User ${n.uid} replied to comment ${t} by ${d.userId} on article ${r?.title}`)}return c}catch(e){throw console.error("Error adding reply:",e),e}}async function m(e,t){try{let r=o.j2.currentUser;if(!r)throw Error("You must be logged in to like a comment");let n=(0,i.doc)(o.db,"articles",e,"comments",t),a=await (0,i.x7)(n);if(!a.exists())throw Error("Comment not found");let s=a.data(),l=r.uid,c=(s.likes||[]).includes(l);await (0,i.updateDoc)(n,{likes:c?(0,i.arrayRemove)(l):(0,i.arrayUnion)(l)});let d=(await (0,i.x7)(n)).data();return{success:!0,action:c?"unliked":"liked",likes:d.likes,count:d.likes.length}}catch(e){throw console.error("Error liking comment:",e),e}}async function p(e,t){try{let r=o.j2.currentUser;if(!r)throw Error("You must be logged in to delete a comment");let n=(0,i.doc)(o.db,"articles",e,"comments",t),a=await (0,i.x7)(n);if(!a.exists())throw Error("Comment not found");if(a.data().userId!==r.uid)throw Error("You can only delete your own comments");return await (0,i.kd)(n),{success:!0,message:"Comment deleted successfully"}}catch(e){throw console.error("Error deleting comment:",e),e}}async function f(e){try{let t=o.j2.currentUser;if(!t)throw Error("You must be logged in to delete an article");let r=(0,i.doc)(o.db,"articles",e),n=await (0,i.x7)(r);if(!n.exists())throw Error("Article not found");if(n.data().authorId!==t.uid)throw Error("You can only delete your own articles");return await (0,i.kd)(r),{success:!0,message:"Article deleted successfully"}}catch(e){throw console.error("Error deleting article:",e),e}}async function _(e,t={}){let{limit:r}=t;try{let t=(0,i.rJ)(o.db,"articles"),n=[(0,i._M)("tags","array-contains",e),(0,i._M)("status","==","published"),(0,i.My)("createdAt","desc")];r&&r>0&&n.push((0,i.AB)(r));let a=(0,i.P)(t,...n),s=await (0,i.GG)(a),l=[];return s.forEach(e=>{l.push({id:e.id,...e.data()})}),l}catch(e){throw console.error("Error getting articles by tag:",e),e}}},85540:e=>{e.exports={editorContainer:"Editor_editorContainer__AxL3W",editorContent:"Editor_editorContent__Hto0I",prosemirrorEditor:"Editor_prosemirrorEditor__jSRn5",editor:"Editor_editor__ys4HH",loading:"Editor_loading___nwXA",loadingSpinner:"Editor_loadingSpinner__JMIXQ",spin:"Editor_spin__5Ufeq",modernToolbar:"Editor_modernToolbar__VDG5b",toolbarContainer:"Editor_toolbarContainer__rZaHf",formatGroup:"Editor_formatGroup__OhMWy",divider:"Editor_divider__pHi4V",toolBtn:"Editor_toolBtn__LEamn",active:"Editor_active__UGSnI",headingIcon:"Editor_headingIcon__HKD4e",ProseMirror:"Editor_ProseMirror__DHY3Q",slideInFromTop:"Editor_slideInFromTop__ADbMI"}}};