(()=>{var e={};e.id=9451,e.ids=[9451],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3458:(e,t,r)=>{Promise.resolve().then(r.bind(r,94682))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14036:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(37413);function a({children:e}){return(0,s.jsx)("div",{className:"min-h-screen bg-white",children:e})}r(61120)},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},20365:(e,t,r)=>{"use strict";r.d(t,{$i:()=>u,FA:()=>d,KB:()=>h,SR:()=>x,_z:()=>m,iS:()=>f,zS:()=>g});var s=r(75535),a=r(43649),i=r(49048);let n=new Map,l=new Map;async function o(e){let t=n.get(e),r=Date.now();if(t&&r-t.timestamp<3e5)return t.profile;let s=await (0,i.VM)(e);return s&&n.set(e,{profile:s,timestamp:r}),s}async function c(e,t){let r=`${e}-${t}`,s=l.get(r),a=Date.now();if(s&&a-s.timestamp<3e4)return s.count;let i=await p(e,t);return l.set(r,{count:i,timestamp:a}),i}async function d(e,t){if(!e||!t)throw Error("Both user IDs are required");if(e===t)throw Error("Cannot create conversation with yourself");try{let r=(0,s.collection)(a.db,"conversations"),i=(0,s.query)(r,(0,s.where)("participants","array-contains",e));for(let e of(await (0,s.getDocs)(i)).docs)if(e.data().participants.includes(t))return e.id;let n={participants:[e,t].sort(),lastMessage:{content:"",senderId:"",timestamp:(0,s.serverTimestamp)(),read:!1},createdAt:(0,s.serverTimestamp)(),updatedAt:(0,s.serverTimestamp)()};return(await (0,s.addDoc)(r,n)).id}catch(e){throw console.error("Error getting or creating conversation:",e),e}}async function m(e,t,r,i="text"){let n=a.j2.currentUser;if(!n)throw Error("User must be authenticated to send messages");if(!r.trim())throw Error("Message content cannot be empty");try{let o=(0,s.collection)(a.db,"messages"),c={conversationId:e,senderId:n.uid,receiverId:t,content:r.trim(),type:i,timestamp:(0,s.serverTimestamp)(),read:!1},d=await (0,s.addDoc)(o,c),m=(0,s.doc)(a.db,"conversations",e);await (0,s.updateDoc)(m,{lastMessage:{content:r.trim(),senderId:n.uid,timestamp:(0,s.serverTimestamp)(),read:!1},updatedAt:(0,s.serverTimestamp)()});let u=`${e}-${t}`;return l.delete(u),d.id}catch(e){throw console.error("Error sending message:",e),e}}async function u(e,t,r){let i=a.j2.currentUser;if(!i)throw Error("User must be authenticated to send messages");if(!r.uid||!r.username)throw Error("Profile data must include uid and username");try{let n=(0,s.collection)(a.db,"messages"),o={conversationId:e,senderId:i.uid,receiverId:t,content:`Shared ${r.firstName} ${r.lastName}'s profile`,type:"profile",timestamp:(0,s.serverTimestamp)(),read:!1,profileAttachment:r},c=await (0,s.addDoc)(n,o),d=(0,s.doc)(a.db,"conversations",e);await (0,s.updateDoc)(d,{lastMessage:{content:`Shared ${r.firstName} ${r.lastName}'s profile`,senderId:i.uid,timestamp:(0,s.serverTimestamp)(),read:!1},updatedAt:(0,s.serverTimestamp)()});let m=`${e}-${t}`;return l.delete(m),c.id}catch(e){throw console.error("Error sending profile message:",e),e}}function x(e,t,r=50){try{let i=(0,s.collection)(a.db,"messages"),n=(0,s.query)(i,(0,s.where)("conversationId","==",e),(0,s.orderBy)("timestamp","desc"),(0,s.limit)(r));return(0,s.onSnapshot)(n,e=>{let r=[];e.forEach(e=>{r.push({id:e.id,...e.data()})}),t(r.reverse())})}catch(e){throw console.error("Error subscribing to messages:",e),e}}function h(e,t){try{let r=(0,s.collection)(a.db,"conversations"),i=(0,s.query)(r,(0,s.where)("participants","array-contains",e),(0,s.orderBy)("updatedAt","desc"));return(0,s.onSnapshot)(i,async r=>{let s=[],a=new Map;for(let t of r.docs){let r=({id:t.id,...t.data()}).participants.find(t=>t!==e);r&&!a.has(r)&&a.set(r,o(r))}let i=new Map;for(let[e,t]of a)try{let r=await t;r&&i.set(e,r)}catch(t){console.error(`Error fetching profile for user ${e}:`,t)}for(let t of r.docs){let r={id:t.id,...t.data()},a=r.participants.find(t=>t!==e);if(!a)continue;let n=i.get(a);if(!n)continue;let l=await c(r.id,e);s.push({conversation:r,otherUser:{uid:n.uid,username:n.username,firstName:n.firstName,lastName:n.lastName},unreadCount:l})}t(s)})}catch(e){throw console.error("Error subscribing to conversations:",e),e}}async function f(e,t){try{let r=(0,s.collection)(a.db,"messages"),i=(0,s.query)(r,(0,s.where)("conversationId","==",e),(0,s.where)("receiverId","==",t),(0,s.where)("read","==",!1)),n=(await (0,s.getDocs)(i)).docs.map(e=>(0,s.updateDoc)(e.ref,{read:!0}));await Promise.all(n);let o=`${e}-${t}`;l.delete(o)}catch(e){throw console.error("Error marking messages as read:",e),e}}async function p(e,t){try{let r=(0,s.collection)(a.db,"messages"),i=(0,s.query)(r,(0,s.where)("conversationId","==",e),(0,s.where)("receiverId","==",t),(0,s.where)("read","==",!1));return(await (0,s.getDocs)(i)).size}catch(e){return console.error("Error getting unread message count:",e),0}}async function g(e){try{let t=(0,s.collection)(a.db,"messages"),r=(0,s.query)(t,(0,s.where)("receiverId","==",e),(0,s.where)("read","==",!1));return(await (0,s.getDocs)(r)).size}catch(e){return console.error("Error getting total unread count:",e),0}}},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34377:(e,t,r)=>{"use strict";r.d(t,{I:()=>n,d:()=>i});var s=r(43210),a=r.n(s);let i=(e,t,r=!1)=>{let s=e?.charAt(0)?.toUpperCase()||"A",i=["#4f46e5","#0ea5e9","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16"],n=t?Math.abs(t.charCodeAt(0)%i.length):0,l=i[n];return a().createElement("div",{style:{backgroundColor:l,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:r?"0.8rem":"1rem",width:r?"32px":"40px",height:r?"32px":"40px",borderRadius:"50%",flexShrink:0}},s)},n=(e,t)=>(e?.charAt(0)?.toUpperCase()||"")+(t?.charAt(0)?.toUpperCase()||"")||"U"},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},54902:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c});var s=r(65239),a=r(48088),i=r(88170),n=r.n(i),l=r(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c={children:["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,90715)),"/Users/sirabdisalam/journalite-article-page/src/app/messages/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,14036)),"/Users/sirabdisalam/journalite-article-page/src/app/messages/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/Users/sirabdisalam/journalite-article-page/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"/Users/sirabdisalam/journalite-article-page/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["/Users/sirabdisalam/journalite-article-page/src/app/messages/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69178:(e,t,r)=>{Promise.resolve().then(r.bind(r,90715))},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},90715:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/sirabdisalam/journalite-article-page/src/app/messages/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/sirabdisalam/journalite-article-page/src/app/messages/page.tsx","default")},91645:e=>{"use strict";e.exports=require("net")},94682:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(60687),a=r(43210),i=r(16189),n=r(17193),l=r(43649),o=r(20365),c=r(34377);function d({conversations:e,selectedConversation:t,onConversationSelect:r,loading:a,isMobile:i=!1}){let n=e=>{if(!e)return"";try{let t=e.toDate?e.toDate():new Date(e),r=(new Date().getTime()-t.getTime())/36e5;if(r<24)return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});if(r<168)return t.toLocaleDateString("en-US",{weekday:"short"});return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch(e){return console.warn("Error formatting timestamp:",e),""}},l=(e,t=60)=>e.length<=t?e:e.substring(0,t)+"...";return a?(0,s.jsx)("div",{className:"p-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-3 mb-2",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full animate-pulse"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2 animate-pulse"}),(0,s.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2 animate-pulse"})]})]},t))}):0===e.length?(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No conversations yet"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Start a new conversation to get messaging."})]})}):(0,s.jsx)("div",{className:`${i?"px-0":"p-0"}`,children:e.map(e=>{let a=t?.conversation.id===e.conversation.id,i=e.conversation.lastMessage;return(0,s.jsx)("button",{onClick:()=>r(e),className:`w-full text-left p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors ${a?"bg-blue-50 border-blue-200":""}`,children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.otherUser.firstName,e.otherUser.lastName)})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("p",{className:`text-sm font-medium truncate ${e.unreadCount>0?"text-gray-900":"text-gray-700"}`,children:[e.otherUser.firstName," ",e.otherUser.lastName]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[e.unreadCount>0&&(0,s.jsx)("span",{className:"bg-blue-600 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center",children:e.unreadCount>99?"99+":e.unreadCount}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:n(i.timestamp)})]})]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("p",{className:`text-sm truncate ${e.unreadCount>0?"text-gray-900 font-medium":"text-gray-500"}`,children:i.content?l(i.content):"No messages yet"})}),(0,s.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["@",e.otherUser.username]})]})]})},e.conversation.id)})})}r(49048);var m=r(85814),u=r.n(m);function x({profile:e,isOwn:t=!1}){return(0,s.jsxs)("div",{className:`max-w-sm mx-2 my-1 ${t?"ml-auto":"mr-auto"}`,children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[(0,s.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 border-b border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:(0,c.I)(e.firstName,e.lastName)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("h3",{className:"font-semibold text-gray-900 truncate",children:[e.firstName," ",e.lastName]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:["@",e.username]})]})]})}),(0,s.jsxs)("div",{className:"p-4",children:[e.bio&&(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3 line-clamp-3",children:e.bio}),(0,s.jsxs)(u(),{href:`/user/${encodeURIComponent(e.username.toLowerCase())}`,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"View Profile"]})]})]}),(0,s.jsx)("div",{className:"text-xs text-gray-500 text-center mt-1",children:"\uD83D\uDCCB Shared Profile"})]})}function h({users:e,onUserSelect:t,isLoading:r=!1,searchTerm:a}){return r?(0,s.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,s.jsx)("span",{className:"ml-2 text-sm text-gray-600",children:"Searching users..."})]})}):0===e.length&&a.length>0?(0,s.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:(0,s.jsxs)("div",{className:"text-sm text-gray-500 text-center",children:['No users found matching "@',a,'"']})}):0===e.length?null:(0,s.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 max-h-64 overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 font-medium mb-2 px-2",children:"People you can mention:"}),e.map(e=>(0,s.jsxs)("button",{onClick:()=>t(e),className:"w-full flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors text-left",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.firstName,e.lastName)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"font-medium text-gray-900 text-sm truncate",children:[e.firstName," ",e.lastName]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:["@",e.username]})]}),(0,s.jsx)("div",{className:"text-xs text-blue-600 font-medium",children:"Send Profile"})]},e.uid))]})})}function f({conversation:e,currentUserId:t,isMobile:r=!1}){let[i,n]=(0,a.useState)([]),[l,d]=(0,a.useState)(""),[m,u]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1),g=(0,a.useRef)(null),b=(0,a.useRef)(null),[j,v]=(0,a.useState)([]),[N,y]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[C,S]=(0,a.useState)(""),U=async t=>{p(!0);try{await (0,o.$i)(e.conversation.id,e.otherUser.uid,{uid:t.uid,username:t.username,firstName:t.firstName,lastName:t.lastName,bio:t.bio}),d(""),y(!1),S(""),b.current&&b.current.focus()}catch(e){console.error("Error sending profile message:",e),alert("Failed to send profile. Please try again.")}finally{p(!1)}},M=async t=>{if(t.preventDefault(),l.trim()&&!f){p(!0);try{await (0,o._z)(e.conversation.id,e.otherUser.uid,l.trim()),d(""),y(!1),S(""),b.current&&b.current.focus()}catch(e){console.error("Error sending message:",e),alert("Failed to send message. Please try again.")}finally{p(!1)}}},D=e=>{if(!e)return"";try{let t=e.toDate?e.toDate():new Date(e);if((new Date().getTime()-t.getTime())/36e5<24)return t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(e){return console.warn("Error formatting timestamp:",e),"Just now"}};return m?(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:"Loading conversation..."})]})}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[!r&&(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.otherUser.firstName,e.otherUser.lastName)}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[e.otherUser.firstName," ",e.otherUser.lastName]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["@",e.otherUser.username]})]})]})}),(0,s.jsxs)("div",{className:`flex-1 overflow-y-auto p-4 space-y-3 ${r?"pb-20":"pb-4"}`,children:[0===i.length?(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl mx-auto mb-4",children:(0,c.I)(e.otherUser.firstName,e.otherUser.lastName)}),(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:[e.otherUser.firstName," ",e.otherUser.lastName]}),(0,s.jsxs)("p",{className:"text-gray-500 mb-4",children:["@",e.otherUser.username]}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Start the conversation with a message."})]})}):i.map((r,a)=>{let n=r.senderId===t,l=i[a-1],o=i[a+1],d=0===a||l&&r.timestamp&&l.timestamp&&Math.abs(r.timestamp.toMillis()-l.timestamp.toMillis())>3e5,m=!n&&(!o||o.senderId!==r.senderId||o&&o.timestamp&&r.timestamp&&Math.abs(o.timestamp.toMillis()-r.timestamp.toMillis())>3e5);return(0,s.jsxs)("div",{children:[d&&r.timestamp&&(0,s.jsx)("div",{className:"text-center text-xs text-gray-400 my-4",children:D(r.timestamp)}),(0,s.jsxs)("div",{className:`flex items-end ${n?"justify-end":"justify-start space-x-2"} mb-1`,children:[m&&(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-xs flex-shrink-0 mb-1",children:(0,c.I)(e.otherUser.firstName,e.otherUser.lastName)}),!n&&!m&&(0,s.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),"profile"===r.type&&r.profileAttachment?(0,s.jsx)(x,{profile:r.profileAttachment,isOwn:n}):(0,s.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${n?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:r.content}),!r.read&&!n&&(0,s.jsx)("div",{className:"text-xs text-blue-400 mt-1",children:"New"})]})]})]},r.id)}),(0,s.jsx)("div",{ref:g})]}),(0,s.jsx)("div",{className:`p-4 border-t border-gray-200 bg-white ${r?"pb-8":""}`,children:(0,s.jsxs)("div",{className:"relative",children:[N&&(0,s.jsx)(h,{users:j,onUserSelect:U,isLoading:w,searchTerm:C}),(0,s.jsxs)("form",{onSubmit:M,className:"flex space-x-3",children:[(0,s.jsx)("input",{ref:b,type:"text",value:l,onChange:e=>{let t=e.target.value;d(t);let r=t.lastIndexOf("@");if(-1!==r&&r===t.length-1)y(!0),S("");else if(-1!==r){let e=t.substring(r+1);e.length>0&&!e.includes(" ")?(y(!0),S(e)):e.includes(" ")&&(y(!1),S(""))}else y(!1),S("")},placeholder:`Message ${e.otherUser.firstName}... (Type @ to mention someone)`,className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:f}),(0,s.jsx)("button",{type:"submit",disabled:!l.trim()||f,className:"px-6 py-2 bg-blue-600 text-white rounded-full font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors",children:f?(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"Send"})]})]})})]})}function p({onClose:e,onConversationCreated:t}){let[r]=(0,n.hD)(l.j2),[i,d]=(0,a.useState)(""),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)(!1),[f,p]=(0,a.useState)(!1),g=async e=>{if(r&&!f){p(!0);try{let s={conversation:{id:await (0,o.FA)(r.uid,e.uid),participants:[r.uid,e.uid],lastMessage:{content:"",senderId:"",timestamp:new Date,read:!1},createdAt:new Date,updatedAt:new Date},otherUser:{uid:e.uid,username:e.username,firstName:e.firstName,lastName:e.lastName},unreadCount:0};t(s)}catch(e){console.error("Error creating conversation:",e),alert("Failed to start conversation. Please try again.")}finally{p(!1)}}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t=>{t.target===t.currentTarget&&e()},children:(0,s.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[80vh] overflow-hidden",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"New Message"}),(0,s.jsx)("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsx)("input",{type:"text",value:i,onChange:e=>d(e.target.value),placeholder:"Search for users...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto max-h-96",children:x?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-600 text-sm",children:"Searching..."})]}):i.trim()&&i.length>=2?m.length>0?(0,s.jsx)("div",{className:"p-2",children:m.map(e=>(0,s.jsx)("button",{onClick:()=>g(e),disabled:f,className:"w-full text-left p-3 hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:(0,c.I)(e.firstName,e.lastName)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["@",e.username]}),e.bio&&(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate mt-1",children:e.bio})]}),f&&(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})]})},e.uid))}):(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No users found"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Try searching with a different term."})]}):(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"Search for users"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Type at least 2 characters to search for users to message."})]})})]})})}let g=a.forwardRef(function({title:e,titleId:t,...r},s){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}),b=a.forwardRef(function({title:e,titleId:t,...r},s){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});function j(){let[e]=(0,n.hD)(l.j2),[t,r]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),[c,m]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!0),[h,j]=(0,a.useState)(0),[v,N]=(0,a.useState)(!1),y=e=>{o(e)};return e?(0,s.jsxs)("div",{className:"h-screen flex bg-white",children:[v&&(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10 bg-white border-b border-gray-200 px-4 py-3",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{o(null)},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)(g,{className:"h-6 w-6 text-gray-700"})}),(0,s.jsxs)("div",{className:"flex-1 text-center",children:[(0,s.jsxs)("h1",{className:"text-lg font-semibold text-gray-900",children:[i.otherUser.firstName," ",i.otherUser.lastName]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["@",i.otherUser.username]})]}),(0,s.jsx)("div",{className:"w-10"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),(0,s.jsx)("button",{onClick:()=>m(!0),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,s.jsx)(b,{className:"h-6 w-6 text-blue-600"})})]})})}),v?(0,s.jsx)("div",{className:"flex-1 flex flex-col pt-16",children:i?(0,s.jsx)(f,{conversation:i,currentUserId:e.uid,isMobile:!0}):(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(d,{conversations:t,selectedConversation:i,onConversationSelect:y,loading:u,isMobile:!0})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),(0,s.jsx)("button",{onClick:()=>m(!0),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"New message",children:(0,s.jsx)(b,{className:"h-5 w-5 text-blue-600"})})]}),h>0&&(0,s.jsxs)("p",{className:"text-sm text-blue-600 font-medium",children:[h," unread message",1!==h?"s":""]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(d,{conversations:t,selectedConversation:i,onConversationSelect:y,loading:u})})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col",children:i?(0,s.jsx)(f,{conversation:i,currentUserId:e.uid}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Choose from your existing conversations or start a new one."})]})})})]}),c&&(0,s.jsx)(p,{onClose:()=>m(!1),onConversationCreated:e=>{o(e),m(!1)}})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Please log in to view messages."})})}function v(){let[e,t]=(0,n.hD)(l.j2);return t?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading messages..."})]})}):(e||(0,i.redirect)("/login"),(0,s.jsx)(j,{}))}},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3476,948,2989,4405,9048],()=>r(54902));module.exports=s})();