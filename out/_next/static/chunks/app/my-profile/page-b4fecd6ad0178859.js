(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{19:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var s=t(5155),r=t(2115),l=t(5695),n=t(6203),i=t(3201),m=t(4744),o=t(6874),u=t.n(o);function c(){let[e,a]=(0,r.useState)(""),[t,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[f,h]=(0,r.useState)(""),[x,p]=(0,r.useState)(!0),[N,b]=(0,r.useState)(!1),[g,j]=(0,r.useState)(""),[y,v]=(0,r.useState)(!1),[w,S]=(0,r.useState)({}),[k,P]=(0,r.useState)({}),[U,E]=(0,r.useState)(null),[C,T]=(0,r.useState)(!1),[F,_]=(0,r.useState)(null),[B,L]=(0,r.useState)(""),M=(0,l.useRouter)();(0,r.useEffect)(()=>{let e=(0,n.hg)(i.j2,async e=>{if(e){_(e.uid),L(e.email||"");try{let r=await (0,m.VM)(e.uid);if(r)a(r.firstName),o(r.lastName),d(r.username),h(r.username),E(!0);else{var t,s;let r=(e.displayName||"").split(" ");a(r[0]||""),o(r.slice(1).join(" ")||""),d((null==(t=e.email)?void 0:t.split("@")[0])||""),h((null==(s=e.email)?void 0:s.split("@")[0])||"")}}catch(e){console.error("Error fetching user profile:",e),j("Failed to load your profile. Please try refreshing the page.")}finally{p(!1)}}else M.push("/login")});return()=>e()},[M]);let I=e=>{let{name:a,value:t,validity:s}=e.target;if(S({...w,[a]:!0}),P({...k,[a]:""}),s.valueMissing){let e="This field is required";"firstName"===a&&(e="Please enter your first name"),"lastName"===a&&(e="Please enter your last name"),"username"===a&&(e="Please choose a username"),P({...k,[a]:e})}},G=async e=>{if(e===f)return void E(!0);if(e.length<2)return void E(null);try{T(!0);let a=await (0,m.OQ)(e);E(!a)}catch(e){console.error("Error checking username:",e)}finally{T(!1)}},O=()=>{let a={},s={},r=!0;return s.firstName=!0,e.trim()||(a.firstName="Please enter your first name",r=!1),s.lastName=!0,t.trim()||(a.lastName="Please enter your last name",r=!1),s.username=!0,c.trim()?c.length<2?(a.username="Username must be at least 2 characters",r=!1):c!==f&&!1===U&&(a.username="This username is already taken",r=!1):(a.username="Please choose a username",r=!1),S({...w,...s}),P({...k,...a}),r},R=async a=>{if(a.preventDefault(),O()&&F){b(!0),j(""),v(!1);try{await (0,m.Vz)(F,{firstName:e,lastName:t,username:c,email:B}),i.j2.currentUser&&await (0,n.r7)(i.j2.currentUser,{displayName:c}),h(c),v(!0),setTimeout(()=>{v(!1)},3e3)}catch(a){let e="Failed to update your profile";a instanceof Error&&a.message.includes("Username is already taken")&&(e="This username is already taken",P({...k,username:"This username is already taken"})),j(e),console.error(a)}finally{b(!1)}}},V=e=>{let a="w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md focus:outline-none focus:ring-1 focus:ring-slate-500";return w[e]&&k[e]?"".concat(a," border-red-300 bg-red-50"):"username"===e&&c.length>=2&&!0===U?"".concat(a," border-green-300 bg-green-50"):a};return x?(0,s.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-slate-500 rounded-full border-t-transparent"})}):(0,s.jsx)("div",{className:"min-h-screen bg-[#f5efe0] flex flex-col",children:(0,s.jsx)("div",{className:"py-12 px-6 flex-1 flex flex-col items-center",children:(0,s.jsxs)("div",{className:"w-full max-w-lg mx-auto",children:[(0,s.jsxs)("div",{className:"mb-12 text-center",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-5xl font-serif font-normal text-slate-900",children:"My Profile"}),(0,s.jsx)("p",{className:"mt-2 text-slate-700",children:"Update your personal information"})]}),g&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 text-red-700 text-sm rounded-md",children:g}),y&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-green-50 text-green-700 text-sm rounded-md",children:"Your profile has been updated successfully"}),(0,s.jsxs)("form",{onSubmit:R,className:"space-y-6 w-full bg-white rounded-xl p-8 shadow-sm",noValidate:!0,children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-6",children:[(0,s.jsxs)("div",{className:"w-full md:w-1/2 mb-6 md:mb-0",children:[(0,s.jsx)("label",{htmlFor:"firstName",className:"block mb-2 text-sm font-medium text-slate-700",children:"First Name"}),(0,s.jsx)("input",{id:"firstName",name:"firstName",type:"text",className:V("firstName"),placeholder:"First name",value:e,onChange:e=>a(e.target.value),onBlur:I,required:!0}),w.firstName&&k.firstName&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-500",children:k.firstName})]}),(0,s.jsxs)("div",{className:"w-full md:w-1/2",children:[(0,s.jsx)("label",{htmlFor:"lastName",className:"block mb-2 text-sm font-medium text-slate-700",children:"Last Name"}),(0,s.jsx)("input",{id:"lastName",name:"lastName",type:"text",className:V("lastName"),placeholder:"Last name",value:t,onChange:e=>o(e.target.value),onBlur:I,required:!0}),w.lastName&&k.lastName&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-500",children:k.lastName})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"username",className:"block mb-2 text-sm font-medium text-slate-700",children:"Username"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{id:"username",name:"username",type:"text",className:V("username"),placeholder:"Username",value:c,onChange:e=>{let a=e.target.value;if(d(a),a===f)return void E(!0);let t=setTimeout(()=>{a.length>=2?G(a):E(null)},500);return()=>clearTimeout(t)},onBlur:I,required:!0}),C&&(0,s.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,s.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-slate-500 rounded-full border-t-transparent"})}),!C&&c.length>=2&&!0===U&&(0,s.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-green-500",children:"✓"})]}),w.username&&k.username&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-500",children:k.username}),!k.username&&c.length>=2&&!0===U&&c!==f&&(0,s.jsx)("p",{className:"mt-1 text-sm text-green-500",children:"Username is available"}),!k.username&&c.length>=2&&!1===U&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-500",children:"Username is already taken"})]}),(0,s.jsxs)("div",{className:"pt-4",children:[(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium text-slate-700",children:"Email Address"}),(0,s.jsx)("div",{className:"w-full px-5 py-3.5 bg-[#f8f5ec] border border-[#e8e1d1] rounded-md text-slate-500",children:B}),(0,s.jsx)("p",{className:"mt-2 text-xs text-slate-600",children:"Email address cannot be changed"})]}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)("button",{type:"submit",className:"w-full flex items-center justify-center px-4 py-3.5 bg-[#1a1a19] text-white rounded-md hover:bg-[#2a2a29] focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 transition duration-200",disabled:N,children:N?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white rounded-full border-t-transparent"}),"Saving changes..."]}):(0,s.jsx)("span",{children:"Save changes"})})})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)(u(),{href:"/",className:"text-slate-700 hover:text-slate-900 text-sm",children:"← Back to home"})})]})})})}},3201:(e,a,t)=>{"use strict";t.d(a,{db:()=>o,j2:()=>m});var s=t(3915),r=t(6864),l=t(6203),n=t(5317);let i=(0,s.Wp)({apiKey:"AIzaSyCFpybhLt43iKUw6lNahU1n2zjYv0BXmf4",authDomain:"journalitev1.firebaseapp.com",projectId:"journalitev1",storageBucket:"journalitev1.firebasestorage.app",messagingSenderId:"897263211529",appId:"1:897263211529:web:bae4a00910a2236d6d54d8",measurementId:"G-ZYT8PRMT0D"});try{(0,r.P5)(i)}catch(e){}let m=(0,l.xI)(i),o=(0,n.aU)(i)},4744:(e,a,t)=>{"use strict";t.d(a,{OQ:()=>n,VM:()=>m,Vz:()=>i});var s=t(5317),r=t(6203),l=t(3201);async function n(e){try{let a=(0,s.P)((0,s.rJ)(l.db,"users"),(0,s._M)("username","==",e.toLowerCase()));return!(await (0,s.GG)(a)).empty}catch(e){throw console.error("Error checking username:",e),e}}async function i(e,a){try{if(await m(e))return void console.log("User profile already exists, skipping creation");let t=(0,s.P)((0,s.rJ)(l.db,"users"),(0,s._M)("email","==",a.email.toLowerCase()));if(!(await (0,s.GG)(t)).empty)throw Error("Email is already associated with another account");if(await n(a.username))throw Error("Username is already taken");let i=(0,s.H9)(l.db,"users",e);await (0,s.BN)(i,{uid:e,firstName:a.firstName,lastName:a.lastName,username:a.username.toLowerCase(),email:a.email.toLowerCase(),createdAt:(0,s.O5)()}),l.j2.currentUser&&await (0,r.r7)(l.j2.currentUser,{displayName:a.username})}catch(e){throw console.error("Error creating user profile:",e),e}}async function m(e){try{let a=(0,s.H9)(l.db,"users",e),t=await (0,s.x7)(a);if(t.exists())return t.data();return null}catch(e){throw console.error("Error fetching user profile:",e),e}}},5136:(e,a,t)=>{Promise.resolve().then(t.bind(t,19))},5695:(e,a,t)=>{"use strict";var s=t(8999);t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var a=a=>e(e.s=a);e.O(0,[992,158,117,874,441,684,358],()=>a(5136)),_N_E=e.O()}]);