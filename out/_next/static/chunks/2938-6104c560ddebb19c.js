(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2938],{1999:e=>{e.exports={articleEditor:"ArticleEditor_articleEditor__Y7zhH",toolbar:"ArticleEditor_toolbar__7VR6u",toolbarButton:"ArticleEditor_toolbarButton__n6ugP",active:"ArticleEditor_active__l06wW",editorContent:"ArticleEditor_editorContent__IMeaV",editorStatus:"ArticleEditor_editorStatus__UViLo",fadeIn:"ArticleEditor_fadeIn__hSZwT"}},2938:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var n,a=r(5155),i=r(2115),s=r(5695),o=new Uint8Array(16);let l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var d=[],c=0;c<256;++c)d.push((c+256).toString(16).substr(1));let h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!("string"==typeof r&&l.test(r)))throw TypeError("Stringified UUID is invalid");return r},u=function(e,t,r){var a=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=a[i];return t}return h(a)};var p=r(9210),g=r(3201);class m{applyOperation(e,t){let r=JSON.parse(JSON.stringify(e));switch(t.type){case"INSERT_PARAGRAPH":return this.insertParagraph(r,t.sectionId,t.index,t.paragraph);case"REMOVE_PARAGRAPH":return this.removeParagraph(r,t.sectionId,t.paragraphId,t.index);case"UPDATE_PARAGRAPH":return this.updateParagraph(r,t.sectionId,t.paragraphId,t.updates);case"INSERT_SECTION":return this.insertSection(r,t.index,t.section);case"REMOVE_SECTION":return this.removeSection(r,t.sectionId,t.index);case"UPDATE_SECTION":return this.updateSection(r,t.sectionId,t.updates);default:return console.warn("Unknown operation type:",t.type),r}}applyOperations(e,t){return t.reduce((e,t)=>this.applyOperation(e,t),e)}insertParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn("Section with ID ".concat(t," not found")),e;let i={...n,id:n.id||u()};return e.sections[a].paragraphs.splice(r,0,i),e}removeParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn("Section with ID ".concat(t," not found")),e;let i=e.sections[a];if(n>=0&&n<i.paragraphs.length)if(i.paragraphs[n].id!==r){console.warn("Paragraph ID mismatch at index ".concat(n));let e=i.paragraphs.findIndex(e=>e.id===r);-1!==e&&i.paragraphs.splice(e,1)}else i.paragraphs.splice(n,1);return e}updateParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return console.warn("Section with ID ".concat(t," not found")),e;let i=e.sections[a].paragraphs.findIndex(e=>e.id===r);return -1===i?console.warn("Paragraph with ID ".concat(r," not found in section ").concat(t)):e.sections[a].paragraphs[i]={...e.sections[a].paragraphs[i],...n},e}insertSection(e,t,r){let n={...r,id:r.id||u()};return e.sections.splice(t,0,n),e}removeSection(e,t,r){if(r>=0&&r<e.sections.length)if(e.sections[r].id!==t){console.warn("Section ID mismatch at index ".concat(r));let n=e.sections.findIndex(e=>e.id===t);-1!==n&&e.sections.splice(n,1)}else e.sections.splice(r,1);return e}updateSection(e,t,r){let n=e.sections.findIndex(e=>e.id===t);return -1===n?console.warn("Section with ID ".concat(t," not found")):e.sections[n]={...e.sections[n],...r},e}addTextMark(e,t,r,n,a,i,s){let o=e.sections.findIndex(e=>e.id===t);if(-1===o)return e;let l=e.sections[o].paragraphs.findIndex(e=>e.id===r);if(-1===l)return e;let d={type:n,from:a,to:i,...s&&{attrs:s}},c=[...e.sections[o].paragraphs[l].marks,d];return this.updateParagraph(e,t,r,{marks:c})}removeTextMark(e,t,r,n,a,i){let s=e.sections.findIndex(e=>e.id===t);if(-1===s)return e;let o=e.sections[s].paragraphs.findIndex(e=>e.id===r);if(-1===o)return e;let l=e.sections[s].paragraphs[o].marks.filter(e=>e.type!==n||e.from!==a||e.to!==i);return this.updateParagraph(e,t,r,{marks:l})}splitParagraph(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return e;let i=e.sections[a].paragraphs.findIndex(e=>e.id===r);if(-1===i)return e;let s=e.sections[a].paragraphs[i],o=s.text.substring(0,n),l=s.marks.filter(e=>e.from<n).map(e=>({...e,to:Math.min(e.to,n)})),d=s.text.substring(n),c=s.marks.filter(e=>e.to>n).map(e=>({...e,from:Math.max(e.from-n,0),to:e.to-n})),h=this.updateParagraph(e,t,r,{text:o,marks:l}),p={id:u(),type:s.type,text:d,marks:c,level:s.level};return this.insertParagraph(h,t,i+1,p)}mergeParagraphs(e,t,r,n){let a=e.sections.findIndex(e=>e.id===t);if(-1===a)return e;let i=e.sections[a],s=i.paragraphs.findIndex(e=>e.id===r),o=i.paragraphs.findIndex(e=>e.id===n);if(-1===s||-1===o||o!==s+1)return e;let l=i.paragraphs[s],d=i.paragraphs[o],c=l.text+d.text,h=d.marks.map(e=>({...e,from:e.from+l.text.length,to:e.to+l.text.length})),u=[...l.marks,...h],p=this.updateParagraph(e,t,r,{text:c,marks:u});return this.removeParagraph(p,t,n,o)}}let f=new m;var I=r(8159);class v{initialize(e,t,r){this.model=e,this.editorElement=t,this.onChangeCallback=r||null,I.A.initialize(t,e),I.A.fullRender(e),this.attachEventListeners()}updateModel(e){this.model=e,I.A.fullRender(e)}attachEventListeners(){this.editorElement&&(this.editorElement.setAttribute("contenteditable","true"),this.editorElement.setAttribute("spellcheck","true"),this.editorElement.addEventListener("keydown",this.handleKeyDown),document.addEventListener("selectionchange",this.handleSelectionChange),this.editorElement.addEventListener("focus",this.handleFocus),this.editorElement.addEventListener("blur",this.handleBlur),this.editorElement.addEventListener("input",this.handleInput),this.editorElement.addEventListener("click",this.handleClick),this.editorElement.addEventListener("paste",this.handlePaste))}destroy(){this.editorElement&&(this.editorElement.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("selectionchange",this.handleSelectionChange),this.editorElement.removeEventListener("focus",this.handleFocus),this.editorElement.removeEventListener("blur",this.handleBlur),this.editorElement.removeEventListener("input",this.handleInput),this.editorElement.removeEventListener("click",this.handleClick),this.editorElement.removeEventListener("paste",this.handlePaste))}handleEnterKey(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.findCursorOffsetInParagraph();if(null===e)return;let t=f.splitParagraph(this.model,this.currentSectionId,this.currentParagraphId,e),r=t.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===r)return;let n=t.sections[r].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===n||n+1>=t.sections[r].paragraphs.length)return;let a=t.sections[r].paragraphs[n+1].id;this.model=t,I.A.fullRender(t),this.setCursorPosition(a,0),this.notifyChange()}handleBackspaceAtStart(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||0===t)return;let r=this.model.sections[e].paragraphs[t-1],n=r.text.length,a=f.mergeParagraphs(this.model,this.currentSectionId,r.id,this.currentParagraphId);this.model=a,I.A.fullRender(a),this.setCursorPosition(r.id,n),this.currentParagraphId=r.id,this.notifyChange()}handleDeleteAtEnd(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=this.model.sections.findIndex(e=>e.id===this.currentSectionId);if(-1===e)return;let t=this.model.sections[e].paragraphs.findIndex(e=>e.id===this.currentParagraphId);if(-1===t||t>=this.model.sections[e].paragraphs.length-1)return;let r=this.model.sections[e].paragraphs[t].text.length,n=this.model.sections[e].paragraphs[t+1],a=f.mergeParagraphs(this.model,this.currentSectionId,this.currentParagraphId,n.id);this.model=a,I.A.fullRender(a),this.setCursorPosition(this.currentParagraphId,r),this.notifyChange()}toggleFormat(e){let t;if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let r=window.getSelection();if(!r||r.isCollapsed)return;let{startOffset:n,endOffset:a}=this.getSelectionOffsets();if(null===n||null===a)return;let i=this.findParagraphById(this.currentParagraphId);if(!i)return;let s=i.marks.find(t=>t.type===e&&t.from<=n&&t.to>=a);t=s?f.removeTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,s.from,s.to):f.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,e,n,a),this.model=t,I.A.fullRender(t),this.setTextSelection(this.currentParagraphId,n,a),this.notifyChange()}insertLink(){if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let e=window.getSelection();if(!e||e.isCollapsed)return;let{startOffset:t,endOffset:r}=this.getSelectionOffsets();if(null===t||null===r)return;let n=window.prompt("Enter URL:");if(!n)return;let a=f.addTextMark(this.model,this.currentSectionId,this.currentParagraphId,"link",t,r,{href:n});this.model=a,I.A.fullRender(a),this.setTextSelection(this.currentParagraphId,t,r),this.notifyChange()}updateCurrentParagraphAndSection(){let e=window.getSelection();if(!e||!e.anchorNode){this.currentParagraphId=null,this.currentSectionId=null;return}let t=e.anchorNode.nodeType===Node.ELEMENT_NODE?e.anchorNode:e.anchorNode.parentElement;for(;t&&!t.hasAttribute("data-paragraph-id");)t=t.parentElement;if(!t){this.currentParagraphId=null,this.currentSectionId=null;return}this.currentParagraphId=t.getAttribute("data-paragraph-id");let r=t.parentElement;for(;r&&!r.hasAttribute("data-section-id");)r=r.parentElement;if(!r){this.currentSectionId=null;return}this.currentSectionId=r.getAttribute("data-section-id")}isAtStartOfParagraph(){let e=window.getSelection();return!!e&&!!e.anchorNode&&!!e.isCollapsed&&(e.anchorNode.nodeType===Node.TEXT_NODE,0===e.anchorOffset)}isAtEndOfParagraph(){let e=window.getSelection();if(!e||!e.anchorNode||!e.isCollapsed)return!1;if(e.anchorNode.nodeType===Node.TEXT_NODE){var t;return e.anchorOffset===(null==(t=e.anchorNode.textContent)?void 0:t.length)}let r=e.anchorNode;return e.anchorOffset===r.childNodes.length}findCursorOffsetInParagraph(){var e;if(!this.currentParagraphId||!this.model)return null;let t=window.getSelection();if(!t||!t.isCollapsed)return null;let r=this.findParagraphById(this.currentParagraphId);if(!r)return null;let n=document.querySelector('[data-paragraph-id="'.concat(this.currentParagraphId,'"]'));return n?(null==(e=t.anchorNode)?void 0:e.nodeType)===Node.TEXT_NODE&&t.anchorNode.parentNode===n?t.anchorOffset:r.text.length:null}findParagraphById(e){if(!this.model)return null;for(let t of this.model.sections){let r=t.paragraphs.find(t=>t.id===e);if(r)return r}return null}setCursorPosition(e,t){let r=document.querySelector('[data-paragraph-id="'.concat(e,'"]'));if(!r)return;let n=document.createRange(),a=window.getSelection();0===t?(n.setStart(r,0),n.collapse(!0)):(n.selectNodeContents(r),n.collapse(!1)),a&&(a.removeAllRanges(),a.addRange(n))}setTextSelection(e,t,r){let n=document.querySelector('[data-paragraph-id="'.concat(e,'"]'));if(!n)return;let a=document.createRange(),i=window.getSelection();a.selectNodeContents(n),i&&(i.removeAllRanges(),i.addRange(a))}getSelectionOffsets(){return{startOffset:0,endOffset:0}}notifyChange(){this.onChangeCallback&&this.model&&this.onChangeCallback(this.model)}constructor(){this.model=null,this.editorElement=null,this.selectionState={anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!0},this.onChangeCallback=null,this.focusedElement=null,this.currentParagraphId=null,this.currentSectionId=null,this.handleKeyDown=e=>{if(this.model)switch(this.updateCurrentParagraphAndSection(),e.key){case"Enter":e.shiftKey||(e.preventDefault(),this.handleEnterKey());break;case"Backspace":this.isAtStartOfParagraph()&&(e.preventDefault(),this.handleBackspaceAtStart());break;case"Delete":this.isAtEndOfParagraph()&&(e.preventDefault(),this.handleDeleteAtEnd());break;case"b":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("bold"));break;case"i":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("italic"));break;case"`":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFormat("code"));break;case"k":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.insertLink())}},this.handleSelectionChange=()=>{let e=window.getSelection();e&&(this.selectionState={anchorNode:e.anchorNode,anchorOffset:e.anchorOffset,focusNode:e.focusNode,focusOffset:e.focusOffset,isCollapsed:e.isCollapsed},this.updateCurrentParagraphAndSection())},this.handleFocus=e=>{this.focusedElement=e.target,this.updateCurrentParagraphAndSection()},this.handleBlur=()=>{this.focusedElement=null},this.handleInput=e=>{if(!this.model||!this.currentParagraphId||!this.currentSectionId)return;let t=e.target.textContent||"",r={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:t}},n=f.applyOperation(this.model,r);this.model=n,this.notifyChange()},this.handleClick=()=>{this.updateCurrentParagraphAndSection()},this.handlePaste=e=>{if(e.preventDefault(),!this.model||!this.currentParagraphId||!this.currentSectionId||!e.clipboardData)return;let t=e.clipboardData.getData("text/plain"),r=window.getSelection();if(!r||!r.rangeCount)return;r.getRangeAt(0);let n=this.findParagraphById(this.currentParagraphId);if(!n)return;let a=this.findCursorOffsetInParagraph();if(null===a)return;let i=n.text.substring(0,a)+t+n.text.substring(a),s={type:"UPDATE_PARAGRAPH",sectionId:this.currentSectionId,paragraphId:this.currentParagraphId,updates:{text:i}},o=f.applyOperation(this.model,s);this.model=o,I.A.applyOperation(o,s),this.notifyChange(),this.setCursorPosition(this.currentParagraphId,a+t.length)}}}let C=new v;var x=r(1999),y=r.n(x);let S=e=>{let{articleId:t,initialHtml:r="",onChange:n}=e,s=(0,i.useRef)(null),[o,l]=(0,i.useState)(!1),[d,c]=(0,i.useState)({id:t,title:"",sections:[{id:u(),type:"section",paragraphs:[{id:u(),type:"paragraph",text:"",marks:[]}]}]});(0,i.useEffect)(()=>{if(s.current&&!o){if(r&&r.trim())try{let e=r.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),n=document.createElement("div");n.innerHTML=e;let a=Array.from(n.children).map(e=>{let t=e.tagName.toLowerCase(),r="paragraph";"h1"===t||"h2"===t||"h3"===t?r="heading":"blockquote"===t?r="blockquote":"ul"===t?r="bulletList":"ol"===t?r="orderedList":"li"===t?r="listItem":"img"===t&&(r="image");let n=e.textContent||"",a=[];e.querySelector("strong, b")&&a.push({type:"bold",from:0,to:n.length}),e.querySelector("em, i")&&a.push({type:"italic",from:0,to:n.length});let i={id:u(),type:r,text:n,marks:a};return"heading"===r&&("h1"===t?i.level=1:"h2"===t?i.level=2:"h3"===t&&(i.level=3)),"image"===r&&(i.src=e.getAttribute("src")||""),i});0===a.length&&a.push({id:u(),type:"paragraph",text:"",marks:[]});let i={id:t,title:"",sections:[{id:u(),type:"section",paragraphs:a}]};c(i)}catch(e){console.error("Error parsing initial HTML:",e)}return setTimeout(()=>{if(s.current){if(s.current.innerHTML="",C.initialize(d,s.current,h),r&&r.trim()){let e=r.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,"");s.current.innerHTML=e;let t=document.createRange(),n=window.getSelection();if(s.current.childNodes.length>0){let e=s.current.lastChild;e&&(t.setStartAfter(e),t.collapse(!0),n&&(n.removeAllRanges(),n.addRange(t)))}}else s.current.innerHTML="<p><br></p>";l(!0)}},50),()=>{C.destroy()}}},[t,r]);let h=e=>{c(e),n&&s.current&&n(s.current.innerHTML.replace(/<div[^>]*>Content is loaded from HTML<\/div>/g,"").replace(/<h1[^>]*>Untitled Article<\/h1>/g,""),e)},p=e=>{document.execCommand("formatBlock",!1,"h".concat(e)),s.current&&s.current.focus()};return(0,a.jsxs)("div",{className:y().articleEditor,children:[(0,a.jsxs)("div",{className:y().toolbar,children:[(0,a.jsx)("button",{className:y().toolbarButton,onClick:()=>{document.execCommand("bold",!1),s.current&&s.current.focus()},title:"Bold (Ctrl+B)",children:"B"}),(0,a.jsx)("button",{className:y().toolbarButton,onClick:()=>{document.execCommand("italic",!1),s.current&&s.current.focus()},title:"Italic (Ctrl+I)",children:"I"}),(0,a.jsx)("button",{className:y().toolbarButton,onClick:()=>p(1),title:"Heading 1",children:"H1"}),(0,a.jsx)("button",{className:y().toolbarButton,onClick:()=>p(2),title:"Heading 2",children:"H2"}),(0,a.jsx)("button",{className:y().toolbarButton,onClick:()=>p(3),title:"Heading 3",children:"H3"})]}),(0,a.jsx)("div",{ref:s,className:y().editorContent,contentEditable:!0,"aria-label":"Article editor",suppressContentEditableWarning:!0,onFocus:()=>{if(s.current&&""===s.current.innerHTML){s.current.innerHTML="<p><br></p>";let e=document.createRange(),t=window.getSelection(),r=s.current.querySelector("p");r&&(e.setStart(r,0),e.collapse(!0),t&&(t.removeAllRanges(),t.addRange(e)))}},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){e.preventDefault(),document.execCommand("insertParagraph",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).startContainer.parentElement;e&&"div"===e.tagName.toLowerCase()&&document.execCommand("formatBlock",!1,"p")}return s.current&&n&&n(s.current.innerHTML,d),!1}},onPaste:e=>{var t,r;if("true"===(null==(t=e.nativeEvent.clipboardData)?void 0:t.getData("text/html-editor-match-style"))||(null==(r=e.nativeEvent.clipboardData)?void 0:r.types.includes("text/html-editor-match-style"))){e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}s.current&&n&&setTimeout(()=>{s.current&&n(s.current.innerHTML,d)},0)}})]})};var _=r(9396),E=r.n(_);let A=e=>{let{articleId:t}=e,r=(0,s.useRouter)(),[n,o]=(0,i.useState)(""),[l,d]=(0,i.useState)(""),[c,h]=(0,i.useState)([]),[m,f]=(0,i.useState)(""),[I,v]=(0,i.useState)(!1),[C,x]=(0,i.useState)(!1),[y,_]=(0,i.useState)(!1),[A,P]=(0,i.useState)(""),[b,w]=(0,i.useState)(!!t),[N,k]=(0,i.useState)(null),[T,R]=(0,i.useState)(""),[L,D]=(0,i.useState)(null),B=(0,i.useRef)(null),O=(0,i.useRef)(null),j=(0,i.useCallback)(()=>{B.current&&(B.current.style.height="auto",B.current.style.height="".concat(B.current.scrollHeight,"px"),!n&&B.current&&B.current.focus())},[n]);(0,i.useEffect)(()=>{let e=g.j2.onAuthStateChanged(e=>{k(e),e||r.push("/login?redirect=compose")});return()=>e()},[r]),(0,i.useEffect)(()=>{t&&N?(async()=>{try{w(!0);let e=await (0,p.zE)(t);if(!e){P("Article not found"),r.push("/");return}if(e.authorId!==N.uid){P("You can only edit your own articles"),r.push("/");return}o(e.title);let n=e.body.replace(/data-[\w-]+="[^"]*"/g,"");d(n),h(e.tags||[]),f(e.coverImage||"");let a={id:t,title:e.title,sections:[{id:u(),type:"section",paragraphs:[]}]};D(a)}catch(e){console.error("Error loading article:",e),P("Failed to load article")}finally{w(!1)}})():t||D({id:u(),title:"",sections:[{id:u(),type:"section",paragraphs:[{id:u(),type:"paragraph",text:"",marks:[]}]}]})},[t,N,r]),(0,i.useEffect)(()=>{j()},[n,j]),(0,i.useEffect)(()=>{let e;return N&&n.trim()&&l.trim()&&!C&&!I&&(e=setTimeout(()=>{U("drafts")},3e4)),()=>{e&&clearTimeout(e)}},[N,n,l,C,I]);let H=()=>{let e=T.trim().toLowerCase();e&&!c.includes(e)&&c.length<5&&(h([...c,e]),R(""))},M=e=>{h(c.filter(t=>t!==e))},K=(0,i.useRef)(null),U=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"drafts";if(!N)return void P("You must be logged in to save an article");if(!n.trim())return void P("Title is required");if(!l.trim())return void P("Content is required");try{x(!0),P("");let a=l.replace(/data-[\w-]+="[^"]*"/g,""),i={title:n.trim(),body:a,tags:c,coverImage:m.trim(),status:e};if(console.log("Saving article data:",i),t)await (0,p.iZ)(t,i),"published"===e?(_(!0),setTimeout(()=>{r.push("/articles/".concat(t))},1e3)):(_(!0),setTimeout(()=>_(!1),3e3));else{let t=await (0,p.N6)(i);"published"===e?r.push("/articles/".concat(t.id)):r.push("/dashboard")}}catch(e){console.error("Error saving article:",e),P("Failed to save article. Please try again.")}finally{x(!1),v(!1)}},q=async()=>{if(!l.trim())return void P("Content is required");v(!0),await U("published")},V=async()=>{await U("drafts")};return b?(0,a.jsxs)("div",{className:E().composerLoading,children:[(0,a.jsx)("div",{className:E().loadingIndicator}),(0,a.jsx)("p",{children:"Loading article..."})]}):(0,a.jsxs)("div",{className:E().articleComposer,children:[(0,a.jsxs)("header",{className:E().composerHeader,children:[(0,a.jsx)("div",{className:E().logoContainer,children:(0,a.jsx)("div",{className:E().logo,children:"Journalite"})}),(0,a.jsxs)("div",{className:E().actionButtons,children:[y&&(0,a.jsxs)("span",{className:E().savedIndicator,children:[(0,a.jsx)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"Saved"]}),(0,a.jsx)("button",{className:E().actionButton,onClick:V,disabled:C||I,children:"Save draft"}),(0,a.jsx)("button",{className:E().publishButton,onClick:q,disabled:C||I||!n.trim()||!l.trim(),children:t?"Update":"Publish"})]})]}),(0,a.jsxs)("main",{className:E().composerContent,children:[(0,a.jsx)("textarea",{ref:B,className:E().titleInput,value:n,onChange:e=>{o(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),K.current&&K.current.focus())},placeholder:"Title",rows:1}),(0,a.jsxs)("div",{className:E().coverImageInput,children:[(0,a.jsx)("input",{type:"text",value:m,onChange:e=>{f(e.target.value)},placeholder:"Add a cover image (enter image URL)",className:E().imageUrlInput}),m&&(0,a.jsx)("div",{className:E().coverImagePreview,children:(0,a.jsx)("img",{src:m,alt:"Cover preview"})})]}),(0,a.jsxs)("div",{className:E().tagContainer,children:[c.map(e=>(0,a.jsxs)("div",{className:E().tag,children:[e,(0,a.jsx)("button",{className:E().removeTagButton,onClick:()=>M(e),"aria-label":"Remove ".concat(e," tag"),children:"\xd7"})]},e)),c.length<5&&(0,a.jsx)("input",{ref:O,type:"text",value:T,onChange:e=>{R(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),H())},onBlur:H,placeholder:0===c.length?"Add up to 5 tags...":"Add another tag...",className:E().tagInput})]}),A&&(0,a.jsx)("div",{className:E().errorMessage,children:A}),L&&(0,a.jsx)("div",{className:E().editorContainer,ref:K,children:(0,a.jsx)(S,{articleId:L.id,initialHtml:l,onChange:(e,t)=>{e!==l&&(d(e),D(t),y&&_(!1))}})})]})]})}},9396:e=>{e.exports={articleComposer:"ArticleComposer_articleComposer__NKNNz",composerHeader:"ArticleComposer_composerHeader__WxKaK",logoContainer:"ArticleComposer_logoContainer__9JBIu",logo:"ArticleComposer_logo__83mXS",actionButtons:"ArticleComposer_actionButtons__LvipB",actionButton:"ArticleComposer_actionButton__bgiC0",publishButton:"ArticleComposer_publishButton__eU1uK",savedIndicator:"ArticleComposer_savedIndicator__cBs7G",fadeIn:"ArticleComposer_fadeIn__YzYAJ",composerContent:"ArticleComposer_composerContent__e1ngn",titleInput:"ArticleComposer_titleInput__8eRxt",coverImageInput:"ArticleComposer_coverImageInput__ADPNp",imageUrlInput:"ArticleComposer_imageUrlInput__vYpqn",coverImagePreview:"ArticleComposer_coverImagePreview__gNa8V",tagContainer:"ArticleComposer_tagContainer__I_881",tag:"ArticleComposer_tag__kZ61S",removeTagButton:"ArticleComposer_removeTagButton__P2zqg",tagInput:"ArticleComposer_tagInput__SZSrz",editorContainer:"ArticleComposer_editorContainer__s8Tk_",errorMessage:"ArticleComposer_errorMessage__dg7w6",composerLoading:"ArticleComposer_composerLoading__RrK_T",loadingIndicator:"ArticleComposer_loadingIndicator__i6fhy",spin:"ArticleComposer_spin__WCbXX"}}}]);